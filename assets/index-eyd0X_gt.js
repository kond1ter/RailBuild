(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))C(E);new MutationObserver(E=>{for(const A of E)if(A.type==="childList")for(const T of A.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&C(T)}).observe(document,{childList:!0,subtree:!0});function _(E){const A={};return E.integrity&&(A.integrity=E.integrity),E.referrerPolicy&&(A.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?A.credentials="include":E.crossOrigin==="anonymous"?A.credentials="omit":A.credentials="same-origin",A}function C(E){if(E.ep)return;E.ep=!0;const A=_(E);fetch(E.href,A)}})();const lp=!1;var Pp=Array.isArray,Ay=Array.prototype.indexOf,Sp=Array.from,zy=Object.defineProperty,$o=Object.getOwnPropertyDescriptor,Dy=Object.getOwnPropertyDescriptors,Ly=Object.prototype,Ry=Array.prototype,Zm=Object.getPrototypeOf;function Fy(p){return typeof p=="function"}const xc=()=>{};function By(p){return typeof(p==null?void 0:p.then)=="function"}function Oy(p){for(var y=0;y<p.length;y++)p[y]()}const pn=2,Gm=4,Cp=8,Lh=16,_s=32,Bc=64,wh=128,Gr=256,Th=512,Cr=1024,ys=2048,Ko=4096,fs=8192,Rh=16384,Hm=32768,Fh=65536,jy=1<<17,Wm=1<<19,Xm=1<<20,Pc=Symbol("$state"),Ny=Symbol("legacy props"),Vy=Symbol("");function Km(p){return p===this.v}function Uy(p,y){return p!=p?y==y:p!==y||p!==null&&typeof p=="object"||typeof p=="function"}function Mp(p){return!Uy(p,this.v)}function $y(p){throw new Error("https://svelte.dev/e/effect_in_teardown")}function qy(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Zy(p){throw new Error("https://svelte.dev/e/effect_orphan")}function Gy(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Hy(p){throw new Error("https://svelte.dev/e/props_invalid_value")}function Wy(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Xy(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ky(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Yy(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Yo=!1,Jy=!1;function Qy(){Yo=!0}const Ip=1,Ep=2,Ym=4,ev=8,tv=16,iv=1,rv=2,nv=4,sv=8,av=16,ov=4,lv=1,cv=2,sr=Symbol();function uv(p){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let ui=null;function Ph(p){ui=p}function Jo(p,y=!1,_){ui={p:ui,c:null,e:null,m:!1,s:p,x:null,l:null},Yo&&!y&&(ui.l={s:null,u:null,r1:[],r2:gr(!1)})}function Qo(p){const y=ui;if(y!==null){const T=y.e;if(T!==null){var _=Vt,C=Gt;y.e=null;try{for(var E=0;E<T.length;E++){var A=T[E];Wr(A.effect),Hr(A.reaction),jh(A.fn)}}finally{Wr(_),Hr(C)}}ui=y.p,y.m=!0}return{}}function Oc(){return!Yo||ui!==null&&ui.l===null}function gr(p,y){var _={f:0,v:p,reactions:null,equals:Km,rv:0,wv:0};return _}function Sc(p){return hv(gr(p))}function Sh(p,y=!1){var C;const _=gr(p);return y||(_.equals=Mp),Yo&&ui!==null&&ui.l!==null&&((C=ui.l).s??(C.s=[])).push(_),_}function hv(p){return Gt!==null&&!An&&Gt.f&pn&&(zn===null?Tv([p]):zn.push(p)),p}function Ai(p,y){return Gt!==null&&!An&&Oc()&&Gt.f&(pn|Lh)&&(zn===null||!zn.includes(p))&&Yy(),qo(p,y)}function qo(p,y){return p.equals(y)||(p.v,p.v=y,p.wv=gg(),Jm(p,ys),Oc()&&Vt!==null&&Vt.f&Cr&&!(Vt.f&(_s|Bc))&&(hs===null?Pv([p]):hs.push(p))),y}function Jm(p,y){var _=p.reactions;if(_!==null)for(var C=Oc(),E=_.length,A=0;A<E;A++){var T=_[A],o=T.f;o&ys||!C&&T===Vt||(ms(T,y),o&(Cr|Gr)&&(o&pn?Jm(T,Ko):Uh(T)))}}let Qm=!1;function yr(p,y=null,_){if(typeof p!="object"||p===null||Pc in p)return p;const C=Zm(p);if(C!==Ly&&C!==Ry)return p;var E=new Map,A=Pp(p),T=gr(0);A&&E.set("length",gr(p.length));var o;return new Proxy(p,{defineProperty(he,se,fe){(!("value"in fe)||fe.configurable===!1||fe.enumerable===!1||fe.writable===!1)&&Wy();var xe=E.get(se);return xe===void 0?(xe=gr(fe.value),E.set(se,xe)):Ai(xe,yr(fe.value,o)),!0},deleteProperty(he,se){var fe=E.get(se);if(fe===void 0)se in he&&E.set(se,gr(sr));else{if(A&&typeof se=="string"){var xe=E.get("length"),ie=Number(se);Number.isInteger(ie)&&ie<xe.v&&Ai(xe,ie)}Ai(fe,sr),Tm(T)}return!0},get(he,se,fe){var ge;if(se===Pc)return p;var xe=E.get(se),ie=se in he;if(xe===void 0&&(!ie||(ge=$o(he,se))!=null&&ge.writable)&&(xe=gr(yr(ie?he[se]:sr,o)),E.set(se,xe)),xe!==void 0){var K=ht(xe);return K===sr?void 0:K}return Reflect.get(he,se,fe)},getOwnPropertyDescriptor(he,se){var fe=Reflect.getOwnPropertyDescriptor(he,se);if(fe&&"value"in fe){var xe=E.get(se);xe&&(fe.value=ht(xe))}else if(fe===void 0){var ie=E.get(se),K=ie==null?void 0:ie.v;if(ie!==void 0&&K!==sr)return{enumerable:!0,configurable:!0,value:K,writable:!0}}return fe},has(he,se){var K;if(se===Pc)return!0;var fe=E.get(se),xe=fe!==void 0&&fe.v!==sr||Reflect.has(he,se);if(fe!==void 0||Vt!==null&&(!xe||(K=$o(he,se))!=null&&K.writable)){fe===void 0&&(fe=gr(xe?yr(he[se],o):sr),E.set(se,fe));var ie=ht(fe);if(ie===sr)return!1}return xe},set(he,se,fe,xe){var rt;var ie=E.get(se),K=se in he;if(A&&se==="length")for(var ge=fe;ge<ie.v;ge+=1){var Oe=E.get(ge+"");Oe!==void 0?Ai(Oe,sr):ge in he&&(Oe=gr(sr),E.set(ge+"",Oe))}ie===void 0?(!K||(rt=$o(he,se))!=null&&rt.writable)&&(ie=gr(void 0),Ai(ie,yr(fe,o)),E.set(se,ie)):(K=ie.v!==sr,Ai(ie,yr(fe,o)));var He=Reflect.getOwnPropertyDescriptor(he,se);if(He!=null&&He.set&&He.set.call(xe,fe),!K){if(A&&typeof se=="string"){var Ze=E.get("length"),Re=Number(se);Number.isInteger(Re)&&Re>=Ze.v&&Ai(Ze,Re+1)}Tm(T)}return!0},ownKeys(he){ht(T);var se=Reflect.ownKeys(he).filter(ie=>{var K=E.get(ie);return K===void 0||K.v!==sr});for(var[fe,xe]of E)xe.v!==sr&&!(fe in he)&&se.push(fe);return se},setPrototypeOf(){Xy()}})}function Tm(p,y=1){Ai(p,p.v+y)}var Pm,eg,tg,ig,rg;function dv(){if(Pm===void 0){Pm=window,eg=document,tg=/Firefox/.test(navigator.userAgent);var p=Element.prototype,y=Node.prototype;ig=$o(y,"firstChild").get,rg=$o(y,"nextSibling").get,p.__click=void 0,p.__className="",p.__attributes=null,p.__styles=null,p.__e=void 0,Text.prototype.__t=void 0}}function Bh(p=""){return document.createTextNode(p)}function Ch(p){return ig.call(p)}function Oh(p){return rg.call(p)}function Si(p,y){return Ch(p)}function Ic(p,y){{var _=Ch(p);return _ instanceof Comment&&_.data===""?Oh(_):_}}function Yi(p,y=1,_=!1){let C=p;for(;y--;)C=Oh(C);return C}function pv(p){p.textContent=""}function Ho(p){var y=pn|ys,_=Gt!==null&&Gt.f&pn?Gt:null;return Vt===null||_!==null&&_.f&Gr?y|=Gr:Vt.f|=Xm,{ctx:ui,deps:null,effects:null,equals:Km,f:y,fn:p,reactions:null,rv:0,v:null,wv:0,parent:_??Vt}}function ng(p){const y=Ho(p);return y.equals=Mp,y}function sg(p){var y=p.effects;if(y!==null){p.effects=null;for(var _=0;_<y.length;_+=1)Qs(y[_])}}function fv(p){for(var y=p.parent;y!==null;){if(!(y.f&pn))return y;y=y.parent}return null}function mv(p){var y,_=Vt;Wr(fv(p));try{sg(p),y=yg(p)}finally{Wr(_)}return y}function ag(p){var y=mv(p),_=(Ks||p.f&Gr)&&p.deps!==null?Ko:Cr;ms(p,_),p.equals(y)||(p.v=y,p.wv=gg())}function gv(p){Vt===null&&Gt===null&&Zy(),Gt!==null&&Gt.f&Gr&&Vt===null&&qy(),Ap&&$y()}function _v(p,y){var _=y.last;_===null?y.last=y.first=p:(_.next=p,p.prev=_,y.last=p)}function jc(p,y,_,C=!0){var E=(p&Bc)!==0,A=Vt,T={ctx:ui,deps:null,nodes_start:null,nodes_end:null,f:p|ys,first:null,fn:y,last:null,next:null,parent:E?null:A,prev:null,teardown:null,transitions:null,wv:0};if(_){var o=Zo;try{Sm(!0),zp(T),T.f|=Hm}catch(fe){throw Qs(T),fe}finally{Sm(o)}}else y!==null&&Uh(T);var he=_&&T.deps===null&&T.first===null&&T.nodes_start===null&&T.teardown===null&&(T.f&(Xm|wh))===0;if(!he&&!E&&C&&(A!==null&&_v(T,A),Gt!==null&&Gt.f&pn)){var se=Gt;(se.effects??(se.effects=[])).push(T)}return T}function og(p){gv();var y=Vt!==null&&(Vt.f&_s)!==0&&ui!==null&&!ui.m;if(y){var _=ui;(_.e??(_.e=[])).push({fn:p,effect:Vt,reaction:Gt})}else{var C=jh(p);return C}}function yv(p){const y=jc(Bc,p,!0);return(_={})=>new Promise(C=>{_.outro?Na(y,()=>{Qs(y),C(void 0)}):(Qs(y),C(void 0))})}function jh(p){return jc(Gm,p,!1)}function vv(p){return jc(Cp,p,!0)}function Js(p,y=[],_=Ho){const C=y.map(_);return Nc(()=>p(...C.map(ht)))}function Nc(p,y=0){return jc(Cp|Lh|y,p,!0)}function Va(p,y=!0){return jc(Cp|_s,p,!0,y)}function lg(p){var y=p.teardown;if(y!==null){const _=Ap,C=Gt;Cm(!0),Hr(null);try{y.call(null)}finally{Cm(_),Hr(C)}}}function cg(p,y=!1){var _=p.first;for(p.first=p.last=null;_!==null;){var C=_.next;Qs(_,y),_=C}}function bv(p){for(var y=p.first;y!==null;){var _=y.next;y.f&_s||Qs(y),y=_}}function Qs(p,y=!0){var _=!1;if((y||p.f&Wm)&&p.nodes_start!==null){for(var C=p.nodes_start,E=p.nodes_end;C!==null;){var A=C===E?null:Oh(C);C.remove(),C=A}_=!0}cg(p,y&&!_),Eh(p,0),ms(p,Rh);var T=p.transitions;if(T!==null)for(const he of T)he.stop();lg(p);var o=p.parent;o!==null&&o.first!==null&&ug(p),p.next=p.prev=p.teardown=p.ctx=p.deps=p.fn=p.nodes_start=p.nodes_end=null}function ug(p){var y=p.parent,_=p.prev,C=p.next;_!==null&&(_.next=C),C!==null&&(C.prev=_),y!==null&&(y.first===p&&(y.first=C),y.last===p&&(y.last=_))}function Na(p,y){var _=[];kp(p,_,!0),hg(_,()=>{Qs(p),y&&y()})}function hg(p,y){var _=p.length;if(_>0){var C=()=>--_||y();for(var E of p)E.out(C)}else y()}function kp(p,y,_){if(!(p.f&fs)){if(p.f^=fs,p.transitions!==null)for(const T of p.transitions)(T.is_global||_)&&y.push(T);for(var C=p.first;C!==null;){var E=C.next,A=(C.f&Fh)!==0||(C.f&_s)!==0;kp(C,y,A?_:!1),C=E}}}function Wo(p){dg(p,!0)}function dg(p,y){if(p.f&fs){p.f^=fs,p.f&Cr||(p.f^=Cr),Vc(p)&&(ms(p,ys),Uh(p));for(var _=p.first;_!==null;){var C=_.next,E=(_.f&Fh)!==0||(_.f&_s)!==0;dg(_,E?y:!1),_=C}if(p.transitions!==null)for(const A of p.transitions)(A.is_global||y)&&A.in()}}let Mh=!1,cp=[];function pg(){Mh=!1;const p=cp.slice();cp=[],Oy(p)}function Nh(p){Mh||(Mh=!0,queueMicrotask(pg)),cp.push(p)}function xv(){Mh&&pg()}const fg=0,wv=1;let mh=!1,gh=fg,Ec=!1,kc=null,Zo=!1,Ap=!1;function Sm(p){Zo=p}function Cm(p){Ap=p}let Oa=[],Go=0;let Gt=null,An=!1;function Hr(p){Gt=p}let Vt=null;function Wr(p){Vt=p}let zn=null;function Tv(p){zn=p}let _r=null,Or=0,hs=null;function Pv(p){hs=p}let mg=1,Ih=0,Ks=!1;function gg(){return++mg}function Vc(p){var xe;var y=p.f;if(y&ys)return!0;if(y&Ko){var _=p.deps,C=(y&Gr)!==0;if(_!==null){var E,A,T=(y&Th)!==0,o=C&&Vt!==null&&!Ks,he=_.length;if(T||o){var se=p,fe=se.parent;for(E=0;E<he;E++)A=_[E],(T||!((xe=A==null?void 0:A.reactions)!=null&&xe.includes(se)))&&(A.reactions??(A.reactions=[])).push(se);T&&(se.f^=Th),o&&fe!==null&&!(fe.f&Gr)&&(se.f^=Gr)}for(E=0;E<he;E++)if(A=_[E],Vc(A)&&ag(A),A.wv>p.wv)return!0}(!C||Vt!==null&&!Ks)&&ms(p,Cr)}return!1}function Sv(p,y){for(var _=y;_!==null;){if(_.f&wh)try{_.fn(p);return}catch{_.f^=wh}_=_.parent}throw mh=!1,p}function Cv(p){return(p.f&Rh)===0&&(p.parent===null||(p.parent.f&wh)===0)}function Vh(p,y,_,C){if(mh){if(_===null&&(mh=!1),Cv(y))throw p;return}_!==null&&(mh=!0);{Sv(p,y);return}}function _g(p,y,_=!0){var C=p.reactions;if(C!==null)for(var E=0;E<C.length;E++){var A=C[E];A.f&pn?_g(A,y,!1):y===A&&(_?ms(A,ys):A.f&Cr&&ms(A,Ko),Uh(A))}}function yg(p){var K;var y=_r,_=Or,C=hs,E=Gt,A=Ks,T=zn,o=ui,he=An,se=p.f;_r=null,Or=0,hs=null,Gt=se&(_s|Bc)?null:p,Ks=(se&Gr)!==0&&(!Zo||E===null||he),zn=null,Ph(p.ctx),An=!1,Ih++;try{var fe=(0,p.fn)(),xe=p.deps;if(_r!==null){var ie;if(Eh(p,Or),xe!==null&&Or>0)for(xe.length=Or+_r.length,ie=0;ie<_r.length;ie++)xe[Or+ie]=_r[ie];else p.deps=xe=_r;if(!Ks)for(ie=Or;ie<xe.length;ie++)((K=xe[ie]).reactions??(K.reactions=[])).push(p)}else xe!==null&&Or<xe.length&&(Eh(p,Or),xe.length=Or);if(Oc()&&hs!==null&&!An&&xe!==null&&!(p.f&(pn|Ko|ys)))for(ie=0;ie<hs.length;ie++)_g(hs[ie],p);return E!==null&&Ih++,fe}finally{_r=y,Or=_,hs=C,Gt=E,Ks=A,zn=T,Ph(o),An=he}}function Mv(p,y){let _=y.reactions;if(_!==null){var C=Ay.call(_,p);if(C!==-1){var E=_.length-1;E===0?_=y.reactions=null:(_[C]=_[E],_.pop())}}_===null&&y.f&pn&&(_r===null||!_r.includes(y))&&(ms(y,Ko),y.f&(Gr|Th)||(y.f^=Th),sg(y),Eh(y,0))}function Eh(p,y){var _=p.deps;if(_!==null)for(var C=y;C<_.length;C++)Mv(p,_[C])}function zp(p){var y=p.f;if(!(y&Rh)){ms(p,Cr);var _=Vt,C=ui;Vt=p;try{y&Lh?bv(p):cg(p),lg(p);var E=yg(p);p.teardown=typeof E=="function"?E:null,p.wv=mg;var A=p.deps,T;lp&&Jy&&p.f&ys}catch(o){Vh(o,p,_,C||p.ctx)}finally{Vt=_}}}function vg(){if(Go>1e3){Go=0;try{Gy()}catch(p){if(kc!==null)Vh(p,kc,null);else throw p}}Go++}function bg(p){var y=p.length;if(y!==0){vg();var _=Zo;Zo=!0;try{for(var C=0;C<y;C++){var E=p[C];E.f&Cr||(E.f^=Cr);var A=kv(E);Iv(A)}}finally{Zo=_}}}function Iv(p){var y=p.length;if(y!==0)for(var _=0;_<y;_++){var C=p[_];if(!(C.f&(Rh|fs)))try{Vc(C)&&(zp(C),C.deps===null&&C.first===null&&C.nodes_start===null&&(C.teardown===null?ug(C):C.fn=null))}catch(E){Vh(E,C,null,C.ctx)}}}function Ev(){if(Ec=!1,Go>1001)return;const p=Oa;Oa=[],bg(p),Ec||(Go=0,kc=null)}function Uh(p){gh===fg&&(Ec||(Ec=!0,queueMicrotask(Ev))),kc=p;for(var y=p;y.parent!==null;){y=y.parent;var _=y.f;if(_&(Bc|_s)){if(!(_&Cr))return;y.f^=Cr}}Oa.push(y)}function kv(p){var y=[],_=p.first;e:for(;_!==null;){var C=_.f,E=(C&_s)!==0,A=E&&(C&Cr)!==0,T=_.next;if(!A&&!(C&fs)){if(C&Gm)y.push(_);else if(E)_.f^=Cr;else{var o=Gt;try{Gt=_,Vc(_)&&zp(_)}catch(fe){Vh(fe,_,null,_.ctx)}finally{Gt=o}}var he=_.first;if(he!==null){_=he;continue}}if(T===null){let fe=_.parent;for(;fe!==null;){if(p===fe)break e;var se=fe.next;if(se!==null){_=se;continue e}fe=fe.parent}}_=T}return y}function xg(p){var y=gh,_=Oa;try{vg();const E=[];gh=wv,Oa=E,Ec=!1,bg(_);var C=p==null?void 0:p();return xv(),(Oa.length>0||E.length>0)&&xg(),Go=0,kc=null,C}finally{gh=y,Oa=_}}function ht(p){var y=p.f,_=(y&pn)!==0;if(Gt!==null&&!An){zn!==null&&zn.includes(p)&&Ky();var C=Gt.deps;p.rv<Ih&&(p.rv=Ih,_r===null&&C!==null&&C[Or]===p?Or++:_r===null?_r=[p]:(!Ks||!_r.includes(p))&&_r.push(p))}else if(_&&p.deps===null&&p.effects===null){var E=p,A=E.parent;A!==null&&!(A.f&Gr)&&(E.f^=Gr)}return _&&(E=p,Vc(E)&&ag(E)),p.v}function Ac(p){var y=An;try{return An=!0,p()}finally{An=y}}const Av=-7169;function ms(p,y){p.f=p.f&Av|y}const zv=["touchstart","touchmove"];function Dv(p){return zv.includes(p)}function Lv(p){var y=Gt,_=Vt;Hr(null),Wr(null);try{return p()}finally{Hr(y),Wr(_)}}const wg=new Set,up=new Set;function Dp(p){for(var y=0;y<p.length;y++)wg.add(p[y]);for(var _ of up)_(p)}function uh(p){var Re;var y=this,_=y.ownerDocument,C=p.type,E=((Re=p.composedPath)==null?void 0:Re.call(p))||[],A=E[0]||p.target,T=0,o=p.__root;if(o){var he=E.indexOf(o);if(he!==-1&&(y===document||y===window)){p.__root=y;return}var se=E.indexOf(y);if(se===-1)return;he<=se&&(T=he)}if(A=E[T]||p.target,A!==y){zy(p,"currentTarget",{configurable:!0,get(){return A||_}});var fe=Gt,xe=Vt;Hr(null),Wr(null);try{for(var ie,K=[];A!==null;){var ge=A.assignedSlot||A.parentNode||A.host||null;try{var Oe=A["__"+C];if(Oe!==void 0&&!A.disabled)if(Pp(Oe)){var[He,...Ze]=Oe;He.apply(A,[p,...Ze])}else Oe.call(A,p)}catch(rt){ie?K.push(rt):ie=rt}if(p.cancelBubble||ge===y||ge===null)break;A=ge}if(ie){for(let rt of K)queueMicrotask(()=>{throw rt});throw ie}}finally{p.__root=y,delete p.currentTarget,Hr(fe),Wr(xe)}}}function Rv(p){var y;y=document.head.appendChild(Bh());try{Nc(()=>p(y),Wm)}finally{}}function Fv(p){var y=document.createElement("template");return y.innerHTML=p,y.content}function hp(p,y){var _=Vt;_.nodes_start===null&&(_.nodes_start=p,_.nodes_end=y)}function Ji(p,y){var _=(y&lv)!==0,C=(y&cv)!==0,E,A=!p.startsWith("<!>");return()=>{E===void 0&&(E=Fv(A?p:"<!>"+p),_||(E=Ch(E)));var T=C||tg?document.importNode(E,!0):E.cloneNode(!0);if(_){var o=Ch(T),he=T.lastChild;hp(o,he)}else hp(T,T);return T}}function Bv(){var p=document.createDocumentFragment(),y=document.createComment(""),_=Bh();return p.append(y,_),hp(y,_),p}function Gi(p,y){p!==null&&p.before(y)}let dp=!0;function kh(p,y){var _=y==null?"":typeof y=="object"?y+"":y;_!==(p.__t??(p.__t=p.nodeValue))&&(p.__t=_,p.nodeValue=_+"")}function Ov(p,y){return jv(p,y)}const Vo=new Map;function jv(p,{target:y,anchor:_,props:C={},events:E,context:A,intro:T=!0}){dv();var o=new Set,he=xe=>{for(var ie=0;ie<xe.length;ie++){var K=xe[ie];if(!o.has(K)){o.add(K);var ge=Dv(K);y.addEventListener(K,uh,{passive:ge});var Oe=Vo.get(K);Oe===void 0?(document.addEventListener(K,uh,{passive:ge}),Vo.set(K,1)):Vo.set(K,Oe+1)}}};he(Sp(wg)),up.add(he);var se=void 0,fe=yv(()=>{var xe=_??y.appendChild(Bh());return Va(()=>{if(A){Jo({});var ie=ui;ie.c=A}E&&(C.$$events=E),dp=T,se=p(xe,C)||{},dp=!0,A&&Qo()}),()=>{var ge;for(var ie of o){y.removeEventListener(ie,uh);var K=Vo.get(ie);--K===0?(document.removeEventListener(ie,uh),Vo.delete(ie)):Vo.set(ie,K)}up.delete(he),xe!==_&&((ge=xe.parentNode)==null||ge.removeChild(xe))}});return Nv.set(se,fe),se}let Nv=new WeakMap;const ip=0,hh=1,rp=2;function Vv(p,y,_,C,E){var A=p,T=Oc(),o=ui,he=sr,se,fe,xe,ie=(T?gr:Sh)(void 0),K=(T?gr:Sh)(void 0),ge=!1;function Oe(Ze,Re){ge=!0,Re&&(Wr(He),Hr(He),Ph(o));try{Ze===ip&&_&&(se?Wo(se):se=Va(()=>_(A))),Ze===hh&&C&&(fe?Wo(fe):fe=Va(()=>C(A,ie))),Ze!==ip&&se&&Na(se,()=>se=null),Ze!==hh&&fe&&Na(fe,()=>fe=null),Ze!==rp&&xe&&Na(xe,()=>xe=null)}finally{Re&&(Ph(null),Hr(null),Wr(null),xg())}}var He=Nc(()=>{if(he!==(he=y())){if(By(he)){var Ze=he;ge=!1,Ze.then(Re=>{Ze===he&&(qo(ie,Re),Oe(hh,!0))},Re=>{if(Ze===he)throw qo(K,Re),Oe(rp,!0),K.v}),Nh(()=>{ge||Oe(ip,!0)})}else qo(ie,he),Oe(hh,!1);return()=>he=sr}})}function Lp(p,y,_=!1){var C=p,E=null,A=null,T=sr,o=_?Fh:0,he=!1;const se=(xe,ie=!0)=>{he=!0,fe(ie,xe)},fe=(xe,ie)=>{T!==(T=xe)&&(T?(E?Wo(E):ie&&(E=Va(()=>ie(C))),A&&Na(A,()=>{A=null})):(A?Wo(A):ie&&(A=Va(()=>ie(C))),E&&Na(E,()=>{E=null})))};Nc(()=>{he=!1,y(se),he||fe(null,null)},o)}function Tg(p,y){return y}function Uv(p,y,_,C){for(var E=[],A=y.length,T=0;T<A;T++)kp(y[T].e,E,!0);var o=A>0&&E.length===0&&_!==null;if(o){var he=_.parentNode;pv(he),he.append(_),C.clear(),Ws(p,y[0].prev,y[A-1].next)}hg(E,()=>{for(var se=0;se<A;se++){var fe=y[se];o||(C.delete(fe.k),Ws(p,fe.prev,fe.next)),Qs(fe.e,!o)}})}function pp(p,y,_,C,E,A=null){var T=p,o={flags:y,items:new Map,first:null},he=(y&Ym)!==0;if(he){var se=p;T=se.appendChild(Bh())}var fe=null,xe=!1,ie=ng(()=>{var K=_();return Pp(K)?K:K==null?[]:Sp(K)});Nc(()=>{var K=ht(ie),ge=K.length;xe&&ge===0||(xe=ge===0,$v(K,o,T,E,y,C,_),A!==null&&(ge===0?fe?Wo(fe):fe=Va(()=>A(T)):fe!==null&&Na(fe,()=>{fe=null})),ht(ie))})}function $v(p,y,_,C,E,A,T){var mi,fn,It,Xr;var o=(E&ev)!==0,he=(E&(Ip|Ep))!==0,se=p.length,fe=y.items,xe=y.first,ie=xe,K,ge=null,Oe,He=[],Ze=[],Re,rt,Je,lt;if(o)for(lt=0;lt<se;lt+=1)Re=p[lt],rt=A(Re,lt),Je=fe.get(rt),Je!==void 0&&((mi=Je.a)==null||mi.measure(),(Oe??(Oe=new Set)).add(Je));for(lt=0;lt<se;lt+=1){if(Re=p[lt],rt=A(Re,lt),Je=fe.get(rt),Je===void 0){var ft=ie?ie.e.nodes_start:_;ge=Zv(ft,y,ge,ge===null?y.first:ge.next,Re,rt,lt,C,E,T),fe.set(rt,ge),He=[],Ze=[],ie=ge.next;continue}if(he&&qv(Je,Re,lt,E),Je.e.f&fs&&(Wo(Je.e),o&&((fn=Je.a)==null||fn.unfix(),(Oe??(Oe=new Set)).delete(Je))),Je!==ie){if(K!==void 0&&K.has(Je)){if(He.length<Ze.length){var et=Ze[0],ct;ge=et.prev;var kt=He[0],Qi=He[He.length-1];for(ct=0;ct<He.length;ct+=1)Mm(He[ct],et,_);for(ct=0;ct<Ze.length;ct+=1)K.delete(Ze[ct]);Ws(y,kt.prev,Qi.next),Ws(y,ge,kt),Ws(y,Qi,et),ie=et,ge=Qi,lt-=1,He=[],Ze=[]}else K.delete(Je),Mm(Je,ie,_),Ws(y,Je.prev,Je.next),Ws(y,Je,ge===null?y.first:ge.next),Ws(y,ge,Je),ge=Je;continue}for(He=[],Ze=[];ie!==null&&ie.k!==rt;)ie.e.f&fs||(K??(K=new Set)).add(ie),Ze.push(ie),ie=ie.next;if(ie===null)continue;Je=ie}He.push(Je),ge=Je,ie=Je.next}if(ie!==null||K!==void 0){for(var Ci=K===void 0?[]:Sp(K);ie!==null;)ie.e.f&fs||Ci.push(ie),ie=ie.next;var zi=Ci.length;if(zi>0){var er=E&Ym&&se===0?_:null;if(o){for(lt=0;lt<zi;lt+=1)(It=Ci[lt].a)==null||It.measure();for(lt=0;lt<zi;lt+=1)(Xr=Ci[lt].a)==null||Xr.fix()}Uv(y,Ci,er,fe)}}o&&Nh(()=>{var Mr;if(Oe!==void 0)for(Je of Oe)(Mr=Je.a)==null||Mr.apply()}),Vt.first=y.first&&y.first.e,Vt.last=ge&&ge.e}function qv(p,y,_,C){C&Ip&&qo(p.v,y),C&Ep?qo(p.i,_):p.i=_}function Zv(p,y,_,C,E,A,T,o,he,se){var fe=(he&Ip)!==0,xe=(he&tv)===0,ie=fe?xe?Sh(E):gr(E):E,K=he&Ep?gr(T):T,ge={i:K,v:ie,k:A,a:null,e:null,prev:_,next:C};try{return ge.e=Va(()=>o(p,ie,K,se),Qm),ge.e.prev=_&&_.e,ge.e.next=C&&C.e,_===null?y.first=ge:(_.next=ge,_.e.next=ge.e),C!==null&&(C.prev=ge,C.e.prev=ge.e),ge}finally{}}function Mm(p,y,_){for(var C=p.next?p.next.e.nodes_start:_,E=y?y.e.nodes_start:_,A=p.e.nodes_start;A!==C;){var T=Oh(A);E.before(A),A=T}}function Ws(p,y,_){y===null?p.first=_:(y.next=_,y.e.next=_&&_.e),_!==null&&(_.prev=y,_.e.prev=y&&y.e)}function Cc(p,y,_,C){var E=p.__attributes??(p.__attributes={});E[y]!==(E[y]=_)&&(y==="style"&&"__styles"in p&&(p.__styles={}),y==="loading"&&(p[Vy]=_),_==null?p.removeAttribute(y):typeof _!="string"&&Gv(p).includes(y)?p[y]=_:p.setAttribute(y,_))}var Im=new Map;function Gv(p){var y=Im.get(p.nodeName);if(y)return y;Im.set(p.nodeName,y=[]);for(var _,C=p,E=Element.prototype;E!==C;){_=Dy(C);for(var A in _)_[A].set&&y.push(A);C=Zm(C)}return y}function zc(p,y,_){var C=p.__className,E=Hv(y);(C!==E||Qm)&&(y==null?p.removeAttribute("class"):p.className=E,p.__className=E)}function Hv(p,y){return(p??"")+""}const Wv=()=>performance.now(),ds={tick:p=>requestAnimationFrame(p),now:()=>Wv(),tasks:new Set};function Pg(){const p=ds.now();ds.tasks.forEach(y=>{y.c(p)||(ds.tasks.delete(y),y.f())}),ds.tasks.size!==0&&ds.tick(Pg)}function Xv(p){let y;return ds.tasks.size===0&&ds.tick(Pg),{promise:new Promise(_=>{ds.tasks.add(y={c:p,f:_})}),abort(){ds.tasks.delete(y)}}}function dh(p,y){Lv(()=>{p.dispatchEvent(new CustomEvent(y))})}function Kv(p){if(p==="float")return"cssFloat";if(p==="offset")return"cssOffset";if(p.startsWith("--"))return p;const y=p.split("-");return y.length===1?y[0]:y[0]+y.slice(1).map(_=>_[0].toUpperCase()+_.slice(1)).join("")}function Em(p){const y={},_=p.split(";");for(const C of _){const[E,A]=C.split(":");if(!E||A===void 0)break;const T=Kv(E.trim());y[T]=A.trim()}return y}const Yv=p=>p;function fp(p,y,_,C){var E=(p&ov)!==0,A="both",T,o=y.inert,he=y.style.overflow,se,fe;function xe(){var He=Gt,Ze=Vt;Hr(null),Wr(null);try{return T??(T=_()(y,(C==null?void 0:C())??{},{direction:A}))}finally{Hr(He),Wr(Ze)}}var ie={is_global:E,in(){y.inert=o,dh(y,"introstart"),se=mp(y,xe(),fe,1,()=>{dh(y,"introend"),se==null||se.abort(),se=T=void 0,y.style.overflow=he})},out(He){y.inert=!0,dh(y,"outrostart"),fe=mp(y,xe(),se,0,()=>{dh(y,"outroend"),He==null||He()})},stop:()=>{se==null||se.abort(),fe==null||fe.abort()}},K=Vt;if((K.transitions??(K.transitions=[])).push(ie),dp){var ge=E;if(!ge){for(var Oe=K.parent;Oe&&Oe.f&Fh;)for(;(Oe=Oe.parent)&&!(Oe.f&Lh););ge=!Oe||(Oe.f&Hm)!==0}ge&&jh(()=>{Ac(()=>ie.in())})}}function mp(p,y,_,C,E){var A=C===1;if(Fy(y)){var T,o=!1;return Nh(()=>{if(!o){var He=y({direction:A?"in":"out"});T=mp(p,He,_,C,E)}}),{abort:()=>{o=!0,T==null||T.abort()},deactivate:()=>T.deactivate(),reset:()=>T.reset(),t:()=>T.t()}}if(_==null||_.deactivate(),!(y!=null&&y.duration))return E(),{abort:xc,deactivate:xc,reset:xc,t:()=>C};const{delay:he=0,css:se,tick:fe,easing:xe=Yv}=y;var ie=[];if(A&&_===void 0&&(fe&&fe(0,1),se)){var K=Em(se(0,1));ie.push(K,K)}var ge=()=>1-C,Oe=p.animate(ie,{duration:he});return Oe.onfinish=()=>{var He=(_==null?void 0:_.t())??1-C;_==null||_.abort();var Ze=C-He,Re=y.duration*Math.abs(Ze),rt=[];if(Re>0){var Je=!1;if(se)for(var lt=Math.ceil(Re/16.666666666666668),ft=0;ft<=lt;ft+=1){var et=He+Ze*xe(ft/lt),ct=Em(se(et,1-et));rt.push(ct),Je||(Je=ct.overflow==="hidden")}Je&&(p.style.overflow="hidden"),ge=()=>{var kt=Oe.currentTime;return He+Ze*xe(kt/Re)},fe&&Xv(()=>{if(Oe.playState!=="running")return!1;var kt=ge();return fe(kt,1-kt),!0})}Oe=p.animate(rt,{duration:Re,fill:"forwards"}),Oe.onfinish=()=>{ge=()=>C,fe==null||fe(C,1-C),E()}},{abort:()=>{Oe&&(Oe.cancel(),Oe.effect=null,Oe.onfinish=xc)},deactivate:()=>{E=xc},reset:()=>{C===0&&(fe==null||fe(1,0))},t:()=>ge()}}function km(p,y){return p===y||(p==null?void 0:p[Pc])===y}function _h(p={},y,_,C){return jh(()=>{var E,A;return vv(()=>{E=A,A=[],Ac(()=>{p!==_(...A)&&(y(p,...A),E&&km(_(...E),p)&&y(null,...E))})}),()=>{Nh(()=>{A&&km(_(...A),p)&&y(null,...A)})}}),p}let ph=!1;function Jv(p){var y=ph;try{return ph=!1,[p(),ph]}finally{ph=y}}function $h(p,y,_,C){var ft;var E=(_&iv)!==0,A=!Yo||(_&rv)!==0,T=(_&sv)!==0,o=(_&av)!==0,he=!1,se;T?[se,he]=Jv(()=>p[y]):se=p[y];var fe=Pc in p||Ny in p,xe=T&&(((ft=$o(p,y))==null?void 0:ft.set)??(fe&&y in p&&(et=>p[y]=et)))||void 0,ie=C,K=!0,ge=!1,Oe=()=>(ge=!0,K&&(K=!1,o?ie=Ac(C):ie=C),ie);se===void 0&&C!==void 0&&(xe&&A&&Hy(),se=Oe(),xe&&xe(se));var He;if(A)He=()=>{var et=p[y];return et===void 0?Oe():(K=!0,ge=!1,et)};else{var Ze=(E?Ho:ng)(()=>p[y]);Ze.f|=jy,He=()=>{var et=ht(Ze);return et!==void 0&&(ie=void 0),et===void 0?ie:et}}if(!(_&nv))return He;if(xe){var Re=p.$$legacy;return function(et,ct){return arguments.length>0?((!A||!ct||Re||he)&&xe(ct?He():et),et):He()}}var rt=!1,Je=Sh(se),lt=Ho(()=>{var et=He(),ct=ht(Je);return rt?(rt=!1,ct):Je.v=et});return E||(lt.equals=Mp),function(et,ct){if(arguments.length>0){const kt=ct?ht(lt):A&&T?yr(et):et;return lt.equals(kt)||(rt=!0,Ai(Je,kt),ge&&ie!==void 0&&(ie=kt),Ac(()=>ht(lt))),et}return ht(lt)}}function Rp(p){ui===null&&uv(),Yo&&ui.l!==null?Qv(ui).m.push(p):og(()=>{const y=Ac(p);if(typeof y=="function")return y})}function Qv(p){var y=p.l;return y.u??(y.u={a:[],b:[],m:[]})}const e0="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(e0);const t0=p=>p;function i0(p){const y=p-1;return y*y*y+1}function Am(p){const y=typeof p=="string"&&p.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return y?[parseFloat(y[1]),y[2]||"px"]:[p,"px"]}function zm(p,{delay:y=0,duration:_=400,easing:C=t0}={}){const E=+getComputedStyle(p).opacity;return{delay:y,duration:_,easing:C,css:A=>`opacity: ${A*E}`}}function r0(p,{delay:y=0,duration:_=400,easing:C=i0,x:E=0,y:A=0,opacity:T=0}={}){const o=getComputedStyle(p),he=+o.opacity,se=o.transform==="none"?"":o.transform,fe=he*(1-T),[xe,ie]=Am(E),[K,ge]=Am(A);return{delay:y,duration:_,easing:C,css:(Oe,He)=>`
			transform: ${se} translate(${(1-Oe)*xe}${ie}, ${(1-Oe)*K}${ge});
			opacity: ${he-fe*He}`}}const Dm="/assets/thumb1-BgbfEqun.png",Lm="/assets/thumb2-DsRbuYBa.png",n0="/assets/thumb3-CtkJ2QwG.png",s0="/assets/thumb4-Dh05XWcZ.png",Uo="/assets/rail-build-vid-B1v--xHu.mp4",a0=async()=>new Promise(p=>{setTimeout(()=>{p(l0)},0)}),o0=async()=>new Promise(p=>{setTimeout(()=>{p(c0)},0)}),l0=[{id:0,thumbUrl:Dm,videoUrl:Uo,title:"Строительство ВСМ1 или 5 и 6 пути примыкание к ГХ ОКТ ЖД около Радищево",formatedDate:"23 августа 2024"},{id:1,thumbUrl:Lm,videoUrl:Uo,title:"Строительство ВСМ1 или 5 и 6 пути примыкание к ГХ ОКТ ЖД около Радищево",formatedDate:"1 августа 2024"},{id:2,thumbUrl:n0,videoUrl:Uo,formatedDate:"14 июля 2024"},{id:3,thumbUrl:s0,videoUrl:Uo,formatedDate:"7 июня 2024"},{id:4,thumbUrl:Dm,videoUrl:Uo,formatedDate:"23 августа 2024"},{id:5,thumbUrl:Lm,videoUrl:Uo,formatedDate:"1 августа 2024"}],c0={type:"FeatureCollection",features:[{type:"Feature",properties:{"@id":"way/60277128",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"110",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.8879197,56.8369449],[35.8882175,56.8368313]]},id:"way/60277128"},{type:"Feature",properties:{"@id":"way/98715299",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"1",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.0455204,56.7535081],[36.0489686,56.7515365],[36.0514978,56.7502855],[36.0534506,56.7494417],[36.0546253,56.7489341],[36.0667794,56.7442239],[36.0710202,56.7425803],[36.0800855,56.7390428],[36.0891724,56.7354965],[36.0934356,56.7338469],[36.1068225,56.7286558],[36.120164,56.7234885],[36.1275685,56.7206311],[36.1307409,56.7193983],[36.131325,56.7191713],[36.1324645,56.7187285],[36.1334541,56.7183439],[36.138224,56.7164947],[36.1387311,56.7162962],[36.1400653,56.7157781],[36.1411873,56.7153424],[36.1417566,56.7151213],[36.1428843,56.7146816],[36.1439192,56.7142816],[36.1446326,56.7140048],[36.1453541,56.7137248],[36.1460881,56.7134454],[36.1469036,56.7131431],[36.1475623,56.7129094],[36.1483153,56.7126516],[36.1490777,56.7123988],[36.1498294,56.7121625],[36.1506005,56.7119266],[36.1513811,56.7116988],[36.1521649,56.711475],[36.1530132,56.7112468],[36.1536911,56.7110728],[36.1545099,56.71087],[36.1554104,56.7106561],[36.1564357,56.7104272],[36.1573134,56.7102436],[36.1578499,56.7101342],[36.1583072,56.7100444],[36.159311,56.7098575],[36.1603242,56.7096815],[36.1613394,56.709517],[36.161725,56.7094581],[36.1623647,56.7093654],[36.163392,56.7092252],[36.164423,56.709096],[36.1654606,56.7089738],[36.1664933,56.708853],[36.1675286,56.7087334],[36.1747679,56.7078942],[36.1774526,56.7076145],[36.1776409,56.7075928],[36.1777385,56.7075816],[36.1936576,56.7057522],[36.199099,56.7051268],[36.2005386,56.7049562],[36.201987,56.7047846],[36.2048859,56.7044477],[36.209644,56.7038932],[36.210707,56.7037732],[36.2170914,56.7030479],[36.2197483,56.7027391],[36.2220043,56.7024766],[36.224847,56.7021329],[36.2256104,56.7020238],[36.2280973,56.7016685],[36.2315884,56.701034],[36.2352995,56.7001986],[36.2389902,56.6991855],[36.2406426,56.6986125],[36.2422517,56.6980545],[36.2459176,56.6965803],[36.2532898,56.6937135]]},id:"way/98715299"},{type:"Feature",properties:{"@id":"way/159080386",branch:"ОКТ",bridge:"yes",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",layer:"1",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"2",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.9497842,56.8130603],[35.9500989,56.8129363]]},id:"way/159080386"},{type:"Feature",properties:{"@id":"way/159080388",branch:"ОКТ",bridge:"yes",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",layer:"1",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"1",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.9497084,56.8129996],[35.9500233,56.8128722]]},id:"way/159080388"},{type:"Feature",properties:{"@id":"way/159080950",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"2",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.315057,56.621352],[36.3169985,56.6204445],[36.3254705,56.6160605],[36.3307912,56.6133069],[36.3354217,56.6109287],[36.3356549,56.610809],[36.3373875,56.6099198],[36.3439307,56.6065612],[36.3493081,56.6037916],[36.3540556,56.6013462],[36.3550906,56.6008131]]},id:"way/159080950"},{type:"Feature",properties:{"@id":"way/159132560",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"I",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.2532898,56.6937135],[36.2539981,56.6934291],[36.2614265,56.6904885],[36.2632562,56.6897523],[36.26445,56.6892454],[36.2655001,56.6887863],[36.266433,56.688355],[36.2670568,56.6880417],[36.267333,56.687903],[36.268372,56.687352],[36.269596,56.686663],[36.270746,56.685971],[36.271421,56.68555],[36.272293,56.684963],[36.273312,56.684255],[36.273814,56.683876],[36.274381,56.683429],[36.2745958,56.6832572],[36.275026,56.682913],[36.275706,56.682344],[36.276504,56.681645],[36.277013,56.681167],[36.2771864,56.6809983],[36.2772474,56.6809389],[36.27739,56.6808],[36.277921,56.680231],[36.278568,56.67953],[36.278982,56.679047],[36.279464,56.678469],[36.280105,56.677635],[36.280431,56.677165],[36.28096,56.67637],[36.281318,56.67579],[36.281568,56.675372],[36.2817924,56.6749384],[36.281978,56.67458],[36.282339,56.673839],[36.282575,56.673331],[36.282913,56.672581],[36.2829795,56.672439],[36.283173,56.672026],[36.283473,56.671359],[36.283672,56.670964],[36.28392,56.670395],[36.28424,56.669735],[36.28449,56.669214],[36.284834,56.668493],[36.285211,56.66765],[36.285609,56.666806],[36.2857703,56.6664523],[36.28592,56.666124],[36.286352,56.665186],[36.286706,56.664398],[36.2869501,56.663865],[36.287103,56.66353],[36.287292,56.663141],[36.287555,56.662552],[36.287702,56.66224],[36.287957,56.661687],[36.288222,56.661111],[36.2885964,56.6602861],[36.2886618,56.6601419],[36.2889089,56.6595974],[36.2909548,56.6551623],[36.2928273,56.6511038],[36.2942038,56.6481254],[36.2946494,56.6471611],[36.2948871,56.6466901],[36.2949408,56.6465721],[36.294985,56.6464751],[36.295478,56.6454374],[36.2956101,56.6451419],[36.2958599,56.6445886],[36.2961054,56.6440446],[36.2989076,56.637998],[36.2993785,56.6369818],[36.2999003,56.6358514],[36.2999736,56.6356926]]},id:"way/159132560"},{type:"Feature",properties:{"@id":"way/159141417",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"1",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.2999736,56.6356926],[36.300336,56.634929],[36.30079,56.634009],[36.301237,56.633214],[36.3015,56.632776],[36.301927,56.63211],[36.302303,56.631564],[36.302793,56.630913],[36.303105,56.630517],[36.30358,56.629935],[36.3040168,56.629393],[36.304902,56.628481],[36.305511,56.627867],[36.305946,56.627458],[36.306417,56.627025],[36.307023,56.626496],[36.307476,56.626132],[36.308181,56.625554],[36.308716,56.625145],[36.309083,56.624874],[36.309674,56.624447],[36.31028,56.624022],[36.310889,56.623621],[36.311569,56.623196],[36.312262,56.622782],[36.313126,56.622301],[36.3134066,56.6221559],[36.313672,56.622019],[36.314649,56.621506],[36.314981,56.621341]]},id:"way/159141417"},{type:"Feature",properties:{"@id":"way/159141419",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"1",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.314981,56.621341],[36.3169523,56.6204165],[36.325424,56.6160327],[36.3307444,56.6132793],[36.3350358,56.6110764],[36.3353765,56.6109015],[36.3373392,56.6098938],[36.3438838,56.6065336],[36.3492568,56.6037662],[36.3540087,56.6013186],[36.3550437,56.6007855]]},id:"way/159141419"},{type:"Feature",properties:{"@id":"way/159141420",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"2",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.3000392,56.6357036],[36.300412,56.63494],[36.300866,56.63402],[36.301313,56.633225],[36.301576,56.632787],[36.302003,56.632121],[36.302379,56.631575],[36.302869,56.630924],[36.303181,56.630528],[36.303656,56.629946],[36.3040928,56.629404],[36.304978,56.628492],[36.305587,56.627878],[36.306022,56.627469],[36.306493,56.627036],[36.307099,56.626507],[36.307552,56.626143],[36.308257,56.625565],[36.308792,56.625156],[36.309159,56.624885],[36.30975,56.624458],[36.310356,56.624033],[36.310965,56.623632],[36.311645,56.623207],[36.312338,56.622793],[36.313202,56.622312],[36.3134537,56.622182],[36.313748,56.62203],[36.314725,56.621517],[36.315057,56.621352]]},id:"way/159141420"},{type:"Feature",properties:{"@id":"way/159141421",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"II",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.2885862,56.6604786],[36.2886668,56.6603044],[36.2887147,56.6602007],[36.288926,56.6597436],[36.2902468,56.6568874],[36.2910401,56.6551718],[36.2929132,56.6511203],[36.2944909,56.6477075],[36.2947591,56.6471274],[36.29482,56.6469794],[36.2949542,56.6466984],[36.2950557,56.6464858],[36.295536,56.6454467],[36.2959284,56.6445978],[36.2961796,56.6440543],[36.2989758,56.6380045],[36.2999667,56.6358605],[36.3000392,56.6357036]]},id:"way/159141421"},{type:"Feature",properties:{"@id":"way/159141423",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"2",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.0455712,56.7535387],[36.0489534,56.7516124],[36.0515699,56.7503133],[36.0535003,56.7494746],[36.05467,56.7489664],[36.0668283,56.7442546],[36.071063,56.7426134],[36.0801291,56.7390755],[36.0892151,56.7355296],[36.0934872,56.7338801],[36.1068657,56.7286929],[36.1202082,56.7235216],[36.1275997,56.7206634],[36.1302018,56.7196531],[36.1319304,56.7189819],[36.1324947,56.7187628],[36.13349,56.7183763],[36.1387727,56.7163258],[36.1394604,56.716058],[36.1400975,56.7158106],[36.1406485,56.7155967],[36.142379,56.7149247],[36.142929,56.7147112],[36.1439567,56.7143121],[36.1446755,56.7140335],[36.1453997,56.7137553],[36.1461298,56.7134785],[36.1469442,56.7131753],[36.1475966,56.7129417],[36.1483488,56.7126829],[36.1491106,56.7124319],[36.1498623,56.7121942],[36.1506327,56.7119601],[36.1514107,56.7117326],[36.1521938,56.7115126],[36.153044,56.711284],[36.1536375,56.7111305],[36.1545327,56.7109071],[36.1554345,56.7106948],[36.1564136,56.7104754],[36.1573409,56.71028],[36.1583307,56.7100798],[36.1593345,56.7098932],[36.1603403,56.7097195],[36.1613589,56.7095549],[36.1617411,56.7094968],[36.1623781,56.7094026],[36.1634054,56.7092634],[36.1644367,56.7091346],[36.165466,56.7090124],[36.1665018,56.708892],[36.1675427,56.7087713],[36.1747793,56.7079313],[36.1774624,56.707649],[36.1776448,56.7076279],[36.1777547,56.7076152],[36.1936691,56.7057751],[36.1990941,56.7051478],[36.2019937,56.7048045],[36.2048919,56.7044646],[36.2096598,56.7039124],[36.2107035,56.7037915],[36.2197584,56.7027684],[36.2220114,56.7025001],[36.2248555,56.7021675],[36.2256247,56.7020557],[36.2281107,56.7016945],[36.2316131,56.701071],[36.2353292,56.7002345],[36.2390255,56.6992199],[36.2406878,56.6986434],[36.2422921,56.6980871],[36.2459597,56.6966122],[36.2533559,56.693725]]},id:"way/159141423"},{type:"Feature",properties:{"@id":"way/159685183",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"110",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"I",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.8979122,56.8331442],[35.8983248,56.8330047],[35.9000451,56.8323747],[35.9015431,56.8317933],[35.9019969,56.8316077]]},id:"way/159685183"},{type:"Feature",properties:{"@id":"way/159685187",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"110",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"II",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.8575499,56.8494934],[35.85843,56.8490186],[35.8592344,56.8486132],[35.8615418,56.8475067],[35.8618715,56.8473486],[35.8622024,56.8471966],[35.8625544,56.8470452],[35.86314,56.8467885],[35.8638419,56.8464978],[35.8649238,56.8460735],[35.865807,56.8457384],[35.8659199,56.8456963],[35.8671635,56.8452331],[35.868228,56.8448165],[35.8689172,56.8445218],[35.8705508,56.8437387],[35.8712387,56.8434509],[35.8750302,56.8419687],[35.8771988,56.8411251],[35.8780079,56.8408126],[35.8788056,56.8405452],[35.8797334,56.8402432],[35.8804559,56.8400076],[35.8811627,56.8397681],[35.8820128,56.8394456],[35.8826072,56.8392166],[35.8832045,56.8389783]]},id:"way/159685187"},{type:"Feature",properties:{"@id":"way/159685190",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"110",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"1",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.8882175,56.8368313],[35.888942,56.8365554],[35.8894812,56.8363421],[35.8898983,56.8361794],[35.8907871,56.8358106],[35.8913507,56.8355916],[35.8919176,56.8353714],[35.8920477,56.8353213],[35.8925742,56.8351256],[35.8940621,56.8345563],[35.8956213,56.8339636],[35.8973099,56.8333564],[35.8979122,56.8331442]]},id:"way/159685190"},{type:"Feature",properties:{"@id":"way/159685195",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"110",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"1",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.8574445,56.8494411],[35.8583254,56.8489639],[35.8592637,56.8484591],[35.8595359,56.8483237],[35.8605935,56.8477975],[35.8617521,56.8472772],[35.862435,56.8469724],[35.8632974,56.8465978],[35.8637972,56.8463737],[35.8643411,56.8461487],[35.8647636,56.8459649],[35.8648582,56.8459244],[35.8657606,56.8455384],[35.8662521,56.8453141],[35.867396,56.8447726],[35.8679875,56.8444773],[35.8683465,56.8443052],[35.8694465,56.8437778],[35.8704606,56.8432796],[35.8709999,56.8430311],[35.8715381,56.8428123],[35.8726573,56.8423798],[35.8743005,56.8417398],[35.8751078,56.8414293],[35.8757605,56.8411724],[35.8765075,56.8408834],[35.8766264,56.8408373],[35.8775178,56.8404918],[35.8780348,56.8402963],[35.8791325,56.8399395],[35.8804495,56.8395358],[35.8819521,56.839085]]},id:"way/159685195"},{type:"Feature",properties:{"@id":"way/159685201",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"110",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"2",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.888732,56.8369154],[35.8890411,56.8367995],[35.8895991,56.8365941],[35.8915688,56.8358406],[35.8916602,56.8358046],[35.8927844,56.835362],[35.8937641,56.834979],[35.8963909,56.8338754],[35.8986765,56.8329448]]},id:"way/159685201"},{type:"Feature",properties:{"@id":"way/159685210",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"II",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.9411735,56.8163667],[35.9426421,56.8157994],[35.9452322,56.8147989],[35.9458922,56.8145486],[35.9461228,56.8144612],[35.9497842,56.8130603]]},id:"way/159685210"},{type:"Feature",properties:{"@id":"way/188134102",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"130",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"I",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.911628,56.827793],[35.916526,56.825893],[35.917888,56.82537],[35.9191361,56.8249296],[35.9214257,56.8240281],[35.921447,56.82402],[35.9220168,56.8238003],[35.925781,56.822349],[35.926364,56.82212],[35.926986,56.82188],[35.931289,56.82019],[35.9325081,56.8197072],[35.934246,56.819019],[35.93621,56.818256],[35.941135,56.816337]]},id:"way/188134102"},{type:"Feature",properties:{"@id":"way/383358083",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"130",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"II",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.9116668,56.8278226],[35.9165644,56.8259228],[35.9179261,56.8253999],[35.9191917,56.8249607],[35.9214852,56.8240499],[35.9215478,56.8240258],[35.922027,56.823841],[35.9258196,56.8223787],[35.9264026,56.8221497],[35.9270246,56.8219097],[35.9313279,56.8202196],[35.9325527,56.8197346],[35.9342848,56.8190486],[35.9362486,56.8182857],[35.9411735,56.8163667]]},id:"way/383358083"},{type:"Feature",properties:{"@id":"way/383358085",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"110",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"II",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.8986765,56.8329448],[35.8994703,56.8326441],[35.9005434,56.8322376],[35.9014098,56.8318913],[35.9026186,56.8314037],[35.9035721,56.8310325],[35.9042591,56.8307485],[35.9043608,56.8307085],[35.9049348,56.8304828],[35.906723,56.8297796],[35.9116668,56.8278226]]},id:"way/383358085"},{type:"Feature",properties:{"@id":"way/383358864",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"200",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"2",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.0383598,56.7591583],[36.0396406,56.7579153],[36.0406649,56.7570337],[36.0415363,56.7563336],[36.0421739,56.755847],[36.0422254,56.7558077],[36.0422856,56.7557645],[36.0429356,56.755276],[36.0455712,56.7535387]]},id:"way/383358864"},{type:"Feature",properties:{"@id":"way/383358865",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"2",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.9500989,56.8129363],[35.9519398,56.8122331],[35.9592414,56.8093579],[35.9725423,56.8041632],[35.978803,56.8017052],[35.9807042,56.8009776],[35.9823491,56.8003288],[35.9835371,56.7998697],[35.9842916,56.7995617],[35.9858894,56.7989307],[35.9979242,56.794218],[35.9992519,56.7937036],[35.9999174,56.7934239],[36.0002573,56.7932856],[36.002232,56.7924196],[36.0038072,56.7916631],[36.0058969,56.7905238],[36.00771,56.7894615],[36.0092048,56.7884845],[36.0101913,56.7877113],[36.0106864,56.7873512],[36.0119478,56.7863648],[36.013381,56.7850813],[36.0143408,56.7841505],[36.0150368,56.7834224],[36.0153511,56.7830837],[36.0157935,56.7826068],[36.0187458,56.7795955],[36.0211368,56.7770792],[36.0245982,56.7734969],[36.0264143,56.7715834],[36.0307459,56.7671806],[36.0340929,56.7636543],[36.0383598,56.7591583]]},id:"way/383358865"},{type:"Feature",properties:{"@id":"way/383359788",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"2",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.2533559,56.693725],[36.2540354,56.6934563],[36.263135,56.6898581],[36.2643926,56.689326],[36.26565,56.688777],[36.266509,56.688366],[36.2671022,56.6880681],[36.267409,56.687914],[36.268448,56.687363],[36.269672,56.686674],[36.270822,56.685982],[36.271497,56.685561],[36.272369,56.684974],[36.273388,56.684266],[36.27389,56.683887],[36.274457,56.68344],[36.2746965,56.6832484],[36.275102,56.682924],[36.275782,56.682355],[36.27658,56.681656],[36.277089,56.681178],[36.2773141,56.6809589],[36.277466,56.680811],[36.277997,56.680242],[36.278644,56.679541],[36.279058,56.679058],[36.27954,56.67848],[36.280181,56.677646],[36.280507,56.677176],[36.281036,56.676381],[36.281394,56.675801],[36.281644,56.675383],[36.2819132,56.6748629],[36.282054,56.674591],[36.282415,56.67385],[36.282651,56.673342],[36.282989,56.672592],[36.283057,56.6724468],[36.283249,56.672037],[36.283549,56.67137],[36.283748,56.670975],[36.283996,56.670406],[36.284316,56.669746],[36.284566,56.669225],[36.28491,56.668504],[36.285287,56.667661],[36.285685,56.666817],[36.2858485,56.6664584],[36.285996,56.666135],[36.286428,56.665197],[36.286782,56.664409],[36.2870244,56.6638789],[36.287179,56.663541],[36.287368,56.663152],[36.287631,56.662563],[36.287778,56.662251],[36.288033,56.661698],[36.288298,56.661122],[36.2885862,56.6604786]]},id:"way/383359788"},{type:"Feature",properties:{"@id":"way/1033312751",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"1",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.9500233,56.8128722],[35.951888,56.8121619],[35.9591763,56.8093204],[35.9724858,56.8041317],[35.9787764,56.8016766],[35.9806633,56.8009474],[35.9834863,56.7998374],[35.9858378,56.7988973],[35.9978677,56.7941821],[35.9991956,56.7936576],[35.9998424,56.793335],[35.999866,56.7933254],[36.0001748,56.7931997],[36.0021471,56.7923348],[36.0037191,56.7915798],[36.0058061,56.7904419],[36.0076168,56.789381],[36.0091088,56.7884059],[36.0101305,56.78768],[36.0106114,56.7873193],[36.0118475,56.7862895],[36.013279,56.7850075],[36.0142375,56.7840779],[36.0149327,56.7833507],[36.0152698,56.7829874],[36.0156895,56.782535],[36.018657,56.7795718],[36.0210331,56.777007],[36.0244945,56.7734247],[36.0263475,56.771562],[36.0306456,56.7671095],[36.0339725,56.7636239],[36.038282,56.7591344]]},id:"way/1033312751"},{type:"Feature",properties:{"@id":"way/1033312752",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"200",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"1",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[36.038282,56.7591344],[36.0395866,56.7578926],[36.0399135,56.7576125],[36.04095,56.7567296],[36.0414878,56.7563111],[36.042126,56.7558283],[36.0421775,56.7557893],[36.0422401,56.755744],[36.0429396,56.7552232],[36.0455204,56.7535081]]},id:"way/1033312752"},{type:"Feature",properties:{"@id":"way/1033312753",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"yes",maxspeed:"220",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"I",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.941135,56.816337],[35.9425845,56.815777],[35.945194,56.814769],[35.9458479,56.814521],[35.9460847,56.8144313],[35.9497084,56.8129996]]},id:"way/1033312753"},{type:"Feature",properties:{"@id":"way/1033312754",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"110",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"I",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.9019969,56.8316077],[35.90422,56.830719],[35.9048065,56.8304887],[35.9048964,56.8304534],[35.906684,56.82975],[35.911628,56.827793]]},id:"way/1033312754"},{type:"Feature",properties:{"@id":"way/1173037078",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"110",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"backward","railway:track_ref":"II",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.8832045,56.8389783],[35.8843374,56.8385306],[35.8850228,56.8382686],[35.8855941,56.838047],[35.8861175,56.8378597],[35.8873588,56.8374114],[35.8882471,56.8370888],[35.8884537,56.8370169],[35.888732,56.8369154]]},id:"way/1173037078"},{type:"Feature",properties:{"@id":"way/1173037082",branch:"ОКТ",electrified:"contact_line",frequency:"0",gauge:"1520",highspeed:"no",maxspeed:"110",operator:'ОАО "РЖД"',passenger_lines:"2",railway:"rail","railway:preferred_direction":"forward","railway:track_ref":"1",usage:"main",voltage:"3000"},geometry:{type:"LineString",coordinates:[[35.8819521,56.839085],[35.8831172,56.8387305],[35.8839802,56.8384601],[35.8845196,56.8382787],[35.8851215,56.8380629],[35.8859344,56.8377287],[35.8864565,56.8375328],[35.8867141,56.8374279],[35.8879197,56.8369449]]},id:"way/1173037082"}]};function u0(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var yh={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.1.0/LICENSE.txt
 */var h0=yh.exports,Rm;function d0(){return Rm||(Rm=1,function(p,y){(function(_,C){p.exports=C()})(h0,function(){var _={},C={};function E(T,o,he){if(C[T]=he,T==="index"){var se="var sharedModule = {}; ("+C.shared+")(sharedModule); ("+C.worker+")(sharedModule);",fe={};return C.shared(fe),C.index(_,fe),typeof window<"u"&&_.setWorkerUrl(window.URL.createObjectURL(new Blob([se],{type:"text/javascript"}))),_}}E("shared",["exports"],function(T){function o(n,t,r,s){return new(r||(r=Promise))(function(c,d){function f(w){try{b(s.next(w))}catch(S){d(S)}}function g(w){try{b(s.throw(w))}catch(S){d(S)}}function b(w){var S;w.done?c(w.value):(S=w.value,S instanceof r?S:new r(function(M){M(S)})).then(f,g)}b((s=s.apply(n,t||[])).next())})}function he(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var se,fe;function xe(){if(fe)return se;function n(t,r){this.x=t,this.y=r}return fe=1,se=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,s=t.y-this.y;return r*r+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),s=Math.sin(t),c=s*this.x+r*this.y;return this.x=r*this.x-s*this.y,this.y=c,this},_rotateAround:function(t,r){var s=Math.cos(t),c=Math.sin(t),d=r.y+c*(this.x-r.x)+s*(this.y-r.y);return this.x=r.x+s*(this.x-r.x)-c*(this.y-r.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t},se}typeof SuppressedError=="function"&&SuppressedError;var ie,K,ge=he(xe()),Oe=function(){if(K)return ie;function n(t,r,s,c){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=s,this.p2y=c}return K=1,ie=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var s=t,c=0;c<8;c++){var d=this.sampleCurveX(s)-t;if(Math.abs(d)<r)return s;var f=this.sampleCurveDerivativeX(s);if(Math.abs(f)<1e-6)break;s-=d/f}var g=0,b=1;for(s=t,c=0;c<20&&(d=this.sampleCurveX(s),!(Math.abs(d-t)<r));c++)t>d?g=s:b=s,s=.5*(b-g)+g;return s},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},ie}(),He=he(Oe);let Ze,Re;function rt(){return Ze==null&&(Ze=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ze}function Je(){if(Re==null&&(Re=!1,rt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let s=0;s<5*5;s++){const c=4*s;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(s%5,Math.floor(s/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){Re=!0;break}}}return Re||!1}var lt,ft=1e-6,et=typeof Float32Array<"u"?Float32Array:Array;function ct(){var n=new et(9);return et!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function kt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Qi(){var n=new et(3);return et!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Ci(n,t,r){var s=new et(3);return s[0]=n,s[1]=t,s[2]=r,s}function zi(n,t,r){var s=t[0],c=t[1],d=t[2],f=t[3];return n[0]=r[0]*s+r[4]*c+r[8]*d+r[12]*f,n[1]=r[1]*s+r[5]*c+r[9]*d+r[13]*f,n[2]=r[2]*s+r[6]*c+r[10]*d+r[14]*f,n[3]=r[3]*s+r[7]*c+r[11]*d+r[15]*f,n}function er(){var n=new et(4);return et!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function mi(){var n=new et(2);return et!=Float32Array&&(n[0]=0,n[1]=0),n}function fn(n,t){var r=new et(2);return r[0]=n,r[1]=t,r}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)}),Qi(),lt=new et(4),et!=Float32Array&&(lt[0]=0,lt[1]=0,lt[2]=0,lt[3]=0),Qi(),Ci(1,0,0),Ci(0,1,0),er(),er(),ct(),mi();const It=8192;function Xr(n,t,r){return t*(It/(n.tileSize*Math.pow(2,r-n.tileID.overscaledZ)))}function Mr(n,t){return(n%t+t)%t}function Dn(n,t,r){return n*(1-r)+t*r}function Ln(n){if(n<=0)return 0;if(n>=1)return 1;const t=n*n,r=t*n;return 4*(n<.5?r:3*(n-t)+r-.75)}function vs(n,t,r,s){const c=new He(n,t,r,s);return d=>c.solve(d)}const jr=vs(.25,.1,.25,1);function Ir(n,t,r){return Math.min(r,Math.max(t,n))}function vr(n,t,r){const s=r-t,c=((n-t)%s+s)%s+t;return c===t?r:c}function Di(n,...t){for(const r of t)for(const s in r)n[s]=r[s];return n}let Rn=1;function Fn(n,t,r){const s={};for(const c in n)s[c]=t.call(this,n[c],c,n);return s}function Bn(n,t,r){const s={};for(const c in n)t.call(this,n[c],c,n)&&(s[c]=n[c]);return s}function ar(n){return Array.isArray(n)?n.map(ar):typeof n=="object"&&n?Fn(n,ar):n}const ea={};function ji(n){ea[n]||(typeof console<"u"&&console.warn(n),ea[n]=!0)}function gi(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function Kr(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let oi=null;function On(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const jn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Er(n,t,r,s,c){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(n,{timestamp:0});try{const f=d==null?void 0:d.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const g=f.startsWith("BGR"),b=new Uint8ClampedArray(s*c*4);if(yield d.copyTo(b,function(w,S,M,z,R){const F=4*Math.max(1,0),O=(Math.max(0,M)-M)*z*4+F,q=4*z,X=Math.max(0,S),ue=Math.max(0,M);return{rect:{x:X,y:ue,width:Math.min(w.width,S+z)-X,height:Math.min(w.height,M+R)-ue},layout:[{offset:O,stride:q}]}}(n,t,r,s,c)),g)for(let w=0;w<b.length;w+=4){const S=b[w];b[w]=b[w+2],b[w+2]=S}return b}finally{d.close()}})}let mn,gn;function or(n){return n/Math.PI*180}const Nn="AbortError";function Vn(){return new Error(Nn)}const _n={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ta(n){return _n.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const Un="global-dispatcher";class Yr extends Error{constructor(t,r,s,c){super(`AJAXError: ${r} (${t}): ${s}`),this.status=t,this.statusText=r,this.url=s,this.body=c}}const $n=()=>Kr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Jr=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const s=ta(n.url);if(s)return s(n,t);if(Kr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:Un},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test($n())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,c){return o(this,void 0,void 0,function*(){const d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:$n(),signal:c.signal});let f,g;s.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{f=yield fetch(d)}catch(w){throw new Yr(0,w.message,s.url,new Blob)}if(!f.ok){const w=yield f.blob();throw new Yr(f.status,f.statusText,s.url,w)}g=s.type==="arrayBuffer"||s.type==="image"?f.arrayBuffer():s.type==="json"?f.json():f.text();const b=yield g;if(c.signal.aborted)throw Vn();return{data:b,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}})}(n,t);if(Kr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:Un},t)}var r;return function(s,c){return new Promise((d,f)=>{var g;const b=new XMLHttpRequest;b.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(b.responseType="arraybuffer");for(const w in s.headers)b.setRequestHeader(w,s.headers[w]);s.type==="json"&&(b.responseType="text",!((g=s.headers)===null||g===void 0)&&g.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=s.credentials==="include",b.onerror=()=>{f(new Error(b.statusText))},b.onload=()=>{if(!c.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let w=b.response;if(s.type==="json")try{w=JSON.parse(b.response)}catch(S){return void f(S)}d({data:w,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const w=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});f(new Yr(b.status,b.statusText,s.url,w))}},c.signal.addEventListener("abort",()=>{b.abort(),f(Vn())}),b.send(s.body)})}(n,t)};function qn(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function yn(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function bs(n,t,r){if(r&&r[n]){const s=r[n].indexOf(t);s!==-1&&r[n].splice(s,1)}}class xs{constructor(t,r={}){Di(this,r),this.type=t}}class ia extends xs{constructor(t,r={}){super("error",Di({error:t},r))}}class vn{on(t,r){return this._listeners=this._listeners||{},yn(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return bs(t,r,this._listeners),bs(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},yn(t,r,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,r){typeof t=="string"&&(t=new xs(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const g of c)g.call(this,t);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const g of d)bs(s,g,this._oneTimeListeners),g.call(this,t);const f=this._eventedParent;f&&(Di(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(t))}else t instanceof ia&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var Z={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const j=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function V(n,t){const r={};for(const s in n)s!=="ref"&&(r[s]=n[s]);return j.forEach(s=>{s in t&&(r[s]=t[s])}),r}function U(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!U(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!U(n[r],t[r]))return!1;return!0}return n===t}function Q(n,t){n.push(t)}function oe(n,t,r){Q(r,{command:"addSource",args:[n,t[n]]})}function me(n,t,r){Q(t,{command:"removeSource",args:[n]}),r[n]=!0}function we(n,t,r,s){me(n,r,s),oe(n,t,r)}function pe(n,t,r){let s;for(s in n[r])if(Object.prototype.hasOwnProperty.call(n[r],s)&&s!=="data"&&!U(n[r][s],t[r][s]))return!1;for(s in t[r])if(Object.prototype.hasOwnProperty.call(t[r],s)&&s!=="data"&&!U(n[r][s],t[r][s]))return!1;return!0}function Me(n,t,r,s,c,d){n=n||{},t=t||{};for(const f in n)Object.prototype.hasOwnProperty.call(n,f)&&(U(n[f],t[f])||r.push({command:d,args:[s,f,t[f],c]}));for(const f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(n,f)&&(U(n[f],t[f])||r.push({command:d,args:[s,f,t[f],c]}))}function Pe(n){return n.id}function _e(n,t){return n[t.id]=t,n}class de{constructor(t,r,s,c){this.message=(t?`${t}: `:"")+s,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ue(n,...t){for(const r of t)for(const s in r)n[s]=r[s];return n}class Ne extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class at{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(t){return new at(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const dt={kind:"null"},ke={kind:"number"},$e={kind:"string"},Ye={kind:"boolean"},yt={kind:"color"},Pt={kind:"projectionDefinition"},ut={kind:"object"},We={kind:"value"},ri={kind:"collator"},bn={kind:"formatted"},_i={kind:"padding"},hi={kind:"resolvedImage"},Ht={kind:"variableAnchorOffsetCollection"};function lr(n,t){return{kind:"array",itemType:n,N:t}}function Wt(n){if(n.kind==="array"){const t=Wt(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const ra=[dt,ke,$e,Ye,yt,Pt,bn,ut,lr(We),_i,hi,Ht];function ws(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ws(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of ra)if(!ws(r,t))return null}}return`Expected ${Wt(n)} but found ${Wt(t)} instead.`}function el(n,t){return t.some(r=>r.kind===n.kind)}function Zn(n,t){return t.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function Gn(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const Zc=.96422,tl=.82521,Gc=4/29,Ts=6/29,Hc=3*Ts*Ts,Hh=Ts*Ts*Ts,Wh=Math.PI/180,Xh=180/Math.PI;function Wc(n){return(n%=360)<0&&(n+=360),n}function il([n,t,r,s]){let c,d;const f=rl((.2225045*(n=Hn(n))+.7168786*(t=Hn(t))+.0606169*(r=Hn(r)))/1);n===t&&t===r?c=d=f:(c=rl((.4360747*n+.3850649*t+.1430804*r)/Zc),d=rl((.0139322*n+.0971045*t+.7141733*r)/tl));const g=116*f-16;return[g<0?0:g,500*(c-f),200*(f-d),s]}function Hn(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function rl(n){return n>Hh?Math.pow(n,1/3):n/Hc+Gc}function Xc([n,t,r,s]){let c=(n+16)/116,d=isNaN(t)?c:c+t/500,f=isNaN(r)?c:c-r/200;return c=1*nl(c),d=Zc*nl(d),f=tl*nl(f),[Wn(3.1338561*d-1.6168667*c-.4906146*f),Wn(-.9787684*d+1.9161415*c+.033454*f),Wn(.0719453*d-.2289914*c+1.4052427*f),s]}function Wn(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function nl(n){return n>Ts?n*n*n:Hc*(n-Gc)}function Ua(n){return parseInt(n.padEnd(2,n),16)/255}function Kc(n,t){return Xn(t?n/100:n,0,1)}function Xn(n,t,r){return Math.min(Math.max(t,n),r)}function sl(n){return!n.some(Number.isNaN)}const Nr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function vt(n,t,r){return n+r*(t-n)}function Vr(n,t,r){return n.map((s,c)=>vt(s,t[c],r))}class bt{constructor(t,r,s,c=1,d=!0){this.r=t,this.g=r,this.b=s,this.a=c,d||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,r,s,c]))}static parse(t){if(t instanceof bt)return t;if(typeof t!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Nr[s];if(c){const[f,g,b]=c;return[f/255,g/255,b/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const f=s.length<6?1:2;let g=1;return[Ua(s.slice(g,g+=f)),Ua(s.slice(g,g+=f)),Ua(s.slice(g,g+=f)),Ua(s.slice(g,g+f)||"ff")]}if(s.startsWith("rgb")){const f=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[g,b,w,S,M,z,R,F,O,q,X,ue]=f,ee=[S||" ",R||" ",q].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const L=[w,z,O].join(""),$=L==="%%%"?100:L===""?255:0;if($){const te=[Xn(+b/$,0,1),Xn(+M/$,0,1),Xn(+F/$,0,1),X?Kc(+X,ue):1];if(sl(te))return te}}return}}const d=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[f,g,b,w,S,M,z,R,F]=d,O=[b||" ",S||" ",z].join("");if(O==="  "||O==="  /"||O===",,"||O===",,,"){const q=[+g,Xn(+w,0,100),Xn(+M,0,100),R?Kc(+R,F):1];if(sl(q))return function([X,ue,ee,L]){function $(te){const ve=(te+X/30)%12,ze=ue*Math.min(ee,1-ee);return ee-ze*Math.max(-1,Math.min(ve-3,9-ve,1))}return X=Wc(X),ue/=100,ee/=100,[$(0),$(8),$(4),L]}(q)}}}(t);return r?new bt(...r,!1):void 0}get rgb(){const{r:t,g:r,b:s,a:c}=this,d=c||1/0;return this.overwriteGetter("rgb",[t/d,r/d,s/d,c])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,s,c,d]=il(t),f=Math.sqrt(s*s+c*c);return[Math.round(1e4*f)?Wc(Math.atan2(c,s)*Xh):NaN,f,r,d]}(this.rgb))}get lab(){return this.overwriteGetter("lab",il(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,s,c]=this.rgb;return`rgba(${[t,r,s].map(d=>Math.round(255*d)).join(",")},${c})`}static interpolate(t,r,s,c="rgb"){switch(c){case"rgb":{const[d,f,g,b]=Vr(t.rgb,r.rgb,s);return new bt(d,f,g,b,!1)}case"hcl":{const[d,f,g,b]=t.hcl,[w,S,M,z]=r.hcl;let R,F;if(isNaN(d)||isNaN(w))isNaN(d)?isNaN(w)?R=NaN:(R=w,g!==1&&g!==0||(F=S)):(R=d,M!==1&&M!==0||(F=f));else{let ee=w-d;w>d&&ee>180?ee-=360:w<d&&d-w>180&&(ee+=360),R=d+s*ee}const[O,q,X,ue]=function([ee,L,$,te]){return ee=isNaN(ee)?0:ee*Wh,Xc([$,Math.cos(ee)*L,Math.sin(ee)*L,te])}([R,F??vt(f,S,s),vt(g,M,s),vt(b,z,s)]);return new bt(O,q,X,ue,!1)}case"lab":{const[d,f,g,b]=Xc(Vr(t.lab,r.lab,s));return new bt(d,f,g,b,!1)}}}}bt.black=new bt(0,0,0,1),bt.white=new bt(1,1,1,1),bt.transparent=new bt(0,0,0,0),bt.red=new bt(1,0,0,1);class $a{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Yc=["bottom","center","top"];class na{constructor(t,r,s,c,d,f){this.text=t,this.image=r,this.scale=s,this.fontStack=c,this.textColor=d,this.verticalAlign=f}}class si{constructor(t){this.sections=t}static fromString(t){return new si([new na(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof si?t:si.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class yi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof yi)return t;if(typeof t=="number")return new yi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new yi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,s){return new yi(Vr(t.values,r.values,s))}}class ei{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const al=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ni{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ni)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const s=t[r],c=t[r+1];if(typeof s!="string"||!al.has(s)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Ni(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,s){const c=t.values,d=r.values;if(c.length!==d.length)throw new ei(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const f=[];for(let g=0;g<c.length;g+=2){if(c[g]!==d[g])throw new ei(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${c[g]}, to[${g}]: ${d[g]}`);f.push(c[g]);const[b,w]=c[g+1],[S,M]=d[g+1];f.push([vt(b,S,s),vt(w,M,s)])}return new Ni(f)}}class Vi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Vi({name:t,available:!1}):null}}class Ui{constructor(t,r,s){this.from=t,this.to=r,this.transition=s}static interpolate(t,r,s){return new Ui(t,r,s)}static parse(t){return t instanceof Ui?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Ui(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Ui(t.from,t.to,t.transition):typeof t=="string"?new Ui(t,t,1):void 0}}function ol(n,t,r,s){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[n,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[n,t,r,s]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Kn(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Ui||n instanceof bt||n instanceof $a||n instanceof si||n instanceof yi||n instanceof Ni||n instanceof Vi)return!0;if(Array.isArray(n)){for(const t of n)if(!Kn(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!Kn(n[t]))return!1;return!0}return!1}function Ut(n){if(n===null)return dt;if(typeof n=="string")return $e;if(typeof n=="boolean")return Ye;if(typeof n=="number")return ke;if(n instanceof bt)return yt;if(n instanceof Ui)return Pt;if(n instanceof $a)return ri;if(n instanceof si)return bn;if(n instanceof yi)return _i;if(n instanceof Ni)return Ht;if(n instanceof Vi)return hi;if(Array.isArray(n)){const t=n.length;let r;for(const s of n){const c=Ut(s);if(r){if(r===c)continue;r=We;break}r=c}return lr(r||We,t)}return ut}function sa(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof bt||n instanceof Ui||n instanceof si||n instanceof yi||n instanceof Ni||n instanceof Vi?n.toString():JSON.stringify(n)}class Ur{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Kn(t[1]))return r.error("invalid value");const s=t[1];let c=Ut(s);const d=r.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new Ur(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Qr={string:$e,number:ke,boolean:Ye,object:ut};class br{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,c=1;const d=t[0];if(d==="array"){let g,b;if(t.length>2){const w=t[1];if(typeof w!="string"||!(w in Qr)||w==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=Qr[w],c++}else g=We;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=t[2],c++}s=lr(g,b)}else{if(!Qr[d])throw new Error(`Types doesn't contain name = ${d}`);s=Qr[d]}const f=[];for(;c<t.length;c++){const g=r.parse(t[c],c,We);if(!g)return null;f.push(g)}return new br(s,f)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!ws(this.type,Ut(s)))return s;if(r===this.args.length-1)throw new ei(`Expected value to be of type ${Wt(this.type)}, but found ${Wt(Ut(s))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const ll={"to-boolean":Ye,"to-color":yt,"to-number":ke,"to-string":$e};class en{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0];if(!ll[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&t.length!==2)return r.error("Expected one argument.");const c=ll[s],d=[];for(let f=1;f<t.length;f++){const g=r.parse(t[f],f,We);if(!g)return null;d.push(g)}return new en(c,d)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,s;for(const c of this.args){if(r=c.evaluate(t),s=null,r instanceof bt)return r;if(typeof r=="string"){const d=t.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ol(r[0],r[1],r[2],r[3]),!s))return new bt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ei(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(t);const c=yi.parse(r);if(c)return c}throw new ei(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(t);const c=Ni.parse(r);if(c)return c}throw new ei(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(t),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new ei(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return si.fromString(sa(this.args[0].evaluate(t)));case"resolvedImage":return Vi.fromString(sa(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return sa(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const qa=["Unknown","Point","LineString","Polygon"];class $t{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=bt.parse(t)),r}}class Ps{constructor(t,r,s=[],c,d=new at,f=[]){this.registry=t,this.path=s,this.key=s.map(g=>`[${g}]`).join(""),this.scope=d,this.errors=f,this.expectedType=c,this._isConstant=r}parse(t,r,s,c,d={}){return r?this.concat(r,s,c)._parse(t,d):this._parse(t,d)}_parse(t,r){function s(c,d,f){return f==="assert"?new br(d,[c]):f==="coerce"?new en(d,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let f=d.parse(t,this);if(!f)return null;if(this.expectedType){const g=this.expectedType,b=f.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||b.kind!=="value")if(g.kind!=="projectionDefinition"||b.kind!=="string"&&b.kind!=="array")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(g.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(g.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(g,b))return null}else f=s(f,g,r.typeAnnotation||"coerce");else f=s(f,g,r.typeAnnotation||"coerce");else f=s(f,g,r.typeAnnotation||"coerce");else f=s(f,g,r.typeAnnotation||"coerce");else f=s(f,g,r.typeAnnotation||"assert")}if(!(f instanceof Ur)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const g=new $t;try{f=new Ur(f.type,f.evaluate(g))}catch(b){return this.error(b.message),null}}return f}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const c=typeof t=="number"?this.path.concat(t):this.path,d=s?this.scope.concat(s):this.scope;return new Ps(this.registry,this._isConstant,c,r||null,d,this.errors)}error(t,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new Ne(s,t))}checkSubtype(t,r){const s=ws(t,r);return s&&this.error(s),s}}class Tt{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let d=1;d<t.length-1;d+=2){const f=t[d];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const g=r.parse(t[d+1],d+1);if(!g)return null;s.push([f,g])}const c=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return c?new Tt(s,c):null}outputDefined(){return this.result.outputDefined()}}class gt{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new gt(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class aa{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,ke),c=r.parse(t[2],2,lr(r.expectedType||We));return s&&c?new aa(c.type.itemType,s,c):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new ei(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new ei(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new ei(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class St{constructor(t,r){this.type=Ye,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,We),c=r.parse(t[2],2,We);return s&&c?el(s.type,[Ye,$e,ke,dt,We])?new St(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!Zn(r,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(Ut(r))} instead.`);if(!Zn(s,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${Wt(Ut(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ss{constructor(t,r,s){this.type=ke,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,We),c=r.parse(t[2],2,We);if(!s||!c)return null;if(!el(s.type,[Ye,$e,ke,dt,We]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(s.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,ke);return d?new Ss(s,c,d):null}return new Ss(s,c)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Zn(r,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Wt(Ut(r))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),Zn(s,["string"])){const d=s.indexOf(r,c);return d===-1?-1:[...s.slice(0,d)].length}if(Zn(s,["array"]))return s.indexOf(r,c);throw new ei(`Expected second argument to be of type array or string, but found ${Wt(Ut(s))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class kr{constructor(t,r,s,c,d,f){this.inputType=t,this.type=r,this.input=s,this.cases=c,this.outputs=d,this.otherwise=f}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const d={},f=[];for(let w=2;w<t.length-1;w+=2){let S=t[w];const M=t[w+1];Array.isArray(S)||(S=[S]);const z=r.concat(w);if(S.length===0)return z.error("Expected at least one branch label.");for(const F of S){if(typeof F!="number"&&typeof F!="string")return z.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return z.error("Numeric branch labels must be integer values.");if(s){if(z.checkSubtype(s,Ut(F)))return null}else s=Ut(F);if(d[String(F)]!==void 0)return z.error("Branch labels must be unique.");d[String(F)]=f.length}const R=r.parse(M,w,c);if(!R)return null;c=c||R.type,f.push(R)}const g=r.parse(t[1],1,We);if(!g)return null;const b=r.parse(t[t.length-1],t.length-1,c);return b?g.type.kind!=="value"&&r.concat(1).checkSubtype(s,g.type)?null:new kr(s,c,g,d,f,b):null}evaluate(t){const r=this.input.evaluate(t);return(Ut(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class oa{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const c=[];for(let f=1;f<t.length-1;f+=2){const g=r.parse(t[f],f,Ye);if(!g)return null;const b=r.parse(t[f+1],f+1,s);if(!b)return null;c.push([g,b]),s=s||b.type}const d=r.parse(t[t.length-1],t.length-1,s);if(!d)return null;if(!s)throw new Error("Can't infer output type");return new oa(s,c,d)}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class la{constructor(t,r,s,c){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,We),c=r.parse(t[2],2,ke);if(!s||!c)return null;if(!el(s.type,[lr(We),$e,We]))return r.error(`Expected first argument to be of type array or string, but found ${Wt(s.type)} instead`);if(t.length===4){const d=r.parse(t[3],3,ke);return d?new la(s.type,s,c,d):null}return new la(s.type,s,c)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),Zn(r,["string"]))return[...r].slice(s,c).join("");if(Zn(r,["array"]))return r.slice(s,c);throw new ei(`Expected first argument to be of type array or string, but found ${Wt(Ut(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ca(n,t){const r=n.length-1;let s,c,d=0,f=r,g=0;for(;d<=f;)if(g=Math.floor((d+f)/2),s=n[g],c=n[g+1],s<=t){if(g===r||t<c)return g;d=g+1}else{if(!(s>t))throw new ei("Input is not a number.");f=g-1}return 0}class Yn{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[c,d]of s)this.labels.push(c),this.outputs.push(d)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,ke);if(!s)return null;const c=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let f=1;f<t.length;f+=2){const g=f===1?-1/0:t[f],b=t[f+1],w=f,S=f+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const M=r.parse(b,S,d);if(!M)return null;d=d||M.type,c.push([g,M])}return new Yn(d,s,c)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const c=this.input.evaluate(t);if(c<=r[0])return s[0].evaluate(t);const d=r.length;return c>=r[d-1]?s[d-1].evaluate(t):s[ca(r,c)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Jc(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var cl,ul,Qc=function(){if(ul)return cl;function n(t,r,s,c){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=s,this.p2y=c}return ul=1,cl=n,n.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var s=t,c=0;c<8;c++){var d=this.sampleCurveX(s)-t;if(Math.abs(d)<r)return s;var f=this.sampleCurveDerivativeX(s);if(Math.abs(f)<1e-6)break;s-=d/f}var g=0,b=1;for(s=t,c=0;c<20&&(d=this.sampleCurveX(s),!(Math.abs(d-t)<r));c++)t>d?g=s:b=s,s=.5*(b-g)+g;return s},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},cl}(),ua=Jc(Qc);class Ot{constructor(t,r,s,c,d){this.type=t,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[f,g]of d)this.labels.push(f),this.outputs.push(g)}static interpolationFactor(t,r,s,c){let d=0;if(t.name==="exponential")d=Cs(r,t.base,s,c);else if(t.name==="linear")d=Cs(r,1,s,c);else if(t.name==="cubic-bezier"){const f=t.controlPoints;d=new ua(f[0],f[1],f[2],f[3]).solve(Cs(r,1,s,c))}return d}static parse(t,r){let[s,c,d,...f]=t;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const w=c[1];if(typeof w!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const w=c.slice(1);if(w.length!==4||w.some(S=>typeof S!="number"||S<0||S>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,ke),!d)return null;const g=[];let b=null;s==="interpolate-hcl"||s==="interpolate-lab"?b=yt:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let w=0;w<f.length;w+=2){const S=f[w],M=f[w+1],z=w+3,R=w+4;if(typeof S!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(g.length&&g[g.length-1][0]>=S)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const F=r.parse(M,R,b);if(!F)return null;b=b||F.type,g.push([S,F])}return Gn(b,ke)||Gn(b,Pt)||Gn(b,yt)||Gn(b,_i)||Gn(b,Ht)||Gn(b,lr(ke))?new Ot(b,s,c,d,g):r.error(`Type ${Wt(b)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const c=this.input.evaluate(t);if(c<=r[0])return s[0].evaluate(t);const d=r.length;if(c>=r[d-1])return s[d-1].evaluate(t);const f=ca(r,c),g=Ot.interpolationFactor(this.interpolation,c,r[f],r[f+1]),b=s[f].evaluate(t),w=s[f+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return vt(b,w,g);case"color":return bt.interpolate(b,w,g);case"padding":return yi.interpolate(b,w,g);case"variableAnchorOffsetCollection":return Ni.interpolate(b,w,g);case"array":return Vr(b,w,g);case"projectionDefinition":return Ui.interpolate(b,w,g)}case"interpolate-hcl":return bt.interpolate(b,w,g,"hcl");case"interpolate-lab":return bt.interpolate(b,w,g,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Cs(n,t,r,s){const c=s-r,d=n-r;return c===0?0:t===1?d/c:(Math.pow(t,d)-1)/(Math.pow(t,c)-1)}const Ar={color:bt.interpolate,number:vt,padding:yi.interpolate,variableAnchorOffsetCollection:Ni.interpolate,array:Vr};class Jn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s=null;const c=r.expectedType;c&&c.kind!=="value"&&(s=c);const d=[];for(const g of t.slice(1)){const b=r.parse(g,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,d.push(b)}if(!s)throw new Error("No output type");const f=c&&d.some(g=>ws(c,g.type));return new Jn(f?We:s,d)}evaluate(t){let r,s=null,c=0;for(const d of this.args)if(c++,s=d.evaluate(t),s&&s instanceof Vi&&!s.available&&(r||(r=s.name),s=null,c===this.args.length&&(s=r)),s!==null)break;return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function vi(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function hl(n,t,r,s){return s.compare(t,r)===0}function xn(n,t,r){const s=n!=="=="&&n!=="!=";return class Sg{constructor(d,f,g){this.type=Ye,this.lhs=d,this.rhs=f,this.collator=g,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const g=d[0];let b=f.parse(d[1],1,We);if(!b)return null;if(!vi(g,b.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${Wt(b.type)}'.`);let w=f.parse(d[2],2,We);if(!w)return null;if(!vi(g,w.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${Wt(w.type)}'.`);if(b.type.kind!==w.type.kind&&b.type.kind!=="value"&&w.type.kind!=="value")return f.error(`Cannot compare types '${Wt(b.type)}' and '${Wt(w.type)}'.`);s&&(b.type.kind==="value"&&w.type.kind!=="value"?b=new br(w.type,[b]):b.type.kind!=="value"&&w.type.kind==="value"&&(w=new br(b.type,[w])));let S=null;if(d.length===4){if(b.type.kind!=="string"&&w.type.kind!=="string"&&b.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(S=f.parse(d[3],3,ri),!S)return null}return new Sg(b,w,S)}evaluate(d){const f=this.lhs.evaluate(d),g=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const b=Ut(f),w=Ut(g);if(b.kind!==w.kind||b.kind!=="string"&&b.kind!=="number")throw new ei(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=Ut(f),w=Ut(g);if(b.kind!=="string"||w.kind!=="string")return t(d,f,g)}return this.collator?r(d,f,g,this.collator.evaluate(d)):t(d,f,g)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const eu=xn("==",function(n,t,r){return t===r},hl),Kh=xn("!=",function(n,t,r){return t!==r},function(n,t,r,s){return!hl(0,t,r,s)}),Za=xn("<",function(n,t,r){return t<r},function(n,t,r,s){return s.compare(t,r)<0}),dl=xn(">",function(n,t,r){return t>r},function(n,t,r,s){return s.compare(t,r)>0}),Yh=xn("<=",function(n,t,r){return t<=r},function(n,t,r,s){return s.compare(t,r)<=0}),Ga=xn(">=",function(n,t,r){return t>=r},function(n,t,r,s){return s.compare(t,r)>=0});class Qn{constructor(t,r,s){this.type=ri,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Ye);if(!c)return null;const d=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Ye);if(!d)return null;let f=null;return s.locale&&(f=r.parse(s.locale,1,$e),!f)?null:new Qn(c,d,f)}evaluate(t){return new $a(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class cr{constructor(t,r,s,c,d){this.type=$e,this.number=t,this.locale=r,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const s=r.parse(t[1],1,ke);if(!s)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=r.parse(c.locale,1,$e),!d))return null;let f=null;if(c.currency&&(f=r.parse(c.currency,1,$e),!f))return null;let g=null;if(c["min-fraction-digits"]&&(g=r.parse(c["min-fraction-digits"],1,ke),!g))return null;let b=null;return c["max-fraction-digits"]&&(b=r.parse(c["max-fraction-digits"],1,ke),!b)?null:new cr(s,d,f,g,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class ha{constructor(t){this.type=bn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const c=[];let d=!1;for(let f=1;f<=t.length-1;++f){const g=t[f];if(d&&typeof g=="object"&&!Array.isArray(g)){d=!1;let b=null;if(g["font-scale"]&&(b=r.parse(g["font-scale"],1,ke),!b))return null;let w=null;if(g["text-font"]&&(w=r.parse(g["text-font"],1,lr($e)),!w))return null;let S=null;if(g["text-color"]&&(S=r.parse(g["text-color"],1,yt),!S))return null;let M=null;if(g["vertical-align"]){if(typeof g["vertical-align"]=="string"&&!Yc.includes(g["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${g["vertical-align"]}' instead.`);if(M=r.parse(g["vertical-align"],1,$e),!M)return null}const z=c[c.length-1];z.scale=b,z.font=w,z.textColor=S,z.verticalAlign=M}else{const b=r.parse(t[f],1,We);if(!b)return null;const w=b.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:b,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ha(c)}evaluate(t){return new si(this.sections.map(r=>{const s=r.content.evaluate(t);return Ut(s)===hi?new na("",s,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new na(sa(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Ms{constructor(t){this.type=hi,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const s=r.parse(t[1],1,$e);return s?new Ms(s):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),s=Vi.fromString(r);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(r)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}}class pl{constructor(t){this.type=ke,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Wt(s.type)} instead.`):new pl(s):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new ei(`Expected value to be of type string or array, but found ${Wt(Ut(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const xr=8192;function Jh(n,t){const r=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(r*c*xr),Math.round(s*c*xr)]}function fl(n,t){const r=Math.pow(2,t.z);return[(c=(n[0]/xr+t.x)/r,360*c-180),(s=(n[1]/xr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,c}function da(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function pa(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Ha(n,t,r){const s=n[0]-t[0],c=n[1]-t[1],d=n[0]-r[0],f=n[1]-r[1];return s*f-d*c==0&&s*d<=0&&c*f<=0}function Wa(n,t,r,s){return(c=[s[0]-r[0],s[1]-r[1]])[0]*(d=[t[0]-n[0],t[1]-n[1]])[1]-c[1]*d[0]!=0&&!(!iu(n,t,r,s)||!iu(r,s,n,t));var c,d}function tu(n,t,r){for(const s of r)for(let c=0;c<s.length-1;++c)if(Wa(n,t,s[c],s[c+1]))return!0;return!1}function es(n,t,r=!1){let s=!1;for(const g of t)for(let b=0;b<g.length-1;b++){if(Ha(n,g[b],g[b+1]))return r;(d=g[b])[1]>(c=n)[1]!=(f=g[b+1])[1]>c[1]&&c[0]<(f[0]-d[0])*(c[1]-d[1])/(f[1]-d[1])+d[0]&&(s=!s)}var c,d,f;return s}function Qh(n,t){for(const r of t)if(es(n,r))return!0;return!1}function ml(n,t){for(const r of n)if(!es(r,t))return!1;for(let r=0;r<n.length-1;++r)if(tu(n[r],n[r+1],t))return!1;return!0}function ed(n,t){for(const r of t)if(ml(n,r))return!0;return!1}function iu(n,t,r,s){const c=s[0]-r[0],d=s[1]-r[1],f=(n[0]-r[0])*d-c*(n[1]-r[1]),g=(t[0]-r[0])*d-c*(t[1]-r[1]);return f>0&&g<0||f<0&&g>0}function gl(n,t,r){const s=[];for(let c=0;c<n.length;c++){const d=[];for(let f=0;f<n[c].length;f++){const g=Jh(n[c][f],r);da(t,g),d.push(g)}s.push(d)}return s}function ru(n,t,r){const s=[];for(let c=0;c<n.length;c++){const d=gl(n[c],t,r);s.push(d)}return s}function nu(n,t,r,s){if(n[0]<r[0]||n[0]>r[2]){const c=.5*s;let d=n[0]-r[0]>c?-s:r[0]-n[0]>c?s:0;d===0&&(d=n[0]-r[2]>c?-s:r[2]-n[0]>c?s:0),n[0]+=d}da(t,n)}function _l(n,t,r,s){const c=Math.pow(2,s.z)*xr,d=[s.x*xr,s.y*xr],f=[];for(const g of n)for(const b of g){const w=[b.x+d[0],b.y+d[1]];nu(w,t,r,c),f.push(w)}return f}function yl(n,t,r,s){const c=Math.pow(2,s.z)*xr,d=[s.x*xr,s.y*xr],f=[];for(const b of n){const w=[];for(const S of b){const M=[S.x+d[0],S.y+d[1]];da(t,M),w.push(M)}f.push(w)}if(t[2]-t[0]<=c/2){(g=t)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const b of f)for(const w of b)nu(w,t,r,c)}var g;return f}class wn{constructor(t,r){this.type=Ye,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Kn(t[1])){const s=t[1];if(s.type==="FeatureCollection"){const c=[];for(const d of s.features){const{type:f,coordinates:g}=d.geometry;f==="Polygon"&&c.push(g),f==="MultiPolygon"&&c.push(...g)}if(c.length)return new wn(s,{type:"MultiPolygon",coordinates:c})}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new wn(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new wn(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const g=gl(s.coordinates,d,f),b=_l(r.geometry(),c,d,f);if(!pa(c,d))return!1;for(const w of b)if(!es(w,g))return!1}if(s.type==="MultiPolygon"){const g=ru(s.coordinates,d,f),b=_l(r.geometry(),c,d,f);if(!pa(c,d))return!1;for(const w of b)if(!Qh(w,g))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const g=gl(s.coordinates,d,f),b=yl(r.geometry(),c,d,f);if(!pa(c,d))return!1;for(const w of b)if(!ml(w,g))return!1}if(s.type==="MultiPolygon"){const g=ru(s.coordinates,d,f),b=yl(r.geometry(),c,d,f);if(!pa(c,d))return!1;for(const w of b)if(!ed(w,g))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let su=class{constructor(n=[],t=(r,s)=>r<s?-1:r>s?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,s=t[n];for(;n>0;){const c=n-1>>1,d=t[c];if(r(s,d)>=0)break;t[n]=d,n=c}t[n]=s}_down(n){const{data:t,compare:r}=this,s=this.length>>1,c=t[n];for(;n<s;){let d=1+(n<<1);const f=d+1;if(f<this.length&&r(t[f],t[d])<0&&(d=f),r(t[d],c)>=0)break;t[n]=t[d],n=d}t[n]=c}};function au(n,t,r=0,s=n.length-1,c=vl){for(;s>r;){if(s-r>600){const b=s-r+1,w=t-r+1,S=Math.log(b),M=.5*Math.exp(2*S/3),z=.5*Math.sqrt(S*M*(b-M)/b)*(w-b/2<0?-1:1);au(n,t,Math.max(r,Math.floor(t-w*M/b+z)),Math.min(s,Math.floor(t+(b-w)*M/b+z)),c)}const d=n[t];let f=r,g=s;for(fa(n,r,t),c(n[s],d)>0&&fa(n,r,s);f<g;){for(fa(n,f,g),f++,g--;c(n[f],d)<0;)f++;for(;c(n[g],d)>0;)g--}c(n[r],d)===0?fa(n,r,g):(g++,fa(n,g,s)),g<=t&&(r=g+1),t<=g&&(s=g-1)}}function fa(n,t,r){const s=n[t];n[t]=n[r],n[r]=s}function vl(n,t){return n<t?-1:n>t?1:0}function Xa(n,t){if(n.length<=1)return[n];const r=[];let s,c;for(const d of n){const f=id(d);f!==0&&(d.area=Math.abs(f),c===void 0&&(c=f<0),c===f<0?(s&&r.push(s),s=[d]):s.push(d))}if(s&&r.push(s),t>1)for(let d=0;d<r.length;d++)r[d].length<=t||(au(r[d],t,1,r[d].length-1,td),r[d]=r[d].slice(0,t));return r}function td(n,t){return t.area-n.area}function id(n){let t=0;for(let r,s,c=0,d=n.length,f=d-1;c<d;f=c++)r=n[c],s=n[f],t+=(s.x-r.x)*(r.y+s.y);return t}const bl=1/298.257223563,xl=bl*(2-bl),ou=Math.PI/180;class wl{constructor(t){const r=6378.137*ou*1e3,s=Math.cos(t*ou),c=1/(1-xl*(1-s*s)),d=Math.sqrt(c);this.kx=r*d*s,this.ky=r*d*c*(1-xl)}distance(t,r){const s=this.wrap(t[0]-r[0])*this.kx,c=(t[1]-r[1])*this.ky;return Math.sqrt(s*s+c*c)}pointOnLine(t,r){let s,c,d,f,g=1/0;for(let b=0;b<t.length-1;b++){let w=t[b][0],S=t[b][1],M=this.wrap(t[b+1][0]-w)*this.kx,z=(t[b+1][1]-S)*this.ky,R=0;M===0&&z===0||(R=(this.wrap(r[0]-w)*this.kx*M+(r[1]-S)*this.ky*z)/(M*M+z*z),R>1?(w=t[b+1][0],S=t[b+1][1]):R>0&&(w+=M/this.kx*R,S+=z/this.ky*R)),M=this.wrap(r[0]-w)*this.kx,z=(r[1]-S)*this.ky;const F=M*M+z*z;F<g&&(g=F,s=w,c=S,d=b,f=R)}return{point:[s,c],index:d,t:Math.max(0,Math.min(1,f))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Tl(n,t){return t[0]-n[0]}function ma(n){return n[1]-n[0]+1}function tn(n,t){return n[1]>=n[0]&&n[1]<t}function Pl(n,t){if(n[0]>n[1])return[null,null];const r=ma(n);if(t){if(r===2)return[n,null];const c=Math.floor(r/2);return[[n[0],n[0]+c],[n[0]+c,n[1]]]}if(r===1)return[n,null];const s=Math.floor(r/2)-1;return[[n[0],n[0]+s],[n[0]+s+1,n[1]]]}function Sl(n,t){if(!tn(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=t[0];s<=t[1];++s)da(r,n[s]);return r}function Ka(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const s of r)da(t,s);return t}function lu(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function Cl(n,t,r){if(!lu(n)||!lu(t))return NaN;let s=0,c=0;return n[2]<t[0]&&(s=t[0]-n[2]),n[0]>t[2]&&(s=n[0]-t[2]),n[1]>t[3]&&(c=n[1]-t[3]),n[3]<t[1]&&(c=t[1]-n[3]),r.distance([0,0],[s,c])}function ts(n,t,r){const s=r.pointOnLine(t,n);return r.distance(n,s.point)}function Ml(n,t,r,s,c){const d=Math.min(ts(n,[r,s],c),ts(t,[r,s],c)),f=Math.min(ts(r,[n,t],c),ts(s,[n,t],c));return Math.min(d,f)}function Et(n,t,r,s,c){if(!tn(t,n.length)||!tn(s,r.length))return 1/0;let d=1/0;for(let f=t[0];f<t[1];++f){const g=n[f],b=n[f+1];for(let w=s[0];w<s[1];++w){const S=r[w],M=r[w+1];if(Wa(g,b,S,M))return 0;d=Math.min(d,Ml(g,b,S,M,c))}}return d}function rd(n,t,r,s,c){if(!tn(t,n.length)||!tn(s,r.length))return NaN;let d=1/0;for(let f=t[0];f<=t[1];++f)for(let g=s[0];g<=s[1];++g)if(d=Math.min(d,c.distance(n[f],r[g])),d===0)return d;return d}function nd(n,t,r){if(es(n,t,!0))return 0;let s=1/0;for(const c of t){const d=c[0],f=c[c.length-1];if(d!==f&&(s=Math.min(s,ts(n,[f,d],r)),s===0))return s;const g=r.pointOnLine(c,n);if(s=Math.min(s,r.distance(n,g.point)),s===0)return s}return s}function sd(n,t,r,s){if(!tn(t,n.length))return NaN;for(let d=t[0];d<=t[1];++d)if(es(n[d],r,!0))return 0;let c=1/0;for(let d=t[0];d<t[1];++d){const f=n[d],g=n[d+1];for(const b of r)for(let w=0,S=b.length,M=S-1;w<S;M=w++){const z=b[M],R=b[w];if(Wa(f,g,z,R))return 0;c=Math.min(c,Ml(f,g,z,R,s))}}return c}function cu(n,t){for(const r of n)for(const s of r)if(es(s,t,!0))return!0;return!1}function ad(n,t,r,s=1/0){const c=Ka(n),d=Ka(t);if(s!==1/0&&Cl(c,d,r)>=s)return s;if(pa(c,d)){if(cu(n,t))return 0}else if(cu(t,n))return 0;let f=1/0;for(const g of n)for(let b=0,w=g.length,S=w-1;b<w;S=b++){const M=g[S],z=g[b];for(const R of t)for(let F=0,O=R.length,q=O-1;F<O;q=F++){const X=R[q],ue=R[F];if(Wa(M,z,X,ue))return 0;f=Math.min(f,Ml(M,z,X,ue,r))}}return f}function uu(n,t,r,s,c,d){if(!d)return;const f=Cl(Sl(s,d),c,r);f<t&&n.push([f,d,[0,0]])}function Ya(n,t,r,s,c,d,f){if(!d||!f)return;const g=Cl(Sl(s,d),Sl(c,f),r);g<t&&n.push([g,d,f])}function Ja(n,t,r,s,c=1/0){let d=Math.min(s.distance(n[0],r[0][0]),c);if(d===0)return d;const f=new su([[0,[0,n.length-1],[0,0]]],Tl),g=Ka(r);for(;f.length>0;){const b=f.pop();if(b[0]>=d)continue;const w=b[1],S=t?50:100;if(ma(w)<=S){if(!tn(w,n.length))return NaN;if(t){const M=sd(n,w,r,s);if(isNaN(M)||M===0)return M;d=Math.min(d,M)}else for(let M=w[0];M<=w[1];++M){const z=nd(n[M],r,s);if(d=Math.min(d,z),d===0)return 0}}else{const M=Pl(w,t);uu(f,d,s,n,g,M[0]),uu(f,d,s,n,g,M[1])}}return d}function Qa(n,t,r,s,c,d=1/0){let f=Math.min(d,c.distance(n[0],r[0]));if(f===0)return f;const g=new su([[0,[0,n.length-1],[0,r.length-1]]],Tl);for(;g.length>0;){const b=g.pop();if(b[0]>=f)continue;const w=b[1],S=b[2],M=t?50:100,z=s?50:100;if(ma(w)<=M&&ma(S)<=z){if(!tn(w,n.length)&&tn(S,r.length))return NaN;let R;if(t&&s)R=Et(n,w,r,S,c),f=Math.min(f,R);else if(t&&!s){const F=n.slice(w[0],w[1]+1);for(let O=S[0];O<=S[1];++O)if(R=ts(r[O],F,c),f=Math.min(f,R),f===0)return f}else if(!t&&s){const F=r.slice(S[0],S[1]+1);for(let O=w[0];O<=w[1];++O)if(R=ts(n[O],F,c),f=Math.min(f,R),f===0)return f}else R=rd(n,w,r,S,c),f=Math.min(f,R)}else{const R=Pl(w,t),F=Pl(S,s);Ya(g,f,c,n,r,R[0],F[0]),Ya(g,f,c,n,r,R[0],F[1]),Ya(g,f,c,n,r,R[1],F[0]),Ya(g,f,c,n,r,R[1],F[1])}}return f}function Il(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class is{constructor(t,r){this.type=ke,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Kn(t[1])){const s=t[1];if(s.type==="FeatureCollection")return new is(s,s.features.map(c=>Il(c.geometry)).flat());if(s.type==="Feature")return new is(s,Il(s.geometry));if("type"in s&&"coordinates"in s)return new is(s,Il(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const c=r.geometry(),d=c.flat().map(b=>fl([b.x,b.y],r.canonical));if(c.length===0)return NaN;const f=new wl(d[0][1]);let g=1/0;for(const b of s){switch(b.type){case"Point":g=Math.min(g,Qa(d,!1,[b.coordinates],!1,f,g));break;case"LineString":g=Math.min(g,Qa(d,!1,b.coordinates,!0,f,g));break;case"Polygon":g=Math.min(g,Ja(d,!1,b.coordinates,f,g))}if(g===0)return g}return g}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const c=r.geometry(),d=c.flat().map(b=>fl([b.x,b.y],r.canonical));if(c.length===0)return NaN;const f=new wl(d[0][1]);let g=1/0;for(const b of s){switch(b.type){case"Point":g=Math.min(g,Qa(d,!0,[b.coordinates],!1,f,g));break;case"LineString":g=Math.min(g,Qa(d,!0,b.coordinates,!0,f,g));break;case"Polygon":g=Math.min(g,Ja(d,!0,b.coordinates,f,g))}if(g===0)return g}return g}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,s){const c=r.geometry();if(c.length===0||c[0].length===0)return NaN;const d=Xa(c,0).map(b=>b.map(w=>w.map(S=>fl([S.x,S.y],r.canonical)))),f=new wl(d[0][0][0][1]);let g=1/0;for(const b of s)for(const w of d){switch(b.type){case"Point":g=Math.min(g,Ja([b.coordinates],!1,w,f,g));break;case"LineString":g=Math.min(g,Ja(b.coordinates,!0,w,f,g));break;case"Polygon":g=Math.min(g,ad(w,b.coordinates,f,g))}if(g===0)return g}return g}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Is={"==":eu,"!=":Kh,">":dl,"<":Za,">=":Ga,"<=":Yh,array:br,at:aa,boolean:br,case:oa,coalesce:Jn,collator:Qn,format:ha,image:Ms,in:St,"index-of":Ss,interpolate:Ot,"interpolate-hcl":Ot,"interpolate-lab":Ot,length:pl,let:Tt,literal:Ur,match:kr,number:br,"number-format":cr,object:br,slice:la,step:Yn,string:br,"to-boolean":en,"to-color":en,"to-number":en,"to-string":en,var:gt,within:wn,distance:is};class wr{constructor(t,r,s,c){this.name=t,this.type=r,this._evaluate=s,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const s=t[0],c=wr.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,g=f.filter(([w])=>!Array.isArray(w)||w.length===t.length-1);let b=null;for(const[w,S]of g){b=new Ps(r.registry,eo,r.path,null,r.scope);const M=[];let z=!1;for(let R=1;R<t.length;R++){const F=t[R],O=Array.isArray(w)?w[R-1]:w.type,q=b.parse(F,1+M.length,O);if(!q){z=!0;break}M.push(q)}if(!z)if(Array.isArray(w)&&w.length!==M.length)b.error(`Expected ${w.length} arguments, but found ${M.length} instead.`);else{for(let R=0;R<M.length;R++){const F=Array.isArray(w)?w[R]:w.type,O=M[R];b.concat(R+1).checkSubtype(F,O.type)}if(b.errors.length===0)return new wr(s,d,S,M)}}if(g.length===1)r.errors.push(...b.errors);else{const w=(g.length?g:f).map(([M])=>{return z=M,Array.isArray(z)?`(${z.map(Wt).join(", ")})`:`(${Wt(z.type)}...)`;var z}).join(" | "),S=[];for(let M=1;M<t.length;M++){const z=r.parse(t[M],1+S.length);if(!z)return null;S.push(Wt(z.type))}r.error(`Expected arguments of type ${w}, but found (${S.join(", ")}) instead.`)}return null}static register(t,r){wr.definitions=r;for(const s in r)t[s]=wr}}function hu(n,[t,r,s,c]){t=t.evaluate(n),r=r.evaluate(n),s=s.evaluate(n);const d=c?c.evaluate(n):1,f=ol(t,r,s,d);if(f)throw new ei(f);return new bt(t/255,r/255,s/255,d,!1)}function du(n,t){return n in t}function El(n,t){const r=t[n];return r===void 0?null:r}function rs(n){return{type:n}}function eo(n){if(n instanceof gt)return eo(n.boundExpression);if(n instanceof wr&&n.name==="error"||n instanceof Qn||n instanceof wn||n instanceof is)return!1;const t=n instanceof en||n instanceof br;let r=!0;return n.eachChild(s=>{r=t?r&&eo(s):r&&s instanceof Ur}),!!r&&to(n)&&io(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function to(n){if(n instanceof wr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof wn||n instanceof is)return!1;let t=!0;return n.eachChild(r=>{t&&!to(r)&&(t=!1)}),t}function ga(n){if(n instanceof wr&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(r=>{t&&!ga(r)&&(t=!1)}),t}function io(n,t){if(n instanceof wr&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(s=>{r&&!io(s,t)&&(r=!1)}),r}function pu(n){return{result:"success",value:n}}function Es(n){return{result:"error",value:n}}function ks(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function fu(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function kl(n){return!!n.expression&&n.expression.interpolated}function Mt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function ro(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function od(n){return n}function mu(n,t){const r=t.type==="color",s=n.stops&&typeof n.stops[0][0]=="object",c=s||!(s||n.property!==void 0),d=n.type||(kl(t)?"exponential":"interval");if(r||t.type==="padding"){const S=r?bt.parse:yi.parse;(n=Ue({},n)).stops&&(n.stops=n.stops.map(M=>[M[0],S(M[1])])),n.default=S(n.default?n.default:t.default)}if(n.colorSpace&&(f=n.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var f;let g,b,w;if(d==="exponential")g=gu;else if(d==="interval")g=ld;else if(d==="categorical"){g=Al,b=Object.create(null);for(const S of n.stops)b[S[0]]=S[1];w=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);g=cd}if(s){const S={},M=[];for(let F=0;F<n.stops.length;F++){const O=n.stops[F],q=O[0].zoom;S[q]===void 0&&(S[q]={zoom:q,type:n.type,property:n.property,default:n.default,stops:[]},M.push(q)),S[q].stops.push([O[0].value,O[1]])}const z=[];for(const F of M)z.push([S[F].zoom,mu(S[F],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Ot.interpolationFactor.bind(void 0,R),zoomStops:z.map(F=>F[0]),evaluate:({zoom:F},O)=>gu({stops:z,base:n.base},t,F).evaluate(F,O)}}if(c){const S=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Ot.interpolationFactor.bind(void 0,S),zoomStops:n.stops.map(M=>M[0]),evaluate:({zoom:M})=>g(n,t,M,b,w)}}return{kind:"source",evaluate(S,M){const z=M&&M.properties?M.properties[n.property]:void 0;return z===void 0?_a(n.default,t.default):g(n,t,z,b,w)}}}function _a(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function Al(n,t,r,s,c){return _a(typeof r===c?s[r]:void 0,n.default,t.default)}function ld(n,t,r){if(Mt(r)!=="number")return _a(n.default,t.default);const s=n.stops.length;if(s===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[s-1][0])return n.stops[s-1][1];const c=ca(n.stops.map(d=>d[0]),r);return n.stops[c][1]}function gu(n,t,r){const s=n.base!==void 0?n.base:1;if(Mt(r)!=="number")return _a(n.default,t.default);const c=n.stops.length;if(c===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[c-1][0])return n.stops[c-1][1];const d=ca(n.stops.map(S=>S[0]),r),f=function(S,M,z,R){const F=R-z,O=S-z;return F===0?0:M===1?O/F:(Math.pow(M,O)-1)/(Math.pow(M,F)-1)}(r,s,n.stops[d][0],n.stops[d+1][0]),g=n.stops[d][1],b=n.stops[d+1][1],w=Ar[t.type]||od;return typeof g.evaluate=="function"?{evaluate(...S){const M=g.evaluate.apply(void 0,S),z=b.evaluate.apply(void 0,S);if(M!==void 0&&z!==void 0)return w(M,z,f,n.colorSpace)}}:w(g,b,f,n.colorSpace)}function cd(n,t,r){switch(t.type){case"color":r=bt.parse(r);break;case"formatted":r=si.fromString(r.toString());break;case"resolvedImage":r=Vi.fromString(r.toString());break;case"padding":r=yi.parse(r);break;default:Mt(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return _a(r,n.default,t.default)}wr.register(Is,{error:[{kind:"error"},[$e],(n,[t])=>{throw new ei(t.evaluate(n))}],typeof:[$e,[We],(n,[t])=>Wt(Ut(t.evaluate(n)))],"to-rgba":[lr(ke,4),[yt],(n,[t])=>{const[r,s,c,d]=t.evaluate(n).rgb;return[255*r,255*s,255*c,d]}],rgb:[yt,[ke,ke,ke],hu],rgba:[yt,[ke,ke,ke,ke],hu],has:{type:Ye,overloads:[[[$e],(n,[t])=>du(t.evaluate(n),n.properties())],[[$e,ut],(n,[t,r])=>du(t.evaluate(n),r.evaluate(n))]]},get:{type:We,overloads:[[[$e],(n,[t])=>El(t.evaluate(n),n.properties())],[[$e,ut],(n,[t,r])=>El(t.evaluate(n),r.evaluate(n))]]},"feature-state":[We,[$e],(n,[t])=>El(t.evaluate(n),n.featureState||{})],properties:[ut,[],n=>n.properties()],"geometry-type":[$e,[],n=>n.geometryType()],id:[We,[],n=>n.id()],zoom:[ke,[],n=>n.globals.zoom],"heatmap-density":[ke,[],n=>n.globals.heatmapDensity||0],"line-progress":[ke,[],n=>n.globals.lineProgress||0],accumulated:[We,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ke,rs(ke),(n,t)=>{let r=0;for(const s of t)r+=s.evaluate(n);return r}],"*":[ke,rs(ke),(n,t)=>{let r=1;for(const s of t)r*=s.evaluate(n);return r}],"-":{type:ke,overloads:[[[ke,ke],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[ke],(n,[t])=>-t.evaluate(n)]]},"/":[ke,[ke,ke],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[ke,[ke,ke],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[ke,[],()=>Math.LN2],pi:[ke,[],()=>Math.PI],e:[ke,[],()=>Math.E],"^":[ke,[ke,ke],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[ke,[ke],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[ke,[ke],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[ke,[ke],(n,[t])=>Math.log(t.evaluate(n))],log2:[ke,[ke],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[ke,[ke],(n,[t])=>Math.sin(t.evaluate(n))],cos:[ke,[ke],(n,[t])=>Math.cos(t.evaluate(n))],tan:[ke,[ke],(n,[t])=>Math.tan(t.evaluate(n))],asin:[ke,[ke],(n,[t])=>Math.asin(t.evaluate(n))],acos:[ke,[ke],(n,[t])=>Math.acos(t.evaluate(n))],atan:[ke,[ke],(n,[t])=>Math.atan(t.evaluate(n))],min:[ke,rs(ke),(n,t)=>Math.min(...t.map(r=>r.evaluate(n)))],max:[ke,rs(ke),(n,t)=>Math.max(...t.map(r=>r.evaluate(n)))],abs:[ke,[ke],(n,[t])=>Math.abs(t.evaluate(n))],round:[ke,[ke],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[ke,[ke],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[ke,[ke],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[Ye,[$e,We],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[Ye,[We],(n,[t])=>n.id()===t.value],"filter-type-==":[Ye,[$e],(n,[t])=>n.geometryType()===t.value],"filter-<":[Ye,[$e,We],(n,[t,r])=>{const s=n.properties()[t.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[Ye,[We],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[Ye,[$e,We],(n,[t,r])=>{const s=n.properties()[t.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[Ye,[We],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[Ye,[$e,We],(n,[t,r])=>{const s=n.properties()[t.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[Ye,[We],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[Ye,[$e,We],(n,[t,r])=>{const s=n.properties()[t.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[Ye,[We],(n,[t])=>{const r=n.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[Ye,[We],(n,[t])=>t.value in n.properties()],"filter-has-id":[Ye,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ye,[lr($e)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ye,[lr(We)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[Ye,[$e,lr(We)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[Ye,[$e,lr(We)],(n,[t,r])=>function(s,c,d,f){for(;d<=f;){const g=d+f>>1;if(c[g]===s)return!0;c[g]>s?f=g-1:d=g+1}return!1}(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ye,overloads:[[[Ye,Ye],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[rs(Ye),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Ye,overloads:[[[Ye,Ye],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[rs(Ye),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[Ye,[Ye],(n,[t])=>!t.evaluate(n)],"is-supported-script":[Ye,[$e],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[$e,[$e],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[$e,[$e],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[$e,rs(We),(n,t)=>t.map(r=>sa(r.evaluate(n))).join("")],"resolved-locale":[$e,[ri],(n,[t])=>t.evaluate(n).resolvedLocale()]});class no{constructor(t,r){var s;this.expression=t,this._warningHistory={},this._evaluator=new $t,this._defaultValue=r?(s=r).type==="color"&&ro(s.default)?new bt(0,0,0,0):s.type==="color"?bt.parse(s.default)||null:s.type==="padding"?yi.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?Ni.parse(s.default)||null:s.type==="projectionDefinition"?Ui.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,s,c,d,f){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,c,d,f){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null;try{const g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new ei(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function so(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Is}function ao(n,t){const r=new Ps(Is,eo,[],t?function(c){const d={color:yt,string:$e,number:ke,enum:$e,boolean:Ye,formatted:bn,padding:_i,projectionDefinition:Pt,resolvedImage:hi,variableAnchorOffsetCollection:Ht};return c.type==="array"?lr(d[c.value]||We,c.length):d[c.type]}(t):void 0),s=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?pu(new no(s,t)):Es(r.errors)}class As{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!ga(r.expression)}evaluateWithoutErrorHandling(t,r,s,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,c,d,f)}evaluate(t,r,s,c,d,f){return this._styleExpression.evaluate(t,r,s,c,d,f)}}class oo{constructor(t,r,s,c){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!ga(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,r,s,c,d,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,c,d,f)}evaluate(t,r,s,c,d,f){return this._styleExpression.evaluate(t,r,s,c,d,f)}interpolationFactor(t,r,s){return this.interpolationType?Ot.interpolationFactor(this.interpolationType,t,r,s):0}}function _u(n,t){const r=ao(n,t);if(r.result==="error")return r;const s=r.value.expression,c=to(s);if(!c&&!ks(t))return Es([new Ne("","data expressions not supported")]);const d=io(s,["zoom"]);if(!d&&!fu(t))return Es([new Ne("","zoom expressions not supported")]);const f=co(s);return f||d?f instanceof Ne?Es([f]):f instanceof Ot&&!kl(t)?Es([new Ne("",'"interpolate" expressions cannot be used with this property')]):pu(f?new oo(c?"camera":"composite",r.value,f.labels,f instanceof Ot?f.interpolation:void 0):new As(c?"constant":"source",r.value)):Es([new Ne("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class lo{constructor(t,r){this._parameters=t,this._specification=r,Ue(this,mu(this._parameters,this._specification))}static deserialize(t){return new lo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function co(n){let t=null;if(n instanceof Tt)t=co(n.result);else if(n instanceof Jn){for(const r of n.args)if(t=co(r),t)break}else(n instanceof Yn||n instanceof Ot)&&n.input instanceof wr&&n.input.name==="zoom"&&(t=n);return t instanceof Ne||n.eachChild(r=>{const s=co(r);s instanceof Ne?t=s:!t&&s?t=new Ne("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new Ne("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function zl(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!zl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const ud={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function uo(n){if(n==null)return{filter:()=>!0,needGeometry:!1};zl(n)||(n=ho(n));const t=ao(n,ud);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,c)=>t.value.evaluate(r,s,{},c),needGeometry:vu(n)}}function yu(n,t){return n<t?-1:n>t?1:0}function vu(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if(vu(n[t]))return!0;return!1}function ho(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?po(n[1],n[2],"=="):t==="!="?ya(po(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?po(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(ho))):t==="all"?["all"].concat(n.slice(1).map(ho)):t==="none"?["all"].concat(n.slice(1).map(ho).map(ya)):t==="in"?Dl(n[1],n.slice(2)):t==="!in"?ya(Dl(n[1],n.slice(2))):t==="has"?Ll(n[1]):t!=="!has"||ya(Ll(n[1]));var r}function po(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function Dl(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",n,["literal",t.sort(yu)]]:["filter-in-small",n,["literal",t]]}}function Ll(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ya(n){return["!",n]}function va(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let c="[";for(const d of n)c+=`${va(d)},`;return`${c}]`}const r=Object.keys(n).sort();let s="{";for(let c=0;c<r.length;c++)s+=`${JSON.stringify(r[c])}:${va(n[r[c]])},`;return`${s}}`}function Rl(n){let t="";for(const r of j)t+=`/${va(n[r])}`;return t}function fo(n){const t=n.value;return t?[new de(n.key,t,"constants have been deprecated as of v8")]:[]}function Xt(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function ns(n){if(Array.isArray(n))return n.map(ns);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=ns(n[r]);return t}return Xt(n)}function Tr(n){const t=n.key,r=n.value,s=n.valueSpec||{},c=n.objectElementValidators||{},d=n.style,f=n.styleSpec,g=n.validateSpec;let b=[];const w=Mt(r);if(w!=="object")return[new de(t,r,`object expected, ${w} found`)];for(const S in r){const M=S.split(".")[0],z=s[M]||s["*"];let R;if(c[M])R=c[M];else if(s[M])R=g;else if(c["*"])R=c["*"];else{if(!s["*"]){b.push(new de(t,r[S],`unknown property "${S}"`));continue}R=g}b=b.concat(R({key:(t&&`${t}.`)+S,value:r[S],valueSpec:z,style:d,styleSpec:f,object:r,objectKey:S,validateSpec:g},r))}for(const S in s)c[S]||s[S].required&&s[S].default===void 0&&r[S]===void 0&&b.push(new de(t,r,`missing required property "${S}"`));return b}function Fl(n){const t=n.value,r=n.valueSpec,s=n.style,c=n.styleSpec,d=n.key,f=n.arrayElementValidator||n.validateSpec;if(Mt(t)!=="array")return[new de(d,t,`array expected, ${Mt(t)} found`)];if(r.length&&t.length!==r.length)return[new de(d,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new de(d,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let g={type:r.value,values:r.values};c.$version<7&&(g.function=r.function),Mt(r.value)==="object"&&(g=r.value);let b=[];for(let w=0;w<t.length;w++)b=b.concat(f({array:t,arrayIndex:w,value:t[w],valueSpec:g,validateSpec:n.validateSpec,style:s,styleSpec:c,key:`${d}[${w}]`}));return b}function Bl(n){const t=n.key,r=n.value,s=n.valueSpec;let c=Mt(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new de(t,r,`number expected, ${c} found`)]:"minimum"in s&&r<s.minimum?[new de(t,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new de(t,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function bu(n){const t=n.valueSpec,r=Xt(n.value.type);let s,c,d,f={};const g=r!=="categorical"&&n.value.property===void 0,b=!g,w=Mt(n.value.stops)==="array"&&Mt(n.value.stops[0])==="array"&&Mt(n.value.stops[0][0])==="object",S=Tr({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(R){if(r==="identity")return[new de(R.key,R.value,'identity function may not have a "stops" property')];let F=[];const O=R.value;return F=F.concat(Fl({key:R.key,value:O,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:M})),Mt(O)==="array"&&O.length===0&&F.push(new de(R.key,O,"array must have at least one stop")),F},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return r==="identity"&&g&&S.push(new de(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||S.push(new de(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!kl(n.valueSpec)&&S.push(new de(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!ks(n.valueSpec)?S.push(new de(n.key,n.value,"property functions not supported")):g&&!fu(n.valueSpec)&&S.push(new de(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!w||n.value.property!==void 0||S.push(new de(n.key,n.value,'"property" property is required')),S;function M(R){let F=[];const O=R.value,q=R.key;if(Mt(O)!=="array")return[new de(q,O,`array expected, ${Mt(O)} found`)];if(O.length!==2)return[new de(q,O,`array length 2 expected, length ${O.length} found`)];if(w){if(Mt(O[0])!=="object")return[new de(q,O,`object expected, ${Mt(O[0])} found`)];if(O[0].zoom===void 0)return[new de(q,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new de(q,O,"object stop key must have value")];if(d&&d>Xt(O[0].zoom))return[new de(q,O[0].zoom,"stop zoom values must appear in ascending order")];Xt(O[0].zoom)!==d&&(d=Xt(O[0].zoom),c=void 0,f={}),F=F.concat(Tr({key:`${q}[0]`,value:O[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Bl,value:z}}))}else F=F.concat(z({key:`${q}[0]`,value:O[0],validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},O));return so(ns(O[1]))?F.concat([new de(`${q}[1]`,O[1],"expressions are not allowed in function stops.")]):F.concat(R.validateSpec({key:`${q}[1]`,value:O[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function z(R,F){const O=Mt(R.value),q=Xt(R.value),X=R.value!==null?R.value:F;if(s){if(O!==s)return[new de(R.key,X,`${O} stop domain type must match previous stop domain type ${s}`)]}else s=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new de(R.key,X,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&r!=="categorical"){let ue=`number expected, ${O} found`;return ks(t)&&r===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new de(R.key,X,ue)]}return r!=="categorical"||O!=="number"||isFinite(q)&&Math.floor(q)===q?r!=="categorical"&&O==="number"&&c!==void 0&&q<c?[new de(R.key,X,"stop domain values must appear in ascending order")]:(c=q,r==="categorical"&&q in f?[new de(R.key,X,"stop domain values must be unique")]:(f[q]=!0,[])):[new de(R.key,X,`integer expected, found ${q}`)]}}function zs(n){const t=(n.expressionContext==="property"?_u:ao)(ns(n.value),n.valueSpec);if(t.result==="error")return t.value.map(s=>new de(`${n.key}${s.key}`,n.value,s.message));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new de(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!ga(r))return[new de(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!ga(r))return[new de(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!io(r,["zoom","feature-state"]))return[new de(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!to(r))return[new de(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ds(n){const t=n.key,r=n.value,s=n.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(Xt(r))===-1&&c.push(new de(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Xt(r))===-1&&c.push(new de(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function mo(n){return zl(ns(n.value))?zs(Ue({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ba(n)}function ba(n){const t=n.value,r=n.key;if(Mt(t)!=="array")return[new de(r,t,`array expected, ${Mt(t)} found`)];const s=n.styleSpec;let c,d=[];if(t.length<1)return[new de(r,t,"filter array must have at least 1 element")];switch(d=d.concat(Ds({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),Xt(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Xt(t[1])==="$type"&&d.push(new de(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new de(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=Mt(t[1]),c!=="string"&&d.push(new de(`${r}[1]`,t[1],`string expected, ${c} found`)));for(let f=2;f<t.length;f++)c=Mt(t[f]),Xt(t[1])==="$type"?d=d.concat(Ds({key:`${r}[${f}]`,value:t[f],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new de(`${r}[${f}]`,t[f],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let f=1;f<t.length;f++)d=d.concat(ba({key:`${r}[${f}]`,value:t[f],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":c=Mt(t[1]),t.length!==2?d.push(new de(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new de(`${r}[1]`,t[1],`string expected, ${c} found`))}return d}function xu(n,t){const r=n.key,s=n.validateSpec,c=n.style,d=n.styleSpec,f=n.value,g=n.objectKey,b=d[`${t}_${n.layerType}`];if(!b)return[];const w=g.match(/^(.*)-transition$/);if(t==="paint"&&w&&b[w[1]]&&b[w[1]].transition)return s({key:r,value:f,valueSpec:d.transition,style:c,styleSpec:d});const S=n.valueSpec||b[g];if(!S)return[new de(r,f,`unknown property "${g}"`)];let M;if(Mt(f)==="string"&&ks(S)&&!S.tokens&&(M=/^{([^}]+)}$/.exec(f)))return[new de(r,f,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const z=[];return n.layerType==="symbol"&&(g==="text-field"&&c&&!c.glyphs&&z.push(new de(r,f,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&ro(ns(f))&&Xt(f.type)==="identity"&&z.push(new de(r,f,'"text-font" does not support identity functions'))),z.concat(s({key:n.key,value:f,valueSpec:S,style:c,styleSpec:d,expressionContext:"property",propertyType:t,propertyKey:g}))}function Ol(n){return xu(n,"paint")}function jl(n){return xu(n,"layout")}function wu(n){let t=[];const r=n.value,s=n.key,c=n.style,d=n.styleSpec;r.type||r.ref||t.push(new de(s,r,'either "type" or "ref" is required'));let f=Xt(r.type);const g=Xt(r.ref);if(r.id){const b=Xt(r.id);for(let w=0;w<n.arrayIndex;w++){const S=c.layers[w];Xt(S.id)===b&&t.push(new de(s,r.id,`duplicate layer id "${r.id}", previously used at line ${S.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in r&&t.push(new de(s,r[w],`"${w}" is prohibited for ref layers`))}),c.layers.forEach(w=>{Xt(w.id)===g&&(b=w)}),b?b.ref?t.push(new de(s,r.ref,"ref cannot reference another ref layer")):f=Xt(b.type):t.push(new de(s,r.ref,`ref layer "${g}" not found`))}else if(f!=="background")if(r.source){const b=c.sources&&c.sources[r.source],w=b&&Xt(b.type);b?w==="vector"&&f==="raster"?t.push(new de(s,r.source,`layer "${r.id}" requires a raster source`)):w!=="raster-dem"&&f==="hillshade"?t.push(new de(s,r.source,`layer "${r.id}" requires a raster-dem source`)):w==="raster"&&f!=="raster"?t.push(new de(s,r.source,`layer "${r.id}" requires a vector source`)):w!=="vector"||r["source-layer"]?w==="raster-dem"&&f!=="hillshade"?t.push(new de(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||w==="geojson"&&b.lineMetrics||t.push(new de(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new de(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new de(s,r.source,`source "${r.source}" not found`))}else t.push(new de(s,r,'missing required property "source"'));return t=t.concat(Tr({key:s,value:r,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:mo,layout:b=>Tr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":w=>jl(Ue({layerType:f},w))}}),paint:b=>Tr({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":w=>Ol(Ue({layerType:f},w))}})}})),t}function Tn(n){const t=n.value,r=n.key,s=Mt(t);return s!=="string"?[new de(r,t,`string expected, ${s} found`)]:[]}const Nl={promoteId:function({key:n,value:t}){if(Mt(t)==="string")return Tn({key:n,value:t});{const r=[];for(const s in t)r.push(...Tn({key:`${n}.${s}`,value:t[s]}));return r}}};function Ls(n){const t=n.value,r=n.key,s=n.styleSpec,c=n.style,d=n.validateSpec;if(!t.type)return[new de(r,t,'"type" is required')];const f=Xt(t.type);let g;switch(f){case"vector":case"raster":return g=Tr({key:r,value:t,valueSpec:s[`source_${f.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:Nl,validateSpec:d}),g;case"raster-dem":return g=function(b){var w;const S=(w=b.sourceName)!==null&&w!==void 0?w:"",M=b.value,z=b.styleSpec,R=z.source_raster_dem,F=b.style;let O=[];const q=Mt(M);if(M===void 0)return O;if(q!=="object")return O.push(new de("source_raster_dem",M,`object expected, ${q} found`)),O;const X=Xt(M.encoding)==="custom",ue=["redFactor","greenFactor","blueFactor","baseShift"],ee=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const L in M)!X&&ue.includes(L)?O.push(new de(L,M[L],`In "${S}": "${L}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):R[L]?O=O.concat(b.validateSpec({key:L,value:M[L],valueSpec:R[L],validateSpec:b.validateSpec,style:F,styleSpec:z})):O.push(new de(L,M[L],`unknown property "${L}"`));return O}({sourceName:r,value:t,style:n.style,styleSpec:s,validateSpec:d}),g;case"geojson":if(g=Tr({key:r,value:t,valueSpec:s.source_geojson,style:c,styleSpec:s,validateSpec:d,objectElementValidators:Nl}),t.cluster)for(const b in t.clusterProperties){const[w,S]=t.clusterProperties[b],M=typeof w=="string"?[w,["accumulated"],["get",b]]:w;g.push(...zs({key:`${r}.${b}.map`,value:S,expressionContext:"cluster-map"})),g.push(...zs({key:`${r}.${b}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return g;case"video":return Tr({key:r,value:t,valueSpec:s.source_video,style:c,validateSpec:d,styleSpec:s});case"image":return Tr({key:r,value:t,valueSpec:s.source_image,style:c,validateSpec:d,styleSpec:s});case"canvas":return[new de(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ds({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Tu(n){const t=n.value,r=n.styleSpec,s=r.light,c=n.style;let d=[];const f=Mt(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new de("light",t,`object expected, ${f} found`)]),d;for(const g in t){const b=g.match(/^(.*)-transition$/);d=d.concat(b&&s[b[1]]&&s[b[1]].transition?n.validateSpec({key:g,value:t[g],valueSpec:r.transition,validateSpec:n.validateSpec,style:c,styleSpec:r}):s[g]?n.validateSpec({key:g,value:t[g],valueSpec:s[g],validateSpec:n.validateSpec,style:c,styleSpec:r}):[new de(g,t[g],`unknown property "${g}"`)])}return d}function Pu(n){const t=n.value,r=n.styleSpec,s=r.sky,c=n.style,d=Mt(t);if(t===void 0)return[];if(d!=="object")return[new de("sky",t,`object expected, ${d} found`)];let f=[];for(const g in t)f=f.concat(s[g]?n.validateSpec({key:g,value:t[g],valueSpec:s[g],style:c,styleSpec:r}):[new de(g,t[g],`unknown property "${g}"`)]);return f}function Su(n){const t=n.value,r=n.styleSpec,s=r.terrain,c=n.style;let d=[];const f=Mt(t);if(t===void 0)return d;if(f!=="object")return d=d.concat([new de("terrain",t,`object expected, ${f} found`)]),d;for(const g in t)d=d.concat(s[g]?n.validateSpec({key:g,value:t[g],valueSpec:s[g],validateSpec:n.validateSpec,style:c,styleSpec:r}):[new de(g,t[g],`unknown property "${g}"`)]);return d}function Cu(n){let t=[];const r=n.value,s=n.key;if(Array.isArray(r)){const c=[],d=[];for(const f in r)r[f].id&&c.includes(r[f].id)&&t.push(new de(s,r,`all the sprites' ids must be unique, but ${r[f].id} is duplicated`)),c.push(r[f].id),r[f].url&&d.includes(r[f].url)&&t.push(new de(s,r,`all the sprites' URLs must be unique, but ${r[f].url} is duplicated`)),d.push(r[f].url),t=t.concat(Tr({key:`${s}[${f}]`,value:r[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Tn({key:s,value:r})}const Mu={"*":()=>[],array:Fl,boolean:function(n){const t=n.value,r=n.key,s=Mt(t);return s!=="boolean"?[new de(r,t,`boolean expected, ${s} found`)]:[]},number:Bl,color:function(n){const t=n.key,r=n.value,s=Mt(r);return s!=="string"?[new de(t,r,`color expected, ${s} found`)]:bt.parse(String(r))?[]:[new de(t,r,`color expected, "${r}" found`)]},constants:fo,enum:Ds,filter:mo,function:bu,layer:wu,object:Tr,source:Ls,light:Tu,sky:Pu,terrain:Su,projection:function(n){const t=n.value,r=n.styleSpec,s=r.projection,c=n.style,d=Mt(t);if(t===void 0)return[];if(d!=="object")return[new de("projection",t,`object expected, ${d} found`)];let f=[];for(const g in t)f=f.concat(s[g]?n.validateSpec({key:g,value:t[g],valueSpec:s[g],style:c,styleSpec:r}):[new de(g,t[g],`unknown property "${g}"`)]);return f},projectionDefinition:function(n){const t=n.key;let r=n.value;r=r instanceof String?r.valueOf():r;const s=Mt(r);return s!=="array"||function(c){return Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"}(r)||function(c){return!!["interpolate","step","literal"].includes(c[0])}(r)?["array","string"].includes(s)?[]:[new de(t,r,`projection expected, invalid type "${s}" found`)]:[new de(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Tn,formatted:function(n){return Tn(n).length===0?[]:zs(n)},resolvedImage:function(n){return Tn(n).length===0?[]:zs(n)},padding:function(n){const t=n.key,r=n.value;if(Mt(r)==="array"){if(r.length<1||r.length>4)return[new de(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let c=[];for(let d=0;d<r.length;d++)c=c.concat(n.validateSpec({key:`${t}[${d}]`,value:r[d],validateSpec:n.validateSpec,valueSpec:s}));return c}return Bl({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,s=Mt(r),c=n.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new de(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let f=0;f<r.length;f+=2)d=d.concat(Ds({key:`${t}[${f}]`,value:r[f],valueSpec:c.layout_symbol["text-anchor"]})),d=d.concat(Fl({key:`${t}[${f+1}]`,value:r[f+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:c}));return d},sprite:Cu};function go(n){const t=n.value,r=n.valueSpec,s=n.styleSpec;return n.validateSpec=go,r.expression&&ro(Xt(t))?bu(n):r.expression&&so(ns(t))?zs(n):r.type&&Mu[r.type]?Mu[r.type](n):Tr(Ue({},n,{valueSpec:r.type?s[r.type]:r}))}function Rs(n){const t=n.value,r=n.key,s=Tn(n);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new de(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new de(r,t,'"glyphs" url must include a "{range}" token'))),s}function Wi(n,t=Z){let r=[];return r=r.concat(go({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:go,objectElementValidators:{glyphs:Rs,"*":()=>[]}})),n.constants&&(r=r.concat(fo({key:"constants",value:n.constants}))),Fs(r)}function ai(n){return function(t){return n({...t,validateSpec:go})}}function Fs(n){return[].concat(n).sort((t,r)=>t.line-r.line)}function zr(n){return function(...t){return Fs(n.apply(this,t))}}Wi.source=zr(ai(Ls)),Wi.sprite=zr(ai(Cu)),Wi.glyphs=zr(ai(Rs)),Wi.light=zr(ai(Tu)),Wi.sky=zr(ai(Pu)),Wi.terrain=zr(ai(Su)),Wi.layer=zr(ai(wu)),Wi.filter=zr(ai(mo)),Wi.paintProperty=zr(ai(Ol)),Wi.layoutProperty=zr(ai(jl));const Bs=Wi,hd=Bs.light,xa=Bs.sky,Iu=Bs.paintProperty,Vl=Bs.layoutProperty;function Eu(n,t){let r=!1;if(t&&t.length)for(const s of t)n.fire(new ia(new Error(s.message))),r=!0;return r}class ss{constructor(t,r,s){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const f=new Int32Array(this.arrayBuffer);t=f[0],this.d=(r=f[1])+2*(s=f[2]);for(let b=0;b<this.d*this.d;b++){const w=f[3+b],S=f[3+b+1];c.push(w===S?null:f.subarray(w,S))}const g=f[3+c.length+1];this.keys=f.subarray(f[3+c.length],g),this.bboxes=f.subarray(g),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let f=0;f<this.d*this.d;f++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=s,this.scale=r/t,this.uid=0;const d=s/r*t;this.min=-d,this.max=t+d}insert(t,r,s,c,d){this._forEachCell(r,s,c,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,s,c,d,f){this.cells[d].push(f)}query(t,r,s,c,d){const f=this.min,g=this.max;if(t<=f&&r<=f&&g<=s&&g<=c&&!d)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,r,s,c,this._queryCell,b,{},d),b}}_queryCell(t,r,s,c,d,f,g,b){const w=this.cells[d];if(w!==null){const S=this.keys,M=this.bboxes;for(let z=0;z<w.length;z++){const R=w[z];if(g[R]===void 0){const F=4*R;(b?b(M[F+0],M[F+1],M[F+2],M[F+3]):t<=M[F+2]&&r<=M[F+3]&&s>=M[F+0]&&c>=M[F+1])?(g[R]=!0,f.push(S[R])):g[R]=!1}}}}_forEachCell(t,r,s,c,d,f,g,b){const w=this._convertToCellCoord(t),S=this._convertToCellCoord(r),M=this._convertToCellCoord(s),z=this._convertToCellCoord(c);for(let R=w;R<=M;R++)for(let F=S;F<=z;F++){const O=this.d*F+R;if((!b||b(this._convertFromCellCoord(R),this._convertFromCellCoord(F),this._convertFromCellCoord(R+1),this._convertFromCellCoord(F+1)))&&d.call(this,t,r,s,c,O,f,g,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let s=0;for(let f=0;f<this.cells.length;f++)s+=this.cells[f].length;const c=new Int32Array(r+s+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let d=r;for(let f=0;f<t.length;f++){const g=t[f];c[3+f]=d,c.set(g,d),d+=g.length}return c[3+t.length]=d,c.set(this.keys,d),d+=this.keys.length,c[3+t.length+1]=d,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer}static serialize(t,r){const s=t.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(t){return new ss(t.buffer)}}const rn={};function Ge(n,t,r={}){if(rn[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),rn[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Ge("Object",Object),Ge("TransferableGridIndex",ss),Ge("Color",bt),Ge("Error",Error),Ge("AJAXError",Yr),Ge("ResolvedImage",Vi),Ge("StylePropertyFunction",lo),Ge("StyleExpression",no,{omit:["_evaluator"]}),Ge("ZoomDependentExpression",oo),Ge("ZoomConstantExpression",As),Ge("CompoundExpression",wr,{omit:["_evaluate"]});for(const n in Is)Is[n]._classRegistryKey||Ge(`Expression_${n}`,Is[n]);function ku(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function as(n){return n.$name||n.constructor._classRegistryKey}function Au(n){return!function(t){if(t===null||typeof t!="object")return!1;const r=as(t);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||ku(n)||On(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function wa(n,t){if(Au(n))return(ku(n)||On(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const d=[];for(const f of n)d.push(wa(f,t));return d}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=as(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!rn[r])throw new Error(`${r} is not registered.`);const{klass:s}=rn[r],c=s.serialize?s.serialize(n,t):{};if(s.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in n){if(!n.hasOwnProperty(d)||rn[r].omit.indexOf(d)>=0)continue;const f=n[d];c[d]=rn[r].shallow.indexOf(d)>=0?f:wa(f,t)}n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(c.$name=r),c}function Pn(n){if(Au(n))return n;if(Array.isArray(n))return n.map(Pn);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=as(n)||"Object";if(!rn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=rn[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const s=Object.create(r.prototype);for(const c of Object.keys(n)){if(c==="$name")continue;const d=n[c];s[c]=rn[t].shallow.indexOf(c)>=0?d:Pn(d)}return s}class zu{constructor(){this.first=!0}update(t,r){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const xt={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Os(n){for(const t of n)if(vo(t.charCodeAt(0)))return!0;return!1}function Du(n){for(const t of n)if(!Ru(t.charCodeAt(0)))return!1;return!0}function _o(n){const t=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const Lu=_o(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ru(n){return!Lu.test(String.fromCodePoint(n))}const yo=_o(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function vo(n){return!(n!==746&&n!==747&&(n<4352||!(xt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||xt["CJK Compatibility"](n)||xt["CJK Strokes"](n)||!(!xt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||xt["Enclosed CJK Letters and Months"](n)||xt["Ideographic Description Characters"](n)||xt.Kanbun(n)||xt.Katakana(n)&&n!==12540||!(!xt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!xt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||xt["Vertical Forms"](n)||xt["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||yo.test(String.fromCodePoint(n)))))}function Fu(n){return!(vo(n)||function(t){return!!(xt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||xt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||xt["Letterlike Symbols"](t)||xt["Number Forms"](t)||xt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||xt["Control Pictures"](t)&&t!==9251||xt["Optical Character Recognition"](t)||xt["Enclosed Alphanumerics"](t)||xt["Geometric Shapes"](t)||xt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||xt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||xt["CJK Symbols and Punctuation"](t)||xt.Katakana(t)||xt["Private Use Area"](t)||xt["CJK Compatibility Forms"](t)||xt["Small Form Variants"](t)||xt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const Bu=_o(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ou(n){return Bu.test(String.fromCodePoint(n))}function ju(n,t){return!(!t&&Ou(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||xt.Khmer(n))}function Nu(n){for(const t of n)if(Ou(t.charCodeAt(0)))return!0;return!1}const nn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(nn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,t){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const r=n.pluginURL,s=new Promise(d=>{this.loadScriptResolve=d});t(r);const c=new Promise(d=>setTimeout(()=>d(),this.TIMEOUT));if(yield Promise.race([s,c]),this.isParsed()){const d={pluginStatus:"loaded",pluginURL:r};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class Kt{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new zu,this.transition={})}isSupportedScript(t){return function(r,s){for(const c of r)if(!ju(c.charCodeAt(0),s))return!1;return!0}(t,nn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class bo{constructor(t,r){this.property=t,this.value=r,this.expression=function(s,c){if(ro(s))return new lo(s,c);if(so(s)){const d=_u(s,c);if(d.result==="error")throw new Error(d.value.map(f=>`${f.key}: ${f.message}`).join(", "));return d.value}{let d=s;return c.type==="color"&&typeof s=="string"?d=bt.parse(s):c.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(s)?d=Ni.parse(s):c.type==="projectionDefinition"&&typeof s=="string"&&(d=Ui.parse(s)):d=yi.parse(s),{kind:"constant",evaluate:()=>d}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class xo{constructor(t){this.property=t,this.value=new bo(t,void 0)}transitioned(t,r){return new $l(this.property,this.value,r,Di({},t.transition,this.transition),t.now)}untransitioned(){return new $l(this.property,this.value,null,{},0)}}class Ul{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ar(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new xo(this._values[t].property)),this._values[t].value=new bo(this._values[t].property,r===null?void 0:ar(r))}getTransition(t){return ar(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new xo(this._values[t].property)),this._values[t].transition=ar(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s);const c=this.getTransition(r);c!==void 0&&(t[`${r}-transition`]=c)}return t}transitioned(t,r){const s=new ql(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(t,r._values[c]);return s}untransitioned(){const t=new ql(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class $l{constructor(t,r,s,c,d){this.property=t,this.value=r,this.begin=d+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const c=t.now||0,d=this.value.possiblyEvaluate(t,r,s),f=this.prior;if(f){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return f.possiblyEvaluate(t,r,s);{const g=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(t,r,s),d,Ln(g))}}return d}}class ql{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const c=new js(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(t,r,s);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class wo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return ar(this._values[t].value)}setValue(t,r){this._values[t]=new bo(this._values[t].property,r===null?void 0:ar(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const c=new js(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(t,r,s);return c}}class $r{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,s,c){return this.property.evaluate(this.value,this.parameters,t,r,s,c)}}class js{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class it{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,s){const c=Ar[this.specification.type];return c?c(t,r,s):t}}class ot{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,c){return new $r(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},s,c)}:t.expression,r)}interpolate(t,r,s){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new $r(this,{kind:"constant",value:void 0},t.parameters);const c=Ar[this.specification.type];if(c){const d=c(t.value.value,r.value.value,s);return new $r(this,{kind:"constant",value:d},t.parameters)}return t}evaluate(t,r,s,c,d,f){return t.kind==="constant"?t.value:t.evaluate(r,s,c,d,f)}}class Ta extends ot{possiblyEvaluate(t,r,s,c){if(t.value===void 0)return new $r(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const d=t.expression.evaluate(r,null,{},s,c),f=t.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,g=this._calculate(f,f,f,r);return new $r(this,{kind:"constant",value:g},r)}if(t.expression.kind==="camera"){const d=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new $r(this,{kind:"constant",value:d},r)}return new $r(this,t.expression,r)}evaluate(t,r,s,c,d,f){if(t.kind==="source"){const g=t.evaluate(r,s,c,d,f);return this._calculate(g,g,g,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},s,c),t.evaluate({zoom:Math.floor(r.zoom)},s,c),t.evaluate({zoom:Math.floor(r.zoom)+1},s,c),r):t.value}_calculate(t,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class To{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const d=t.expression.evaluate(r,null,{},s,c);return this._calculate(d,d,d,r)}return this._calculate(t.expression.evaluate(new Kt(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Kt(Math.floor(r.zoom),r)),t.expression.evaluate(new Kt(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class Po{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,c){return!!t.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class tr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const s=t[r];s.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new bo(s,void 0),d=this.defaultTransitionablePropertyValues[r]=new xo(s);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}Ge("DataDrivenProperty",ot),Ge("DataConstantProperty",it),Ge("CrossFadedDataDrivenProperty",Ta),Ge("CrossFadedProperty",To),Ge("ColorRampProperty",Po);const Vu="-transition";class qr extends vn{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new wo(r.layout)),r.paint)){this._transitionablePaint=new Ul(r.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new js(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,s={}){r!=null&&this._validate(Vl,`layers.${this.id}.layout.${t}`,t,r,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(Vu)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(r!=null&&this._validate(Iu,`layers.${this.id}.paint.${t}`,t,r,s))return!1;if(t.endsWith(Vu))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const c=this._transitionablePaint._values[t],d=c.property.specification["property-type"]==="cross-faded-data-driven",f=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||f||d||this._handleOverridablePaintPropertyUpdate(t,g,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Bn(t,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(t,r,s,c,d={}){return(!d||d.validate!==!1)&&Eu(this,t.call(Bs,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:Z,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof $r&&ks(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const dd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Pa{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class jt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function li(n,t=1){let r=0,s=0;return{members:n.map(c=>{const d=dd[c.type].BYTES_PER_ELEMENT,f=r=Uu(r,Math.max(t,d)),g=c.components||1;return s=Math.max(s,d),r+=d*g,{name:c.name,type:c.type,components:g,offset:f}}),size:Uu(r,Math.max(s,t)),alignment:t}}function Uu(n,t){return Math.ceil(n/t)*t}class Sa extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const c=2*t;return this.int16[c+0]=r,this.int16[c+1]=s,t}}Sa.prototype.bytesPerElement=4,Ge("StructArrayLayout2i4",Sa);class Ca extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s)}emplace(t,r,s,c){const d=3*t;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=c,t}}Ca.prototype.bytesPerElement=6,Ge("StructArrayLayout3i6",Ca);class Zl extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,c)}emplace(t,r,s,c,d){const f=4*t;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=c,this.int16[f+3]=d,t}}Zl.prototype.bytesPerElement=8,Ge("StructArrayLayout4i8",Zl);class Gl extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,s,c,d,f)}emplace(t,r,s,c,d,f,g){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=c,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=g,t}}Gl.prototype.bytesPerElement=12,Ge("StructArrayLayout2i4i12",Gl);class sn extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,s,c,d,f)}emplace(t,r,s,c,d,f,g){const b=4*t,w=8*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.uint8[w+4]=c,this.uint8[w+5]=d,this.uint8[w+6]=f,this.uint8[w+7]=g,t}}sn.prototype.bytesPerElement=8,Ge("StructArrayLayout2i4ub8",sn);class Ns extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const c=2*t;return this.float32[c+0]=r,this.float32[c+1]=s,t}}Ns.prototype.bytesPerElement=8,Ge("StructArrayLayout2f8",Ns);class Ma extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,d,f,g,b,w,S){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,s,c,d,f,g,b,w,S)}emplace(t,r,s,c,d,f,g,b,w,S,M){const z=10*t;return this.uint16[z+0]=r,this.uint16[z+1]=s,this.uint16[z+2]=c,this.uint16[z+3]=d,this.uint16[z+4]=f,this.uint16[z+5]=g,this.uint16[z+6]=b,this.uint16[z+7]=w,this.uint16[z+8]=S,this.uint16[z+9]=M,t}}Ma.prototype.bytesPerElement=20,Ge("StructArrayLayout10ui20",Ma);class So extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,d,f,g,b,w,S,M,z){const R=this.length;return this.resize(R+1),this.emplace(R,t,r,s,c,d,f,g,b,w,S,M,z)}emplace(t,r,s,c,d,f,g,b,w,S,M,z,R){const F=12*t;return this.int16[F+0]=r,this.int16[F+1]=s,this.int16[F+2]=c,this.int16[F+3]=d,this.uint16[F+4]=f,this.uint16[F+5]=g,this.uint16[F+6]=b,this.uint16[F+7]=w,this.int16[F+8]=S,this.int16[F+9]=M,this.int16[F+10]=z,this.int16[F+11]=R,t}}So.prototype.bytesPerElement=24,Ge("StructArrayLayout4i4ui4i24",So);class Ia extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s)}emplace(t,r,s,c){const d=3*t;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=c,t}}Ia.prototype.bytesPerElement=12,Ge("StructArrayLayout3f12",Ia);class Hl extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Hl.prototype.bytesPerElement=4,Ge("StructArrayLayout1ul4",Hl);class Vs extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,d,f,g,b,w){const S=this.length;return this.resize(S+1),this.emplace(S,t,r,s,c,d,f,g,b,w)}emplace(t,r,s,c,d,f,g,b,w,S){const M=10*t,z=5*t;return this.int16[M+0]=r,this.int16[M+1]=s,this.int16[M+2]=c,this.int16[M+3]=d,this.int16[M+4]=f,this.int16[M+5]=g,this.uint32[z+3]=b,this.uint16[M+8]=w,this.uint16[M+9]=S,t}}Vs.prototype.bytesPerElement=20,Ge("StructArrayLayout6i1ul2ui20",Vs);class os extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,s,c,d,f)}emplace(t,r,s,c,d,f,g){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=c,this.int16[b+3]=d,this.int16[b+4]=f,this.int16[b+5]=g,t}}os.prototype.bytesPerElement=12,Ge("StructArrayLayout2i2i2i12",os);class Wl extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,d){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,c,d)}emplace(t,r,s,c,d,f){const g=4*t,b=8*t;return this.float32[g+0]=r,this.float32[g+1]=s,this.float32[g+2]=c,this.int16[b+6]=d,this.int16[b+7]=f,t}}Wl.prototype.bytesPerElement=16,Ge("StructArrayLayout2f1f2i16",Wl);class Co extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,s,c,d,f)}emplace(t,r,s,c,d,f,g){const b=16*t,w=4*t,S=8*t;return this.uint8[b+0]=r,this.uint8[b+1]=s,this.float32[w+1]=c,this.float32[w+2]=d,this.int16[S+6]=f,this.int16[S+7]=g,t}}Co.prototype.bytesPerElement=16,Ge("StructArrayLayout2ub2f2i16",Co);class Sn extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s)}emplace(t,r,s,c){const d=3*t;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=c,t}}Sn.prototype.bytesPerElement=6,Ge("StructArrayLayout3ui6",Sn);class Xl extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,c,d,f,g,b,w,S,M,z,R,F,O,q,X){const ue=this.length;return this.resize(ue+1),this.emplace(ue,t,r,s,c,d,f,g,b,w,S,M,z,R,F,O,q,X)}emplace(t,r,s,c,d,f,g,b,w,S,M,z,R,F,O,q,X,ue){const ee=24*t,L=12*t,$=48*t;return this.int16[ee+0]=r,this.int16[ee+1]=s,this.uint16[ee+2]=c,this.uint16[ee+3]=d,this.uint32[L+2]=f,this.uint32[L+3]=g,this.uint32[L+4]=b,this.uint16[ee+10]=w,this.uint16[ee+11]=S,this.uint16[ee+12]=M,this.float32[L+7]=z,this.float32[L+8]=R,this.uint8[$+36]=F,this.uint8[$+37]=O,this.uint8[$+38]=q,this.uint32[L+10]=X,this.int16[ee+22]=ue,t}}Xl.prototype.bytesPerElement=48,Ge("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Xl);class Kl extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,c,d,f,g,b,w,S,M,z,R,F,O,q,X,ue,ee,L,$,te,ve,ze,Te,Ce,Fe,Le){const Be=this.length;return this.resize(Be+1),this.emplace(Be,t,r,s,c,d,f,g,b,w,S,M,z,R,F,O,q,X,ue,ee,L,$,te,ve,ze,Te,Ce,Fe,Le)}emplace(t,r,s,c,d,f,g,b,w,S,M,z,R,F,O,q,X,ue,ee,L,$,te,ve,ze,Te,Ce,Fe,Le,Be){const Ee=32*t,Ke=16*t;return this.int16[Ee+0]=r,this.int16[Ee+1]=s,this.int16[Ee+2]=c,this.int16[Ee+3]=d,this.int16[Ee+4]=f,this.int16[Ee+5]=g,this.int16[Ee+6]=b,this.int16[Ee+7]=w,this.uint16[Ee+8]=S,this.uint16[Ee+9]=M,this.uint16[Ee+10]=z,this.uint16[Ee+11]=R,this.uint16[Ee+12]=F,this.uint16[Ee+13]=O,this.uint16[Ee+14]=q,this.uint16[Ee+15]=X,this.uint16[Ee+16]=ue,this.uint16[Ee+17]=ee,this.uint16[Ee+18]=L,this.uint16[Ee+19]=$,this.uint16[Ee+20]=te,this.uint16[Ee+21]=ve,this.uint16[Ee+22]=ze,this.uint32[Ke+12]=Te,this.float32[Ke+13]=Ce,this.float32[Ke+14]=Fe,this.uint16[Ee+30]=Le,this.uint16[Ee+31]=Be,t}}Kl.prototype.bytesPerElement=64,Ge("StructArrayLayout8i15ui1ul2f2ui64",Kl);class Ea extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Ea.prototype.bytesPerElement=4,Ge("StructArrayLayout1f4",Ea);class Yl extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s)}emplace(t,r,s,c){const d=3*t;return this.uint16[6*t+0]=r,this.float32[d+1]=s,this.float32[d+2]=c,t}}Yl.prototype.bytesPerElement=12,Ge("StructArrayLayout1ui2f12",Yl);class u extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s)}emplace(t,r,s,c){const d=4*t;return this.uint32[2*t+0]=r,this.uint16[d+2]=s,this.uint16[d+3]=c,t}}u.prototype.bytesPerElement=8,Ge("StructArrayLayout1ul2ui8",u);class e extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const c=2*t;return this.uint16[c+0]=r,this.uint16[c+1]=s,t}}e.prototype.bytesPerElement=4,Ge("StructArrayLayout2ui4",e);class i extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}i.prototype.bytesPerElement=2,Ge("StructArrayLayout1ui2",i);class a extends jt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,t,r,s,c)}emplace(t,r,s,c,d){const f=4*t;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=c,this.float32[f+3]=d,t}}a.prototype.bytesPerElement=16,Ge("StructArrayLayout4f16",a);class l extends Pa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ge(this.anchorPointX,this.anchorPointY)}}l.prototype.size=20;class h extends Vs{get(t){return new l(this,t)}}Ge("CollisionBoxArray",h);class m extends Pa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}m.prototype.size=48;class v extends Xl{get(t){return new m(this,t)}}Ge("PlacedSymbolArray",v);class x extends Pa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}x.prototype.size=64;class P extends Kl{get(t){return new x(this,t)}}Ge("SymbolInstanceArray",P);class I extends Ea{getoffsetX(t){return this.float32[1*t+0]}}Ge("GlyphOffsetArray",I);class k extends Ca{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ge("SymbolLineVertexArray",k);class D extends Pa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}D.prototype.size=12;class B extends Yl{get(t){return new D(this,t)}}Ge("TextAnchorOffsetArray",B);class N extends Pa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}N.prototype.size=8;class H extends u{get(t){return new N(this,t)}}Ge("FeatureIndexArray",H);class G extends Sa{}class W extends Sa{}class Y extends Sa{}class re extends Gl{}class ne extends sn{}class ae extends Ns{}class ce extends Ma{}class le extends So{}class ye extends Ia{}class be extends Hl{}class Ie extends os{}class Ae extends Co{}class Se extends Sn{}class Ve extends e{}const je=li([{name:"a_pos",components:2,type:"Int16"}],4),{members:De}=je;class qe{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,s,c){const d=this.segments[this.segments.length-1];return t>qe.MAX_VERTEX_ARRAY_LENGTH&&ji(`Max vertices per segment is ${qe.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${qe.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+t>qe.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c?this.createNewSegment(r,s,c):d}createNewSegment(t,r,s){const c={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return s!==void 0&&(c.sortKey=s),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(c),c}getOrCreateLatestSegment(t,r,s){return this.prepareSegment(0,t,r,s)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,c){return new qe([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function _t(n,t){return 256*(n=Ir(Math.floor(n),0,255))+Ir(Math.floor(t),0,255)}qe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ge("SegmentVector",qe);const Ct=li([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Yt,Lt,Jt,Rt={exports:{}},zt={exports:{}},Ft={exports:{}},Li=function(){if(Jt)return Rt.exports;Jt=1;var n=(Yt||(Yt=1,zt.exports=function(r,s){var c,d,f,g,b,w,S,M;for(d=r.length-(c=3&r.length),f=s,b=3432918353,w=461845907,M=0;M<d;)S=255&r.charCodeAt(M)|(255&r.charCodeAt(++M))<<8|(255&r.charCodeAt(++M))<<16|(255&r.charCodeAt(++M))<<24,++M,f=27492+(65535&(g=5*(65535&(f=(f^=S=(65535&(S=(S=(65535&S)*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*w+(((S>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(S=0,c){case 3:S^=(255&r.charCodeAt(M+2))<<16;case 2:S^=(255&r.charCodeAt(M+1))<<8;case 1:f^=S=(65535&(S=(S=(65535&(S^=255&r.charCodeAt(M)))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<15|S>>>17))*w+(((S>>>16)*w&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),zt.exports),t=(Lt||(Lt=1,Ft.exports=function(r,s){for(var c,d=r.length,f=s^d,g=0;d>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(g)|(255&r.charCodeAt(++g))<<8|(255&r.charCodeAt(++g))<<16|(255&r.charCodeAt(++g))<<24))+((1540483477*(c>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++g;switch(d){case 3:f^=(255&r.charCodeAt(g+2))<<16;case 2:f^=(255&r.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Ft.exports);return Rt.exports=n,Rt.exports.murmur3=n,Rt.exports.murmur2=t,Rt.exports}(),di=he(Li);class pi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,s,c){this.ids.push(Xi(t)),this.positions.push(r,s,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Xi(t);let s=0,c=this.ids.length-1;for(;s<c;){const f=s+c>>1;this.ids[f]>=r?c=f:s=f+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(t,r){const s=new Float64Array(t.ids),c=new Uint32Array(t.positions);return an(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(t){const r=new pi;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Xi(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:di(String(n))}function an(n,t,r,s){for(;r<s;){const c=n[r+s>>1];let d=r-1,f=s+1;for(;;){do d++;while(n[d]<c);do f--;while(n[f]>c);if(d>=f)break;Zr(n,d,f),Zr(t,3*d,3*f),Zr(t,3*d+1,3*f+1),Zr(t,3*d+2,3*f+2)}f-r<s-f?(an(n,t,r,f),r=f+1):(an(n,t,f+1,s),s=f)}}function Zr(n,t,r){const s=n[t];n[t]=n[r],n[r]=s}Ge("FeaturePositionMap",pi);class ur{constructor(t,r){this.gl=t.gl,this.location=r}}class on extends ur{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class ka extends ur{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Aa extends ur{constructor(t,r){super(t,r),this.current=bt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Us=new Float32Array(16);function ir(n){return[_t(255*n.r,255*n.g),_t(255*n.b,255*n.a)]}class Pr{constructor(t,r,s){this.value=t,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(t,r,s){t.set(s.constantOr(this.value))}getBinding(t,r,s){return this.type==="color"?new Aa(t,r):new on(t,r)}}class Sr{constructor(t,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,s,c){const d=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(d)}getBinding(t,r,s){return s.substr(0,9)==="u_pattern"?new ka(t,r):new on(t,r)}}class hr{constructor(t,r,s,c){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,r,s,c,d){const f=this.paintVertexArray.length,g=this.expression.evaluate(new Kt(0),r,{},c,[],d);this.paintVertexArray.resize(t),this._setPaintValue(f,t,g)}updatePaintArray(t,r,s,c){const d=this.expression.evaluate({zoom:0},s,c);this._setPaintValue(t,r,d)}_setPaintValue(t,r,s){if(this.type==="color"){const c=ir(s);for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=t;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bt{constructor(t,r,s,c,d,f){this.expression=t,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,r,s,c,d){const f=this.expression.evaluate(new Kt(this.zoom),r,{},c,[],d),g=this.expression.evaluate(new Kt(this.zoom+1),r,{},c,[],d),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,f,g)}updatePaintArray(t,r,s,c){const d=this.expression.evaluate({zoom:this.zoom},s,c),f=this.expression.evaluate({zoom:this.zoom+1},s,c);this._setPaintValue(t,r,d,f)}_setPaintValue(t,r,s,c){if(this.type==="color"){const d=ir(s),f=ir(c);for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,d[0],d[1],f[0],f[1])}else{for(let d=t;d<r;d++)this.paintVertexArray.emplace(d,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=Ir(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,r,s){return new on(t,r)}}class Qt{constructor(t,r,s,c,d,f){this.expression=t,this.type=r,this.useIntegerZoom=s,this.zoom=c,this.layerId=f,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(t,r,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,c,d){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(t,r,s,c){if(!c||!s)return;const{min:d,mid:f,max:g}=s,b=c[d],w=c[f],S=c[g];if(b&&w&&S)for(let M=t;M<r;M++)this.zoomInPaintVertexArray.emplace(M,w.tl[0],w.tl[1],w.br[0],w.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],w.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,w.tl[0],w.tl[1],w.br[0],w.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],w.pixelRatio,S.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ct.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ct.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class dr{constructor(t,r,s){this.binders={},this._buffers=[];const c=[];for(const d in t.paint._values){if(!s(d))continue;const f=t.paint.get(d);if(!(f instanceof $r&&ks(f.property.specification)))continue;const g=pd(d,t.type),b=f.value,w=f.property.specification.type,S=f.property.useIntegerZoom,M=f.property.specification["property-type"],z=M==="cross-faded"||M==="cross-faded-data-driven";if(b.kind==="constant")this.binders[d]=z?new Sr(b.value,g):new Pr(b.value,g,w),c.push(`/u_${d}`);else if(b.kind==="source"||z){const R=$u(d,w,"source");this.binders[d]=z?new Qt(b,w,S,r,R,t.id):new hr(b,g,w,R),c.push(`/a_${d}`)}else{const R=$u(d,w,"composite");this.binders[d]=new Bt(b,g,w,S,r,R),c.push(`/z_${d}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof hr||r instanceof Bt?r.maxValue:0}populatePaintArrays(t,r,s,c,d){for(const f in this.binders){const g=this.binders[f];(g instanceof hr||g instanceof Bt||g instanceof Qt)&&g.populatePaintArray(t,r,s,c,d)}}setConstantPatternPositions(t,r){for(const s in this.binders){const c=this.binders[s];c instanceof Sr&&c.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,s,c,d){let f=!1;for(const g in t){const b=r.getPositions(g);for(const w of b){const S=s.feature(w.index);for(const M in this.binders){const z=this.binders[M];if((z instanceof hr||z instanceof Bt||z instanceof Qt)&&z.expression.isStateDependent===!0){const R=c.paint.get(M);z.expression=R.value,z.updatePaintArray(w.start,w.end,S,t[g],d),f=!0}}}}return f}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Pr||s instanceof Sr)&&t.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof hr||s instanceof Bt)for(let c=0;c<s.paintVertexAttributes.length;c++)t.push(s.paintVertexAttributes[c].name);else if(s instanceof Qt)for(let c=0;c<Ct.members.length;c++)t.push(Ct.members[c].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Pr||s instanceof Sr||s instanceof Bt)for(const c of s.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const s=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Pr||d instanceof Sr||d instanceof Bt){for(const f of d.uniformNames)if(r[f]){const g=d.getBinding(t,r[f],f);s.push({name:f,property:c,binding:g})}}}return s}setUniforms(t,r,s,c){for(const{name:d,property:f,binding:g}of r)this.binders[f].setUniform(g,c,s.get(f),d)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(t&&s instanceof Qt){const c=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof hr||s instanceof Bt)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof hr||s instanceof Bt||s instanceof Qt)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof hr||r instanceof Bt||r instanceof Qt)&&r.destroy()}}}class ti{constructor(t,r,s=()=>!0){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new dr(c,r,s);this.needsUpload=!1,this._featureMap=new pi,this._bufferOffset=0}populatePaintArrays(t,r,s,c,d,f){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(t,r,c,d,f);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,c){for(const d of s)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,r,d,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function pd(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function $u(n,t,r){const s={color:{source:Ns,composite:a},number:{source:Ea,composite:Ns}},c=function(d){return{"line-pattern":{source:ce,composite:ce},"fill-pattern":{source:ce,composite:ce},"fill-extrusion-pattern":{source:ce,composite:ce}}[d]}(n);return c&&c[r]||s[t][r]}Ge("ConstantBinder",Pr),Ge("CrossFadedConstantBinder",Sr),Ge("SourceExpressionBinder",hr),Ge("CrossFadedCompositeBinder",Qt),Ge("CompositeExpressionBinder",Bt),Ge("ProgramConfiguration",dr,{omit:["_buffers"]}),Ge("ProgramConfigurationSet",ti);const Jl=Math.pow(2,14)-1,qu=-Jl-1;function ls(n){const t=It/n.extent,r=n.loadGeometry();for(let s=0;s<r.length;s++){const c=r[s];for(let d=0;d<c.length;d++){const f=c[d],g=Math.round(f.x*t),b=Math.round(f.y*t);f.x=Ir(g,qu,Jl),f.y=Ir(b,qu,Jl),(g<f.x||g>f.x+1||b<f.y||b>f.y+1)&&ji("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function cs(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?ls(n):[]}}const Cn=-32768;function Zu(n,t,r,s,c){n.emplaceBack(Cn+8*t+s,Cn+8*r+c)}class Mo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new W,this.indexArray=new Se,this.segments=new qe,this.programConfigurations=new ti(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){const c=this.layers[0],d=[];let f=null,g=!1,b=c.type==="heatmap";if(c.type==="circle"){const S=c;f=S.layout.get("circle-sort-key"),g=!f.isConstant(),b=b||S.paint.get("circle-pitch-alignment")==="map"}const w=b?r.subdivisionGranularity.circle:1;for(const{feature:S,id:M,index:z,sourceLayerIndex:R}of t){const F=this.layers[0]._featureFilter.needGeometry,O=cs(S,F);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),O,s))continue;const q=g?f.evaluate(O,{},s):void 0,X={id:M,properties:S.properties,type:S.type,sourceLayerIndex:R,index:z,geometry:F?O.geometry:ls(S),patterns:{},sortKey:q};d.push(X)}g&&d.sort((S,M)=>S.sortKey-M.sortKey);for(const S of d){const{geometry:M,index:z,sourceLayerIndex:R}=S,F=t[z].feature;this.addFeature(S,M,z,s,w),r.featureIndex.insert(F,M,z,R,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,De),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,c,d=1){let f;switch(d){case 1:f=[0,7];break;case 3:f=[0,2,5,7];break;case 5:f=[0,1,3,4,6,7];break;case 7:f=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}const g=f.length;for(const b of r)for(const w of b){const S=w.x,M=w.y;if(S<0||S>=It||M<0||M>=It)continue;const z=this.segments.prepareSegment(g*g,this.layoutVertexArray,this.indexArray,t.sortKey),R=z.vertexLength;for(let F=0;F<g;F++)for(let O=0;O<g;O++)Zu(this.layoutVertexArray,S,M,f[O],f[F]);for(let F=0;F<g-1;F++)for(let O=0;O<g-1;O++){const q=R+F*g+O,X=R+(F+1)*g+O;this.indexArray.emplaceBack(q,X+1,q+1),this.indexArray.emplaceBack(q,X,X+1)}z.vertexLength+=g*g,z.primitiveLength+=(g-1)*(g-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},c)}}function Ql(n,t){for(let r=0;r<n.length;r++)if(Io(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Io(n,t[r]))return!0;return!!fd(n,t)}function ec(n,t,r){return!!Io(n,t)||!!md(t,n,r)}function tc(n,t){if(n.length===1)return Up(t,n[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let c=0;c<s.length;c++)if(Io(n,s[c]))return!0}for(let r=0;r<n.length;r++)if(Up(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(fd(n,t[r]))return!0;return!1}function ic(n,t,r){if(n.length>1){if(fd(n,t))return!0;for(let s=0;s<t.length;s++)if(md(t[s],n,r))return!0}for(let s=0;s<n.length;s++)if(md(n[s],t,r))return!0;return!1}function fd(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const s=n[r],c=n[r+1];for(let d=0;d<t.length-1;d++)if(Yg(s,c,t[d],t[d+1]))return!0}return!1}function Yg(n,t,r,s){return gi(n,r,s)!==gi(t,r,s)&&gi(n,t,r)!==gi(n,t,s)}function md(n,t,r){const s=r*r;if(t.length===1)return n.distSqr(t[0])<s;for(let c=1;c<t.length;c++)if(Vp(n,t[c-1],t[c])<s)return!0;return!1}function Vp(n,t,r){const s=t.distSqr(r);if(s===0)return n.distSqr(t);const c=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/s;return n.distSqr(c<0?t:c>1?r:r.sub(t)._mult(c)._add(t))}function Up(n,t){let r,s,c,d=!1;for(let f=0;f<n.length;f++){r=n[f];for(let g=0,b=r.length-1;g<r.length;b=g++)s=r[g],c=r[b],s.y>t.y!=c.y>t.y&&t.x<(c.x-s.x)*(t.y-s.y)/(c.y-s.y)+s.x&&(d=!d)}return d}function Io(n,t){let r=!1;for(let s=0,c=n.length-1;s<n.length;c=s++){const d=n[s],f=n[c];d.y>t.y!=f.y>t.y&&t.x<(f.x-d.x)*(t.y-d.y)/(f.y-d.y)+d.x&&(r=!r)}return r}function Jg(n,t,r){const s=r[0],c=r[2];if(n.x<s.x&&t.x<s.x||n.x>c.x&&t.x>c.x||n.y<s.y&&t.y<s.y||n.y>c.y&&t.y>c.y)return!1;const d=gi(n,t,r[0]);return d!==gi(n,t,r[1])||d!==gi(n,t,r[2])||d!==gi(n,t,r[3])}function rc(n,t,r){const s=t.paint.get(n).value;return s.kind==="constant"?s.value:r.programConfigurations.get(t.id).getMaxValue(n)}function Gu(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Hu(n,t,r,s,c){if(!t[0]&&!t[1])return n;const d=ge.convert(t)._mult(c);r==="viewport"&&d._rotate(-s);const f=[];for(let g=0;g<n.length;g++)f.push(n[g].sub(d));return f}let $p,qp;Ge("CircleBucket",Mo,{omit:["layers"]});var Qg={get paint(){return qp=qp||new tr({"circle-radius":new ot(Z.paint_circle["circle-radius"]),"circle-color":new ot(Z.paint_circle["circle-color"]),"circle-blur":new ot(Z.paint_circle["circle-blur"]),"circle-opacity":new ot(Z.paint_circle["circle-opacity"]),"circle-translate":new it(Z.paint_circle["circle-translate"]),"circle-translate-anchor":new it(Z.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new it(Z.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new it(Z.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ot(Z.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ot(Z.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ot(Z.paint_circle["circle-stroke-opacity"])})},get layout(){return $p=$p||new tr({"circle-sort-key":new ot(Z.layout_circle["circle-sort-key"])})}};class e_ extends qr{constructor(t){super(t,Qg)}createBucket(t){return new Mo(t)}queryRadius(t){const r=t;return rc("circle-radius",this,r)+rc("circle-stroke-width",this,r)+Gu(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:s,geometry:c,transform:d,pixelsToTileUnits:f,pixelPosMatrix:g}){const b=Hu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,f),w=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),S=this.paint.get("circle-pitch-alignment")==="map",M=S?b:function(R,F){return R.map(O=>Zp(O,F))}(b,g),z=S?w*f:w;for(const R of c)for(const F of R){const O=S?F:Zp(F,g);let q=z;const X=zi([],[F.x,F.y,0,1],g);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?q*=X[3]/d.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(q*=d.cameraToCenterDistance/X[3]),ec(M,O,q))return!0}return!1}}function Zp(n,t){const r=zi([],[n.x,n.y,0,1],t);return new ge(r[0]/r[3],r[1]/r[3])}class Gp extends Mo{}let Hp;Ge("HeatmapBucket",Gp,{omit:["layers"]});var t_={get paint(){return Hp=Hp||new tr({"heatmap-radius":new ot(Z.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ot(Z.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new it(Z.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Po(Z.paint_heatmap["heatmap-color"]),"heatmap-opacity":new it(Z.paint_heatmap["heatmap-opacity"])})}};function gd(n,{width:t,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*r*s)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*r*s}`)}else c=new Uint8Array(t*r*s);return n.width=t,n.height=r,n.data=c,n}function Wp(n,{width:t,height:r},s){if(t===n.width&&r===n.height)return;const c=gd({},{width:t,height:r},s);_d(n,c,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},s),n.width=t,n.height=r,n.data=c.data}function _d(n,t,r,s,c,d){if(c.width===0||c.height===0)return t;if(c.width>n.width||c.height>n.height||r.x>n.width-c.width||r.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||s.x>t.width-c.width||s.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const f=n.data,g=t.data;if(f===g)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<c.height;b++){const w=((r.y+b)*n.width+r.x)*d,S=((s.y+b)*t.width+s.x)*d;for(let M=0;M<c.width*d;M++)g[S+M]=f[w+M]}return t}class nc{constructor(t,r){gd(this,t,1,r)}resize(t){Wp(this,t,1)}clone(){return new nc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,c,d){_d(t,r,s,c,d,1)}}class Dr{constructor(t,r){gd(this,t,4,r)}resize(t){Wp(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Dr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,c,d){_d(t,r,s,c,d,4)}}function Xp(n){const t={},r=n.resolution||256,s=n.clips?n.clips.length:1,c=n.image||new Dr({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const d=(f,g,b)=>{t[n.evaluationKey]=b;const w=n.expression.evaluate(t);c.data[f+g+0]=Math.floor(255*w.r/w.a),c.data[f+g+1]=Math.floor(255*w.g/w.a),c.data[f+g+2]=Math.floor(255*w.b/w.a),c.data[f+g+3]=Math.floor(255*w.a)};if(n.clips)for(let f=0,g=0;f<s;++f,g+=4*r)for(let b=0,w=0;b<r;b++,w+=4){const S=b/(r-1),{start:M,end:z}=n.clips[f];d(g,w,M*(1-S)+z*S)}else for(let f=0,g=0;f<r;f++,g+=4)d(0,g,f/(r-1));return c}Ge("AlphaImage",nc),Ge("RGBAImage",Dr);const yd="big-fb";class i_ extends qr{createBucket(t){return new Gp(t)}constructor(t){super(t,t_),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(yd)&&this.heatmapFbos.delete(yd)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Kp;var r_={get paint(){return Kp=Kp||new tr({"hillshade-illumination-direction":new it(Z.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new it(Z.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new it(Z.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new it(Z.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new it(Z.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new it(Z.paint_hillshade["hillshade-accent-color"])})}};class n_ extends qr{constructor(t){super(t,r_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const s_=li([{name:"a_pos",components:2,type:"Int16"}],4),{members:a_}=s_;function vd(n,t,r){const s=r.patternDependencies;let c=!1;for(const d of t){const f=d.paint.get(`${n}-pattern`);f.isConstant()||(c=!0);const g=f.constantOr(null);g&&(c=!0,s[g.to]=!0,s[g.from]=!0)}return c}function bd(n,t,r,s,c){const d=c.patternDependencies;for(const f of t){const g=f.paint.get(`${n}-pattern`).value;if(g.kind!=="constant"){let b=g.evaluate({zoom:s-1},r,{},c.availableImages),w=g.evaluate({zoom:s},r,{},c.availableImages),S=g.evaluate({zoom:s+1},r,{},c.availableImages);b=b&&b.name?b.name:b,w=w&&w.name?w.name:w,S=S&&S.name?S.name:S,d[b]=!0,d[w]=!0,d[S]=!0,r.patterns[f.id]={min:b,mid:w,max:S}}}return r}function Yp(n,t,r,s,c){let d;if(c===function(f,g,b,w){let S=0;for(let M=g,z=b-w;M<b;M+=w)S+=(f[z]-f[M])*(f[M+1]+f[z+1]),z=M;return S}(n,t,r,s)>0)for(let f=t;f<r;f+=s)d=tf(f/s|0,n[f],n[f+1],d);else for(let f=r-s;f>=t;f-=s)d=tf(f/s|0,n[f],n[f+1],d);return d&&Eo(d,d.next)&&(lc(d),d=d.next),d}function za(n,t){if(!n)return n;t||(t=n);let r,s=n;do if(r=!1,s.steiner||!Eo(s,s.next)&&ci(s.prev,s,s.next)!==0)s=s.next;else{if(lc(s),s=t=s.prev,s===s.next)break;r=!0}while(r||s!==t);return t}function sc(n,t,r,s,c,d,f){if(!n)return;!f&&d&&function(b,w,S,M){let z=b;do z.z===0&&(z.z=xd(z.x,z.y,w,S,M)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==b);z.prevZ.nextZ=null,z.prevZ=null,function(R){let F,O=1;do{let q,X=R;R=null;let ue=null;for(F=0;X;){F++;let ee=X,L=0;for(let te=0;te<O&&(L++,ee=ee.nextZ,ee);te++);let $=O;for(;L>0||$>0&&ee;)L!==0&&($===0||!ee||X.z<=ee.z)?(q=X,X=X.nextZ,L--):(q=ee,ee=ee.nextZ,$--),ue?ue.nextZ=q:R=q,q.prevZ=ue,ue=q;X=ee}ue.nextZ=null,O*=2}while(F>1)}(z)}(n,s,c,d);let g=n;for(;n.prev!==n.next;){const b=n.prev,w=n.next;if(d?l_(n,s,c,d):o_(n))t.push(b.i,n.i,w.i),lc(n),n=w.next,g=w.next;else if((n=w)===g){f?f===1?sc(n=c_(za(n),t),t,r,s,c,d,2):f===2&&u_(n,t,r,s,c,d):sc(za(n),t,r,s,c,d,1);break}}}function o_(n){const t=n.prev,r=n,s=n.next;if(ci(t,r,s)>=0)return!1;const c=t.x,d=r.x,f=s.x,g=t.y,b=r.y,w=s.y,S=Math.min(c,d,f),M=Math.min(g,b,w),z=Math.max(c,d,f),R=Math.max(g,b,w);let F=s.next;for(;F!==t;){if(F.x>=S&&F.x<=z&&F.y>=M&&F.y<=R&&ac(c,g,d,b,f,w,F.x,F.y)&&ci(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function l_(n,t,r,s){const c=n.prev,d=n,f=n.next;if(ci(c,d,f)>=0)return!1;const g=c.x,b=d.x,w=f.x,S=c.y,M=d.y,z=f.y,R=Math.min(g,b,w),F=Math.min(S,M,z),O=Math.max(g,b,w),q=Math.max(S,M,z),X=xd(R,F,t,r,s),ue=xd(O,q,t,r,s);let ee=n.prevZ,L=n.nextZ;for(;ee&&ee.z>=X&&L&&L.z<=ue;){if(ee.x>=R&&ee.x<=O&&ee.y>=F&&ee.y<=q&&ee!==c&&ee!==f&&ac(g,S,b,M,w,z,ee.x,ee.y)&&ci(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,L.x>=R&&L.x<=O&&L.y>=F&&L.y<=q&&L!==c&&L!==f&&ac(g,S,b,M,w,z,L.x,L.y)&&ci(L.prev,L,L.next)>=0))return!1;L=L.nextZ}for(;ee&&ee.z>=X;){if(ee.x>=R&&ee.x<=O&&ee.y>=F&&ee.y<=q&&ee!==c&&ee!==f&&ac(g,S,b,M,w,z,ee.x,ee.y)&&ci(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;L&&L.z<=ue;){if(L.x>=R&&L.x<=O&&L.y>=F&&L.y<=q&&L!==c&&L!==f&&ac(g,S,b,M,w,z,L.x,L.y)&&ci(L.prev,L,L.next)>=0)return!1;L=L.nextZ}return!0}function c_(n,t){let r=n;do{const s=r.prev,c=r.next.next;!Eo(s,c)&&Qp(s,r,r.next,c)&&oc(s,c)&&oc(c,s)&&(t.push(s.i,r.i,c.i),lc(r),lc(r.next),r=n=c),r=r.next}while(r!==n);return za(r)}function u_(n,t,r,s,c,d){let f=n;do{let g=f.next.next;for(;g!==f.prev;){if(f.i!==g.i&&m_(f,g)){let b=ef(f,g);return f=za(f,f.next),b=za(b,b.next),sc(f,t,r,s,c,d,0),void sc(b,t,r,s,c,d,0)}g=g.next}f=f.next}while(f!==n)}function h_(n,t){let r=n.x-t.x;return r===0&&(r=n.y-t.y,r===0)&&(r=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function d_(n,t){const r=function(c,d){let f=d;const g=c.x,b=c.y;let w,S=-1/0;if(Eo(c,f))return f;do{if(Eo(c,f.next))return f.next;if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){const O=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(O<=g&&O>S&&(S=O,w=f.x<f.next.x?f:f.next,O===g))return w}f=f.next}while(f!==d);if(!w)return null;const M=w,z=w.x,R=w.y;let F=1/0;f=w;do{if(g>=f.x&&f.x>=z&&g!==f.x&&Jp(b<R?g:S,b,z,R,b<R?S:g,b,f.x,f.y)){const O=Math.abs(b-f.y)/(g-f.x);oc(f,c)&&(O<F||O===F&&(f.x>w.x||f.x===w.x&&p_(w,f)))&&(w=f,F=O)}f=f.next}while(f!==M);return w}(n,t);if(!r)return t;const s=ef(r,n);return za(s,s.next),za(r,r.next)}function p_(n,t){return ci(n.prev,n,t.prev)<0&&ci(t.next,n,n.next)<0}function xd(n,t,r,s,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f_(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function Jp(n,t,r,s,c,d,f,g){return(c-f)*(t-g)>=(n-f)*(d-g)&&(n-f)*(s-g)>=(r-f)*(t-g)&&(r-f)*(d-g)>=(c-f)*(s-g)}function ac(n,t,r,s,c,d,f,g){return!(n===f&&t===g)&&Jp(n,t,r,s,c,d,f,g)}function m_(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(r,s){let c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&Qp(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(n,t)&&(oc(n,t)&&oc(t,n)&&function(r,s){let c=r,d=!1;const f=(r.x+s.x)/2,g=(r.y+s.y)/2;do c.y>g!=c.next.y>g&&c.next.y!==c.y&&f<(c.next.x-c.x)*(g-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==r);return d}(n,t)&&(ci(n.prev,n,t.prev)||ci(n,t.prev,t))||Eo(n,t)&&ci(n.prev,n,n.next)>0&&ci(t.prev,t,t.next)>0)}function ci(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function Eo(n,t){return n.x===t.x&&n.y===t.y}function Qp(n,t,r,s){const c=Xu(ci(n,t,r)),d=Xu(ci(n,t,s)),f=Xu(ci(r,s,n)),g=Xu(ci(r,s,t));return c!==d&&f!==g||!(c!==0||!Wu(n,r,t))||!(d!==0||!Wu(n,s,t))||!(f!==0||!Wu(r,n,s))||!(g!==0||!Wu(r,t,s))}function Wu(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function Xu(n){return n>0?1:n<0?-1:0}function oc(n,t){return ci(n.prev,n,n.next)<0?ci(n,t,n.next)>=0&&ci(n,n.prev,t)>=0:ci(n,t,n.prev)<0||ci(n,n.next,t)<0}function ef(n,t){const r=wd(n.i,n.x,n.y),s=wd(t.i,t.x,t.y),c=n.next,d=t.prev;return n.next=t,t.prev=n,r.next=c,c.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function tf(n,t,r,s){const c=wd(n,t,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function lc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function wd(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ko{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Ku{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Ku.noSubdivision=new Ku({fill:new ko(0,0),line:new ko(0,0),tile:new ko(0,0),stencil:new ko(0,0),circle:1}),Ge("SubdivisionGranularityExpression",ko),Ge("SubdivisionGranularitySetting",Ku);const Ao=-32768,cc=32767;class g_{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=It/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|(r+=32768)<<0}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const s=0|Math.round(t),c=0|Math.round(r),d=this._getKey(s,c);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);const f=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,f),this._vertexBuffer.push(s,c),f}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(c,d){const f=[];for(let g=0;g<d.length;g+=3){const b=d[g],w=d[g+1],S=d[g+2],M=c[2*b],z=c[2*b+1];(c[2*w]-M)*(c[2*S+1]-z)-(c[2*w+1]-z)*(c[2*S]-M)>0?(f.push(b),f.push(S),f.push(w)):(f.push(b),f.push(w),f.push(S))}return f}(this._vertexBuffer,t);const r=[],s=t.length;for(let c=0;c<s;c+=3){const d=[t[c+0],t[c+1],t[c+2]],f=[this._vertexBuffer[2*t[c+0]+0],this._vertexBuffer[2*t[c+0]+1],this._vertexBuffer[2*t[c+1]+0],this._vertexBuffer[2*t[c+1]+1],this._vertexBuffer[2*t[c+2]+0],this._vertexBuffer[2*t[c+2]+1]];let g=1/0,b=1/0,w=-1/0,S=-1/0;for(let O=0;O<3;O++){const q=f[2*O],X=f[2*O+1];g=Math.min(g,q),w=Math.max(w,q),b=Math.min(b,X),S=Math.max(S,X)}if(g===w||b===S)continue;const M=Math.floor(g/this._granularityCellSize),z=Math.ceil(w/this._granularityCellSize),R=Math.floor(b/this._granularityCellSize),F=Math.ceil(S/this._granularityCellSize);if(M!==z||R!==F)for(let O=R;O<F;O++){const q=this._scanlineGenerateVertexRingForCellRow(O,f,d);__(this._vertexBuffer,q,r)}else r.push(...d)}return r}_scanlineGenerateVertexRingForCellRow(t,r,s){const c=t*this._granularityCellSize,d=c+this._granularityCellSize,f=[];for(let g=0;g<3;g++){const b=r[2*g],w=r[2*g+1],S=r[2*(g+1)%6],M=r[(2*(g+1)+1)%6],z=r[2*(g+2)%6],R=r[(2*(g+2)+1)%6],F=S-b,O=M-w,q=F===0,X=O===0,ue=(c-w)/O,ee=(d-w)/O,L=Math.min(ue,ee),$=Math.max(ue,ee);if(!X&&(L>=1||$<=0)||X&&(w<c||w>d)){M>=c&&M<=d&&f.push(s[(g+1)%3]);continue}!X&&L>0&&f.push(this._vertexToIndex(b+F*L,w+O*L));const te=b+F*Math.max(L,0),ve=b+F*Math.min($,1);q||this._generateIntraEdgeVertices(f,b,w,S,M,te,ve),!X&&$<1&&f.push(this._vertexToIndex(b+F*$,w+O*$)),(X||M>=c&&M<=d)&&f.push(s[(g+1)%3]),!X&&(M<=c||M>=d)&&this._generateInterEdgeVertices(f,b,w,S,M,z,R,ve,c,d)}return f}_generateIntraEdgeVertices(t,r,s,c,d,f,g){const b=c-r,w=d-s,S=w===0,M=S?Math.min(r,c):Math.min(f,g),z=S?Math.max(r,c):Math.max(f,g),R=Math.floor(M/this._granularityCellSize)+1,F=Math.ceil(z/this._granularityCellSize)-1;if(S?r<c:f<g)for(let O=R;O<=F;O++){const q=O*this._granularityCellSize;t.push(this._vertexToIndex(q,s+w*(q-r)/b))}else for(let O=F;O>=R;O--){const q=O*this._granularityCellSize;t.push(this._vertexToIndex(q,s+w*(q-r)/b))}}_generateInterEdgeVertices(t,r,s,c,d,f,g,b,w,S){const M=d-s,z=f-c,R=g-d,F=(w-d)/R,O=(S-d)/R,q=Math.min(F,O),X=Math.max(F,O),ue=c+z*q;let ee=Math.floor(Math.min(ue,b)/this._granularityCellSize)+1,L=Math.ceil(Math.max(ue,b)/this._granularityCellSize)-1,$=b<ue;const te=R===0;if(te&&(g===w||g===S))return;if(te||q>=1||X<=0){const ze=s-g,Te=f+(r-f)*Math.min((w-g)/ze,(S-g)/ze);ee=Math.floor(Math.min(Te,b)/this._granularityCellSize)+1,L=Math.ceil(Math.max(Te,b)/this._granularityCellSize)-1,$=b<Te}const ve=M>0?S:w;if($)for(let ze=ee;ze<=L;ze++)t.push(this._vertexToIndex(ze*this._granularityCellSize,ve));else for(let ze=L;ze>=ee;ze--)t.push(this._vertexToIndex(ze*this._granularityCellSize,ve))}_generateOutline(t){const r=[];for(const s of t){const c=Da(s,this._granularity,!0),d=this._pointArrayToIndices(c),f=[];for(let g=1;g<d.length;g++)f.push(d[g-1]),f.push(d[g]);r.push(f)}return r}_handlePoles(t){let r=!1,s=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(s=!0)),(r||s)&&this._fillPoles(t,r,s)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const s=t[r+1];s===Ao&&(t[r+1]=-32767),s===cc&&(t[r+1]=32766)}}_generatePoleQuad(t,r,s,c,d,f){c>d!=(f===Ao)?(t.push(r),t.push(s),t.push(this._vertexToIndex(c,f)),t.push(s),t.push(this._vertexToIndex(d,f)),t.push(this._vertexToIndex(c,f))):(t.push(s),t.push(r),t.push(this._vertexToIndex(c,f)),t.push(this._vertexToIndex(d,f)),t.push(s),t.push(this._vertexToIndex(c,f)))}_fillPoles(t,r,s){const c=this._vertexBuffer,d=It,f=t.length;for(let g=2;g<f;g+=3){const b=t[g-2],w=t[g-1],S=t[g],M=c[2*b],z=c[2*b+1],R=c[2*w],F=c[2*w+1],O=c[2*S],q=c[2*S+1];r&&(z===0&&F===0&&this._generatePoleQuad(t,b,w,M,R,Ao),F===0&&q===0&&this._generatePoleQuad(t,w,S,R,O,Ao),q===0&&z===0&&this._generatePoleQuad(t,S,b,O,M,Ao)),s&&(z===d&&F===d&&this._generatePoleQuad(t,b,w,M,R,cc),F===d&&q===d&&this._generatePoleQuad(t,w,S,R,O,cc),q===d&&z===d&&this._generatePoleQuad(t,S,b,O,M,cc))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:s,holeIndices:c}=function(g){const b=[],w=[];for(const S of g)if(S.length!==0){S!==g[0]&&b.push(w.length/2);for(let M=0;M<S.length;M++)w.push(S[M].x),w.push(S[M].y)}return{flattened:w,holeIndices:b}}(t);let d;this._initializeVertices(s);try{const g=function(w,S,M=2){const z=S&&S.length,R=z?S[0]*M:w.length;let F=Yp(w,0,R,M,!0);const O=[];if(!F||F.next===F.prev)return O;let q,X,ue;if(z&&(F=function(ee,L,$,te){const ve=[];for(let ze=0,Te=L.length;ze<Te;ze++){const Ce=Yp(ee,L[ze]*te,ze<Te-1?L[ze+1]*te:ee.length,te,!1);Ce===Ce.next&&(Ce.steiner=!0),ve.push(f_(Ce))}ve.sort(h_);for(let ze=0;ze<ve.length;ze++)$=d_(ve[ze],$);return $}(w,S,F,M)),w.length>80*M){q=1/0,X=1/0;let ee=-1/0,L=-1/0;for(let $=M;$<R;$+=M){const te=w[$],ve=w[$+1];te<q&&(q=te),ve<X&&(X=ve),te>ee&&(ee=te),ve>L&&(L=ve)}ue=Math.max(ee-q,L-X),ue=ue!==0?32767/ue:0}return sc(F,O,M,q,X,ue,0),O}(s,c),b=this._convertIndices(s,g);d=this._subdivideTrianglesScanline(b)}catch(g){console.error(g)}let f=[];return r&&(f=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:f}}_convertIndices(t,r){const s=[];for(let c=0;c<r.length;c++)s.push(this._vertexToIndex(t[2*r[c]],t[2*r[c]+1]));return s}_pointArrayToIndices(t){const r=[];for(let s=0;s<t.length;s++){const c=t[s];r.push(this._vertexToIndex(c.x,c.y))}return r}}function rf(n,t,r,s=!0){return new g_(r,t).subdividePolygonInternal(n,s)}function Da(n,t,r=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const s=n[0],c=n[n.length-1],d=r&&(s.x!==c.x||s.y!==c.y);if(t<2)return d?[...n,n[0]]:[...n];const f=Math.floor(It/t),g=[];g.push(new ge(n[0].x,n[0].y));const b=n.length,w=d?b:b-1;for(let S=0;S<w;S++){const M=n[S],z=S<b-1?n[S+1]:n[0],R=M.x,F=M.y,O=z.x,q=z.y,X=R!==O,ue=F!==q;if(!X&&!ue)continue;const ee=O-R,L=q-F,$=Math.abs(ee),te=Math.abs(L);let ve=R,ze=F;for(;;){const Ce=ee>0?(Math.floor(ve/f)+1)*f:(Math.ceil(ve/f)-1)*f,Fe=L>0?(Math.floor(ze/f)+1)*f:(Math.ceil(ze/f)-1)*f,Le=Math.abs(ve-Ce),Be=Math.abs(ze-Fe),Ee=Math.abs(ve-O),Ke=Math.abs(ze-q),st=X?Le/$:Number.POSITIVE_INFINITY,nt=ue?Be/te:Number.POSITIVE_INFINITY;if((Ee<=Le||!X)&&(Ke<=Be||!ue))break;if(st<nt&&X||!ue){ve=Ce,ze+=L*st;const tt=new ge(ve,Math.round(ze));g[g.length-1].x===tt.x&&g[g.length-1].y===tt.y||g.push(tt)}else{ve+=ee*nt,ze=Fe;const tt=new ge(Math.round(ve),ze);g[g.length-1].x===tt.x&&g[g.length-1].y===tt.y||g.push(tt)}}const Te=new ge(O,q);g[g.length-1].x===Te.x&&g[g.length-1].y===Te.y||g.push(Te)}return g}function __(n,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let s=0,c=n[2*t[0]];for(let b=1;b<t.length;b++){const w=n[2*t[b]];w<c&&(c=w,s=b)}const d=t.length;let f=s,g=(f+1)%d;for(;;){const b=f-1>=0?f-1:d-1,w=(g+1)%d,S=n[2*t[b]],M=n[2*t[w]],z=n[2*t[f]],R=n[2*t[f]+1],F=n[2*t[g]+1];let O=!1;if(S<M)O=!0;else if(S>M)O=!1;else{const q=F-R,X=-(n[2*t[g]]-z),ue=R<F?1:-1;((S-z)*q+(n[2*t[b]+1]-R)*X)*ue>((M-z)*q+(n[2*t[w]+1]-R)*X)*ue&&(O=!0)}if(O){const q=t[b],X=t[f],ue=t[g];q!==X&&q!==ue&&X!==ue&&r.push(ue,X,q),f--,f<0&&(f=d-1)}else{const q=t[w],X=t[f],ue=t[g];q!==X&&q!==ue&&X!==ue&&r.push(ue,X,q),g++,g>=d&&(g=0)}if(b===w)break}}function nf(n,t,r,s,c,d,f,g,b){const w=c.length/2,S=f&&g&&b;if(w<qe.MAX_VERTEX_ARRAY_LENGTH){const M=t.prepareSegment(w,r,s),z=M.vertexLength;for(let O=0;O<d.length;O+=3)s.emplaceBack(z+d[O],z+d[O+1],z+d[O+2]);let R,F;M.vertexLength+=w,M.primitiveLength+=d.length/3,S&&(F=f.prepareSegment(w,r,g),R=F.vertexLength,F.vertexLength+=w);for(let O=0;O<c.length;O+=2)n(c[O],c[O+1]);if(S)for(let O=0;O<b.length;O++){const q=b[O];for(let X=1;X<q.length;X+=2)g.emplaceBack(R+q[X-1],R+q[X]);F.primitiveLength+=q.length/2}}else(function(M,z,R,F,O,q){const X=[];for(let te=0;te<F.length/2;te++)X.push(-1);const ue={count:0};let ee=0,L=M.getOrCreateLatestSegment(z,R),$=L.vertexLength;for(let te=2;te<O.length;te+=3){const ve=O[te-2],ze=O[te-1],Te=O[te];let Ce=X[ve]<ee,Fe=X[ze]<ee,Le=X[Te]<ee;L.vertexLength+((Ce?1:0)+(Fe?1:0)+(Le?1:0))>qe.MAX_VERTEX_ARRAY_LENGTH&&(L=M.createNewSegment(z,R),ee=ue.count,Ce=!0,Fe=!0,Le=!0,$=0);const Be=uc(X,F,q,ue,ve,Ce,L),Ee=uc(X,F,q,ue,ze,Fe,L),Ke=uc(X,F,q,ue,Te,Le,L);R.emplaceBack($+Be-ee,$+Ee-ee,$+Ke-ee),L.primitiveLength++}})(t,r,s,c,d,n),S&&function(M,z,R,F,O,q){const X=[];for(let te=0;te<F.length/2;te++)X.push(-1);const ue={count:0};let ee=0,L=M.getOrCreateLatestSegment(z,R),$=L.vertexLength;for(let te=0;te<O.length;te++){const ve=O[te];for(let ze=1;ze<O[te].length;ze+=2){const Te=ve[ze-1],Ce=ve[ze];let Fe=X[Te]<ee,Le=X[Ce]<ee;L.vertexLength+((Fe?1:0)+(Le?1:0))>qe.MAX_VERTEX_ARRAY_LENGTH&&(L=M.createNewSegment(z,R),ee=ue.count,Fe=!0,Le=!0,$=0);const Be=uc(X,F,q,ue,Te,Fe,L),Ee=uc(X,F,q,ue,Ce,Le,L);R.emplaceBack($+Be-ee,$+Ee-ee),L.primitiveLength++}}}(f,r,g,c,b,n),t.forceNewSegmentOnNextPrepare(),f==null||f.forceNewSegmentOnNextPrepare()}function uc(n,t,r,s,c,d,f){if(d){const g=s.count;return r(t[2*c],t[2*c+1]),n[c]=s.count,s.count++,f.vertexLength++,g}return n[c]}class Td{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Y,this.indexArray=new Se,this.indexArray2=new Ve,this.programConfigurations=new ti(t.layers,t.zoom),this.segments=new qe,this.segments2=new qe,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=vd("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),d=!c.isConstant(),f=[];for(const{feature:g,id:b,index:w,sourceLayerIndex:S}of t){const M=this.layers[0]._featureFilter.needGeometry,z=cs(g,M);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),z,s))continue;const R=d?c.evaluate(z,{},s,r.availableImages):void 0,F={id:b,properties:g.properties,type:g.type,sourceLayerIndex:S,index:w,geometry:M?z.geometry:ls(g),patterns:{},sortKey:R};f.push(F)}d&&f.sort((g,b)=>g.sortKey-b.sortKey);for(const g of f){const{geometry:b,index:w,sourceLayerIndex:S}=g;if(this.hasPattern){const M=bd("fill",this.layers,g,this.zoom,r);this.patternFeatures.push(M)}else this.addFeature(g,b,w,s,{},r.subdivisionGranularity);r.featureIndex.insert(t[w].feature,b,w,S,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,a_),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,c,d,f){for(const g of Xa(r,500)){const b=rf(g,c,f.fill.getGranularityForZoomLevel(c.z)),w=this.layoutVertexArray;nf((S,M)=>{w.emplaceBack(S,M)},this.segments,this.layoutVertexArray,this.indexArray,b.verticesFlattened,b.indicesTriangles,this.segments2,this.indexArray2,b.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,c)}}let sf,af;Ge("FillBucket",Td,{omit:["layers","patternFeatures"]});var y_={get paint(){return af=af||new tr({"fill-antialias":new it(Z.paint_fill["fill-antialias"]),"fill-opacity":new ot(Z.paint_fill["fill-opacity"]),"fill-color":new ot(Z.paint_fill["fill-color"]),"fill-outline-color":new ot(Z.paint_fill["fill-outline-color"]),"fill-translate":new it(Z.paint_fill["fill-translate"]),"fill-translate-anchor":new it(Z.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ta(Z.paint_fill["fill-pattern"])})},get layout(){return sf=sf||new tr({"fill-sort-key":new ot(Z.layout_fill["fill-sort-key"])})}};class v_ extends qr{constructor(t){super(t,y_)}recalculate(t,r){super.recalculate(t,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Td(t)}queryRadius(){return Gu(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:s,pixelsToTileUnits:c}){return tc(Hu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-s.bearingInRadians,c),r)}isTileClipped(){return!0}}const b_=li([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),x_=li([{name:"a_centroid",components:2,type:"Int16"}],4),{members:w_}=b_;var Pd,of,Sd,lf,Cd,cf,uf,Yu={};function hf(){if(of)return Pd;of=1;var n=xe();function t(c,d,f,g,b){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=g,this._values=b,c.readFields(r,this,d)}function r(c,d,f){c==1?d.id=f.readVarint():c==2?function(g,b){for(var w=g.readVarint()+g.pos;g.pos<w;){var S=b._keys[g.readVarint()],M=b._values[g.readVarint()];b.properties[S]=M}}(f,d):c==3?d.type=f.readVarint():c==4&&(d._geometry=f.pos)}function s(c){for(var d,f,g=0,b=0,w=c.length,S=w-1;b<w;S=b++)g+=((f=c[S]).x-(d=c[b]).x)*(d.y+f.y);return g}return Pd=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var d,f=c.readVarint()+c.pos,g=1,b=0,w=0,S=0,M=[];c.pos<f;){if(b<=0){var z=c.readVarint();g=7&z,b=z>>3}if(b--,g===1||g===2)w+=c.readSVarint(),S+=c.readSVarint(),g===1&&(d&&M.push(d),d=[]),d.push(new n(w,S));else{if(g!==7)throw new Error("unknown command "+g);d&&d.push(d[0].clone())}}return d&&M.push(d),M},t.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var d=c.readVarint()+c.pos,f=1,g=0,b=0,w=0,S=1/0,M=-1/0,z=1/0,R=-1/0;c.pos<d;){if(g<=0){var F=c.readVarint();f=7&F,g=F>>3}if(g--,f===1||f===2)(b+=c.readSVarint())<S&&(S=b),b>M&&(M=b),(w+=c.readSVarint())<z&&(z=w),w>R&&(R=w);else if(f!==7)throw new Error("unknown command "+f)}return[S,z,M,R]},t.prototype.toGeoJSON=function(c,d,f){var g,b,w=this.extent*Math.pow(2,f),S=this.extent*c,M=this.extent*d,z=this.loadGeometry(),R=t.types[this.type];function F(X){for(var ue=0;ue<X.length;ue++){var ee=X[ue];X[ue]=[360*(ee.x+S)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+M)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(g=0;g<z.length;g++)O[g]=z[g][0];F(z=O);break;case 2:for(g=0;g<z.length;g++)F(z[g]);break;case 3:for(z=function(X){var ue=X.length;if(ue<=1)return[X];for(var ee,L,$=[],te=0;te<ue;te++){var ve=s(X[te]);ve!==0&&(L===void 0&&(L=ve<0),L===ve<0?(ee&&$.push(ee),ee=[X[te]]):ee.push(X[te]))}return ee&&$.push(ee),$}(z),g=0;g<z.length;g++)for(b=0;b<z[g].length;b++)F(z[g][b])}z.length===1?z=z[0]:R="Multi"+R;var q={type:"Feature",geometry:{type:R,coordinates:z},properties:this.properties};return"id"in this&&(q.id=this.id),q},Pd}function df(){if(lf)return Sd;lf=1;var n=hf();function t(s,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(r,this,c),this.length=this._features.length}function r(s,c,d){s===15?c.version=d.readVarint():s===1?c.name=d.readString():s===5?c.extent=d.readVarint():s===2?c._features.push(d.pos):s===3?c._keys.push(d.readString()):s===4&&c._values.push(function(f){for(var g=null,b=f.readVarint()+f.pos;f.pos<b;){var w=f.readVarint()>>3;g=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return g}(d))}return Sd=t,t.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var c=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,c,this.extent,this._keys,this._values)},Sd}function pf(){return uf||(uf=1,Yu.VectorTile=function(){if(cf)return Cd;cf=1;var n=df();function t(r,s,c){if(r===3){var d=new n(c,c.readVarint()+c.pos);d.length&&(s[d.name]=d)}}return Cd=function(r,s){this.layers=r.readFields(t,{},s)},Cd}(),Yu.VectorTileFeature=hf(),Yu.VectorTileLayer=df()),Yu}var hc=he(pf());const T_=hc.VectorTileFeature.types,Md=Math.pow(2,13);function dc(n,t,r,s,c,d,f,g){n.emplaceBack(t,r,2*Math.floor(s*Md)+f,c*Md*2,d*Md*2,Math.round(g))}class Id{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new re,this.centroidVertexArray=new G,this.indexArray=new Se,this.programConfigurations=new ti(t.layers,t.zoom),this.segments=new qe,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.features=[],this.hasPattern=vd("fill-extrusion",this.layers,r);for(const{feature:c,id:d,index:f,sourceLayerIndex:g}of t){const b=this.layers[0]._featureFilter.needGeometry,w=cs(c,b);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),w,s))continue;const S={id:d,sourceLayerIndex:g,index:f,geometry:b?w.geometry:ls(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(bd("fill-extrusion",this.layers,S,this.zoom,r)):this.addFeature(S,S.geometry,f,s,{},r.subdivisionGranularity),r.featureIndex.insert(c,S.geometry,f,g,this.index,!0)}}addFeatures(t,r,s){for(const c of this.features){const{geometry:d}=c;this.addFeature(c,d,c.index,r,s,t.subdivisionGranularity)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,w_),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,x_.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,s,c,d,f){for(const g of Xa(r,500)){const b={x:0,y:0,sampleCount:0},w=this.layoutVertexArray.length;this.processPolygon(b,c,t,g,f);const S=this.layoutVertexArray.length-w,M=Math.floor(b.x/b.sampleCount),z=Math.floor(b.y/b.sampleCount);for(let R=0;R<S;R++)this.centroidVertexArray.emplaceBack(M,z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,c)}processPolygon(t,r,s,c,d){if(c.length<1||ff(c[0]))return;for(const M of c)M.length!==0&&P_(t,M);const f={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},g=d.fill.getGranularityForZoomLevel(r.z),b=T_[s.type]==="Polygon";for(const M of c){if(M.length===0||ff(M))continue;const z=Da(M,g,b);this._generateSideFaces(z,f)}if(!b)return;const w=rf(c,r,g,!1),S=this.layoutVertexArray;nf((M,z)=>{dc(S,M,z,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles)}_generateSideFaces(t,r){let s=0;for(let c=1;c<t.length;c++){const d=t[c],f=t[c-1];if(S_(d,f))continue;r.segment.vertexLength+4>qe.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const g=d.sub(f)._perp()._unit(),b=f.dist(d);s+b>32768&&(s=0),dc(this.layoutVertexArray,d.x,d.y,g.x,g.y,0,0,s),dc(this.layoutVertexArray,d.x,d.y,g.x,g.y,0,1,s),s+=b,dc(this.layoutVertexArray,f.x,f.y,g.x,g.y,0,0,s),dc(this.layoutVertexArray,f.x,f.y,g.x,g.y,0,1,s);const w=r.segment.vertexLength;this.indexArray.emplaceBack(w,w+2,w+1),this.indexArray.emplaceBack(w+1,w+2,w+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function P_(n,t){for(let r=0;r<t.length;r++){const s=t[r];r===t.length-1&&t[0].x===s.x&&t[0].y===s.y||(n.x+=s.x,n.y+=s.y,n.sampleCount++)}}function S_(n,t){return n.x===t.x&&(n.x<0||n.x>It)||n.y===t.y&&(n.y<0||n.y>It)}function ff(n){return n.every(t=>t.x<0)||n.every(t=>t.x>It)||n.every(t=>t.y<0)||n.every(t=>t.y>It)}let mf;Ge("FillExtrusionBucket",Id,{omit:["layers","features"]});var C_={get paint(){return mf=mf||new tr({"fill-extrusion-opacity":new it(Z["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ot(Z["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new it(Z["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new it(Z["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ta(Z["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ot(Z["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ot(Z["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new it(Z["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class M_ extends qr{constructor(t){super(t,C_)}createBucket(t){return new Id(t)}queryRadius(){return Gu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:s,geometry:c,transform:d,pixelsToTileUnits:f,pixelPosMatrix:g}){const b=Hu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,f),w=this.paint.get("fill-extrusion-height").evaluate(r,s),S=this.paint.get("fill-extrusion-base").evaluate(r,s),M=function(R,F,O){const q=[];for(const X of R){const ue=[X.x,X.y,0,1];zi(ue,ue,F),q.push(new ge(ue[0]/ue[3],ue[1]/ue[3]))}return q}(b,g),z=function(R,F,O,q){const X=[],ue=[],ee=q[8]*F,L=q[9]*F,$=q[10]*F,te=q[11]*F,ve=q[8]*O,ze=q[9]*O,Te=q[10]*O,Ce=q[11]*O;for(const Fe of R){const Le=[],Be=[];for(const Ee of Fe){const Ke=Ee.x,st=Ee.y,nt=q[0]*Ke+q[4]*st+q[12],tt=q[1]*Ke+q[5]*st+q[13],wt=q[2]*Ke+q[6]*st+q[14],ni=q[3]*Ke+q[7]*st+q[15],xi=wt+$,qi=ni+te,Rr=nt+ve,fr=tt+ze,Ri=wt+Te,ii=ni+Ce,Mi=new ge((nt+ee)/qi,(tt+L)/qi);Mi.z=xi/qi,Le.push(Mi);const Fi=new ge(Rr/ii,fr/ii);Fi.z=Ri/ii,Be.push(Fi)}X.push(Le),ue.push(Be)}return[X,ue]}(c,S,w,g);return function(R,F,O){let q=1/0;tc(O,F)&&(q=gf(O,F[0]));for(let X=0;X<F.length;X++){const ue=F[X],ee=R[X];for(let L=0;L<ue.length-1;L++){const $=ue[L],te=[$,ue[L+1],ee[L+1],ee[L],$];Ql(O,te)&&(q=Math.min(q,gf(O,te)))}}return q!==1/0&&q}(z[0],z[1],M)}}function pc(n,t){return n.x*t.x+n.y*t.y}function gf(n,t){if(n.length===1){let r=0;const s=t[r++];let c;for(;!c||s.equals(c);)if(c=t[r++],!c)return 1/0;for(;r<t.length;r++){const d=t[r],f=n[0],g=c.sub(s),b=d.sub(s),w=f.sub(s),S=pc(g,g),M=pc(g,b),z=pc(b,b),R=pc(w,g),F=pc(w,b),O=S*z-M*M,q=(z*R-M*F)/O,X=(S*F-M*R)/O,ue=s.z*(1-q-X)+c.z*q+d.z*X;if(isFinite(ue))return ue}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}const I_=li([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:E_}=I_,k_=li([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:A_}=k_,z_=hc.VectorTileFeature.types,D_=Math.cos(Math.PI/180*37.5),_f=Math.pow(2,14)/.5;class Ed{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ne,this.layoutVertexArray2=new ae,this.indexArray=new Se,this.programConfigurations=new ti(t.layers,t.zoom),this.segments=new qe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=vd("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),d=!c.isConstant(),f=[];for(const{feature:g,id:b,index:w,sourceLayerIndex:S}of t){const M=this.layers[0]._featureFilter.needGeometry,z=cs(g,M);if(!this.layers[0]._featureFilter.filter(new Kt(this.zoom),z,s))continue;const R=d?c.evaluate(z,{},s):void 0,F={id:b,properties:g.properties,type:g.type,sourceLayerIndex:S,index:w,geometry:M?z.geometry:ls(g),patterns:{},sortKey:R};f.push(F)}d&&f.sort((g,b)=>g.sortKey-b.sortKey);for(const g of f){const{geometry:b,index:w,sourceLayerIndex:S}=g;if(this.hasPattern){const M=bd("line",this.layers,g,this.zoom,r);this.patternFeatures.push(M)}else this.addFeature(g,b,w,s,{},r.subdivisionGranularity);r.featureIndex.insert(t[w].feature,b,w,S,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,A_)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,E_),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,c,d,f){const g=this.layers[0].layout,b=g.get("line-join").evaluate(t,{}),w=g.get("line-cap"),S=g.get("line-miter-limit"),M=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const z of r)this.addLine(z,t,b,w,S,M,c,f);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,d,c)}addLine(t,r,s,c,d,f,g,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Da(t,g?b.line.getGranularityForZoomLevel(g.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<t.length-1;ee++)this.totalDistance+=t[ee].dist(t[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=z_[r.type]==="Polygon";let S=t.length;for(;S>=2&&t[S-1].equals(t[S-2]);)S--;let M=0;for(;M<S-1&&t[M].equals(t[M+1]);)M++;if(S<(w?3:2))return;s==="bevel"&&(d=1.05);const z=this.overscaling<=16?15*It/(512*this.overscaling):0,R=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let F,O,q,X,ue;this.e1=this.e2=-1,w&&(F=t[S-2],ue=t[M].sub(F)._unit()._perp());for(let ee=M;ee<S;ee++){if(q=ee===S-1?w?t[M+1]:void 0:t[ee+1],q&&t[ee].equals(q))continue;ue&&(X=ue),F&&(O=F),F=t[ee],ue=q?q.sub(F)._unit()._perp():X,X=X||ue;let L=X.add(ue);L.x===0&&L.y===0||L._unit();const $=X.x*ue.x+X.y*ue.y,te=L.x*ue.x+L.y*ue.y,ve=te!==0?1/te:1/0,ze=2*Math.sqrt(2-2*te),Te=te<D_&&O&&q,Ce=X.x*ue.y-X.y*ue.x>0;if(Te&&ee>M){const Be=F.dist(O);if(Be>2*z){const Ee=F.sub(F.sub(O)._mult(z/Be)._round());this.updateDistance(O,Ee),this.addCurrentVertex(Ee,X,0,0,R),O=Ee}}const Fe=O&&q;let Le=Fe?s:w?"butt":c;if(Fe&&Le==="round"&&(ve<f?Le="miter":ve<=2&&(Le="fakeround")),Le==="miter"&&ve>d&&(Le="bevel"),Le==="bevel"&&(ve>2&&(Le="flipbevel"),ve<d&&(Le="miter")),O&&this.updateDistance(O,F),Le==="miter")L._mult(ve),this.addCurrentVertex(F,L,0,0,R);else if(Le==="flipbevel"){if(ve>100)L=ue.mult(-1);else{const Be=ve*X.add(ue).mag()/X.sub(ue).mag();L._perp()._mult(Be*(Ce?-1:1))}this.addCurrentVertex(F,L,0,0,R),this.addCurrentVertex(F,L.mult(-1),0,0,R)}else if(Le==="bevel"||Le==="fakeround"){const Be=-Math.sqrt(ve*ve-1),Ee=Ce?Be:0,Ke=Ce?0:Be;if(O&&this.addCurrentVertex(F,X,Ee,Ke,R),Le==="fakeround"){const st=Math.round(180*ze/Math.PI/20);for(let nt=1;nt<st;nt++){let tt=nt/st;if(tt!==.5){const ni=tt-.5;tt+=tt*ni*(tt-1)*((1.0904+$*($*(3.55645-1.43519*$)-3.2452))*ni*ni+(.848013+$*(.215638*$-1.06021)))}const wt=ue.sub(X)._mult(tt)._add(X)._unit()._mult(Ce?-1:1);this.addHalfVertex(F,wt.x,wt.y,!1,Ce,0,R)}}q&&this.addCurrentVertex(F,ue,-Ee,-Ke,R)}else if(Le==="butt")this.addCurrentVertex(F,L,0,0,R);else if(Le==="square"){const Be=O?1:-1;this.addCurrentVertex(F,L,Be,Be,R)}else Le==="round"&&(O&&(this.addCurrentVertex(F,X,0,0,R),this.addCurrentVertex(F,X,1,1,R,!0)),q&&(this.addCurrentVertex(F,ue,-1,-1,R,!0),this.addCurrentVertex(F,ue,0,0,R)));if(Te&&ee<S-1){const Be=F.dist(q);if(Be>2*z){const Ee=F.add(q.sub(F)._mult(z/Be)._round());this.updateDistance(F,Ee),this.addCurrentVertex(Ee,ue,0,0,R),F=Ee}}}}addCurrentVertex(t,r,s,c,d,f=!1){const g=r.y*c-r.x,b=-r.y-r.x*c;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,f,!1,s,d),this.addHalfVertex(t,g,b,f,!0,-c,d),this.distance>_f/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,s,c,d,f))}addHalfVertex({x:t,y:r},s,c,d,f,g,b){const w=.5*(this.lineClips?this.scaledDistance*(_f-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(r<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(g===0?0:g<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const S=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,S,this.e2),b.primitiveLength++),f?this.e2=S:this.e1=S}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let yf,vf;Ge("LineBucket",Ed,{omit:["layers","patternFeatures"]});var bf={get paint(){return vf=vf||new tr({"line-opacity":new ot(Z.paint_line["line-opacity"]),"line-color":new ot(Z.paint_line["line-color"]),"line-translate":new it(Z.paint_line["line-translate"]),"line-translate-anchor":new it(Z.paint_line["line-translate-anchor"]),"line-width":new ot(Z.paint_line["line-width"]),"line-gap-width":new ot(Z.paint_line["line-gap-width"]),"line-offset":new ot(Z.paint_line["line-offset"]),"line-blur":new ot(Z.paint_line["line-blur"]),"line-dasharray":new To(Z.paint_line["line-dasharray"]),"line-pattern":new Ta(Z.paint_line["line-pattern"]),"line-gradient":new Po(Z.paint_line["line-gradient"])})},get layout(){return yf=yf||new tr({"line-cap":new it(Z.layout_line["line-cap"]),"line-join":new ot(Z.layout_line["line-join"]),"line-miter-limit":new it(Z.layout_line["line-miter-limit"]),"line-round-limit":new it(Z.layout_line["line-round-limit"]),"line-sort-key":new ot(Z.layout_line["line-sort-key"])})}};class L_ extends ot{possiblyEvaluate(t,r){return r=new Kt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,s,c){return r=Di({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,s,c)}}let Ju;class R_ extends qr{constructor(t){super(t,bf),this.gradientVersion=0,Ju||(Ju=new L_(bf.paint.properties["line-width"].specification),Ju.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Yn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Ju.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ed(t)}queryRadius(t){const r=t,s=xf(rc("line-width",this,r),rc("line-gap-width",this,r)),c=rc("line-offset",this,r);return s/2+Math.abs(c)+Gu(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:s,geometry:c,transform:d,pixelsToTileUnits:f}){const g=Hu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,f),b=f/2*xf(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),w=this.paint.get("line-offset").evaluate(r,s);return w&&(c=function(S,M){const z=[];for(let R=0;R<S.length;R++){const F=S[R],O=[];for(let q=0;q<F.length;q++){const X=F[q-1],ue=F[q],ee=F[q+1],L=q===0?new ge(0,0):ue.sub(X)._unit()._perp(),$=q===F.length-1?new ge(0,0):ee.sub(ue)._unit()._perp(),te=L._add($)._unit(),ve=te.x*$.x+te.y*$.y;ve!==0&&te._mult(1/ve),O.push(te._mult(M)._add(ue))}z.push(O)}return z}(c,w*f)),function(S,M,z){for(let R=0;R<M.length;R++){const F=M[R];if(S.length>=3){for(let O=0;O<F.length;O++)if(Io(S,F[O]))return!0}if(ic(S,F,z))return!0}return!1}(g,c,b)}isTileClipped(){return!0}}function xf(n,t){return t>0?t+2*n:n}const F_=li([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),B_=li([{name:"a_projected_pos",components:3,type:"Float32"}],4);li([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const O_=li([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);li([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wf=li([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),j_=li([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function N_(n,t,r){return n.sections.forEach(s=>{s.text=function(c,d,f){const g=d.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?c=c.toLocaleUpperCase():g==="lowercase"&&(c=c.toLocaleLowerCase()),nn.applyArabicShaping&&(c=nn.applyArabicShaping(c)),c}(s.text,t,r)}),n}li([{name:"triangle",components:3,type:"Uint16"}]),li([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),li([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),li([{type:"Float32",name:"offsetX"}]),li([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),li([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const fc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Tf,kd,Pf,bi=24,Ad={};function V_(){return Tf||(Tf=1,Ad.read=function(n,t,r,s,c){var d,f,g=8*c-s-1,b=(1<<g)-1,w=b>>1,S=-7,M=r?c-1:0,z=r?-1:1,R=n[t+M];for(M+=z,d=R&(1<<-S)-1,R>>=-S,S+=g;S>0;d=256*d+n[t+M],M+=z,S-=8);for(f=d&(1<<-S)-1,d>>=-S,S+=s;S>0;f=256*f+n[t+M],M+=z,S-=8);if(d===0)d=1-w;else{if(d===b)return f?NaN:1/0*(R?-1:1);f+=Math.pow(2,s),d-=w}return(R?-1:1)*f*Math.pow(2,d-s)},Ad.write=function(n,t,r,s,c,d){var f,g,b,w=8*d-c-1,S=(1<<w)-1,M=S>>1,z=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=s?0:d-1,F=s?1:-1,O=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(g=isNaN(t)?1:0,f=S):(f=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-f))<1&&(f--,b*=2),(t+=f+M>=1?z/b:z*Math.pow(2,1-M))*b>=2&&(f++,b/=2),f+M>=S?(g=0,f=S):f+M>=1?(g=(t*b-1)*Math.pow(2,c),f+=M):(g=t*Math.pow(2,M-1)*Math.pow(2,c),f=0));c>=8;n[r+R]=255&g,R+=F,g/=256,c-=8);for(f=f<<c|g,w+=c;w>0;n[r+R]=255&f,R+=F,f/=256,w-=8);n[r+R-F]|=128*O}),Ad}function Sf(){if(Pf)return kd;Pf=1,kd=t;var n=V_();function t(L){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(L)?L:new Uint8Array(L||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var r=4294967296,s=1/r,c=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function d(L){return L.type===t.Bytes?L.readVarint()+L.pos:L.pos+1}function f(L,$,te){return te?4294967296*$+(L>>>0):4294967296*($>>>0)+(L>>>0)}function g(L,$,te){var ve=$<=16383?1:$<=2097151?2:$<=268435455?3:Math.floor(Math.log($)/(7*Math.LN2));te.realloc(ve);for(var ze=te.pos-1;ze>=L;ze--)te.buf[ze+ve]=te.buf[ze]}function b(L,$){for(var te=0;te<L.length;te++)$.writeVarint(L[te])}function w(L,$){for(var te=0;te<L.length;te++)$.writeSVarint(L[te])}function S(L,$){for(var te=0;te<L.length;te++)$.writeFloat(L[te])}function M(L,$){for(var te=0;te<L.length;te++)$.writeDouble(L[te])}function z(L,$){for(var te=0;te<L.length;te++)$.writeBoolean(L[te])}function R(L,$){for(var te=0;te<L.length;te++)$.writeFixed32(L[te])}function F(L,$){for(var te=0;te<L.length;te++)$.writeSFixed32(L[te])}function O(L,$){for(var te=0;te<L.length;te++)$.writeFixed64(L[te])}function q(L,$){for(var te=0;te<L.length;te++)$.writeSFixed64(L[te])}function X(L,$){return(L[$]|L[$+1]<<8|L[$+2]<<16)+16777216*L[$+3]}function ue(L,$,te){L[te]=$,L[te+1]=$>>>8,L[te+2]=$>>>16,L[te+3]=$>>>24}function ee(L,$){return(L[$]|L[$+1]<<8|L[$+2]<<16)+(L[$+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(L,$,te){for(te=te||this.length;this.pos<te;){var ve=this.readVarint(),ze=ve>>3,Te=this.pos;this.type=7&ve,L(ze,$,this),this.pos===Te&&this.skip(ve)}return $},readMessage:function(L,$){return this.readFields(L,$,this.readVarint()+this.pos)},readFixed32:function(){var L=X(this.buf,this.pos);return this.pos+=4,L},readSFixed32:function(){var L=ee(this.buf,this.pos);return this.pos+=4,L},readFixed64:function(){var L=X(this.buf,this.pos)+X(this.buf,this.pos+4)*r;return this.pos+=8,L},readSFixed64:function(){var L=X(this.buf,this.pos)+ee(this.buf,this.pos+4)*r;return this.pos+=8,L},readFloat:function(){var L=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,L},readDouble:function(){var L=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,L},readVarint:function(L){var $,te,ve=this.buf;return $=127&(te=ve[this.pos++]),te<128?$:($|=(127&(te=ve[this.pos++]))<<7,te<128?$:($|=(127&(te=ve[this.pos++]))<<14,te<128?$:($|=(127&(te=ve[this.pos++]))<<21,te<128?$:function(ze,Te,Ce){var Fe,Le,Be=Ce.buf;if(Fe=(112&(Le=Be[Ce.pos++]))>>4,Le<128||(Fe|=(127&(Le=Be[Ce.pos++]))<<3,Le<128)||(Fe|=(127&(Le=Be[Ce.pos++]))<<10,Le<128)||(Fe|=(127&(Le=Be[Ce.pos++]))<<17,Le<128)||(Fe|=(127&(Le=Be[Ce.pos++]))<<24,Le<128)||(Fe|=(1&(Le=Be[Ce.pos++]))<<31,Le<128))return f(ze,Fe,Te);throw new Error("Expected varint not more than 10 bytes")}($|=(15&(te=ve[this.pos]))<<28,L,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var L=this.readVarint();return L%2==1?(L+1)/-2:L/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var L=this.readVarint()+this.pos,$=this.pos;return this.pos=L,L-$>=12&&c?function(te,ve,ze){return c.decode(te.subarray(ve,ze))}(this.buf,$,L):function(te,ve,ze){for(var Te="",Ce=ve;Ce<ze;){var Fe,Le,Be,Ee=te[Ce],Ke=null,st=Ee>239?4:Ee>223?3:Ee>191?2:1;if(Ce+st>ze)break;st===1?Ee<128&&(Ke=Ee):st===2?(192&(Fe=te[Ce+1]))==128&&(Ke=(31&Ee)<<6|63&Fe)<=127&&(Ke=null):st===3?(Le=te[Ce+2],(192&(Fe=te[Ce+1]))==128&&(192&Le)==128&&((Ke=(15&Ee)<<12|(63&Fe)<<6|63&Le)<=2047||Ke>=55296&&Ke<=57343)&&(Ke=null)):st===4&&(Le=te[Ce+2],Be=te[Ce+3],(192&(Fe=te[Ce+1]))==128&&(192&Le)==128&&(192&Be)==128&&((Ke=(15&Ee)<<18|(63&Fe)<<12|(63&Le)<<6|63&Be)<=65535||Ke>=1114112)&&(Ke=null)),Ke===null?(Ke=65533,st=1):Ke>65535&&(Ke-=65536,Te+=String.fromCharCode(Ke>>>10&1023|55296),Ke=56320|1023&Ke),Te+=String.fromCharCode(Ke),Ce+=st}return Te}(this.buf,$,L)},readBytes:function(){var L=this.readVarint()+this.pos,$=this.buf.subarray(this.pos,L);return this.pos=L,$},readPackedVarint:function(L,$){if(this.type!==t.Bytes)return L.push(this.readVarint($));var te=d(this);for(L=L||[];this.pos<te;)L.push(this.readVarint($));return L},readPackedSVarint:function(L){if(this.type!==t.Bytes)return L.push(this.readSVarint());var $=d(this);for(L=L||[];this.pos<$;)L.push(this.readSVarint());return L},readPackedBoolean:function(L){if(this.type!==t.Bytes)return L.push(this.readBoolean());var $=d(this);for(L=L||[];this.pos<$;)L.push(this.readBoolean());return L},readPackedFloat:function(L){if(this.type!==t.Bytes)return L.push(this.readFloat());var $=d(this);for(L=L||[];this.pos<$;)L.push(this.readFloat());return L},readPackedDouble:function(L){if(this.type!==t.Bytes)return L.push(this.readDouble());var $=d(this);for(L=L||[];this.pos<$;)L.push(this.readDouble());return L},readPackedFixed32:function(L){if(this.type!==t.Bytes)return L.push(this.readFixed32());var $=d(this);for(L=L||[];this.pos<$;)L.push(this.readFixed32());return L},readPackedSFixed32:function(L){if(this.type!==t.Bytes)return L.push(this.readSFixed32());var $=d(this);for(L=L||[];this.pos<$;)L.push(this.readSFixed32());return L},readPackedFixed64:function(L){if(this.type!==t.Bytes)return L.push(this.readFixed64());var $=d(this);for(L=L||[];this.pos<$;)L.push(this.readFixed64());return L},readPackedSFixed64:function(L){if(this.type!==t.Bytes)return L.push(this.readSFixed64());var $=d(this);for(L=L||[];this.pos<$;)L.push(this.readSFixed64());return L},skip:function(L){var $=7&L;if($===t.Varint)for(;this.buf[this.pos++]>127;);else if($===t.Bytes)this.pos=this.readVarint()+this.pos;else if($===t.Fixed32)this.pos+=4;else{if($!==t.Fixed64)throw new Error("Unimplemented type: "+$);this.pos+=8}},writeTag:function(L,$){this.writeVarint(L<<3|$)},realloc:function(L){for(var $=this.length||16;$<this.pos+L;)$*=2;if($!==this.length){var te=new Uint8Array($);te.set(this.buf),this.buf=te,this.length=$}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(L){this.realloc(4),ue(this.buf,L,this.pos),this.pos+=4},writeSFixed32:function(L){this.realloc(4),ue(this.buf,L,this.pos),this.pos+=4},writeFixed64:function(L){this.realloc(8),ue(this.buf,-1&L,this.pos),ue(this.buf,Math.floor(L*s),this.pos+4),this.pos+=8},writeSFixed64:function(L){this.realloc(8),ue(this.buf,-1&L,this.pos),ue(this.buf,Math.floor(L*s),this.pos+4),this.pos+=8},writeVarint:function(L){(L=+L||0)>268435455||L<0?function($,te){var ve,ze;if($>=0?(ve=$%4294967296|0,ze=$/4294967296|0):(ze=~(-$/4294967296),4294967295^(ve=~(-$%4294967296))?ve=ve+1|0:(ve=0,ze=ze+1|0)),$>=18446744073709552e3||$<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");te.realloc(10),function(Te,Ce,Fe){Fe.buf[Fe.pos++]=127&Te|128,Te>>>=7,Fe.buf[Fe.pos++]=127&Te|128,Te>>>=7,Fe.buf[Fe.pos++]=127&Te|128,Te>>>=7,Fe.buf[Fe.pos++]=127&Te|128,Fe.buf[Fe.pos]=127&(Te>>>=7)}(ve,0,te),function(Te,Ce){var Fe=(7&Te)<<4;Ce.buf[Ce.pos++]|=Fe|((Te>>>=3)?128:0),Te&&(Ce.buf[Ce.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Ce.buf[Ce.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Ce.buf[Ce.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Ce.buf[Ce.pos++]=127&Te|((Te>>>=7)?128:0),Te&&(Ce.buf[Ce.pos++]=127&Te)))))}(ze,te)}(L,this):(this.realloc(4),this.buf[this.pos++]=127&L|(L>127?128:0),L<=127||(this.buf[this.pos++]=127&(L>>>=7)|(L>127?128:0),L<=127||(this.buf[this.pos++]=127&(L>>>=7)|(L>127?128:0),L<=127||(this.buf[this.pos++]=L>>>7&127))))},writeSVarint:function(L){this.writeVarint(L<0?2*-L-1:2*L)},writeBoolean:function(L){this.writeVarint(!!L)},writeString:function(L){L=String(L),this.realloc(4*L.length),this.pos++;var $=this.pos;this.pos=function(ve,ze,Te){for(var Ce,Fe,Le=0;Le<ze.length;Le++){if((Ce=ze.charCodeAt(Le))>55295&&Ce<57344){if(!Fe){Ce>56319||Le+1===ze.length?(ve[Te++]=239,ve[Te++]=191,ve[Te++]=189):Fe=Ce;continue}if(Ce<56320){ve[Te++]=239,ve[Te++]=191,ve[Te++]=189,Fe=Ce;continue}Ce=Fe-55296<<10|Ce-56320|65536,Fe=null}else Fe&&(ve[Te++]=239,ve[Te++]=191,ve[Te++]=189,Fe=null);Ce<128?ve[Te++]=Ce:(Ce<2048?ve[Te++]=Ce>>6|192:(Ce<65536?ve[Te++]=Ce>>12|224:(ve[Te++]=Ce>>18|240,ve[Te++]=Ce>>12&63|128),ve[Te++]=Ce>>6&63|128),ve[Te++]=63&Ce|128)}return Te}(this.buf,L,this.pos);var te=this.pos-$;te>=128&&g($,te,this),this.pos=$-1,this.writeVarint(te),this.pos+=te},writeFloat:function(L){this.realloc(4),n.write(this.buf,L,this.pos,!0,23,4),this.pos+=4},writeDouble:function(L){this.realloc(8),n.write(this.buf,L,this.pos,!0,52,8),this.pos+=8},writeBytes:function(L){var $=L.length;this.writeVarint($),this.realloc($);for(var te=0;te<$;te++)this.buf[this.pos++]=L[te]},writeRawMessage:function(L,$){this.pos++;var te=this.pos;L($,this);var ve=this.pos-te;ve>=128&&g(te,ve,this),this.pos=te-1,this.writeVarint(ve),this.pos+=ve},writeMessage:function(L,$,te){this.writeTag(L,t.Bytes),this.writeRawMessage($,te)},writePackedVarint:function(L,$){$.length&&this.writeMessage(L,b,$)},writePackedSVarint:function(L,$){$.length&&this.writeMessage(L,w,$)},writePackedBoolean:function(L,$){$.length&&this.writeMessage(L,z,$)},writePackedFloat:function(L,$){$.length&&this.writeMessage(L,S,$)},writePackedDouble:function(L,$){$.length&&this.writeMessage(L,M,$)},writePackedFixed32:function(L,$){$.length&&this.writeMessage(L,R,$)},writePackedSFixed32:function(L,$){$.length&&this.writeMessage(L,F,$)},writePackedFixed64:function(L,$){$.length&&this.writeMessage(L,O,$)},writePackedSFixed64:function(L,$){$.length&&this.writeMessage(L,q,$)},writeBytesField:function(L,$){this.writeTag(L,t.Bytes),this.writeBytes($)},writeFixed32Field:function(L,$){this.writeTag(L,t.Fixed32),this.writeFixed32($)},writeSFixed32Field:function(L,$){this.writeTag(L,t.Fixed32),this.writeSFixed32($)},writeFixed64Field:function(L,$){this.writeTag(L,t.Fixed64),this.writeFixed64($)},writeSFixed64Field:function(L,$){this.writeTag(L,t.Fixed64),this.writeSFixed64($)},writeVarintField:function(L,$){this.writeTag(L,t.Varint),this.writeVarint($)},writeSVarintField:function(L,$){this.writeTag(L,t.Varint),this.writeSVarint($)},writeStringField:function(L,$){this.writeTag(L,t.Bytes),this.writeString($)},writeFloatField:function(L,$){this.writeTag(L,t.Fixed32),this.writeFloat($)},writeDoubleField:function(L,$){this.writeTag(L,t.Fixed64),this.writeDouble($)},writeBooleanField:function(L,$){this.writeVarintField(L,!!$)}},kd}var zd=he(Sf());const Dd=3;function U_(n,t,r){n===1&&r.readMessage($_,t)}function $_(n,t,r){if(n===3){const{id:s,bitmap:c,width:d,height:f,left:g,top:b,advance:w}=r.readMessage(q_,{});t.push({id:s,bitmap:new nc({width:d+2*Dd,height:f+2*Dd},c),metrics:{width:d,height:f,left:g,top:b,advance:w}})}}function q_(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}const Z_=Dd;function Cf(n){let t=0,r=0;for(const f of n)t+=f.w*f.h,r=Math.max(r,f.w);n.sort((f,g)=>g.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let c=0,d=0;for(const f of n)for(let g=s.length-1;g>=0;g--){const b=s[g];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,d=Math.max(d,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===b.w&&f.h===b.h){const w=s.pop();g<s.length&&(s[g]=w)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(s.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:c,h:d,fill:t/(c*d)||0}}const pr=1;class Ld{constructor(t,{pixelRatio:r,version:s,stretchX:c,stretchY:d,content:f,textFitWidth:g,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=c,this.stretchY=d,this.content=f,this.version=s,this.textFitWidth=g,this.textFitHeight=b}get tl(){return[this.paddedRect.x+pr,this.paddedRect.y+pr]}get br(){return[this.paddedRect.x+this.paddedRect.w-pr,this.paddedRect.y+this.paddedRect.h-pr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*pr)/this.pixelRatio,(this.paddedRect.h-2*pr)/this.pixelRatio]}}class Mf{constructor(t,r){const s={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(t,s,d),this.addImages(r,c,d);const{w:f,h:g}=Cf(d),b=new Dr({width:f||1,height:g||1});for(const w in t){const S=t[w],M=s[w].paddedRect;Dr.copy(S.data,b,{x:0,y:0},{x:M.x+pr,y:M.y+pr},S.data)}for(const w in r){const S=r[w],M=c[w].paddedRect,z=M.x+pr,R=M.y+pr,F=S.data.width,O=S.data.height;Dr.copy(S.data,b,{x:0,y:0},{x:z,y:R},S.data),Dr.copy(S.data,b,{x:0,y:O-1},{x:z,y:R-1},{width:F,height:1}),Dr.copy(S.data,b,{x:0,y:0},{x:z,y:R+O},{width:F,height:1}),Dr.copy(S.data,b,{x:F-1,y:0},{x:z-1,y:R},{width:1,height:O}),Dr.copy(S.data,b,{x:0,y:0},{x:z+F,y:R},{width:1,height:O})}this.image=b,this.iconPositions=s,this.patternPositions=c}addImages(t,r,s){for(const c in t){const d=t[c],f={x:0,y:0,w:d.data.width+2*pr,h:d.data.height+2*pr};s.push(f),r[c]=new Ld(f,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[c,d]=t.tl;s.update(r.data,void 0,{x:c,y:d})}}var $s;Ge("ImagePosition",Ld),Ge("ImageAtlas",Mf),T.ai=void 0,($s=T.ai||(T.ai={}))[$s.none=0]="none",$s[$s.horizontal=1]="horizontal",$s[$s.vertical=2]="vertical",$s[$s.horizontalOnly=3]="horizontalOnly";const Qu=-17;class mc{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,s){const c=new mc;return c.scale=t||1,c.fontStack=r,c.verticalAlign=s||"bottom",c}static forImage(t,r){const s=new mc;return s.imageName=t,s.verticalAlign=r||"bottom",s}}class zo{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new zo;for(let c=0;c<t.sections.length;c++){const d=t.sections[c];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let s=0;s<t.length;s++){const c=t.charCodeAt(s+1)||null,d=t.charCodeAt(s-1)||null;r+=c&&Fu(c)&&!fc[t[s+1]]||d&&Fu(d)&&!fc[t[s-1]]||!fc[t[s]]?t[s]:fc[t[s]]}return r}(this.text)}trim(){let t=0;for(let s=0;s<this.text.length&&th[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&th[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new zo;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}getMaxImageSize(t){let r=0,s=0;for(let c=0;c<this.length();c++){const d=this.getSection(c);if(d.imageName){const f=t[d.imageName];if(!f)continue;const g=f.displaySize;r=Math.max(r,g[0]),s=Math.max(s,g[1])}}return{maxImageWidth:r,maxImageHeight:s}}addTextSection(t,r){this.text+=t.text,this.sections.push(mc.forText(t.scale,t.fontStack||r,t.verticalAlign));const s=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void ji("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(mc.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):ji("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function eh(n,t,r,s,c,d,f,g,b,w,S,M,z,R,F){const O=zo.fromFeature(n,c);let q;M===T.ai.vertical&&O.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:ue}=nn;if(X&&O.sections.length===1){q=[];const $=X(O.toString(),Rd(O,w,d,t,s,R));for(const te of $){const ve=new zo;ve.text=te,ve.sections=O.sections;for(let ze=0;ze<te.length;ze++)ve.sectionIndex.push(0);q.push(ve)}}else if(ue){q=[];const $=ue(O.text,O.sectionIndex,Rd(O,w,d,t,s,R));for(const te of $){const ve=new zo;ve.text=te[0],ve.sectionIndex=te[1],ve.sections=O.sections,q.push(ve)}}else q=function($,te){const ve=[],ze=$.text;let Te=0;for(const Ce of te)ve.push($.substring(Te,Ce)),Te=Ce;return Te<ze.length&&ve.push($.substring(Te,ze.length)),ve}(O,Rd(O,w,d,t,s,R));const ee=[],L={positionedLines:ee,text:O.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function($,te,ve,ze,Te,Ce,Fe,Le,Be,Ee,Ke,st){let nt=0,tt=0,wt=0,ni=0;const xi=Le==="right"?1:Le==="left"?0:.5,qi=bi/st;let Rr=0;for(const ii of Te){ii.trim();const Mi=ii.getMaxScale(),Fi={positionedGlyphs:[],lineOffset:0};$.positionedLines[Rr]=Fi;const Bi=Fi.positionedGlyphs;let rr=0;if(!ii.length()){tt+=Ce,++Rr;continue}const Fr=X_(ze,ii,qi);for(let mr=0;mr<ii.length();mr++){const wi=ii.getSection(mr),Ei=ii.getSectionIndex(mr),ki=ii.getCharCode(mr),fi=K_(Be,Ke,ki);let qt;if(wi.imageName){if($.iconsInText=!0,wi.scale=wi.scale*qi,qt=J_(wi,fi,Mi,Fr,ze),!qt)continue;rr=Math.max(rr,qt.imageOffset)}else if(qt=Y_(wi,ki,fi,Fr,te,ve),!qt)continue;const{rect:ln,metrics:Fo,baselineOffset:cn}=qt;Bi.push({glyph:ki,imageName:wi.imageName,x:nt,y:tt+cn+Qu,vertical:fi,scale:wi.scale,fontStack:wi.fontStack,sectionIndex:Ei,metrics:Fo,rect:ln}),fi?($.verticalizable=!0,nt+=(wi.imageName?Fo.advance:bi)*wi.scale+Ee):nt+=Fo.advance*wi.scale+Ee}Bi.length!==0&&(wt=Math.max(nt-Ee,wt),Q_(Bi,0,Bi.length-1,xi)),nt=0,Fi.lineOffset=Math.max(rr,(Mi-1)*bi);const Ii=Ce*Mi+rr;tt+=Ii,ni=Math.max(Ii,ni),++Rr}const{horizontalAlign:fr,verticalAlign:Ri}=Fd(Fe);(function(ii,Mi,Fi,Bi,rr,Fr,Ii,mr,wi){const Ei=(Mi-Fi)*rr;let ki=0;ki=Fr!==Ii?-mr*Bi-Qu:-Bi*wi*Ii+.5*Ii;for(const fi of ii)for(const qt of fi.positionedGlyphs)qt.x+=Ei,qt.y+=ki})($.positionedLines,xi,fr,Ri,wt,ni,Ce,tt,Te.length),$.top+=-Ri*tt,$.bottom=$.top+tt,$.left+=-fr*wt,$.right=$.left+wt}(L,t,r,s,q,f,g,b,M,w,z,F),!function($){for(const te of $)if(te.positionedGlyphs.length!==0)return!1;return!0}(ee)&&L}const th={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},G_={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},H_={40:!0};function If(n,t,r,s,c,d){if(t.imageName){const f=s[t.imageName];return f?f.displaySize[0]*t.scale*bi/d+c:0}{const f=r[t.fontStack],g=f&&f[n];return g?g.metrics.advance*t.scale+c:0}}function Ef(n,t,r,s){const c=Math.pow(n-t,2);return s?n<t?c/2:2*c:c+Math.abs(r)*r}function W_(n,t,r){let s=0;return n===10&&(s-=1e4),r&&(s+=150),n!==40&&n!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function kf(n,t,r,s,c,d){let f=null,g=Ef(t,r,c,d);for(const b of s){const w=Ef(t-b.x,r,c,d)+b.badness;w<=g&&(f=b,g=w)}return{index:n,x:t,priorBreak:f,badness:g}}function Af(n){return n?Af(n.priorBreak).concat(n.index):[]}function Rd(n,t,r,s,c,d){if(!n)return[];const f=[],g=function(M,z,R,F,O,q){let X=0;for(let ue=0;ue<M.length();ue++){const ee=M.getSection(ue);X+=If(M.getCharCode(ue),ee,F,O,z,q)}return X/Math.max(1,Math.ceil(X/R))}(n,t,r,s,c,d),b=n.text.indexOf("​")>=0;let w=0;for(let M=0;M<n.length();M++){const z=n.getSection(M),R=n.getCharCode(M);if(th[R]||(w+=If(R,z,s,c,t,d)),M<n.length()-1){const F=!((S=R)<11904)&&(!!xt["CJK Compatibility Forms"](S)||!!xt["CJK Compatibility"](S)||!!xt["CJK Strokes"](S)||!!xt["CJK Symbols and Punctuation"](S)||!!xt["Enclosed CJK Letters and Months"](S)||!!xt["Halfwidth and Fullwidth Forms"](S)||!!xt["Ideographic Description Characters"](S)||!!xt["Vertical Forms"](S)||yo.test(String.fromCodePoint(S)));(G_[R]||F||z.imageName||M!==n.length()-2&&H_[n.getCharCode(M+1)])&&f.push(kf(M+1,w,g,f,W_(R,n.getCharCode(M+1),F&&b),!1))}}var S;return Af(kf(n.length(),w,g,f,0,!0))}function Fd(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function X_(n,t,r){const s=t.getMaxScale()*bi,{maxImageWidth:c,maxImageHeight:d}=t.getMaxImageSize(n),f=Math.max(s,d*r);return{verticalLineContentWidth:Math.max(s,c*r),horizontalLineContentHeight:f}}function zf(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function K_(n,t,r){return!(n===T.ai.horizontal||!t&&!vo(r)||t&&(th[r]||(s=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(s)))));var s}function Y_(n,t,r,s,c,d){const f=d[n.fontStack],g=function(w,S,M,z){if(w&&w.rect)return w;const R=S[M.fontStack],F=R&&R[z];return F?{rect:null,metrics:F.metrics}:null}(f&&f[t],c,n,t);if(g===null)return null;let b;if(r)b=s.verticalLineContentWidth-n.scale*bi;else{const w=zf(n.verticalAlign);b=(s.horizontalLineContentHeight-n.scale*bi)*w}return{rect:g.rect,metrics:g.metrics,baselineOffset:b}}function J_(n,t,r,s,c){const d=c[n.imageName];if(!d)return null;const f=d.paddedRect,g=d.displaySize,b={width:g[0],height:g[1],left:pr,top:-3,advance:t?g[1]:g[0]};let w;if(t)w=s.verticalLineContentWidth-g[1]*n.scale;else{const S=zf(n.verticalAlign);w=(s.horizontalLineContentHeight-g[1]*n.scale)*S}return{rect:f,metrics:b,baselineOffset:w,imageOffset:(t?g[0]:g[1])*n.scale-bi*r}}function Q_(n,t,r,s){if(s===0)return;const c=n[r],d=(n[r].x+c.metrics.advance*c.scale)*s;for(let f=t;f<=r;f++)n[f].x-=d}function ey(n,t,r){const{horizontalAlign:s,verticalAlign:c}=Fd(r),d=t[0]-n.displaySize[0]*s,f=t[1]-n.displaySize[1]*c;return{image:n,top:f,bottom:f+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function Df(n){var t,r;let s=n.left,c=n.top,d=n.right-s,f=n.bottom-c;const g=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",w=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(b==="proportional"){if(g==="stretchOnly"&&d/f<w||g==="proportional"){const S=Math.ceil(f*w);s*=S/d,d=S}}else if(g==="proportional"&&b==="stretchOnly"&&w!==0&&d/f>w){const S=Math.ceil(d/w);c*=S/f,f=S}return{x1:s,y1:c,x2:s+d,y2:c+f}}function Lf(n,t,r,s,c,d){const f=n.image;let g;if(f.content){const q=f.content,X=f.pixelRatio||1;g=[q[0]/X,q[1]/X,f.displaySize[0]-q[2]/X,f.displaySize[1]-q[3]/X]}const b=t.left*d,w=t.right*d;let S,M,z,R;r==="width"||r==="both"?(R=c[0]+b-s[3],M=c[0]+w+s[1]):(R=c[0]+(b+w-f.displaySize[0])/2,M=R+f.displaySize[0]);const F=t.top*d,O=t.bottom*d;return r==="height"||r==="both"?(S=c[1]+F-s[0],z=c[1]+O+s[2]):(S=c[1]+(F+O-f.displaySize[1])/2,z=S+f.displaySize[1]),{image:f,top:S,right:M,bottom:z,left:R,collisionPadding:g}}const gc=255,Mn=128,qs=gc*Mn;function Rf(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Kt(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let d=0;for(;d<s.length&&s[d]<=n;)d++;d=Math.max(0,d-1);let f=d;for(;f<s.length&&s[f]<n+1;)f++;f=Math.min(s.length-1,f);const g=s[d],b=s[f];return r.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:b,interpolationType:c}:{kind:"camera",minZoom:g,maxZoom:b,minSize:r.evaluate(new Kt(g)),maxSize:r.evaluate(new Kt(b)),interpolationType:c}}}function Bd(n,t,r){let s="never";const c=n.get(t);return c?s=c:n.get(r)&&(s="always"),s}const ty=hc.VectorTileFeature.types,iy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ih(n,t,r,s,c,d,f,g,b,w,S,M,z){const R=g?Math.min(qs,Math.round(g[0])):0,F=g?Math.min(qs,Math.round(g[1])):0;n.emplaceBack(t,r,Math.round(32*s),Math.round(32*c),d,f,(R<<1)+(b?1:0),F,16*w,16*S,256*M,256*z)}function Od(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function ry(n){for(const t of n.sections)if(Nu(t.text))return!0;return!1}class jd{constructor(t){this.layoutVertexArray=new le,this.indexArray=new Se,this.programConfigurations=t,this.segments=new qe,this.dynamicLayoutVertexArray=new ye,this.opacityVertexArray=new be,this.hasVisibleVertices=!1,this.placedSymbolArray=new v}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,F_.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,B_.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,iy,!0),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ge("SymbolBuffers",jd);class Nd{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new qe,this.collisionVertexArray=new Ae}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,O_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ge("CollisionBuffers",Nd);class Do{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(f=>f.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Rf(this.zoom,r["text-size"]),this.iconSizeData=Rf(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=Bd(s,"text-overlap","text-allow-overlap")!=="never"||Bd(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(f=>T.ai[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=t.sourceID}createArrays(){this.text=new jd(new ti(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new jd(new ti(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new I,this.lineVertexArray=new k,this.symbolInstances=new P,this.textAnchorOffsets=new B}calculateGlyphDependencies(t,r,s,c,d){for(let f=0;f<t.length;f++)if(r[t.charCodeAt(f)]=!0,(s||c)&&d){const g=fc[t.charAt(f)];g&&(r[g.charCodeAt(0)]=!0)}}populate(t,r,s){const c=this.layers[0],d=c.layout,f=d.get("text-font"),g=d.get("text-field"),b=d.get("icon-image"),w=(g.value.kind!=="constant"||g.value.value instanceof si&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),S=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,M=d.get("symbol-sort-key");if(this.features=[],!w&&!S)return;const z=r.iconDependencies,R=r.glyphDependencies,F=r.availableImages,O=new Kt(this.zoom);for(const{feature:q,id:X,index:ue,sourceLayerIndex:ee}of t){const L=c._featureFilter.needGeometry,$=cs(q,L);if(!c._featureFilter.filter(O,$,s))continue;let te,ve;if(L||($.geometry=ls(q)),w){const Te=c.getValueAndResolveTokens("text-field",$,s,F),Ce=si.factory(Te),Fe=this.hasRTLText=this.hasRTLText||ry(Ce);(!Fe||nn.getRTLTextPluginStatus()==="unavailable"||Fe&&nn.isParsed())&&(te=N_(Ce,c,$))}if(S){const Te=c.getValueAndResolveTokens("icon-image",$,s,F);ve=Te instanceof Vi?Te:Vi.fromString(Te)}if(!te&&!ve)continue;const ze=this.sortFeaturesByKey?M.evaluate($,{},s):void 0;if(this.features.push({id:X,text:te,icon:ve,index:ue,sourceLayerIndex:ee,geometry:$.geometry,properties:q.properties,type:ty[q.type],sortKey:ze}),ve&&(z[ve.name]=!0),te){const Te=f.evaluate($,{},s).join(","),Ce=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(T.ai.vertical)>=0;for(const Fe of te.sections)if(Fe.image)z[Fe.image.name]=!0;else{const Le=Os(te.toString()),Be=Fe.fontStack||Te,Ee=R[Be]=R[Be]||{};this.calculateGlyphDependencies(Fe.text,Ee,Ce,this.allowVerticalPlacement,Le)}}}d.get("symbol-placement")==="line"&&(this.features=function(q){const X={},ue={},ee=[];let L=0;function $(Te){ee.push(q[Te]),L++}function te(Te,Ce,Fe){const Le=ue[Te];return delete ue[Te],ue[Ce]=Le,ee[Le].geometry[0].pop(),ee[Le].geometry[0]=ee[Le].geometry[0].concat(Fe[0]),Le}function ve(Te,Ce,Fe){const Le=X[Ce];return delete X[Ce],X[Te]=Le,ee[Le].geometry[0].shift(),ee[Le].geometry[0]=Fe[0].concat(ee[Le].geometry[0]),Le}function ze(Te,Ce,Fe){const Le=Fe?Ce[0][Ce[0].length-1]:Ce[0][0];return`${Te}:${Le.x}:${Le.y}`}for(let Te=0;Te<q.length;Te++){const Ce=q[Te],Fe=Ce.geometry,Le=Ce.text?Ce.text.toString():null;if(!Le){$(Te);continue}const Be=ze(Le,Fe),Ee=ze(Le,Fe,!0);if(Be in ue&&Ee in X&&ue[Be]!==X[Ee]){const Ke=ve(Be,Ee,Fe),st=te(Be,Ee,ee[Ke].geometry);delete X[Be],delete ue[Ee],ue[ze(Le,ee[st].geometry,!0)]=st,ee[Ke].geometry=null}else Be in ue?te(Be,Ee,Fe):Ee in X?ve(Be,Ee,Fe):($(Te),X[Be]=L-1,ue[Ee]=L-1)}return ee.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((q,X)=>q.sortKey-X.sortKey)}update(t,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(r[t.segment+1]),d=t.dist(r[t.segment]);const f={};for(let g=t.segment+1;g<r.length;g++)f[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:c},g<r.length-1&&(c+=r[g+1].dist(r[g]));for(let g=t.segment||0;g>=0;g--)f[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:d},g>0&&(d+=r[g-1].dist(r[g]));for(let g=0;g<r.length;g++){const b=f[g];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,c,d,f,g,b,w,S,M,z){const R=t.indexArray,F=t.layoutVertexArray,O=t.segments.prepareSegment(4*r.length,F,R,this.canOverlap?f.sortKey:void 0),q=this.glyphOffsetArray.length,X=O.vertexLength,ue=this.allowVerticalPlacement&&g===T.ai.vertical?Math.PI/2:0,ee=f.text&&f.text.sections;for(let L=0;L<r.length;L++){const{tl:$,tr:te,bl:ve,br:ze,tex:Te,pixelOffsetTL:Ce,pixelOffsetBR:Fe,minFontScaleX:Le,minFontScaleY:Be,glyphOffset:Ee,isSDF:Ke,sectionIndex:st}=r[L],nt=O.vertexLength,tt=Ee[1];ih(F,b.x,b.y,$.x,tt+$.y,Te.x,Te.y,s,Ke,Ce.x,Ce.y,Le,Be),ih(F,b.x,b.y,te.x,tt+te.y,Te.x+Te.w,Te.y,s,Ke,Fe.x,Ce.y,Le,Be),ih(F,b.x,b.y,ve.x,tt+ve.y,Te.x,Te.y+Te.h,s,Ke,Ce.x,Fe.y,Le,Be),ih(F,b.x,b.y,ze.x,tt+ze.y,Te.x+Te.w,Te.y+Te.h,s,Ke,Fe.x,Fe.y,Le,Be),Od(t.dynamicLayoutVertexArray,b,ue),R.emplaceBack(nt,nt+2,nt+1),R.emplaceBack(nt+1,nt+2,nt+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ee[0]),L!==r.length-1&&st===r[L+1].sectionIndex||t.programConfigurations.populatePaintArrays(F.length,f,f.index,{},z,ee&&ee[st])}t.placedSymbolArray.emplaceBack(b.x,b.y,q,this.glyphOffsetArray.length-q,X,w,S,b.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],g,0,!1,0,M)}_addCollisionDebugVertex(t,r,s,c,d,f){return r.emplaceBack(0,0),t.emplaceBack(s.x,s.y,c,d,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(t,r,s,c,d,f,g){const b=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),w=b.vertexLength,S=d.layoutVertexArray,M=d.collisionVertexArray,z=g.anchorX,R=g.anchorY;this._addCollisionDebugVertex(S,M,f,z,R,new ge(t,r)),this._addCollisionDebugVertex(S,M,f,z,R,new ge(s,r)),this._addCollisionDebugVertex(S,M,f,z,R,new ge(s,c)),this._addCollisionDebugVertex(S,M,f,z,R,new ge(t,c)),b.vertexLength+=4;const F=d.indexArray;F.emplaceBack(w,w+1),F.emplaceBack(w+1,w+2),F.emplaceBack(w+2,w+3),F.emplaceBack(w+3,w),b.primitiveLength+=4}addDebugCollisionBoxes(t,r,s,c){for(let d=t;d<r;d++){const f=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,c?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Nd(Ie,wf.members,Ve),this.iconCollisionBox=new Nd(Ie,wf.members,Ve);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,s,c,d,f,g,b,w){const S={};for(let M=r;M<s;M++){const z=t.get(M);S.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},S.textFeatureIndex=z.featureIndex;break}for(let M=c;M<d;M++){const z=t.get(M);S.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},S.verticalTextFeatureIndex=z.featureIndex;break}for(let M=f;M<g;M++){const z=t.get(M);S.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},S.iconFeatureIndex=z.featureIndex;break}for(let M=b;M<w;M++){const z=t.get(M);S.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},S.verticalIconFeatureIndex=z.featureIndex;break}return S}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<c;d+=4)t.indexArray.emplaceBack(d,d+2,d+1),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),c=[],d=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const b=this.symbolInstances.get(g);c.push(0|Math.round(r*b.anchorX+s*b.anchorY)),d.push(b.featureIndex)}return f.sort((g,b)=>c[g]-c[b]||d[b]-d[g]),f}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,d,f)=>{c>=0&&f.indexOf(c)===d&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ff,Bf;Ge("SymbolBucket",Do,{omit:["layers","collisionBoxArray","features","compareText"]}),Do.MAX_GLYPHS=65535,Do.addDynamicAttributes=Od;var Vd={get paint(){return Bf=Bf||new tr({"icon-opacity":new ot(Z.paint_symbol["icon-opacity"]),"icon-color":new ot(Z.paint_symbol["icon-color"]),"icon-halo-color":new ot(Z.paint_symbol["icon-halo-color"]),"icon-halo-width":new ot(Z.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ot(Z.paint_symbol["icon-halo-blur"]),"icon-translate":new it(Z.paint_symbol["icon-translate"]),"icon-translate-anchor":new it(Z.paint_symbol["icon-translate-anchor"]),"text-opacity":new ot(Z.paint_symbol["text-opacity"]),"text-color":new ot(Z.paint_symbol["text-color"],{runtimeType:yt,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ot(Z.paint_symbol["text-halo-color"]),"text-halo-width":new ot(Z.paint_symbol["text-halo-width"]),"text-halo-blur":new ot(Z.paint_symbol["text-halo-blur"]),"text-translate":new it(Z.paint_symbol["text-translate"]),"text-translate-anchor":new it(Z.paint_symbol["text-translate-anchor"])})},get layout(){return Ff=Ff||new tr({"symbol-placement":new it(Z.layout_symbol["symbol-placement"]),"symbol-spacing":new it(Z.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new it(Z.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ot(Z.layout_symbol["symbol-sort-key"]),"symbol-z-order":new it(Z.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new it(Z.layout_symbol["icon-allow-overlap"]),"icon-overlap":new it(Z.layout_symbol["icon-overlap"]),"icon-ignore-placement":new it(Z.layout_symbol["icon-ignore-placement"]),"icon-optional":new it(Z.layout_symbol["icon-optional"]),"icon-rotation-alignment":new it(Z.layout_symbol["icon-rotation-alignment"]),"icon-size":new ot(Z.layout_symbol["icon-size"]),"icon-text-fit":new it(Z.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new it(Z.layout_symbol["icon-text-fit-padding"]),"icon-image":new ot(Z.layout_symbol["icon-image"]),"icon-rotate":new ot(Z.layout_symbol["icon-rotate"]),"icon-padding":new ot(Z.layout_symbol["icon-padding"]),"icon-keep-upright":new it(Z.layout_symbol["icon-keep-upright"]),"icon-offset":new ot(Z.layout_symbol["icon-offset"]),"icon-anchor":new ot(Z.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new it(Z.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new it(Z.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new it(Z.layout_symbol["text-rotation-alignment"]),"text-field":new ot(Z.layout_symbol["text-field"]),"text-font":new ot(Z.layout_symbol["text-font"]),"text-size":new ot(Z.layout_symbol["text-size"]),"text-max-width":new ot(Z.layout_symbol["text-max-width"]),"text-line-height":new it(Z.layout_symbol["text-line-height"]),"text-letter-spacing":new ot(Z.layout_symbol["text-letter-spacing"]),"text-justify":new ot(Z.layout_symbol["text-justify"]),"text-radial-offset":new ot(Z.layout_symbol["text-radial-offset"]),"text-variable-anchor":new it(Z.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ot(Z.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ot(Z.layout_symbol["text-anchor"]),"text-max-angle":new it(Z.layout_symbol["text-max-angle"]),"text-writing-mode":new it(Z.layout_symbol["text-writing-mode"]),"text-rotate":new ot(Z.layout_symbol["text-rotate"]),"text-padding":new it(Z.layout_symbol["text-padding"]),"text-keep-upright":new it(Z.layout_symbol["text-keep-upright"]),"text-transform":new ot(Z.layout_symbol["text-transform"]),"text-offset":new ot(Z.layout_symbol["text-offset"]),"text-allow-overlap":new it(Z.layout_symbol["text-allow-overlap"]),"text-overlap":new it(Z.layout_symbol["text-overlap"]),"text-ignore-placement":new it(Z.layout_symbol["text-ignore-placement"]),"text-optional":new it(Z.layout_symbol["text-optional"])})}};class Of{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:dt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ge("FormatSectionOverride",Of,{omit:["defaultValue"]});class rh extends qr{constructor(t){super(t,Vd)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const d of s)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,c){const d=this.layout.get(t).evaluate(r,{},s,c),f=this._unevaluatedLayout._values[t];return f.isDataDriven()||so(f.value)||!d?d:function(g,b){return b.replace(/{([^{}]+)}/g,(w,S)=>g&&S in g?String(g[S]):"")}(r.properties,d)}createBucket(t){return new Do(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Vd.paint.overridableProperties){if(!rh.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new Of(r),c=new no(s,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new As("source",c):new oo("composite",c,r.value.zoomStops),this.paint._values[t]=new $r(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&rh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),c=Vd.paint.properties[r];let d=!1;const f=g=>{for(const b of g)if(c.overrides&&c.overrides.hasOverride(b))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof si)f(s.value.value.sections);else if(s.value.kind==="source"){const g=w=>{d||(w instanceof Ur&&Ut(w.value)===bn?f(w.value.sections):w instanceof ha?f(w.sections):w.eachChild(g))},b=s.value;b._styleExpression&&g(b._styleExpression.expression)}return d}}let jf;var ny={get paint(){return jf=jf||new tr({"background-color":new it(Z.paint_background["background-color"]),"background-pattern":new To(Z.paint_background["background-pattern"]),"background-opacity":new it(Z.paint_background["background-opacity"])})}};class sy extends qr{constructor(t){super(t,ny)}}let Nf;var ay={get paint(){return Nf=Nf||new tr({"raster-opacity":new it(Z.paint_raster["raster-opacity"]),"raster-hue-rotate":new it(Z.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new it(Z.paint_raster["raster-brightness-min"]),"raster-brightness-max":new it(Z.paint_raster["raster-brightness-max"]),"raster-saturation":new it(Z.paint_raster["raster-saturation"]),"raster-contrast":new it(Z.paint_raster["raster-contrast"]),"raster-resampling":new it(Z.paint_raster["raster-resampling"]),"raster-fade-duration":new it(Z.paint_raster["raster-fade-duration"])})}};class oy extends qr{constructor(t){super(t,ay)}}class ly extends qr{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class cy{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Ud=63710088e-1;class Zs{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zs(vr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,c=t.lat*r,d=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((t.lng-this.lng)*r);return Ud*Math.acos(Math.min(d,1))}static convert(t){if(t instanceof Zs)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Zs(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Zs(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Vf=2*Math.PI*Ud;function Uf(n){return Vf*Math.cos(n*Math.PI/180)}function $f(n){return(180+n)/360}function qf(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Zf(n,t){return n/Uf(t)}function $d(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Gf(n,t){return n*Uf($d(t))}class _c{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=Zs.convert(t);return new _c($f(s.lng),qf(s.lat),Zf(r,s.lat))}toLngLat(){return new Zs(360*this.x-180,$d(this.y))}toAltitude(){return Gf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Vf*(t=$d(this.y),1/Math.cos(t*Math.PI/180));var t}}function Hf(n,t,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[n*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class qd{constructor(t,r,s){if(!function(c,d,f){return!(c<0||c>25||f<0||f>=Math.pow(2,c)||d<0||d>=Math.pow(2,c))}(t,r,s))throw new Error(`x=${r}, y=${s}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=s,this.key=Lo(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,s){const c=(f=this.y,g=this.z,b=Hf(256*(d=this.x),256*(f=Math.pow(2,g)-f-1),g),w=Hf(256*(d+1),256*(f+1),g),b[0]+","+b[1]+","+w[0]+","+w[1]);var d,f,g,b,w;const S=function(M,z,R){let F,O="";for(let q=M;q>0;q--)F=1<<q-1,O+=(z&F?1:0)+(R&F?2:0);return O}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,S).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new ge((t.x*r-this.x)*It,(t.y*r-this.y)*It)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Wf{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Lo(t,r.z,r.z,r.x,r.y)}}class Lr{constructor(t,r,s,c,d){if(this.terrainRttPosMatrix32f=null,t<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${s}`);this.overscaledZ=t,this.wrap=r,this.canonical=new qd(s,+c,+d),this.key=Lo(r,t,s,c,d)}clone(){return new Lr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Lr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Lr(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?Lo(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Lo(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Lr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new Lr(r,this.wrap,r,s,c),new Lr(r,this.wrap,r,s+1,c),new Lr(r,this.wrap,r,s,c+1),new Lr(r,this.wrap,r,s+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Lr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Lr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Wf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new _c(t.x-this.wrap,t.y))}}function Lo(n,t,r,s,c){(n*=2)<0&&(n=-1*n-1);const d=1<<r;return(d*d*n+d*c+s).toString(36)+r.toString(36)+t.toString(36)}Ge("CanonicalTileID",qd),Ge("OverscaledTileID",Lr,{omit:["terrainRttPosMatrix32f"]});class Xf{constructor(t,r,s,c=1,d=1,f=1,g=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void ji(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const b=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=d,this.blueFactor=f,this.baseShift=g;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let w=0;w<b;w++)this.data[this._idx(-1,w)]=this.data[this._idx(0,w)],this.data[this._idx(b,w)]=this.data[this._idx(b-1,w)],this.data[this._idx(w,-1)]=this.data[this._idx(w,0)],this.data[this._idx(w,b)]=this.data[this._idx(w,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let w=0;w<b;w++)for(let S=0;S<b;S++){const M=this.get(w,S);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(t,r){const s=new Uint8Array(this.data.buffer),c=4*this._idx(t,r);return this.unpack(s[c],s[c+1],s[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,s){return t*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new Dr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,d=r*this.dim+this.dim,f=s*this.dim,g=s*this.dim+this.dim;switch(r){case-1:c=d-1;break;case 1:d=c+1}switch(s){case-1:f=g-1;break;case 1:g=f+1}const b=-r*this.dim,w=-s*this.dim;for(let S=f;S<g;S++)for(let M=c;M<d;M++)this.data[this._idx(M,S)]=t.data[this._idx(M+b,S+w)]}}Ge("DEMData",Xf);class Kf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Yf{constructor(t,r,s,c,d){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=s,t._y=c,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Jf{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ss(It,16,0),this.grid3D=new ss(It,16,0),this.featureIndexArray=new H,this.promoteId=r}insert(t,r,s,c,d,f){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,d);const b=f?this.grid3D:this.grid;for(let w=0;w<r.length;w++){const S=r[w],M=[1/0,1/0,-1/0,-1/0];for(let z=0;z<S.length;z++){const R=S[z];M[0]=Math.min(M[0],R.x),M[1]=Math.min(M[1],R.y),M[2]=Math.max(M[2],R.x),M[3]=Math.max(M[3],R.y)}M[0]<It&&M[1]<It&&M[2]>=0&&M[3]>=0&&b.insert(g,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new hc.VectorTile(new zd(this.rawTileData)).layers,this.sourceLayerCoder=new Kf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,s,c){this.loadVTLayers();const d=t.params,f=It/t.tileSize/t.scale,g=uo(d.filter),b=t.queryGeometry,w=t.queryPadding*f,S=em(b),M=this.grid.query(S.minX-w,S.minY-w,S.maxX+w,S.maxY+w),z=em(t.cameraQueryGeometry),R=this.grid3D.query(z.minX-w,z.minY-w,z.maxX+w,z.maxY+w,(q,X,ue,ee)=>function(L,$,te,ve,ze){for(const Ce of L)if($<=Ce.x&&te<=Ce.y&&ve>=Ce.x&&ze>=Ce.y)return!0;const Te=[new ge($,te),new ge($,ze),new ge(ve,ze),new ge(ve,te)];if(L.length>2){for(const Ce of Te)if(Io(L,Ce))return!0}for(let Ce=0;Ce<L.length-1;Ce++)if(Jg(L[Ce],L[Ce+1],Te))return!0;return!1}(t.cameraQueryGeometry,q-w,X-w,ue+w,ee+w));for(const q of R)M.push(q);M.sort(uy);const F={};let O;for(let q=0;q<M.length;q++){const X=M[q];if(X===O)continue;O=X;const ue=this.featureIndexArray.get(X);let ee=null;this.loadMatchingFeature(F,ue.bucketIndex,ue.sourceLayerIndex,ue.featureIndex,g,d.layers,d.availableImages,r,s,c,(L,$,te)=>(ee||(ee=ls(L)),$.queryIntersectsFeature({queryGeometry:b,feature:L,featureState:te,geometry:ee,zoom:this.z,transform:t.transform,pixelsToTileUnits:f,pixelPosMatrix:t.pixelPosMatrix})))}return F}loadMatchingFeature(t,r,s,c,d,f,g,b,w,S,M){const z=this.bucketLayerIDs[r];if(f&&!z.some(q=>f.has(q)))return;const R=this.sourceLayerCoder.decode(s),F=this.vtLayers[R].feature(c);if(d.needGeometry){const q=cs(F,!0);if(!d.filter(new Kt(this.tileID.overscaledZ),q,this.tileID.canonical))return}else if(!d.filter(new Kt(this.tileID.overscaledZ),F))return;const O=this.getId(F,R);for(let q=0;q<z.length;q++){const X=z[q];if(f&&!f.has(X))continue;const ue=b[X];if(!ue)continue;let ee={};O&&S&&(ee=S.getState(ue.sourceLayer||"_geojsonTileLayer",O));const L=Di({},w[X]);L.paint=Qf(L.paint,ue.paint,F,ee,g),L.layout=Qf(L.layout,ue.layout,F,ee,g);const $=!M||M(F,ue,ee);if(!$)continue;const te=new Yf(F,this.z,this.x,this.y,O);te.layer=L;let ve=t[X];ve===void 0&&(ve=t[X]=[]),ve.push({featureIndex:c,feature:te,intersectionZ:$})}}lookupSymbolFeatures(t,r,s,c,d,f,g,b){const w={};this.loadVTLayers();const S=uo(d);for(const M of t)this.loadMatchingFeature(w,s,c,M,S,f,g,b,r);return w}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){var s;let c=t.id;return this.promoteId&&(c=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof c=="boolean"&&(c=Number(c)),c===void 0&&(!((s=t.properties)===null||s===void 0)&&s.cluster)&&this.promoteId&&(c=Number(t.properties.cluster_id))),c}}function Qf(n,t,r,s,c){return Fn(n,(d,f)=>{const g=t instanceof js?t.get(f):null;return g&&g.evaluate?g.evaluate(r,s,c):g})}function em(n){let t=1/0,r=1/0,s=-1/0,c=-1/0;for(const d of n)t=Math.min(t,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),c=Math.max(c,d.y);return{minX:t,minY:r,maxX:s,maxY:c}}function uy(n,t){return t-n}function tm(n,t,r,s,c){const d=[];for(let f=0;f<n.length;f++){const g=n[f];let b;for(let w=0;w<g.length-1;w++){let S=g[w],M=g[w+1];S.x<t&&M.x<t||(S.x<t?S=new ge(t,S.y+(t-S.x)/(M.x-S.x)*(M.y-S.y))._round():M.x<t&&(M=new ge(t,S.y+(t-S.x)/(M.x-S.x)*(M.y-S.y))._round()),S.y<r&&M.y<r||(S.y<r?S=new ge(S.x+(r-S.y)/(M.y-S.y)*(M.x-S.x),r)._round():M.y<r&&(M=new ge(S.x+(r-S.y)/(M.y-S.y)*(M.x-S.x),r)._round()),S.x>=s&&M.x>=s||(S.x>=s?S=new ge(s,S.y+(s-S.x)/(M.x-S.x)*(M.y-S.y))._round():M.x>=s&&(M=new ge(s,S.y+(s-S.x)/(M.x-S.x)*(M.y-S.y))._round()),S.y>=c&&M.y>=c||(S.y>=c?S=new ge(S.x+(c-S.y)/(M.y-S.y)*(M.x-S.x),c)._round():M.y>=c&&(M=new ge(S.x+(c-S.y)/(M.y-S.y)*(M.x-S.x),c)._round()),b&&S.equals(b[b.length-1])||(b=[S],d.push(b)),b.push(M)))))}}return d}Ge("FeatureIndex",Jf,{omit:["rawTileData","sourceLayerCoder"]});class Gs extends ge{constructor(t,r,s,c){super(t,r),this.angle=s,c!==void 0&&(this.segment=c)}clone(){return new Gs(this.x,this.y,this.angle,this.segment)}}function im(n,t,r,s,c){if(t.segment===void 0||r===0)return!0;let d=t,f=t.segment+1,g=0;for(;g>-r/2;){if(f--,f<0)return!1;g-=n[f].dist(d),d=n[f]}g+=n[f].dist(n[f+1]),f++;const b=[];let w=0;for(;g<r/2;){const S=n[f],M=n[f+1];if(!M)return!1;let z=n[f-1].angleTo(S)-S.angleTo(M);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:g,angleDelta:z}),w+=z;g-b[0].distance>s;)w-=b.shift().angleDelta;if(w>c)return!1;f++,g+=S.dist(M)}return!0}function rm(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function nm(n,t,r){return n?.6*t*r:0}function sm(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function hy(n,t,r,s,c,d){const f=nm(r,c,d),g=sm(r,s)*d;let b=0;const w=rm(n)/2;for(let S=0;S<n.length-1;S++){const M=n[S],z=n[S+1],R=M.dist(z);if(b+R>w){const F=(w-b)/R,O=Ar.number(M.x,z.x,F),q=Ar.number(M.y,z.y,F),X=new Gs(O,q,z.angleTo(M),S);return X._round(),!f||im(n,X,g,f,t)?X:void 0}b+=R}}function dy(n,t,r,s,c,d,f,g,b){const w=nm(s,d,f),S=sm(s,c),M=S*f,z=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return t-M<t/4&&(t=M+t/4),am(n,z?t/2*g%t:(S/2+2*d)*f*g%t,t,w,r,M,z,!1,b)}function am(n,t,r,s,c,d,f,g,b){const w=d/2,S=rm(n);let M=0,z=t-r,R=[];for(let F=0;F<n.length-1;F++){const O=n[F],q=n[F+1],X=O.dist(q),ue=q.angleTo(O);for(;z+r<M+X;){z+=r;const ee=(z-M)/X,L=Ar.number(O.x,q.x,ee),$=Ar.number(O.y,q.y,ee);if(L>=0&&L<b&&$>=0&&$<b&&z-w>=0&&z+w<=S){const te=new Gs(L,$,ue,F);te._round(),s&&!im(n,te,d,s,c)||R.push(te)}}M+=X}return g||R.length||f||(R=am(n,M/2,r,s,c,d,f,!0,b)),R}Ge("Anchor",Gs);const yc=pr;function om(n,t,r,s){const c=[],d=n.image,f=d.pixelRatio,g=d.paddedRect.w-2*yc,b=d.paddedRect.h-2*yc;let w={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const S=d.stretchX||[[0,g]],M=d.stretchY||[[0,b]],z=(Ee,Ke)=>Ee+Ke[1]-Ke[0],R=S.reduce(z,0),F=M.reduce(z,0),O=g-R,q=b-F;let X=0,ue=R,ee=0,L=F,$=0,te=O,ve=0,ze=q;if(d.content&&s){const Ee=d.content,Ke=Ee[2]-Ee[0],st=Ee[3]-Ee[1];(d.textFitWidth||d.textFitHeight)&&(w=Df(n)),X=nh(S,0,Ee[0]),ee=nh(M,0,Ee[1]),ue=nh(S,Ee[0],Ee[2]),L=nh(M,Ee[1],Ee[3]),$=Ee[0]-X,ve=Ee[1]-ee,te=Ke-ue,ze=st-L}const Te=w.x1,Ce=w.y1,Fe=w.x2-Te,Le=w.y2-Ce,Be=(Ee,Ke,st,nt)=>{const tt=sh(Ee.stretch-X,ue,Fe,Te),wt=ah(Ee.fixed-$,te,Ee.stretch,R),ni=sh(Ke.stretch-ee,L,Le,Ce),xi=ah(Ke.fixed-ve,ze,Ke.stretch,F),qi=sh(st.stretch-X,ue,Fe,Te),Rr=ah(st.fixed-$,te,st.stretch,R),fr=sh(nt.stretch-ee,L,Le,Ce),Ri=ah(nt.fixed-ve,ze,nt.stretch,F),ii=new ge(tt,ni),Mi=new ge(qi,ni),Fi=new ge(qi,fr),Bi=new ge(tt,fr),rr=new ge(wt/f,xi/f),Fr=new ge(Rr/f,Ri/f),Ii=t*Math.PI/180;if(Ii){const Ei=Math.sin(Ii),ki=Math.cos(Ii),fi=[ki,-Ei,Ei,ki];ii._matMult(fi),Mi._matMult(fi),Bi._matMult(fi),Fi._matMult(fi)}const mr=Ee.stretch+Ee.fixed,wi=Ke.stretch+Ke.fixed;return{tl:ii,tr:Mi,bl:Bi,br:Fi,tex:{x:d.paddedRect.x+yc+mr,y:d.paddedRect.y+yc+wi,w:st.stretch+st.fixed-mr,h:nt.stretch+nt.fixed-wi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:rr,pixelOffsetBR:Fr,minFontScaleX:te/f/Fe,minFontScaleY:ze/f/Le,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const Ee=lm(S,O,R),Ke=lm(M,q,F);for(let st=0;st<Ee.length-1;st++){const nt=Ee[st],tt=Ee[st+1];for(let wt=0;wt<Ke.length-1;wt++)c.push(Be(nt,Ke[wt],tt,Ke[wt+1]))}}else c.push(Be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:b+1}));return c}function nh(n,t,r){let s=0;for(const c of n)s+=Math.max(t,Math.min(r,c[1]))-Math.max(t,Math.min(r,c[0]));return s}function lm(n,t,r){const s=[{fixed:-1,stretch:0}];for(const[c,d]of n){const f=s[s.length-1];s.push({fixed:c-f.stretch,stretch:f.stretch}),s.push({fixed:c-f.stretch,stretch:f.stretch+(d-c)})}return s.push({fixed:t+yc,stretch:r}),s}function sh(n,t,r,s){return n/t*r+s}function ah(n,t,r,s){return n-t*r/s}class oh{constructor(t,r,s,c,d,f,g,b,w,S){var M;if(this.boxStartIndex=t.length,w){let z=f.top,R=f.bottom;const F=f.collisionPadding;F&&(z-=F[1],R+=F[3]);let O=R-z;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{const z=!((M=f.image)===null||M===void 0)&&M.content&&(f.image.textFitWidth||f.image.textFitHeight)?Df(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};z.y1=z.y1*g-b[0],z.y2=z.y2*g+b[2],z.x1=z.x1*g-b[3],z.x2=z.x2*g+b[1];const R=f.collisionPadding;if(R&&(z.x1-=R[0]*g,z.y1-=R[1]*g,z.x2+=R[2]*g,z.y2+=R[3]*g),S){const F=new ge(z.x1,z.y1),O=new ge(z.x2,z.y1),q=new ge(z.x1,z.y2),X=new ge(z.x2,z.y2),ue=S*Math.PI/180;F._rotate(ue),O._rotate(ue),q._rotate(ue),X._rotate(ue),z.x1=Math.min(F.x,O.x,q.x,X.x),z.x2=Math.max(F.x,O.x,q.x,X.x),z.y1=Math.min(F.y,O.y,q.y,X.y),z.y2=Math.max(F.y,O.y,q.y,X.y)}t.emplaceBack(r.x,r.y,z.x1,z.y1,z.x2,z.y2,s,c,d)}this.boxEndIndex=t.length}}class py{constructor(t=[],r=(s,c)=>s<c?-1:s>c?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:s}=this,c=r[t];for(;t>0;){const d=t-1>>1,f=r[d];if(s(c,f)>=0)break;r[t]=f,t=d}r[t]=c}_down(t){const{data:r,compare:s}=this,c=this.length>>1,d=r[t];for(;t<c;){let f=1+(t<<1);const g=f+1;if(g<this.length&&s(r[g],r[f])<0&&(f=g),s(r[f],d)>=0)break;r[t]=r[f],t=f}r[t]=d}}function fy(n,t=1,r=!1){let s=1/0,c=1/0,d=-1/0,f=-1/0;const g=n[0];for(let R=0;R<g.length;R++){const F=g[R];(!R||F.x<s)&&(s=F.x),(!R||F.y<c)&&(c=F.y),(!R||F.x>d)&&(d=F.x),(!R||F.y>f)&&(f=F.y)}const b=Math.min(d-s,f-c);let w=b/2;const S=new py([],my);if(b===0)return new ge(s,c);for(let R=s;R<d;R+=b)for(let F=c;F<f;F+=b)S.push(new Ro(R+w,F+w,w,n));let M=function(R){let F=0,O=0,q=0;const X=R[0];for(let ue=0,ee=X.length,L=ee-1;ue<ee;L=ue++){const $=X[ue],te=X[L],ve=$.x*te.y-te.x*$.y;O+=($.x+te.x)*ve,q+=($.y+te.y)*ve,F+=3*ve}return new Ro(O/F,q/F,0,R)}(n),z=S.length;for(;S.length;){const R=S.pop();(R.d>M.d||!M.d)&&(M=R,r&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,z)),R.max-M.d<=t||(w=R.h/2,S.push(new Ro(R.p.x-w,R.p.y-w,w,n)),S.push(new Ro(R.p.x+w,R.p.y-w,w,n)),S.push(new Ro(R.p.x-w,R.p.y+w,w,n)),S.push(new Ro(R.p.x+w,R.p.y+w,w,n)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${M.d}`)),M.p}function my(n,t){return t.max-n.max}function Ro(n,t,r,s){this.p=new ge(n,t),this.h=r,this.d=function(c,d){let f=!1,g=1/0;for(let b=0;b<d.length;b++){const w=d[b];for(let S=0,M=w.length,z=M-1;S<M;z=S++){const R=w[S],F=w[z];R.y>c.y!=F.y>c.y&&c.x<(F.x-R.x)*(c.y-R.y)/(F.y-R.y)+R.x&&(f=!f),g=Math.min(g,Vp(c,R,F))}}return(f?1:-1)*Math.sqrt(g)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var $i;T.av=void 0,($i=T.av||(T.av={}))[$i.center=1]="center",$i[$i.left=2]="left",$i[$i.right=3]="right",$i[$i.top=4]="top",$i[$i.bottom=5]="bottom",$i[$i["top-left"]=6]="top-left",$i[$i["top-right"]=7]="top-right",$i[$i["bottom-left"]=8]="bottom-left",$i[$i["bottom-right"]=9]="bottom-right";const Hs=7,Zd=Number.POSITIVE_INFINITY;function cm(n,t){return t[1]!==Zd?function(r,s,c){let d=0,f=0;switch(s=Math.abs(s),c=Math.abs(c),r){case"top-right":case"top-left":case"top":f=c-Hs;break;case"bottom-right":case"bottom-left":case"bottom":f=-c+Hs}switch(r){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,f]}(n,t[0],t[1]):function(r,s){let c=0,d=0;s<0&&(s=0);const f=s/Math.SQRT2;switch(r){case"top-right":case"top-left":d=f-Hs;break;case"bottom-right":case"bottom-left":d=-f+Hs;break;case"bottom":d=-s+Hs;break;case"top":d=s-Hs}switch(r){case"top-right":case"bottom-right":c=-f;break;case"top-left":case"bottom-left":c=f;break;case"left":c=s;break;case"right":c=-s}return[c,d]}(n,t[0])}function um(n,t,r){var s;const c=n.layout,d=(s=c.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(t,{},r);if(d){const g=d.values,b=[];for(let w=0;w<g.length;w+=2){const S=b[w]=g[w],M=g[w+1].map(z=>z*bi);S.startsWith("top")?M[1]-=Hs:S.startsWith("bottom")&&(M[1]+=Hs),b[w+1]=M}return new Ni(b)}const f=c.get("text-variable-anchor");if(f){let g;g=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},r)*bi,Zd]:c.get("text-offset").evaluate(t,{},r).map(w=>w*bi);const b=[];for(const w of f)b.push(w,cm(w,g));return new Ni(b)}return null}function Gd(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gy(n,t,r,s,c,d,f,g,b,w,S,M){let z=d.textMaxSize.evaluate(t,{});z===void 0&&(z=f);const R=n.layers[0].layout,F=R.get("icon-offset").evaluate(t,{},S),O=dm(r.horizontal),q=f/24,X=n.tilePixelRatio*q,ue=n.tilePixelRatio*z/24,ee=n.tilePixelRatio*g,L=n.tilePixelRatio*R.get("symbol-spacing"),$=R.get("text-padding")*n.tilePixelRatio,te=function(st,nt,tt,wt=1){const ni=st.get("icon-padding").evaluate(nt,{},tt),xi=ni&&ni.values;return[xi[0]*wt,xi[1]*wt,xi[2]*wt,xi[3]*wt]}(R,t,S,n.tilePixelRatio),ve=R.get("text-max-angle")/180*Math.PI,ze=R.get("text-rotation-alignment")!=="viewport"&&R.get("symbol-placement")!=="point",Te=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",Ce=R.get("symbol-placement"),Fe=L/2,Le=R.get("icon-text-fit");let Be;s&&Le!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(Be=Lf(s,r.vertical,Le,R.get("icon-text-fit-padding"),F,q)),O&&(s=Lf(s,O,Le,R.get("icon-text-fit-padding"),F,q)));const Ee=S?M.line.getGranularityForZoomLevel(S.z):1,Ke=(st,nt)=>{nt.x<0||nt.x>=It||nt.y<0||nt.y>=It||function(tt,wt,ni,xi,qi,Rr,fr,Ri,ii,Mi,Fi,Bi,rr,Fr,Ii,mr,wi,Ei,ki,fi,qt,ln,Fo,cn,vy){const Bo=tt.addToLineVertexArray(wt,ni);let La,Oo,jo,No,gm=0,_m=0,ym=0,vm=0,ep=-1,tp=-1;const us={};let bm=di("");if(tt.allowVerticalPlacement&&xi.vertical){const Ki=Ri.layout.get("text-rotate").evaluate(qt,{},cn)+90;jo=new oh(ii,wt,Mi,Fi,Bi,xi.vertical,rr,Fr,Ii,Ki),fr&&(No=new oh(ii,wt,Mi,Fi,Bi,fr,wi,Ei,Ii,Ki))}if(qi){const Ki=Ri.layout.get("icon-rotate").evaluate(qt,{}),Br=Ri.layout.get("icon-text-fit")!=="none",Ra=om(qi,Ki,Fo,Br),hn=fr?om(fr,Ki,Fo,Br):void 0;Oo=new oh(ii,wt,Mi,Fi,Bi,qi,wi,Ei,!1,Ki),gm=4*Ra.length;const Fa=tt.iconSizeData;let In=null;Fa.kind==="source"?(In=[Mn*Ri.layout.get("icon-size").evaluate(qt,{})],In[0]>qs&&ji(`${tt.layerIds[0]}: Value for "icon-size" is >= ${gc}. Reduce your "icon-size".`)):Fa.kind==="composite"&&(In=[Mn*ln.compositeIconSizes[0].evaluate(qt,{},cn),Mn*ln.compositeIconSizes[1].evaluate(qt,{},cn)],(In[0]>qs||In[1]>qs)&&ji(`${tt.layerIds[0]}: Value for "icon-size" is >= ${gc}. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,Ra,In,fi,ki,qt,T.ai.none,wt,Bo.lineStartIndex,Bo.lineLength,-1,cn),ep=tt.icon.placedSymbolArray.length-1,hn&&(_m=4*hn.length,tt.addSymbols(tt.icon,hn,In,fi,ki,qt,T.ai.vertical,wt,Bo.lineStartIndex,Bo.lineLength,-1,cn),tp=tt.icon.placedSymbolArray.length-1)}const xm=Object.keys(xi.horizontal);for(const Ki of xm){const Br=xi.horizontal[Ki];if(!La){bm=di(Br.text);const hn=Ri.layout.get("text-rotate").evaluate(qt,{},cn);La=new oh(ii,wt,Mi,Fi,Bi,Br,rr,Fr,Ii,hn)}const Ra=Br.positionedLines.length===1;if(ym+=hm(tt,wt,Br,Rr,Ri,Ii,qt,mr,Bo,xi.vertical?T.ai.horizontal:T.ai.horizontalOnly,Ra?xm:[Ki],us,ep,ln,cn),Ra)break}xi.vertical&&(vm+=hm(tt,wt,xi.vertical,Rr,Ri,Ii,qt,mr,Bo,T.ai.vertical,["vertical"],us,tp,ln,cn));const by=La?La.boxStartIndex:tt.collisionBoxArray.length,xy=La?La.boxEndIndex:tt.collisionBoxArray.length,wy=jo?jo.boxStartIndex:tt.collisionBoxArray.length,Ty=jo?jo.boxEndIndex:tt.collisionBoxArray.length,Py=Oo?Oo.boxStartIndex:tt.collisionBoxArray.length,Sy=Oo?Oo.boxEndIndex:tt.collisionBoxArray.length,Cy=No?No.boxStartIndex:tt.collisionBoxArray.length,My=No?No.boxEndIndex:tt.collisionBoxArray.length;let un=-1;const ch=(Ki,Br)=>Ki&&Ki.circleDiameter?Math.max(Ki.circleDiameter,Br):Br;un=ch(La,un),un=ch(jo,un),un=ch(Oo,un),un=ch(No,un);const wm=un>-1?1:0;wm&&(un*=vy/bi),tt.glyphOffsetArray.length>=Do.MAX_GLYPHS&&ji("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qt.sortKey!==void 0&&tt.addToSortKeyRanges(tt.symbolInstances.length,qt.sortKey);const Iy=um(Ri,qt,cn),[Ey,ky]=function(Ki,Br){const Ra=Ki.length,hn=Br==null?void 0:Br.values;if((hn==null?void 0:hn.length)>0)for(let Fa=0;Fa<hn.length;Fa+=2){const In=hn[Fa+1];Ki.emplaceBack(T.av[hn[Fa]],In[0],In[1])}return[Ra,Ki.length]}(tt.textAnchorOffsets,Iy);tt.symbolInstances.emplaceBack(wt.x,wt.y,us.right>=0?us.right:-1,us.center>=0?us.center:-1,us.left>=0?us.left:-1,us.vertical||-1,ep,tp,bm,by,xy,wy,Ty,Py,Sy,Cy,My,Mi,ym,vm,gm,_m,wm,0,rr,un,Ey,ky)}(n,nt,st,r,s,c,Be,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,X,[$,$,$,$],ze,b,ee,te,Te,F,t,d,w,S,f)};if(Ce==="line")for(const st of tm(t.geometry,0,0,It,It)){const nt=Da(st,Ee),tt=dy(nt,L,ve,r.vertical||O,s,24,ue,n.overscaling,It);for(const wt of tt)O&&_y(n,O.text,Fe,wt)||Ke(nt,wt)}else if(Ce==="line-center"){for(const st of t.geometry)if(st.length>1){const nt=Da(st,Ee),tt=hy(nt,ve,r.vertical||O,s,24,ue);tt&&Ke(nt,tt)}}else if(t.type==="Polygon")for(const st of Xa(t.geometry,0)){const nt=fy(st,16);Ke(Da(st[0],Ee,!0),new Gs(nt.x,nt.y,0))}else if(t.type==="LineString")for(const st of t.geometry){const nt=Da(st,Ee);Ke(nt,new Gs(nt[0].x,nt[0].y,0))}else if(t.type==="Point")for(const st of t.geometry)for(const nt of st)Ke([nt],new Gs(nt.x,nt.y,0))}function hm(n,t,r,s,c,d,f,g,b,w,S,M,z,R,F){const O=function(ue,ee,L,$,te,ve,ze,Te){const Ce=$.layout.get("text-rotate").evaluate(ve,{})*Math.PI/180,Fe=[];for(const Le of ee.positionedLines)for(const Be of Le.positionedGlyphs){if(!Be.rect)continue;const Ee=Be.rect||{};let Ke=Z_+1,st=!0,nt=1,tt=0;const wt=(te||Te)&&Be.vertical,ni=Be.metrics.advance*Be.scale/2;if(Te&&ee.verticalizable&&(tt=Le.lineOffset/2-(Be.imageName?-(bi-Be.metrics.width*Be.scale)/2:(Be.scale-1)*bi)),Be.imageName){const Ei=ze[Be.imageName];st=Ei.sdf,nt=Ei.pixelRatio,Ke=pr/nt}const xi=te?[Be.x+ni,Be.y]:[0,0];let qi=te?[0,0]:[Be.x+ni+L[0],Be.y+L[1]-tt],Rr=[0,0];wt&&(Rr=qi,qi=[0,0]);const fr=Be.metrics.isDoubleResolution?2:1,Ri=(Be.metrics.left-Ke)*Be.scale-ni+qi[0],ii=(-Be.metrics.top-Ke)*Be.scale+qi[1],Mi=Ri+Ee.w/fr*Be.scale/nt,Fi=ii+Ee.h/fr*Be.scale/nt,Bi=new ge(Ri,ii),rr=new ge(Mi,ii),Fr=new ge(Ri,Fi),Ii=new ge(Mi,Fi);if(wt){const Ei=new ge(-ni,ni-Qu),ki=-Math.PI/2,fi=bi/2-ni,qt=new ge(5-Qu-fi,-(Be.imageName?fi:0)),ln=new ge(...Rr);Bi._rotateAround(ki,Ei)._add(qt)._add(ln),rr._rotateAround(ki,Ei)._add(qt)._add(ln),Fr._rotateAround(ki,Ei)._add(qt)._add(ln),Ii._rotateAround(ki,Ei)._add(qt)._add(ln)}if(Ce){const Ei=Math.sin(Ce),ki=Math.cos(Ce),fi=[ki,-Ei,Ei,ki];Bi._matMult(fi),rr._matMult(fi),Fr._matMult(fi),Ii._matMult(fi)}const mr=new ge(0,0),wi=new ge(0,0);Fe.push({tl:Bi,tr:rr,bl:Fr,br:Ii,tex:Ee,writingMode:ee.writingMode,glyphOffset:xi,sectionIndex:Be.sectionIndex,isSDF:st,pixelOffsetTL:mr,pixelOffsetBR:wi,minFontScaleX:0,minFontScaleY:0})}return Fe}(0,r,g,c,d,f,s,n.allowVerticalPlacement),q=n.textSizeData;let X=null;q.kind==="source"?(X=[Mn*c.layout.get("text-size").evaluate(f,{})],X[0]>qs&&ji(`${n.layerIds[0]}: Value for "text-size" is >= ${gc}. Reduce your "text-size".`)):q.kind==="composite"&&(X=[Mn*R.compositeTextSizes[0].evaluate(f,{},F),Mn*R.compositeTextSizes[1].evaluate(f,{},F)],(X[0]>qs||X[1]>qs)&&ji(`${n.layerIds[0]}: Value for "text-size" is >= ${gc}. Reduce your "text-size".`)),n.addSymbols(n.text,O,X,g,d,f,w,t,b.lineStartIndex,b.lineLength,z,F);for(const ue of S)M[ue]=n.text.placedSymbolArray.length-1;return 4*O.length}function dm(n){for(const t in n)return n[t];return null}function _y(n,t,r,s){const c=n.compareText;if(t in c){const d=c[t];for(let f=d.length-1;f>=0;f--)if(s.dist(d[f])<r)return!0}else c[t]=[];return c[t].push(s),!1}const pm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Hd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const d=pm[15&s];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(t,2,1),[g]=new Uint32Array(t,4,1);return new Hd(g,f,d,t)}constructor(t,r=64,s=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const d=pm.indexOf(this.ArrayType),f=2*t*this.ArrayType.BYTES_PER_ELEMENT,g=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-g%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+g+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+f+g+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+g+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Wd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:g}=this,b=[0,d.length-1,0],w=[];for(;b.length;){const S=b.pop()||0,M=b.pop()||0,z=b.pop()||0;if(M-z<=g){for(let q=z;q<=M;q++){const X=f[2*q],ue=f[2*q+1];X>=t&&X<=s&&ue>=r&&ue<=c&&w.push(d[q])}continue}const R=z+M>>1,F=f[2*R],O=f[2*R+1];F>=t&&F<=s&&O>=r&&O<=c&&w.push(d[R]),(S===0?t<=F:r<=O)&&(b.push(z),b.push(R-1),b.push(1-S)),(S===0?s>=F:c>=O)&&(b.push(R+1),b.push(M),b.push(1-S))}return w}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:f}=this,g=[0,c.length-1,0],b=[],w=s*s;for(;g.length;){const S=g.pop()||0,M=g.pop()||0,z=g.pop()||0;if(M-z<=f){for(let q=z;q<=M;q++)mm(d[2*q],d[2*q+1],t,r)<=w&&b.push(c[q]);continue}const R=z+M>>1,F=d[2*R],O=d[2*R+1];mm(F,O,t,r)<=w&&b.push(c[R]),(S===0?t-s<=F:r-s<=O)&&(g.push(z),g.push(R-1),g.push(1-S)),(S===0?t+s>=F:r+s>=O)&&(g.push(R+1),g.push(M),g.push(1-S))}return b}}function Wd(n,t,r,s,c,d){if(c-s<=r)return;const f=s+c>>1;fm(n,t,f,s,c,d),Wd(n,t,r,s,f-1,1-d),Wd(n,t,r,f+1,c,1-d)}function fm(n,t,r,s,c,d){for(;c>s;){if(c-s>600){const w=c-s+1,S=r-s+1,M=Math.log(w),z=.5*Math.exp(2*M/3),R=.5*Math.sqrt(M*z*(w-z)/w)*(S-w/2<0?-1:1);fm(n,t,r,Math.max(s,Math.floor(r-S*z/w+R)),Math.min(c,Math.floor(r+(w-S)*z/w+R)),d)}const f=t[2*r+d];let g=s,b=c;for(vc(n,t,s,r),t[2*c+d]>f&&vc(n,t,s,c);g<b;){for(vc(n,t,g,b),g++,b--;t[2*g+d]<f;)g++;for(;t[2*b+d]>f;)b--}t[2*s+d]===f?vc(n,t,s,b):(b++,vc(n,t,b,c)),b<=r&&(s=b+1),r<=b&&(c=b-1)}}function vc(n,t,r,s){Xd(n,r,s),Xd(t,2*r,2*s),Xd(t,2*r+1,2*s+1)}function Xd(n,t,r){const s=n[t];n[t]=n[r],n[r]=s}function mm(n,t,r,s){const c=n-r,d=t-s;return c*c+d*d}var Kd;T.ce=void 0,(Kd=T.ce||(T.ce={})).create="create",Kd.load="load",Kd.fullLoad="fullLoad";let lh=null,bc=[];const Yd=1e3/60,Jd="loadTime",Qd="fullLoadTime",yy={mark(n){performance.mark(n)},frame(n){const t=n;lh!=null&&bc.push(t-lh),lh=t},clearMetrics(){lh=null,bc=[],performance.clearMeasures(Jd),performance.clearMeasures(Qd);for(const n in T.ce)performance.clearMarks(T.ce[n])},getPerformanceMetrics(){performance.measure(Jd,T.ce.create,T.ce.load),performance.measure(Qd,T.ce.create,T.ce.fullLoad);const n=performance.getEntriesByName(Jd)[0].duration,t=performance.getEntriesByName(Qd)[0].duration,r=bc.length,s=1/(bc.reduce((d,f)=>d+f,0)/r/1e3),c=bc.filter(d=>d>Yd).reduce((d,f)=>d+(f-Yd)/Yd,0);return{loadTime:n,fullLoadTime:t,fps:s,percentDroppedFrames:c/(r+c)*100,totalFrames:r}}};T.$=de,T.A=et,T.B=xa,T.C=function(n){if(oi==null){const t=n.navigator?n.navigator.userAgent:null;oi=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return oi},T.D=it,T.E=vn,T.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new cy(()=>this.process()),this.subscription=function(r,s,c,d){return r.addEventListener(s,c,!1),{unsubscribe:()=>{r.removeEventListener(s,c,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Kr(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((r,s)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:r,reject:s},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const g={id:c,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(g)},{once:!0});const d=[],f=Object.assign(Object.assign({},n),{id:c,sourceMapId:this.mapId,origin:location.origin,data:wa(n.data,d)});this.target.postMessage(f,{transfer:d})})}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Kr(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return o(this,void 0,void 0,function*(){if(t.type==="<response>"){const c=this.resolveRejects[n];return delete this.resolveRejects[n],c?void(t.error?c.reject(Pn(t.error)):c.resolve(Pn(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Pn(t.data),s=new AbortController;this.abortControllers[n]=s;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,r,s);this.completeTask(n,null,c)}catch(c){this.completeTask(n,c)}})}completeTask(n,t,r){const s=[];delete this.abortControllers[n];const c={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?wa(t):null,data:wa(r,s)};this.target.postMessage(c,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},T.G=Un,T.H=function(){var n=new et(16);return et!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},T.I=Ld,T.J=function(n,t,r){var s,c,d,f,g,b,w,S,M,z,R,F,O=r[0],q=r[1],X=r[2];return t===n?(n[12]=t[0]*O+t[4]*q+t[8]*X+t[12],n[13]=t[1]*O+t[5]*q+t[9]*X+t[13],n[14]=t[2]*O+t[6]*q+t[10]*X+t[14],n[15]=t[3]*O+t[7]*q+t[11]*X+t[15]):(c=t[1],d=t[2],f=t[3],g=t[4],b=t[5],w=t[6],S=t[7],M=t[8],z=t[9],R=t[10],F=t[11],n[0]=s=t[0],n[1]=c,n[2]=d,n[3]=f,n[4]=g,n[5]=b,n[6]=w,n[7]=S,n[8]=M,n[9]=z,n[10]=R,n[11]=F,n[12]=s*O+g*q+M*X+t[12],n[13]=c*O+b*q+z*X+t[13],n[14]=d*O+w*q+R*X+t[14],n[15]=f*O+S*q+F*X+t[15]),n},T.K=function(n,t,r){var s=r[0],c=r[1],d=r[2];return n[0]=t[0]*s,n[1]=t[1]*s,n[2]=t[2]*s,n[3]=t[3]*s,n[4]=t[4]*c,n[5]=t[5]*c,n[6]=t[6]*c,n[7]=t[7]*c,n[8]=t[8]*d,n[9]=t[9]*d,n[10]=t[10]*d,n[11]=t[11]*d,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},T.L=function(n,t,r){var s=t[0],c=t[1],d=t[2],f=t[3],g=t[4],b=t[5],w=t[6],S=t[7],M=t[8],z=t[9],R=t[10],F=t[11],O=t[12],q=t[13],X=t[14],ue=t[15],ee=r[0],L=r[1],$=r[2],te=r[3];return n[0]=ee*s+L*g+$*M+te*O,n[1]=ee*c+L*b+$*z+te*q,n[2]=ee*d+L*w+$*R+te*X,n[3]=ee*f+L*S+$*F+te*ue,n[4]=(ee=r[4])*s+(L=r[5])*g+($=r[6])*M+(te=r[7])*O,n[5]=ee*c+L*b+$*z+te*q,n[6]=ee*d+L*w+$*R+te*X,n[7]=ee*f+L*S+$*F+te*ue,n[8]=(ee=r[8])*s+(L=r[9])*g+($=r[10])*M+(te=r[11])*O,n[9]=ee*c+L*b+$*z+te*q,n[10]=ee*d+L*w+$*R+te*X,n[11]=ee*f+L*S+$*F+te*ue,n[12]=(ee=r[12])*s+(L=r[13])*g+($=r[14])*M+(te=r[15])*O,n[13]=ee*c+L*b+$*z+te*q,n[14]=ee*d+L*w+$*R+te*X,n[15]=ee*f+L*S+$*F+te*ue,n},T.M=function(n,t){const r={};for(let s=0;s<t.length;s++){const c=t[s];c in n&&(r[c]=n[c])}return r},T.N=Zs,T.O=$f,T.P=ge,T.Q=qf,T.R=Dr,T.S=Lr,T.T=Ul,T.U=rt,T.V=Je,T.W=Er,T.X=It,T.Y=_c,T.Z=qd,T._=o,T.a=_n,T.a$=function(){return new Float64Array(16)},T.a0=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const s of n){const c=window.document.createElement("source");qn(s)||(t.crossOrigin="Anonymous"),c.src=s,t.appendChild(c)}})},T.a1=function(){return Rn++},T.a2=h,T.a3=Do,T.a4=uo,T.a5=cs,T.a6=Yf,T.a7=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,d)=>{const f=c||d;return t[s]=!f||f.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},T.a8=function(n){return Math.log(n)/Math.LN2},T.a9=function(n){var t=n[0],r=n[1];return t*t+r*r},T.aA=li,T.aB=Ku,T.aC=G,T.aD=qe,T.aE=Se,T.aF=85.051129,T.aG=function(n){return Math.pow(2,n)},T.aH=Zf,T.aI=vr,T.aJ=or,T.aK=Gf,T.aL=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n},T.aM=function(n,t,r){return n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n},T.aN=function(n){var t=new et(3);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},T.aO=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},T.aP=function(n,t,r){return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n},T.aQ=function(n,t){var r=t[0],s=t[1],c=t[2],d=r*r+s*s+c*c;return d>0&&(d=1/Math.sqrt(d)),n[0]=t[0]*d,n[1]=t[1]*d,n[2]=t[2]*d,n},T.aR=function(n,t,r){var s=t[0],c=t[1],d=t[2],f=r[0],g=r[1],b=r[2];return n[0]=c*b-d*g,n[1]=d*f-s*b,n[2]=s*g-c*f,n},T.aS=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]},T.aT=Wf,T.aU=Lo,T.aV=function(n,t,r,s,c){var d,f=1/Math.tan(t/2);return n[0]=f/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0?(n[10]=(c+s)*(d=1/(s-c)),n[14]=2*c*s*d):(n[10]=-1,n[14]=-2*s),n},T.aW=function(n){var t=new et(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},T.aX=function(n,t,r){var s=Math.sin(r),c=Math.cos(r),d=t[0],f=t[1],g=t[2],b=t[3],w=t[4],S=t[5],M=t[6],z=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=d*c+w*s,n[1]=f*c+S*s,n[2]=g*c+M*s,n[3]=b*c+z*s,n[4]=w*c-d*s,n[5]=S*c-f*s,n[6]=M*c-g*s,n[7]=z*c-b*s,n},T.aY=function(n,t,r){var s=Math.sin(r),c=Math.cos(r),d=t[4],f=t[5],g=t[6],b=t[7],w=t[8],S=t[9],M=t[10],z=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=d*c+w*s,n[5]=f*c+S*s,n[6]=g*c+M*s,n[7]=b*c+z*s,n[8]=w*c-d*s,n[9]=S*c-f*s,n[10]=M*c-g*s,n[11]=z*c-b*s,n},T.aZ=function(){const n=new Float32Array(16);return kt(n),n},T.a_=function(){const n=new Float64Array(16);return kt(n),n},T.aa=function(n){return n*Math.PI/180},T.ab=Ir,T.ac=function(n,t){const r=[];for(const s in n)s in t||r.push(s);return r},T.ad=mi,T.ae=function(n){return Math.hypot(n[0],n[1])},T.af=function(n){return n[0]=0,n[1]=0,n},T.ag=function(n,t,r){return n[0]=t[0]*r,n[1]=t[1]*r,n},T.ah=function(n,t){let r=0,s=0;if(n.kind==="constant")s=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:f}=n,g=c?Ir(Ot.interpolationFactor(c,t,d,f),0,1):0;n.kind==="camera"?s=Ar.number(n.minSize,n.maxSize,g):r=g}return{uSizeT:r,uSize:s}},T.aj=function(n,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:c}){return n.kind==="source"?s/Mn:n.kind==="composite"?Ar.number(s/Mn,c/Mn,r):t},T.ak=Od,T.al=zi,T.am=function(n,t,r,s){const c=t.y-n.y,d=t.x-n.x,f=s.y-r.y,g=s.x-r.x,b=f*d-g*c;if(b===0)return null;const w=(g*(n.y-r.y)-f*(n.x-r.x))/b;return new ge(n.x+w*d,n.y+w*c)},T.an=function(n,t){var r=t[0],s=t[1],c=t[2],d=t[3],f=t[4],g=t[5],b=t[6],w=t[7],S=t[8],M=t[9],z=t[10],R=t[11],F=t[12],O=t[13],q=t[14],X=t[15],ue=r*g-s*f,ee=r*b-c*f,L=r*w-d*f,$=s*b-c*g,te=s*w-d*g,ve=c*w-d*b,ze=S*O-M*F,Te=S*q-z*F,Ce=S*X-R*F,Fe=M*q-z*O,Le=M*X-R*O,Be=z*X-R*q,Ee=ue*Be-ee*Le+L*Fe+$*Ce-te*Te+ve*ze;return Ee?(n[0]=(g*Be-b*Le+w*Fe)*(Ee=1/Ee),n[1]=(c*Le-s*Be-d*Fe)*Ee,n[2]=(O*ve-q*te+X*$)*Ee,n[3]=(z*te-M*ve-R*$)*Ee,n[4]=(b*Ce-f*Be-w*Te)*Ee,n[5]=(r*Be-c*Ce+d*Te)*Ee,n[6]=(q*L-F*ve-X*ee)*Ee,n[7]=(S*ve-z*L+R*ee)*Ee,n[8]=(f*Le-g*Ce+w*ze)*Ee,n[9]=(s*Ce-r*Le-d*ze)*Ee,n[10]=(F*te-O*L+X*ue)*Ee,n[11]=(M*L-S*te-R*ue)*Ee,n[12]=(g*Te-f*Fe-b*ze)*Ee,n[13]=(r*Fe-s*Te+c*ze)*Ee,n[14]=(O*ee-F*$-q*ue)*Ee,n[15]=(S*$-M*ee+z*ue)*Ee,n):null},T.ao=tm,T.ap=Ql,T.aq=kt,T.ar=function(n){let t=1/0,r=1/0,s=-1/0,c=-1/0;for(const d of n)t=Math.min(t,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),c=Math.max(c,d.y);return[t,r,s,c]},T.as=bi,T.at=Xr,T.au=function(n,t,r,s,c=!1){if(!r[0]&&!r[1])return[0,0];const d=c?s==="map"?-n.bearingInRadians:0:s==="viewport"?n.bearingInRadians:0;if(d){const f=Math.sin(d),g=Math.cos(d);r=[r[0]*g-r[1]*f,r[0]*f+r[1]*g]}return[c?r[0]:Xr(t,r[0],n.zoom),c?r[1]:Xr(t,r[1],n.zoom)]},T.aw=Bd,T.ax=Gd,T.ay=Fd,T.az=Hd,T.b=On,T.b$=n=>n.type==="line",T.b0=function(n,t,r){const s=new Float64Array(4);return function(c,d,f,g){var b=.5*Math.PI/180;d*=b,f*=b,g*=b;var w=Math.sin(d),S=Math.cos(d),M=Math.sin(f),z=Math.cos(f),R=Math.sin(g),F=Math.cos(g);c[0]=w*z*F-S*M*R,c[1]=S*M*F+w*z*R,c[2]=S*z*R-w*M*F,c[3]=S*z*F+w*M*R}(s,n,t-90,r),s},T.b1=function(n,t,r,s){var c,d,f,g,b,w=t[0],S=t[1],M=t[2],z=t[3],R=r[0],F=r[1],O=r[2],q=r[3];return(d=w*R+S*F+M*O+z*q)<0&&(d=-d,R=-R,F=-F,O=-O,q=-q),1-d>ft?(c=Math.acos(d),f=Math.sin(c),g=Math.sin((1-s)*c)/f,b=Math.sin(s*c)/f):(g=1-s,b=s),n[0]=g*w+b*R,n[1]=g*S+b*F,n[2]=g*M+b*O,n[3]=g*z+b*q,n},T.b2=function(n){const t=new Float64Array(9);var r,s,c,d,f,g,b,w,S,M,z,R,F,O,q,X,ue,ee;M=(c=(s=n)[0])*(b=c+c),z=(d=s[1])*b,F=(f=s[2])*b,O=f*(w=d+d),X=(g=s[3])*b,ue=g*w,ee=g*(S=f+f),(r=t)[0]=1-(R=d*w)-(q=f*S),r[3]=z-ee,r[6]=F+ue,r[1]=z+ee,r[4]=1-M-q,r[7]=O-X,r[2]=F-ue,r[5]=O+X,r[8]=1-M-R;const L=or(-Math.asin(Ir(t[2],-1,1)));let $,te;return Math.hypot(t[5],t[8])<.001?($=0,te=-or(Math.atan2(t[3],t[4]))):($=or(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),te=or(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:$,pitch:L+90,bearing:te}},T.b3=function(n,t){return n.roll==t.roll&&n.pitch==t.pitch&&n.bearing==t.bearing},T.b4=bt,T.b5=on,T.b6=Ao,T.b7=cc,T.b8=ko,T.b9=Dn,T.bA=Fn,T.bB=Bn,T.bC=class extends ur{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},T.bD=class extends ur{constructor(n,t){super(n,t),this.current=Us}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},T.bE=ka,T.bF=Aa,T.bG=class extends ur{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},T.bH=class extends ur{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},T.bI=ct,T.bJ=function(n,t){var r=Math.sin(t),s=Math.cos(t);return n[0]=s,n[1]=r,n[2]=0,n[3]=-r,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},T.bK=function(n,t,r){var s=t[0],c=t[1],d=t[2];return n[0]=s*r[0]+c*r[3]+d*r[6],n[1]=s*r[1]+c*r[4]+d*r[7],n[2]=s*r[2]+c*r[5]+d*r[8],n},T.bL=function(n,t,r,s,c,d,f){var g=1/(t-r),b=1/(s-c),w=1/(d-f);return n[0]=-2*g,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*w,n[11]=0,n[12]=(t+r)*g,n[13]=(c+s)*b,n[14]=(f+d)*w,n[15]=1,n},T.bM=class extends Wl{},T.bN=j_,T.bO=class extends Sn{},T.bP=yd,T.bQ=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},T.bR=Xp,T.bS=function(n,t,r){var s=t[0],c=t[1],d=t[2],f=r[3]*s+r[7]*c+r[11]*d+r[15];return n[0]=(r[0]*s+r[4]*c+r[8]*d+r[12])/(f=f||1),n[1]=(r[1]*s+r[5]*c+r[9]*d+r[13])/f,n[2]=(r[2]*s+r[6]*c+r[10]*d+r[14])/f,n},T.bT=class extends Zl{},T.bU=class extends i{},T.bV=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},T.bW=function(n,t){var r=n[0],s=n[1],c=n[2],d=n[3],f=n[4],g=n[5],b=n[6],w=n[7],S=n[8],M=n[9],z=n[10],R=n[11],F=n[12],O=n[13],q=n[14],X=n[15],ue=t[0],ee=t[1],L=t[2],$=t[3],te=t[4],ve=t[5],ze=t[6],Te=t[7],Ce=t[8],Fe=t[9],Le=t[10],Be=t[11],Ee=t[12],Ke=t[13],st=t[14],nt=t[15];return Math.abs(r-ue)<=ft*Math.max(1,Math.abs(r),Math.abs(ue))&&Math.abs(s-ee)<=ft*Math.max(1,Math.abs(s),Math.abs(ee))&&Math.abs(c-L)<=ft*Math.max(1,Math.abs(c),Math.abs(L))&&Math.abs(d-$)<=ft*Math.max(1,Math.abs(d),Math.abs($))&&Math.abs(f-te)<=ft*Math.max(1,Math.abs(f),Math.abs(te))&&Math.abs(g-ve)<=ft*Math.max(1,Math.abs(g),Math.abs(ve))&&Math.abs(b-ze)<=ft*Math.max(1,Math.abs(b),Math.abs(ze))&&Math.abs(w-Te)<=ft*Math.max(1,Math.abs(w),Math.abs(Te))&&Math.abs(S-Ce)<=ft*Math.max(1,Math.abs(S),Math.abs(Ce))&&Math.abs(M-Fe)<=ft*Math.max(1,Math.abs(M),Math.abs(Fe))&&Math.abs(z-Le)<=ft*Math.max(1,Math.abs(z),Math.abs(Le))&&Math.abs(R-Be)<=ft*Math.max(1,Math.abs(R),Math.abs(Be))&&Math.abs(F-Ee)<=ft*Math.max(1,Math.abs(F),Math.abs(Ee))&&Math.abs(O-Ke)<=ft*Math.max(1,Math.abs(O),Math.abs(Ke))&&Math.abs(q-st)<=ft*Math.max(1,Math.abs(q),Math.abs(st))&&Math.abs(X-nt)<=ft*Math.max(1,Math.abs(X),Math.abs(nt))},T.bX=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},T.bY=n=>n.type==="symbol",T.bZ=n=>n.type==="circle",T.b_=n=>n.type==="heatmap",T.ba=Ln,T.bb=Ui,T.bc=function(n,t,r,s,c){return Dn(s,c,Ir((n-t)/(r-t),0,1))},T.bd=Mr,T.be=function(){return new Float64Array(4)},T.bf=function(){return new Float64Array(3)},T.bg=function(n,t,r,s){var c=[],d=[];return c[0]=t[0]-r[0],c[1]=t[1]-r[1],c[2]=t[2]-r[2],d[0]=c[0]*Math.cos(s)-c[1]*Math.sin(s),d[1]=c[0]*Math.sin(s)+c[1]*Math.cos(s),d[2]=c[2],n[0]=d[0]+r[0],n[1]=d[1]+r[1],n[2]=d[2]+r[2],n},T.bh=function(n,t,r,s){var c=[],d=[];return c[0]=t[0]-r[0],c[1]=t[1]-r[1],c[2]=t[2]-r[2],d[0]=c[0],d[1]=c[1]*Math.cos(s)-c[2]*Math.sin(s),d[2]=c[1]*Math.sin(s)+c[2]*Math.cos(s),n[0]=d[0]+r[0],n[1]=d[1]+r[1],n[2]=d[2]+r[2],n},T.bi=function(n,t,r,s){var c=[],d=[];return c[0]=t[0]-r[0],c[1]=t[1]-r[1],c[2]=t[2]-r[2],d[0]=c[2]*Math.sin(s)+c[0]*Math.cos(s),d[1]=c[1],d[2]=c[2]*Math.cos(s)-c[0]*Math.sin(s),n[0]=d[0]+r[0],n[1]=d[1]+r[1],n[2]=d[2]+r[2],n},T.bj=function(n,t,r){var s=Math.sin(r),c=Math.cos(r),d=t[0],f=t[1],g=t[2],b=t[3],w=t[8],S=t[9],M=t[10],z=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=d*c-w*s,n[1]=f*c-S*s,n[2]=g*c-M*s,n[3]=b*c-z*s,n[8]=d*s+w*c,n[9]=f*s+S*c,n[10]=g*s+M*c,n[11]=b*s+z*c,n},T.bk=function(n,t){const r=Mr(n,360),s=Mr(t,360),c=s-r,d=s>r?c-360:c+360;return Math.abs(c)<Math.abs(d)?c:d},T.bl=function(n){return n[0]=0,n[1]=0,n[2]=0,n},T.bm=function(n,t,r,s){const c=Math.sqrt(n*n+t*t),d=Math.sqrt(r*r+s*s);n/=c,t/=c,r/=d,s/=d;const f=Math.acos(n*r+t*s);return-t*r+n*s>0?f:-f},T.bn=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]},T.bo=Ud,T.bp=function(n,t){const r=Mr(n,2*Math.PI),s=Mr(t,2*Math.PI);return Math.min(Math.abs(r-s),Math.abs(r-s+2*Math.PI),Math.abs(r-s-2*Math.PI))},T.bq=function(n){return Math.hypot(n[0],n[1],n[2])},T.br=function(){const n={},t=Z.$version;for(const r in Z.$root){const s=Z.$root[r];if(s.required){let c=null;c=r==="version"?t:s.type==="array"?[]:{},c!=null&&(n[r]=c)}}return n},T.bs=zu,T.bt=$n,T.bu=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=V(n[r],t[n[r].ref]));return n},T.bv=function(n){if(n.type==="custom")return new ly(n);switch(n.type){case"background":return new sy(n);case"circle":return new e_(n);case"fill":return new v_(n);case"fill-extrusion":return new M_(n);case"heatmap":return new i_(n);case"hillshade":return new n_(n);case"line":return new R_(n);case"raster":return new oy(n);case"symbol":return new rh(n)}},T.bw=ar,T.bx=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!U(n.version,t.version))return[{command:"setStyle",args:[t]}];U(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),U(n.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),U(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),U(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),U(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),U(n.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),U(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),U(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),U(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),U(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),U(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),U(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),U(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const s={},c=[];(function(f,g,b,w){let S;for(S in g=g||{},f=f||{})Object.prototype.hasOwnProperty.call(f,S)&&(Object.prototype.hasOwnProperty.call(g,S)||me(S,b,w));for(S in g)Object.prototype.hasOwnProperty.call(g,S)&&(Object.prototype.hasOwnProperty.call(f,S)?U(f[S],g[S])||(f[S].type==="geojson"&&g[S].type==="geojson"&&pe(f,g,S)?Q(b,{command:"setGeoJSONSourceData",args:[S,g[S].data]}):we(S,g,b,w)):oe(S,g,b))})(n.sources,t.sources,c,s);const d=[];n.layers&&n.layers.forEach(f=>{"source"in f&&s[f.source]?r.push({command:"removeLayer",args:[f.id]}):d.push(f)}),r=r.concat(c),function(f,g,b){g=g||[];const w=(f=f||[]).map(Pe),S=g.map(Pe),M=f.reduce(_e,{}),z=g.reduce(_e,{}),R=w.slice(),F=Object.create(null);let O,q,X,ue,ee;for(let L=0,$=0;L<w.length;L++)O=w[L],Object.prototype.hasOwnProperty.call(z,O)?$++:(Q(b,{command:"removeLayer",args:[O]}),R.splice(R.indexOf(O,$),1));for(let L=0,$=0;L<S.length;L++)O=S[S.length-1-L],R[R.length-1-L]!==O&&(Object.prototype.hasOwnProperty.call(M,O)?(Q(b,{command:"removeLayer",args:[O]}),R.splice(R.lastIndexOf(O,R.length-$),1)):$++,ue=R[R.length-L],Q(b,{command:"addLayer",args:[z[O],ue]}),R.splice(R.length-L,0,O),F[O]=!0);for(let L=0;L<S.length;L++)if(O=S[L],q=M[O],X=z[O],!F[O]&&!U(q,X))if(U(q.source,X.source)&&U(q["source-layer"],X["source-layer"])&&U(q.type,X.type)){for(ee in Me(q.layout,X.layout,b,O,null,"setLayoutProperty"),Me(q.paint,X.paint,b,O,null,"setPaintProperty"),U(q.filter,X.filter)||Q(b,{command:"setFilter",args:[O,X.filter]}),U(q.minzoom,X.minzoom)&&U(q.maxzoom,X.maxzoom)||Q(b,{command:"setLayerZoomRange",args:[O,X.minzoom,X.maxzoom]}),q)Object.prototype.hasOwnProperty.call(q,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Me(q[ee],X[ee],b,O,ee.slice(6),"setPaintProperty"):U(q[ee],X[ee])||Q(b,{command:"setLayerProperty",args:[O,ee,X[ee]]}));for(ee in X)Object.prototype.hasOwnProperty.call(X,ee)&&!Object.prototype.hasOwnProperty.call(q,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Me(q[ee],X[ee],b,O,ee.slice(6),"setPaintProperty"):U(q[ee],X[ee])||Q(b,{command:"setLayerProperty",args:[O,ee,X[ee]]}))}else Q(b,{command:"removeLayer",args:[O]}),ue=R[R.lastIndexOf(O)+1],Q(b,{command:"addLayer",args:[X,ue]})}(d,t.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[t]}]}return r},T.by=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},T.bz=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!n(t[s],r[s]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(!n(t[s],r[s]))return!1;return!0}return t===r},T.c=Vn,T.c0=n=>n.type==="fill",T.c1=n=>n.type==="fill-extrusion",T.c2=n=>n.type==="hillshade",T.c3=n=>n.type==="raster",T.c4=n=>n.type==="background",T.c5=n=>n.type==="custom",T.c6=vs,T.c7=function(n,t,r){const s=fn(t.x-r.x,t.y-r.y),c=fn(n.x-r.x,n.y-r.y);var d,f;return or(Math.atan2(s[0]*c[1]-s[1]*c[0],(d=s)[0]*(f=c)[0]+d[1]*f[1]))},T.c8=jr,T.c9=function(n,t,r){var s=t[0],c=t[1];return n[0]=r[0]*s+r[4]*c+r[12],n[1]=r[1]*s+r[5]*c+r[13],n},T.cA=Sf,T.cB=ao,T.cC=nn,T.ca=function(n,t){const{x:r,y:s}=_c.fromLngLat(t);return!(n<0||n>25||s<0||s>=1||r<0||r>=1)},T.cb=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},T.cc=class extends Ca{},T.cd=yy,T.cf=function(n){return n.message===Nn},T.cg=Yr,T.ch=function(n,t){_n.REGISTERED_PROTOCOLS[n]=t},T.ci=function(n){delete _n.REGISTERED_PROTOCOLS[n]},T.cj=function(n,t){const r={};for(let c=0;c<n.length;c++){const d=t&&t[n[c].id]||Rl(n[c]);t&&(t[n[c].id]=d);let f=r[d];f||(f=r[d]=[]),f.push(n[c])}const s=[];for(const c in r)s.push(r[c]);return s},T.ck=Ge,T.cl=Kf,T.cm=Jf,T.cn=Mf,T.co=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=It/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,s=t._unevaluatedLayout._values,c={layoutIconSize:s["icon-size"].possiblyEvaluate(new Kt(n.bucket.zoom+1),n.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Kt(n.bucket.zoom+1),n.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Kt(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:w,maxZoom:S}=n.bucket.textSizeData;c.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Kt(w),n.canonical),s["text-size"].possiblyEvaluate(new Kt(S),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:w,maxZoom:S}=n.bucket.iconSizeData;c.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Kt(w),n.canonical),s["icon-size"].possiblyEvaluate(new Kt(S),n.canonical)]}const d=r.get("text-line-height")*bi,f=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",g=r.get("text-keep-upright"),b=r.get("text-size");for(const w of n.bucket.features){const S=r.get("text-font").evaluate(w,{},n.canonical).join(","),M=b.evaluate(w,{},n.canonical),z=c.layoutTextSize.evaluate(w,{},n.canonical),R=c.layoutIconSize.evaluate(w,{},n.canonical),F={horizontal:{},vertical:void 0},O=w.text;let q,X=[0,0];if(O){const L=O.toString(),$=r.get("text-letter-spacing").evaluate(w,{},n.canonical)*bi,te=Du(L)?$:0,ve=r.get("text-anchor").evaluate(w,{},n.canonical),ze=um(t,w,n.canonical);if(!ze){const Le=r.get("text-radial-offset").evaluate(w,{},n.canonical);X=Le?cm(ve,[Le*bi,Zd]):r.get("text-offset").evaluate(w,{},n.canonical).map(Be=>Be*bi)}let Te=f?"center":r.get("text-justify").evaluate(w,{},n.canonical);const Ce=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(w,{},n.canonical)*bi:1/0,Fe=()=>{n.bucket.allowVerticalPlacement&&Os(L)&&(F.vertical=eh(O,n.glyphMap,n.glyphPositions,n.imagePositions,S,Ce,d,ve,"left",te,X,T.ai.vertical,!0,z,M))};if(!f&&ze){const Le=new Set;if(Te==="auto")for(let Ee=0;Ee<ze.values.length;Ee+=2)Le.add(Gd(ze.values[Ee]));else Le.add(Te);let Be=!1;for(const Ee of Le)if(!F.horizontal[Ee])if(Be)F.horizontal[Ee]=F.horizontal[0];else{const Ke=eh(O,n.glyphMap,n.glyphPositions,n.imagePositions,S,Ce,d,"center",Ee,te,X,T.ai.horizontal,!1,z,M);Ke&&(F.horizontal[Ee]=Ke,Be=Ke.positionedLines.length===1)}Fe()}else{Te==="auto"&&(Te=Gd(ve));const Le=eh(O,n.glyphMap,n.glyphPositions,n.imagePositions,S,Ce,d,ve,Te,te,X,T.ai.horizontal,!1,z,M);Le&&(F.horizontal[Te]=Le),Fe(),Os(L)&&f&&g&&(F.vertical=eh(O,n.glyphMap,n.glyphPositions,n.imagePositions,S,Ce,d,ve,Te,te,X,T.ai.vertical,!1,z,M))}}let ue=!1;if(w.icon&&w.icon.name){const L=n.imageMap[w.icon.name];L&&(q=ey(n.imagePositions[w.icon.name],r.get("icon-offset").evaluate(w,{},n.canonical),r.get("icon-anchor").evaluate(w,{},n.canonical)),ue=!!L.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=ue:n.bucket.sdfIcons!==ue&&ji("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(L.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const ee=dm(F.horizontal)||F.vertical;n.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||q)&&gy(n.bucket,w,F,q,n.imageMap,c,z,R,X,ue,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},T.cp=Ed,T.cq=Td,T.cr=Id,T.cs=hc,T.ct=zd,T.cu=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},T.cv=function(n,t,r,s,c){return o(this,void 0,void 0,function*(){if(Je())try{return yield Er(n,t,r,s,c)}catch{}return function(d,f,g,b,w){const S=d.width,M=d.height;mn&&gn||(mn=new OffscreenCanvas(S,M),gn=mn.getContext("2d",{willReadFrequently:!0})),mn.width=S,mn.height=M,gn.drawImage(d,0,0,S,M);const z=gn.getImageData(f,g,b,w);return gn.clearRect(0,0,S,M),z.data}(n,t,r,s,c)})},T.cw=Xf,T.cx=he,T.cy=xe,T.cz=pf,T.d=n=>o(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),T.e=Di,T.f=n=>new Promise((t,r)=>{const s=new Image;s.onload=()=>{t(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=jn})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(n)],{type:"image/png"});s.src=n.byteLength?URL.createObjectURL(c):jn}),T.g=ta,T.h=(n,t)=>Jr(Di(n,{type:"json"}),t),T.i=Kr,T.j=ia,T.k=xs,T.l=(n,t)=>Jr(Di(n,{type:"arrayBuffer"}),t),T.m=Jr,T.n=function(n){return new zd(n).readFields(U_,[])},T.o=nc,T.p=Cf,T.q=tr,T.r=hd,T.s=qn,T.t=Eu,T.u=Bs,T.v=Z,T.w=ji,T.x=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},T.y=Ar,T.z=Kt}),E("worker",["./shared"],function(T){class o{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,V){for(const Q of j){this._layerConfigs[Q.id]=Q;const oe=this._layers[Q.id]=T.bv(Q);oe._featureFilter=T.a4(oe.filter),this.keyCache[Q.id]&&delete this.keyCache[Q.id]}for(const Q of V)delete this.keyCache[Q],delete this._layerConfigs[Q],delete this._layers[Q];this.familiesBySource={};const U=T.cj(Object.values(this._layerConfigs),this.keyCache);for(const Q of U){const oe=Q.map(_e=>this._layers[_e.id]),me=oe[0];if(me.visibility==="none")continue;const we=me.source||"";let pe=this.familiesBySource[we];pe||(pe=this.familiesBySource[we]={});const Me=me.sourceLayer||"_geojsonTileLayer";let Pe=pe[Me];Pe||(Pe=pe[Me]=[]),Pe.push(oe)}}}class he{constructor(j){const V={},U=[];for(const we in j){const pe=j[we],Me=V[we]={};for(const Pe in pe){const _e=pe[+Pe];if(!_e||_e.bitmap.width===0||_e.bitmap.height===0)continue;const de={x:0,y:0,w:_e.bitmap.width+2,h:_e.bitmap.height+2};U.push(de),Me[Pe]={rect:de,metrics:_e.metrics}}}const{w:Q,h:oe}=T.p(U),me=new T.o({width:Q||1,height:oe||1});for(const we in j){const pe=j[we];for(const Me in pe){const Pe=pe[+Me];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;const _e=V[we][Me].rect;T.o.copy(Pe.bitmap,me,{x:0,y:0},{x:_e.x+1,y:_e.y+1},Pe.bitmap)}}this.image=me,this.positions=V}}T.ck("GlyphAtlas",he);class se{constructor(j){this.tileID=new T.S(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,V,U,Q,oe){return T._(this,void 0,void 0,function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new T.a2;const me=new T.cl(Object.keys(j.layers).sort()),we=new T.cm(this.tileID,this.promoteId);we.bucketLayerIDs=[];const pe={},Me={featureIndex:we,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:U,subdivisionGranularity:oe},Pe=V.familiesBySource[this.source];for(const ut in Pe){const We=j.layers[ut];if(!We)continue;We.version===1&&T.w(`Vector tile source "${this.source}" layer "${ut}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ri=me.encode(ut),bn=[];for(let _i=0;_i<We.length;_i++){const hi=We.feature(_i),Ht=we.getId(hi,ut);bn.push({feature:hi,id:Ht,index:_i,sourceLayerIndex:ri})}for(const _i of Pe[ut]){const hi=_i[0];hi.source!==this.source&&T.w(`layer.source = ${hi.source} does not equal this.source = ${this.source}`),hi.minzoom&&this.zoom<Math.floor(hi.minzoom)||hi.maxzoom&&this.zoom>=hi.maxzoom||hi.visibility!=="none"&&(fe(_i,this.zoom,U),(pe[hi.id]=hi.createBucket({index:we.bucketLayerIDs.length,layers:_i,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ri,sourceID:this.source})).populate(bn,Me,this.tileID.canonical),we.bucketLayerIDs.push(_i.map(Ht=>Ht.id)))}}const _e=T.bA(Me.glyphDependencies,ut=>Object.keys(ut).map(Number));this.inFlightDependencies.forEach(ut=>ut==null?void 0:ut.abort()),this.inFlightDependencies=[];let de=Promise.resolve({});if(Object.keys(_e).length){const ut=new AbortController;this.inFlightDependencies.push(ut),de=Q.sendAsync({type:"GG",data:{stacks:_e,source:this.source,tileID:this.tileID,type:"glyphs"}},ut)}const Ue=Object.keys(Me.iconDependencies);let Ne=Promise.resolve({});if(Ue.length){const ut=new AbortController;this.inFlightDependencies.push(ut),Ne=Q.sendAsync({type:"GI",data:{icons:Ue,source:this.source,tileID:this.tileID,type:"icons"}},ut)}const at=Object.keys(Me.patternDependencies);let dt=Promise.resolve({});if(at.length){const ut=new AbortController;this.inFlightDependencies.push(ut),dt=Q.sendAsync({type:"GI",data:{icons:at,source:this.source,tileID:this.tileID,type:"patterns"}},ut)}const[ke,$e,Ye]=yield Promise.all([de,Ne,dt]),yt=new he(ke),Pt=new T.cn($e,Ye);for(const ut in pe){const We=pe[ut];We instanceof T.a3?(fe(We.layers,this.zoom,U),T.co({bucket:We,glyphMap:ke,glyphPositions:yt.positions,imageMap:$e,imagePositions:Pt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Me.subdivisionGranularity})):We.hasPattern&&(We instanceof T.cp||We instanceof T.cq||We instanceof T.cr)&&(fe(We.layers,this.zoom,U),We.addFeatures(Me,this.tileID.canonical,Pt.patternPositions))}return this.status="done",{buckets:Object.values(pe).filter(ut=>!ut.isEmpty()),featureIndex:we,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yt.image,imageAtlas:Pt,glyphMap:this.returnDependencies?ke:null,iconMap:this.returnDependencies?$e:null,glyphPositions:this.returnDependencies?yt.positions:null}})}}function fe(Z,j,V){const U=new T.z(j);for(const Q of Z)Q.recalculate(U,V)}class xe{constructor(j,V,U){this.actor=j,this.layerIndex=V,this.availableImages=U,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,V){return T._(this,void 0,void 0,function*(){const U=yield T.l(j.request,V);try{return{vectorTile:new T.cs.VectorTile(new T.ct(U.data)),rawData:U.data,cacheControl:U.cacheControl,expires:U.expires}}catch(Q){const oe=new Uint8Array(U.data);let me=`Unable to parse the tile at ${j.request.url}, `;throw me+=oe[0]===31&&oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Q.message}`,new Error(me)}})}loadTile(j){return T._(this,void 0,void 0,function*(){const V=j.uid,U=!!(j&&j.request&&j.request.collectResourceTiming)&&new T.cu(j.request),Q=new se(j);this.loading[V]=Q;const oe=new AbortController;Q.abort=oe;try{const me=yield this.loadVectorTile(j,oe);if(delete this.loading[V],!me)return null;const we=me.rawData,pe={};me.expires&&(pe.expires=me.expires),me.cacheControl&&(pe.cacheControl=me.cacheControl);const Me={};if(U){const _e=U.finish();_e&&(Me.resourceTiming=JSON.parse(JSON.stringify(_e)))}Q.vectorTile=me.vectorTile;const Pe=Q.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);this.loaded[V]=Q,this.fetching[V]={rawTileData:we,cacheControl:pe,resourceTiming:Me};try{const _e=yield Pe;return T.e({rawTileData:we.slice(0)},_e,pe,Me)}finally{delete this.fetching[V]}}catch(me){throw delete this.loading[V],Q.status="done",this.loaded[V]=Q,me}})}reloadTile(j){return T._(this,void 0,void 0,function*(){const V=j.uid;if(!this.loaded||!this.loaded[V])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const U=this.loaded[V];if(U.showCollisionBoxes=j.showCollisionBoxes,U.status==="parsing"){const Q=yield U.parse(U.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);let oe;if(this.fetching[V]){const{rawTileData:me,cacheControl:we,resourceTiming:pe}=this.fetching[V];delete this.fetching[V],oe=T.e({rawTileData:me.slice(0)},Q,we,pe)}else oe=Q;return oe}if(U.status==="done"&&U.vectorTile)return U.parse(U.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity)})}abortTile(j){return T._(this,void 0,void 0,function*(){const V=this.loading,U=j.uid;V&&V[U]&&V[U].abort&&(V[U].abort.abort(),delete V[U])})}removeTile(j){return T._(this,void 0,void 0,function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]})}}class ie{constructor(){this.loaded={}}loadTile(j){return T._(this,void 0,void 0,function*(){const{uid:V,encoding:U,rawImageData:Q,redFactor:oe,greenFactor:me,blueFactor:we,baseShift:pe}=j,Me=Q.width+2,Pe=Q.height+2,_e=T.b(Q)?new T.R({width:Me,height:Pe},yield T.cv(Q,-1,-1,Me,Pe)):Q,de=new T.cw(V,_e,U,oe,me,we,pe);return this.loaded=this.loaded||{},this.loaded[V]=de,de})}removeTile(j){const V=this.loaded,U=j.uid;V&&V[U]&&delete V[U]}}var K,ge,Oe=function(){if(ge)return K;function Z(V,U){if(V.length!==0){j(V[0],U);for(var Q=1;Q<V.length;Q++)j(V[Q],!U)}}function j(V,U){for(var Q=0,oe=0,me=0,we=V.length,pe=we-1;me<we;pe=me++){var Me=(V[me][0]-V[pe][0])*(V[pe][1]+V[me][1]),Pe=Q+Me;oe+=Math.abs(Q)>=Math.abs(Me)?Q-Pe+Me:Me-Pe+Q,Q=Pe}Q+oe>=0!=!!U&&V.reverse()}return ge=1,K=function V(U,Q){var oe,me=U&&U.type;if(me==="FeatureCollection")for(oe=0;oe<U.features.length;oe++)V(U.features[oe],Q);else if(me==="GeometryCollection")for(oe=0;oe<U.geometries.length;oe++)V(U.geometries[oe],Q);else if(me==="Feature")V(U.geometry,Q);else if(me==="Polygon")Z(U.coordinates,Q);else if(me==="MultiPolygon")for(oe=0;oe<U.coordinates.length;oe++)Z(U.coordinates[oe],Q);return U}}(),He=T.cx(Oe);const Ze=T.cs.VectorTileFeature.prototype.toGeoJSON;class Re{constructor(j){this._feature=j,this.extent=T.X,this.type=j.type,this.properties=j.tags,"id"in j&&!isNaN(j.id)&&(this.id=parseInt(j.id,10))}loadGeometry(){if(this._feature.type===1){const j=[];for(const V of this._feature.geometry)j.push([new T.P(V[0],V[1])]);return j}{const j=[];for(const V of this._feature.geometry){const U=[];for(const Q of V)U.push(new T.P(Q[0],Q[1]));j.push(U)}return j}}toGeoJSON(j,V,U){return Ze.call(this,j,V,U)}}class rt{constructor(j){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=T.X,this.length=j.length,this._features=j}feature(j){return new Re(this._features[j])}}var Je,lt,ft,et={exports:{}},ct=function(){if(ft)return et.exports;ft=1;var Z=T.cA(),j=function(){if(lt)return Je;lt=1;var Pe=T.cy(),_e=T.cz().VectorTileFeature;function de(Ne,at){this.options=at||{},this.features=Ne,this.length=Ne.length}function Ue(Ne,at){this.id=typeof Ne.id=="number"?Ne.id:void 0,this.type=Ne.type,this.rawGeometry=Ne.type===1?[Ne.geometry]:Ne.geometry,this.properties=Ne.tags,this.extent=at||4096}return Je=de,de.prototype.feature=function(Ne){return new Ue(this.features[Ne],this.options.extent)},Ue.prototype.loadGeometry=function(){var Ne=this.rawGeometry;this.geometry=[];for(var at=0;at<Ne.length;at++){for(var dt=Ne[at],ke=[],$e=0;$e<dt.length;$e++)ke.push(new Pe(dt[$e][0],dt[$e][1]));this.geometry.push(ke)}return this.geometry},Ue.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ne=this.geometry,at=1/0,dt=-1/0,ke=1/0,$e=-1/0,Ye=0;Ye<Ne.length;Ye++)for(var yt=Ne[Ye],Pt=0;Pt<yt.length;Pt++){var ut=yt[Pt];at=Math.min(at,ut.x),dt=Math.max(dt,ut.x),ke=Math.min(ke,ut.y),$e=Math.max($e,ut.y)}return[at,ke,dt,$e]},Ue.prototype.toGeoJSON=_e.prototype.toGeoJSON,Je}();function V(Pe){var _e=new Z;return function(de,Ue){for(var Ne in de.layers)Ue.writeMessage(3,U,de.layers[Ne])}(Pe,_e),_e.finish()}function U(Pe,_e){var de;_e.writeVarintField(15,Pe.version||1),_e.writeStringField(1,Pe.name||""),_e.writeVarintField(5,Pe.extent||4096);var Ue={keys:[],values:[],keycache:{},valuecache:{}};for(de=0;de<Pe.length;de++)Ue.feature=Pe.feature(de),_e.writeMessage(2,Q,Ue);var Ne=Ue.keys;for(de=0;de<Ne.length;de++)_e.writeStringField(3,Ne[de]);var at=Ue.values;for(de=0;de<at.length;de++)_e.writeMessage(4,Me,at[de])}function Q(Pe,_e){var de=Pe.feature;de.id!==void 0&&_e.writeVarintField(1,de.id),_e.writeMessage(2,oe,Pe),_e.writeVarintField(3,de.type),_e.writeMessage(4,pe,de)}function oe(Pe,_e){var de=Pe.feature,Ue=Pe.keys,Ne=Pe.values,at=Pe.keycache,dt=Pe.valuecache;for(var ke in de.properties){var $e=de.properties[ke],Ye=at[ke];if($e!==null){Ye===void 0&&(Ue.push(ke),at[ke]=Ye=Ue.length-1),_e.writeVarint(Ye);var yt=typeof $e;yt!=="string"&&yt!=="boolean"&&yt!=="number"&&($e=JSON.stringify($e));var Pt=yt+":"+$e,ut=dt[Pt];ut===void 0&&(Ne.push($e),dt[Pt]=ut=Ne.length-1),_e.writeVarint(ut)}}}function me(Pe,_e){return(_e<<3)+(7&Pe)}function we(Pe){return Pe<<1^Pe>>31}function pe(Pe,_e){for(var de=Pe.loadGeometry(),Ue=Pe.type,Ne=0,at=0,dt=de.length,ke=0;ke<dt;ke++){var $e=de[ke],Ye=1;Ue===1&&(Ye=$e.length),_e.writeVarint(me(1,Ye));for(var yt=Ue===3?$e.length-1:$e.length,Pt=0;Pt<yt;Pt++){Pt===1&&Ue!==1&&_e.writeVarint(me(2,yt-1));var ut=$e[Pt].x-Ne,We=$e[Pt].y-at;_e.writeVarint(we(ut)),_e.writeVarint(we(We)),Ne+=ut,at+=We}Ue===3&&_e.writeVarint(me(7,1))}}function Me(Pe,_e){var de=typeof Pe;de==="string"?_e.writeStringField(1,Pe):de==="boolean"?_e.writeBooleanField(7,Pe):de==="number"&&(Pe%1!=0?_e.writeDoubleField(3,Pe):Pe<0?_e.writeSVarintField(6,Pe):_e.writeVarintField(5,Pe))}return et.exports=V,et.exports.fromVectorTileJs=V,et.exports.fromGeojsonVt=function(Pe,_e){_e=_e||{};var de={};for(var Ue in Pe)de[Ue]=new j(Pe[Ue].features,_e),de[Ue].name=Ue,de[Ue].version=_e.version,de[Ue].extent=_e.extent;return V({layers:de})},et.exports.GeoJSONWrapper=j,et.exports}(),kt=T.cx(ct);const Qi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Z=>Z},Ci=Math.fround||(zi=new Float32Array(1),Z=>(zi[0]=+Z,zi[0]));var zi;const er=3,mi=5,fn=6;class It{constructor(j){this.options=Object.assign(Object.create(Qi),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:V,minZoom:U,maxZoom:Q}=this.options;V&&console.time("total time");const oe=`prepare ${j.length} points`;V&&console.time(oe),this.points=j;const me=[];for(let pe=0;pe<j.length;pe++){const Me=j[pe];if(!Me.geometry)continue;const[Pe,_e]=Me.geometry.coordinates,de=Ci(Dn(Pe)),Ue=Ci(Ln(_e));me.push(de,Ue,1/0,pe,-1,1),this.options.reduce&&me.push(0)}let we=this.trees[Q+1]=this._createTree(me);V&&console.timeEnd(oe);for(let pe=Q;pe>=U;pe--){const Me=+Date.now();we=this.trees[pe]=this._createTree(this._cluster(we,pe)),V&&console.log("z%d: %d clusters in %dms",pe,we.numItems,+Date.now()-Me)}return V&&console.timeEnd("total time"),this}getClusters(j,V){let U=((j[0]+180)%360+360)%360-180;const Q=Math.max(-90,Math.min(90,j[1]));let oe=j[2]===180?180:((j[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)U=-180,oe=180;else if(U>oe){const _e=this.getClusters([U,Q,180,me],V),de=this.getClusters([-180,Q,oe,me],V);return _e.concat(de)}const we=this.trees[this._limitZoom(V)],pe=we.range(Dn(U),Ln(me),Dn(oe),Ln(Q)),Me=we.data,Pe=[];for(const _e of pe){const de=this.stride*_e;Pe.push(Me[de+mi]>1?Xr(Me,de,this.clusterProps):this.points[Me[de+er]])}return Pe}getChildren(j){const V=this._getOriginId(j),U=this._getOriginZoom(j),Q="No cluster with the specified id.",oe=this.trees[U];if(!oe)throw new Error(Q);const me=oe.data;if(V*this.stride>=me.length)throw new Error(Q);const we=this.options.radius/(this.options.extent*Math.pow(2,U-1)),pe=oe.within(me[V*this.stride],me[V*this.stride+1],we),Me=[];for(const Pe of pe){const _e=Pe*this.stride;me[_e+4]===j&&Me.push(me[_e+mi]>1?Xr(me,_e,this.clusterProps):this.points[me[_e+er]])}if(Me.length===0)throw new Error(Q);return Me}getLeaves(j,V,U){const Q=[];return this._appendLeaves(Q,j,V=V||10,U=U||0,0),Q}getTile(j,V,U){const Q=this.trees[this._limitZoom(j)],oe=Math.pow(2,j),{extent:me,radius:we}=this.options,pe=we/me,Me=(U-pe)/oe,Pe=(U+1+pe)/oe,_e={features:[]};return this._addTileFeatures(Q.range((V-pe)/oe,Me,(V+1+pe)/oe,Pe),Q.data,V,U,oe,_e),V===0&&this._addTileFeatures(Q.range(1-pe/oe,Me,1,Pe),Q.data,oe,U,oe,_e),V===oe-1&&this._addTileFeatures(Q.range(0,Me,pe/oe,Pe),Q.data,-1,U,oe,_e),_e.features.length?_e:null}getClusterExpansionZoom(j){let V=this._getOriginZoom(j)-1;for(;V<=this.options.maxZoom;){const U=this.getChildren(j);if(V++,U.length!==1)break;j=U[0].properties.cluster_id}return V}_appendLeaves(j,V,U,Q,oe){const me=this.getChildren(V);for(const we of me){const pe=we.properties;if(pe&&pe.cluster?oe+pe.point_count<=Q?oe+=pe.point_count:oe=this._appendLeaves(j,pe.cluster_id,U,Q,oe):oe<Q?oe++:j.push(we),j.length===U)break}return oe}_createTree(j){const V=new T.az(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let U=0;U<j.length;U+=this.stride)V.add(j[U],j[U+1]);return V.finish(),V.data=j,V}_addTileFeatures(j,V,U,Q,oe,me){for(const we of j){const pe=we*this.stride,Me=V[pe+mi]>1;let Pe,_e,de;if(Me)Pe=Mr(V,pe,this.clusterProps),_e=V[pe],de=V[pe+1];else{const at=this.points[V[pe+er]];Pe=at.properties;const[dt,ke]=at.geometry.coordinates;_e=Dn(dt),de=Ln(ke)}const Ue={type:1,geometry:[[Math.round(this.options.extent*(_e*oe-U)),Math.round(this.options.extent*(de*oe-Q))]],tags:Pe};let Ne;Ne=Me||this.options.generateId?V[pe+er]:this.points[V[pe+er]].id,Ne!==void 0&&(Ue.id=Ne),me.features.push(Ue)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,V){const{radius:U,extent:Q,reduce:oe,minPoints:me}=this.options,we=U/(Q*Math.pow(2,V)),pe=j.data,Me=[],Pe=this.stride;for(let _e=0;_e<pe.length;_e+=Pe){if(pe[_e+2]<=V)continue;pe[_e+2]=V;const de=pe[_e],Ue=pe[_e+1],Ne=j.within(pe[_e],pe[_e+1],we),at=pe[_e+mi];let dt=at;for(const ke of Ne){const $e=ke*Pe;pe[$e+2]>V&&(dt+=pe[$e+mi])}if(dt>at&&dt>=me){let ke,$e=de*at,Ye=Ue*at,yt=-1;const Pt=((_e/Pe|0)<<5)+(V+1)+this.points.length;for(const ut of Ne){const We=ut*Pe;if(pe[We+2]<=V)continue;pe[We+2]=V;const ri=pe[We+mi];$e+=pe[We]*ri,Ye+=pe[We+1]*ri,pe[We+4]=Pt,oe&&(ke||(ke=this._map(pe,_e,!0),yt=this.clusterProps.length,this.clusterProps.push(ke)),oe(ke,this._map(pe,We)))}pe[_e+4]=Pt,Me.push($e/dt,Ye/dt,1/0,Pt,-1,dt),oe&&Me.push(yt)}else{for(let ke=0;ke<Pe;ke++)Me.push(pe[_e+ke]);if(dt>1)for(const ke of Ne){const $e=ke*Pe;if(!(pe[$e+2]<=V)){pe[$e+2]=V;for(let Ye=0;Ye<Pe;Ye++)Me.push(pe[$e+Ye])}}}}return Me}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,V,U){if(j[V+mi]>1){const me=this.clusterProps[j[V+fn]];return U?Object.assign({},me):me}const Q=this.points[j[V+er]].properties,oe=this.options.map(Q);return U&&oe===Q?Object.assign({},oe):oe}}function Xr(Z,j,V){return{type:"Feature",id:Z[j+er],properties:Mr(Z,j,V),geometry:{type:"Point",coordinates:[(U=Z[j],360*(U-.5)),vs(Z[j+1])]}};var U}function Mr(Z,j,V){const U=Z[j+mi],Q=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U,oe=Z[j+fn],me=oe===-1?{}:Object.assign({},V[oe]);return Object.assign(me,{cluster:!0,cluster_id:Z[j+er],point_count:U,point_count_abbreviated:Q})}function Dn(Z){return Z/360+.5}function Ln(Z){const j=Math.sin(Z*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function vs(Z){const j=(180-360*Z)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function jr(Z,j,V,U){let Q=U;const oe=j+(V-j>>1);let me,we=V-j;const pe=Z[j],Me=Z[j+1],Pe=Z[V],_e=Z[V+1];for(let de=j+3;de<V;de+=3){const Ue=Ir(Z[de],Z[de+1],pe,Me,Pe,_e);if(Ue>Q)me=de,Q=Ue;else if(Ue===Q){const Ne=Math.abs(de-oe);Ne<we&&(me=de,we=Ne)}}Q>U&&(me-j>3&&jr(Z,j,me,U),Z[me+2]=Q,V-me>3&&jr(Z,me,V,U))}function Ir(Z,j,V,U,Q,oe){let me=Q-V,we=oe-U;if(me!==0||we!==0){const pe=((Z-V)*me+(j-U)*we)/(me*me+we*we);pe>1?(V=Q,U=oe):pe>0&&(V+=me*pe,U+=we*pe)}return me=Z-V,we=j-U,me*me+we*we}function vr(Z,j,V,U){const Q={id:Z??null,type:j,geometry:V,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Di(Q,V);else if(j==="Polygon")Di(Q,V[0]);else if(j==="MultiLineString")for(const oe of V)Di(Q,oe);else if(j==="MultiPolygon")for(const oe of V)Di(Q,oe[0]);return Q}function Di(Z,j){for(let V=0;V<j.length;V+=3)Z.minX=Math.min(Z.minX,j[V]),Z.minY=Math.min(Z.minY,j[V+1]),Z.maxX=Math.max(Z.maxX,j[V]),Z.maxY=Math.max(Z.maxY,j[V+1])}function Rn(Z,j,V,U){if(!j.geometry)return;const Q=j.geometry.coordinates;if(Q&&Q.length===0)return;const oe=j.geometry.type,me=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2);let we=[],pe=j.id;if(V.promoteId?pe=j.properties[V.promoteId]:V.generateId&&(pe=U||0),oe==="Point")Fn(Q,we);else if(oe==="MultiPoint")for(const Me of Q)Fn(Me,we);else if(oe==="LineString")Bn(Q,we,me,!1);else if(oe==="MultiLineString"){if(V.lineMetrics){for(const Me of Q)we=[],Bn(Me,we,me,!1),Z.push(vr(pe,"LineString",we,j.properties));return}ar(Q,we,me,!1)}else if(oe==="Polygon")ar(Q,we,me,!0);else{if(oe!=="MultiPolygon"){if(oe==="GeometryCollection"){for(const Me of j.geometry.geometries)Rn(Z,{id:pe,geometry:Me,properties:j.properties},V,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Me of Q){const Pe=[];ar(Me,Pe,me,!0),we.push(Pe)}}Z.push(vr(pe,oe,we,j.properties))}function Fn(Z,j){j.push(ea(Z[0]),ji(Z[1]),0)}function Bn(Z,j,V,U){let Q,oe,me=0;for(let pe=0;pe<Z.length;pe++){const Me=ea(Z[pe][0]),Pe=ji(Z[pe][1]);j.push(Me,Pe,0),pe>0&&(me+=U?(Q*Pe-Me*oe)/2:Math.sqrt(Math.pow(Me-Q,2)+Math.pow(Pe-oe,2))),Q=Me,oe=Pe}const we=j.length-3;j[2]=1,jr(j,0,we,V),j[we+2]=1,j.size=Math.abs(me),j.start=0,j.end=j.size}function ar(Z,j,V,U){for(let Q=0;Q<Z.length;Q++){const oe=[];Bn(Z[Q],oe,V,U),j.push(oe)}}function ea(Z){return Z/360+.5}function ji(Z){const j=Math.sin(Z*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function gi(Z,j,V,U,Q,oe,me,we){if(U/=j,oe>=(V/=j)&&me<U)return Z;if(me<V||oe>=U)return null;const pe=[];for(const Me of Z){const Pe=Me.geometry;let _e=Me.type;const de=Q===0?Me.minX:Me.minY,Ue=Q===0?Me.maxX:Me.maxY;if(de>=V&&Ue<U){pe.push(Me);continue}if(Ue<V||de>=U)continue;let Ne=[];if(_e==="Point"||_e==="MultiPoint")Kr(Pe,Ne,V,U,Q);else if(_e==="LineString")oi(Pe,Ne,V,U,Q,!1,we.lineMetrics);else if(_e==="MultiLineString")jn(Pe,Ne,V,U,Q,!1);else if(_e==="Polygon")jn(Pe,Ne,V,U,Q,!0);else if(_e==="MultiPolygon")for(const at of Pe){const dt=[];jn(at,dt,V,U,Q,!0),dt.length&&Ne.push(dt)}if(Ne.length){if(we.lineMetrics&&_e==="LineString"){for(const at of Ne)pe.push(vr(Me.id,_e,at,Me.tags));continue}_e!=="LineString"&&_e!=="MultiLineString"||(Ne.length===1?(_e="LineString",Ne=Ne[0]):_e="MultiLineString"),_e!=="Point"&&_e!=="MultiPoint"||(_e=Ne.length===3?"Point":"MultiPoint"),pe.push(vr(Me.id,_e,Ne,Me.tags))}}return pe.length?pe:null}function Kr(Z,j,V,U,Q){for(let oe=0;oe<Z.length;oe+=3){const me=Z[oe+Q];me>=V&&me<=U&&Er(j,Z[oe],Z[oe+1],Z[oe+2])}}function oi(Z,j,V,U,Q,oe,me){let we=On(Z);const pe=Q===0?mn:gn;let Me,Pe,_e=Z.start;for(let dt=0;dt<Z.length-3;dt+=3){const ke=Z[dt],$e=Z[dt+1],Ye=Z[dt+2],yt=Z[dt+3],Pt=Z[dt+4],ut=Q===0?ke:$e,We=Q===0?yt:Pt;let ri=!1;me&&(Me=Math.sqrt(Math.pow(ke-yt,2)+Math.pow($e-Pt,2))),ut<V?We>V&&(Pe=pe(we,ke,$e,yt,Pt,V),me&&(we.start=_e+Me*Pe)):ut>U?We<U&&(Pe=pe(we,ke,$e,yt,Pt,U),me&&(we.start=_e+Me*Pe)):Er(we,ke,$e,Ye),We<V&&ut>=V&&(Pe=pe(we,ke,$e,yt,Pt,V),ri=!0),We>U&&ut<=U&&(Pe=pe(we,ke,$e,yt,Pt,U),ri=!0),!oe&&ri&&(me&&(we.end=_e+Me*Pe),j.push(we),we=On(Z)),me&&(_e+=Me)}let de=Z.length-3;const Ue=Z[de],Ne=Z[de+1],at=Q===0?Ue:Ne;at>=V&&at<=U&&Er(we,Ue,Ne,Z[de+2]),de=we.length-3,oe&&de>=3&&(we[de]!==we[0]||we[de+1]!==we[1])&&Er(we,we[0],we[1],we[2]),we.length&&j.push(we)}function On(Z){const j=[];return j.size=Z.size,j.start=Z.start,j.end=Z.end,j}function jn(Z,j,V,U,Q,oe){for(const me of Z)oi(me,j,V,U,Q,oe,!1)}function Er(Z,j,V,U){Z.push(j,V,U)}function mn(Z,j,V,U,Q,oe){const me=(oe-j)/(U-j);return Er(Z,oe,V+(Q-V)*me,1),me}function gn(Z,j,V,U,Q,oe){const me=(oe-V)/(Q-V);return Er(Z,j+(U-j)*me,oe,1),me}function or(Z,j){const V=[];for(let U=0;U<Z.length;U++){const Q=Z[U],oe=Q.type;let me;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")me=Nn(Q.geometry,j);else if(oe==="MultiLineString"||oe==="Polygon"){me=[];for(const we of Q.geometry)me.push(Nn(we,j))}else if(oe==="MultiPolygon"){me=[];for(const we of Q.geometry){const pe=[];for(const Me of we)pe.push(Nn(Me,j));me.push(pe)}}V.push(vr(Q.id,oe,me,Q.tags))}return V}function Nn(Z,j){const V=[];V.size=Z.size,Z.start!==void 0&&(V.start=Z.start,V.end=Z.end);for(let U=0;U<Z.length;U+=3)V.push(Z[U]+j,Z[U+1],Z[U+2]);return V}function Vn(Z,j){if(Z.transformed)return Z;const V=1<<Z.z,U=Z.x,Q=Z.y;for(const oe of Z.features){const me=oe.geometry,we=oe.type;if(oe.geometry=[],we===1)for(let pe=0;pe<me.length;pe+=2)oe.geometry.push(_n(me[pe],me[pe+1],j,V,U,Q));else for(let pe=0;pe<me.length;pe++){const Me=[];for(let Pe=0;Pe<me[pe].length;Pe+=2)Me.push(_n(me[pe][Pe],me[pe][Pe+1],j,V,U,Q));oe.geometry.push(Me)}}return Z.transformed=!0,Z}function _n(Z,j,V,U,Q,oe){return[Math.round(V*(Z*U-Q)),Math.round(V*(j*U-oe))]}function ta(Z,j,V,U,Q){const oe=j===Q.maxZoom?0:Q.tolerance/((1<<j)*Q.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:Z.length,source:null,x:V,y:U,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const we of Z)Un(me,we,oe,Q);return me}function Un(Z,j,V,U){const Q=j.geometry,oe=j.type,me=[];if(Z.minX=Math.min(Z.minX,j.minX),Z.minY=Math.min(Z.minY,j.minY),Z.maxX=Math.max(Z.maxX,j.maxX),Z.maxY=Math.max(Z.maxY,j.maxY),oe==="Point"||oe==="MultiPoint")for(let we=0;we<Q.length;we+=3)me.push(Q[we],Q[we+1]),Z.numPoints++,Z.numSimplified++;else if(oe==="LineString")Yr(me,Q,Z,V,!1,!1);else if(oe==="MultiLineString"||oe==="Polygon")for(let we=0;we<Q.length;we++)Yr(me,Q[we],Z,V,oe==="Polygon",we===0);else if(oe==="MultiPolygon")for(let we=0;we<Q.length;we++){const pe=Q[we];for(let Me=0;Me<pe.length;Me++)Yr(me,pe[Me],Z,V,!0,Me===0)}if(me.length){let we=j.tags||null;if(oe==="LineString"&&U.lineMetrics){we={};for(const Me in j.tags)we[Me]=j.tags[Me];we.mapbox_clip_start=Q.start/Q.size,we.mapbox_clip_end=Q.end/Q.size}const pe={geometry:me,type:oe==="Polygon"||oe==="MultiPolygon"?3:oe==="LineString"||oe==="MultiLineString"?2:1,tags:we};j.id!==null&&(pe.id=j.id),Z.features.push(pe)}}function Yr(Z,j,V,U,Q,oe){const me=U*U;if(U>0&&j.size<(Q?me:U))return void(V.numPoints+=j.length/3);const we=[];for(let pe=0;pe<j.length;pe+=3)(U===0||j[pe+2]>me)&&(V.numSimplified++,we.push(j[pe],j[pe+1])),V.numPoints++;Q&&function(pe,Me){let Pe=0;for(let _e=0,de=pe.length,Ue=de-2;_e<de;Ue=_e,_e+=2)Pe+=(pe[_e]-pe[Ue])*(pe[_e+1]+pe[Ue+1]);if(Pe>0===Me)for(let _e=0,de=pe.length;_e<de/2;_e+=2){const Ue=pe[_e],Ne=pe[_e+1];pe[_e]=pe[de-2-_e],pe[_e+1]=pe[de-1-_e],pe[de-2-_e]=Ue,pe[de-1-_e]=Ne}}(we,oe),Z.push(we)}const $n={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Jr{constructor(j,V){const U=(V=this.options=function(oe,me){for(const we in me)oe[we]=me[we];return oe}(Object.create($n),V)).debug;if(U&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");let Q=function(oe,me){const we=[];if(oe.type==="FeatureCollection")for(let pe=0;pe<oe.features.length;pe++)Rn(we,oe.features[pe],me,pe);else Rn(we,oe.type==="Feature"?oe:{geometry:oe},me);return we}(j,V);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Q=function(oe,me){const we=me.buffer/me.extent;let pe=oe;const Me=gi(oe,1,-1-we,we,0,-1,2,me),Pe=gi(oe,1,1-we,2+we,0,-1,2,me);return(Me||Pe)&&(pe=gi(oe,1,-we,1+we,0,-1,2,me)||[],Me&&(pe=or(Me,1).concat(pe)),Pe&&(pe=pe.concat(or(Pe,-1)))),pe}(Q,V),Q.length&&this.splitTile(Q,0,0,0),U&&(Q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,V,U,Q,oe,me,we){const pe=[j,V,U,Q],Me=this.options,Pe=Me.debug;for(;pe.length;){Q=pe.pop(),U=pe.pop(),V=pe.pop(),j=pe.pop();const _e=1<<V,de=qn(V,U,Q);let Ue=this.tiles[de];if(!Ue&&(Pe>1&&console.time("creation"),Ue=this.tiles[de]=ta(j,V,U,Q,Me),this.tileCoords.push({z:V,x:U,y:Q}),Pe)){Pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,U,Q,Ue.numFeatures,Ue.numPoints,Ue.numSimplified),console.timeEnd("creation"));const ri=`z${V}`;this.stats[ri]=(this.stats[ri]||0)+1,this.total++}if(Ue.source=j,oe==null){if(V===Me.indexMaxZoom||Ue.numPoints<=Me.indexMaxPoints)continue}else{if(V===Me.maxZoom||V===oe)continue;if(oe!=null){const ri=oe-V;if(U!==me>>ri||Q!==we>>ri)continue}}if(Ue.source=null,j.length===0)continue;Pe>1&&console.time("clipping");const Ne=.5*Me.buffer/Me.extent,at=.5-Ne,dt=.5+Ne,ke=1+Ne;let $e=null,Ye=null,yt=null,Pt=null,ut=gi(j,_e,U-Ne,U+dt,0,Ue.minX,Ue.maxX,Me),We=gi(j,_e,U+at,U+ke,0,Ue.minX,Ue.maxX,Me);j=null,ut&&($e=gi(ut,_e,Q-Ne,Q+dt,1,Ue.minY,Ue.maxY,Me),Ye=gi(ut,_e,Q+at,Q+ke,1,Ue.minY,Ue.maxY,Me),ut=null),We&&(yt=gi(We,_e,Q-Ne,Q+dt,1,Ue.minY,Ue.maxY,Me),Pt=gi(We,_e,Q+at,Q+ke,1,Ue.minY,Ue.maxY,Me),We=null),Pe>1&&console.timeEnd("clipping"),pe.push($e||[],V+1,2*U,2*Q),pe.push(Ye||[],V+1,2*U,2*Q+1),pe.push(yt||[],V+1,2*U+1,2*Q),pe.push(Pt||[],V+1,2*U+1,2*Q+1)}}getTile(j,V,U){j=+j,V=+V,U=+U;const Q=this.options,{extent:oe,debug:me}=Q;if(j<0||j>24)return null;const we=1<<j,pe=qn(j,V=V+we&we-1,U);if(this.tiles[pe])return Vn(this.tiles[pe],oe);me>1&&console.log("drilling down to z%d-%d-%d",j,V,U);let Me,Pe=j,_e=V,de=U;for(;!Me&&Pe>0;)Pe--,_e>>=1,de>>=1,Me=this.tiles[qn(Pe,_e,de)];return Me&&Me.source?(me>1&&(console.log("found parent tile z%d-%d-%d",Pe,_e,de),console.time("drilling down")),this.splitTile(Me.source,Pe,_e,de,j,V,U),me>1&&console.timeEnd("drilling down"),this.tiles[pe]?Vn(this.tiles[pe],oe):null):null}}function qn(Z,j,V){return 32*((1<<Z)*V+j)+Z}function yn(Z,j){return j?Z.properties[j]:Z.id}function bs(Z,j){if(Z==null)return!0;if(Z.type==="Feature")return yn(Z,j)!=null;if(Z.type==="FeatureCollection"){const V=new Set;for(const U of Z.features){const Q=yn(U,j);if(Q==null||V.has(Q))return!1;V.add(Q)}return!0}return!1}function xs(Z,j){const V=new Map;if(Z!=null)if(Z.type==="Feature")V.set(yn(Z,j),Z);else for(const U of Z.features)V.set(yn(U,j),U);return V}class ia extends xe{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,V){return T._(this,void 0,void 0,function*(){const U=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Q=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!Q)return null;const oe=new rt(Q.features);let me=kt(oe);return me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),{vectorTile:oe,rawData:me.buffer}})}loadData(j){return T._(this,void 0,void 0,function*(){var V;(V=this._pendingRequest)===null||V===void 0||V.abort();const U=!!(j&&j.request&&j.request.collectResourceTiming)&&new T.cu(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest),this._geoJSONIndex=j.cluster?new It(function({superclusterOptions:me,clusterProperties:we}){if(!we||!me)return me;const pe={},Me={},Pe={accumulated:null,zoom:0},_e={properties:null},de=Object.keys(we);for(const Ue of de){const[Ne,at]=we[Ue],dt=T.cB(at),ke=T.cB(typeof Ne=="string"?[Ne,["accumulated"],["get",Ue]]:Ne);pe[Ue]=dt.value,Me[Ue]=ke.value}return me.map=Ue=>{_e.properties=Ue;const Ne={};for(const at of de)Ne[at]=pe[at].evaluate(Pe,_e);return Ne},me.reduce=(Ue,Ne)=>{_e.properties=Ne;for(const at of de)Pe.accumulated=Ue[at],Ue[at]=Me[at].evaluate(Pe,_e)},me}(j)).load((yield this._pendingData).features):(Q=yield this._pendingData,new Jr(Q,j.geojsonVtOptions)),this.loaded={};const oe={};if(U){const me=U.finish();me&&(oe.resourceTiming={},oe.resourceTiming[j.source]=JSON.parse(JSON.stringify(me)))}return oe}catch(oe){if(delete this._pendingRequest,T.cf(oe))return{abandoned:!0};throw oe}var Q})}getData(){return T._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(j){const V=this.loaded;return V&&V[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,V){return T._(this,void 0,void 0,function*(){let U=yield this.loadGeoJSON(j,V);if(delete this._pendingRequest,typeof U!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(He(U,!0),j.filter){const Q=T.cB(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(me=>`${me.key}: ${me.message}`).join(", "));U={type:"FeatureCollection",features:U.features.filter(me=>Q.value.evaluate({zoom:0},me))}}return U})}loadGeoJSON(j,V){return T._(this,void 0,void 0,function*(){const{promoteId:U}=j;if(j.request){const Q=yield T.h(j.request,V);return this._dataUpdateable=bs(Q.data,U)?xs(Q.data,U):void 0,Q.data}if(typeof j.data=="string")try{const Q=JSON.parse(j.data);return this._dataUpdateable=bs(Q,U)?xs(Q,U):void 0,Q}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return function(Q,oe,me){var we,pe,Me,Pe;if(oe.removeAll&&Q.clear(),oe.remove)for(const _e of oe.remove)Q.delete(_e);if(oe.add)for(const _e of oe.add){const de=yn(_e,me);de!=null&&Q.set(de,_e)}if(oe.update)for(const _e of oe.update){let de=Q.get(_e.id);if(de==null)continue;const Ue=!_e.removeAllProperties&&(((we=_e.removeProperties)===null||we===void 0?void 0:we.length)>0||((pe=_e.addOrUpdateProperties)===null||pe===void 0?void 0:pe.length)>0);if((_e.newGeometry||_e.removeAllProperties||Ue)&&(de=Object.assign({},de),Q.set(_e.id,de),Ue&&(de.properties=Object.assign({},de.properties))),_e.newGeometry&&(de.geometry=_e.newGeometry),_e.removeAllProperties)de.properties={};else if(((Me=_e.removeProperties)===null||Me===void 0?void 0:Me.length)>0)for(const Ne of _e.removeProperties)Object.prototype.hasOwnProperty.call(de.properties,Ne)&&delete de.properties[Ne];if(((Pe=_e.addOrUpdateProperties)===null||Pe===void 0?void 0:Pe.length)>0)for(const{key:Ne,value:at}of _e.addOrUpdateProperties)de.properties[Ne]=at}}(this._dataUpdateable,j.dataDiff,U),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(j){return T._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class vn{constructor(j){this.self=j,this.actor=new T.F(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(V,U)=>{if(this.externalWorkerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.externalWorkerSourceTypes[V]=U},this.self.addProtocol=T.ch,this.self.removeProtocol=T.ci,this.self.registerRTLTextPlugin=V=>{T.cC.setMethods(V)},this.actor.registerMessageHandler("LDT",(V,U)=>this._getDEMWorkerSource(V,U.source).loadTile(U)),this.actor.registerMessageHandler("RDT",(V,U)=>T._(this,void 0,void 0,function*(){this._getDEMWorkerSource(V,U.source).removeTile(U)})),this.actor.registerMessageHandler("GCEZ",(V,U)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(V,U.type,U.source).getClusterExpansionZoom(U)})),this.actor.registerMessageHandler("GCC",(V,U)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(V,U.type,U.source).getClusterChildren(U)})),this.actor.registerMessageHandler("GCL",(V,U)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(V,U.type,U.source).getClusterLeaves(U)})),this.actor.registerMessageHandler("LD",(V,U)=>this._getWorkerSource(V,U.type,U.source).loadData(U)),this.actor.registerMessageHandler("GD",(V,U)=>this._getWorkerSource(V,U.type,U.source).getData()),this.actor.registerMessageHandler("LT",(V,U)=>this._getWorkerSource(V,U.type,U.source).loadTile(U)),this.actor.registerMessageHandler("RT",(V,U)=>this._getWorkerSource(V,U.type,U.source).reloadTile(U)),this.actor.registerMessageHandler("AT",(V,U)=>this._getWorkerSource(V,U.type,U.source).abortTile(U)),this.actor.registerMessageHandler("RMT",(V,U)=>this._getWorkerSource(V,U.type,U.source).removeTile(U)),this.actor.registerMessageHandler("RS",(V,U)=>T._(this,void 0,void 0,function*(){if(!this.workerSources[V]||!this.workerSources[V][U.type]||!this.workerSources[V][U.type][U.source])return;const Q=this.workerSources[V][U.type][U.source];delete this.workerSources[V][U.type][U.source],Q.removeSource!==void 0&&Q.removeSource(U)})),this.actor.registerMessageHandler("RM",V=>T._(this,void 0,void 0,function*(){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V]})),this.actor.registerMessageHandler("SR",(V,U)=>T._(this,void 0,void 0,function*(){this.referrer=U})),this.actor.registerMessageHandler("SRPS",(V,U)=>this._syncRTLPluginState(V,U)),this.actor.registerMessageHandler("IS",(V,U)=>T._(this,void 0,void 0,function*(){this.self.importScripts(U)})),this.actor.registerMessageHandler("SI",(V,U)=>this._setImages(V,U)),this.actor.registerMessageHandler("UL",(V,U)=>T._(this,void 0,void 0,function*(){this._getLayerIndex(V).update(U.layers,U.removedIds)})),this.actor.registerMessageHandler("SL",(V,U)=>T._(this,void 0,void 0,function*(){this._getLayerIndex(V).replace(U)}))}_setImages(j,V){return T._(this,void 0,void 0,function*(){this.availableImages[j]=V;for(const U in this.workerSources[j]){const Q=this.workerSources[j][U];for(const oe in Q)Q[oe].availableImages=V}})}_syncRTLPluginState(j,V){return T._(this,void 0,void 0,function*(){return yield T.cC.syncState(V,this.self.importScripts)})}_getAvailableImages(j){let V=this.availableImages[j];return V||(V=[]),V}_getLayerIndex(j){let V=this.layerIndexes[j];return V||(V=this.layerIndexes[j]=new o),V}_getWorkerSource(j,V,U){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][V]||(this.workerSources[j][V]={}),!this.workerSources[j][V][U]){const Q={sendAsync:(oe,me)=>(oe.targetMapId=j,this.actor.sendAsync(oe,me))};switch(V){case"vector":this.workerSources[j][V][U]=new xe(Q,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][V][U]=new ia(Q,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][V][U]=new this.externalWorkerSourceTypes[V](Q,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][V][U]}_getDEMWorkerSource(j,V){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][V]||(this.demWorkerSources[j][V]=new ie),this.demWorkerSources[j][V]}}return T.i(self)&&(self.worker=new vn(self)),vn}),E("index",["exports","./shared"],function(T,o){var he="5.1.0";function se(){var u=new o.A(4);return o.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}let fe,xe;const ie={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(u,e,i){const a=requestAnimationFrame(e);u.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),i(o.c())})},frameAsync(u){return new Promise((e,i)=>{this.frame(u,e,i)})},getImageData(u,e=0){return this.getImageCanvasContext(u).getImageData(-e,-e,u.width+2*e,u.height+2*e)},getImageCanvasContext(u){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=u.width,e.height=u.height,i.drawImage(u,0,0,u.width,u.height),i},resolveURL:u=>(fe||(fe=document.createElement("a")),fe.href=u,fe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(xe==null&&(xe=matchMedia("(prefers-reduced-motion: reduce)")),xe.matches)}};class K{static testProp(e){if(!K.docStyle)return e[0];for(let i=0;i<e.length;i++)if(e[i]in K.docStyle)return e[i];return e[0]}static create(e,i,a){const l=window.document.createElement(e);return i!==void 0&&(l.className=i),a&&a.appendChild(l),l}static createNS(e,i){return window.document.createElementNS(e,i)}static disableDrag(){K.docStyle&&K.selectProp&&(K.userSelect=K.docStyle[K.selectProp],K.docStyle[K.selectProp]="none")}static enableDrag(){K.docStyle&&K.selectProp&&(K.docStyle[K.selectProp]=K.userSelect)}static setTransform(e,i){e.style[K.transformProp]=i}static addEventListener(e,i,a,l={}){e.addEventListener(i,a,"passive"in l?l:l.capture)}static removeEventListener(e,i,a,l={}){e.removeEventListener(i,a,"passive"in l?l:l.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",K.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",K.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",K.suppressClickInternal,!0)},0)}static getScale(e){const i=e.getBoundingClientRect();return{x:i.width/e.offsetWidth||1,y:i.height/e.offsetHeight||1,boundingClientRect:i}}static getPoint(e,i,a){const l=i.boundingClientRect;return new o.P((a.clientX-l.left)/i.x-e.clientLeft,(a.clientY-l.top)/i.y-e.clientTop)}static mousePos(e,i){const a=K.getScale(e);return K.getPoint(e,a,i)}static touchPos(e,i){const a=[],l=K.getScale(e);for(let h=0;h<i.length;h++)a.push(K.getPoint(e,l,i[h]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const i=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),a=i.querySelectorAll("script");for(const l of a)l.remove();return K.clean(i),i.innerHTML}static isPossiblyDangerous(e,i){const a=i.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!a.includes("javascript:")&&!a.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const i=e.children;for(const a of i)K.removeAttributes(a),K.clean(a)}static removeAttributes(e){for(const{name:i,value:a}of e.attributes)K.isPossiblyDangerous(i,a)&&e.removeAttribute(i)}}K.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,K.selectProp=K.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),K.transformProp=K.testProp(["transform","WebkitTransform"]);const ge={supported:!1,testSupport:function(u){!Ze&&He&&(Re?rt(u):Oe=u)}};let Oe,He,Ze=!1,Re=!1;function rt(u){const e=u.createTexture();u.bindTexture(u.TEXTURE_2D,e);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,He),u.isContextLost())return;ge.supported=!0}catch{}u.deleteTexture(e),Ze=!0}var Je;typeof document<"u"&&(He=document.createElement("img"),He.onload=()=>{Oe&&rt(Oe),Oe=null,Re=!0},He.onerror=()=>{Ze=!0,Oe=null},He.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(u){let e,i,a,l;u.resetRequestQueue=()=>{e=[],i=0,a=0,l={}},u.addThrottleControl=x=>{const P=a++;return l[P]=x,P},u.removeThrottleControl=x=>{delete l[x],m()},u.getImage=(x,P,I=!0)=>new Promise((k,D)=>{ge.supported&&(x.headers||(x.headers={}),x.headers.accept="image/webp,*/*"),o.e(x,{type:"image"}),e.push({abortController:P,requestParameters:x,supportImageRefresh:I,state:"queued",onError:B=>{D(B)},onSuccess:B=>{k(B)}}),m()});const h=x=>o._(this,void 0,void 0,function*(){x.state="running";const{requestParameters:P,supportImageRefresh:I,onError:k,onSuccess:D,abortController:B}=x,N=I===!1&&!o.i(self)&&!o.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((W,Y)=>W&&Y==="accept",!0));i++;const H=N?v(P,B):o.m(P,B);try{const W=yield H;delete x.abortController,x.state="completed",W.data instanceof HTMLImageElement||o.b(W.data)?D(W):W.data&&D({data:yield(G=W.data,typeof createImageBitmap=="function"?o.d(G):o.f(G)),cacheControl:W.cacheControl,expires:W.expires})}catch(W){delete x.abortController,k(W)}finally{i--,m()}var G}),m=()=>{const x=(()=>{for(const P of Object.keys(l))if(l[P]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=i;P<x&&e.length>0;P++){const I=e.shift();I.abortController.signal.aborted?P--:h(I)}},v=(x,P)=>new Promise((I,k)=>{const D=new Image,B=x.url,N=x.credentials;N&&N==="include"?D.crossOrigin="use-credentials":(N&&N==="same-origin"||!o.s(B))&&(D.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{D.src="",k(o.c())}),D.fetchPriority="high",D.onload=()=>{D.onerror=D.onload=null,I({data:D})},D.onerror=()=>{D.onerror=D.onload=null,P.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},D.src=B})}(Je||(Je={})),Je.resetRequestQueue();class lt{constructor(e){this._transformRequestFn=e}transformRequest(e,i){return this._transformRequestFn&&this._transformRequestFn(e,i)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ft(u){const e=[];if(typeof u=="string")e.push({id:"default",url:u});else if(u&&u.length>0){const i=[];for(const{id:a,url:l}of u){const h=`${a}${l}`;i.indexOf(h)===-1&&(i.push(h),e.push({id:a,url:l}))}}return e}function et(u,e,i){try{const a=new URL(u);return a.pathname+=`${e}${i}`,a.toString()}catch{throw new Error(`Invalid sprite URL "${u}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class ct{constructor(e,i,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(i,l)}update(e,i,a){const{width:l,height:h}=e,m=!(this.size&&this.size[0]===l&&this.size[1]===h||a),{context:v}=this,{gl:x}=v;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),m)this.size=[l,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||o.b(e)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,l,h,0,this.format,x.UNSIGNED_BYTE,e.data);else{const{x:P,y:I}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||o.b(e)?x.texSubImage2D(x.TEXTURE_2D,0,P,I,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,P,I,l,h,x.RGBA,x.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D)}bind(e,i,a){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),a!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=h.LINEAR),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a||e),this.filter=e),i!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function kt(u){const{userImage:e}=u;return!!(e&&e.render&&e.render())&&(u.data.replace(new Uint8Array(e.data.buffer)),!0)}class Qi extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:i,promiseResolve:a}of this.requestors)a(this._getImagesForIds(i));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const a=i.spriteData;i.data=new o.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),i.spriteData=null}return i}addImage(e,i){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,i)&&(this.images[e]=i)}_validate(e,i){let a=!0;const l=i.data||i.spriteData;return this._validateStretch(i.stretchX,l&&l.width)||(this.fire(new o.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(i.stretchY,l&&l.height)||(this.fire(new o.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(i.content,i)||(this.fire(new o.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,i){if(!e)return!0;let a=0;for(const l of e){if(l[0]<a||l[1]<l[0]||i<l[1])return!1;a=l[1]}return!0}_validateContent(e,i){if(!e)return!0;if(e.length!==4)return!1;const a=i.spriteData,l=a&&a.width||i.data.width,h=a&&a.height||i.data.height;return!(e[0]<0||l<e[0]||e[1]<0||h<e[1]||e[2]<0||l<e[2]||e[3]<0||h<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,i,a=!0){const l=this.getImage(e);if(a&&(l.data.width!==i.data.width||l.data.height!==i.data.height))throw new Error(`size mismatch between old image (${l.data.width}x${l.data.height}) and new image (${i.data.width}x${i.data.height}).`);i.version=l.version+1,this.images[e]=i,this.updatedImages[e]=!0}removeImage(e){const i=this.images[e];delete this.images[e],delete this.patterns[e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((i,a)=>{let l=!0;if(!this.isLoaded())for(const h of e)this.images[h]||(l=!1);this.isLoaded()||l?i(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:i})})}_getImagesForIds(e){const i={};for(const a of e){let l=this.getImage(a);l||(this.fire(new o.k("styleimagemissing",{id:a})),l=this.getImage(a)),l?i[a]={data:l.data.clone(),pixelRatio:l.pixelRatio,sdf:l.sdf,version:l.version,stretchX:l.stretchX,stretchY:l.stretchY,content:l.content,textFitWidth:l.textFitWidth,textFitHeight:l.textFitHeight,hasRenderCallback:!!(l.userImage&&l.userImage.render)}:o.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:i}=this.atlasImage;return{width:e,height:i}}getPattern(e){const i=this.patterns[e],a=this.getImage(e);if(!a)return null;if(i&&i.position.version===a.version)return i.position;if(i)i.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},h=new o.I(l,a);this.patterns[e]={bin:l,position:h}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ct(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const h in this.patterns)e.push(this.patterns[h].bin);const{w:i,h:a}=o.p(e),l=this.atlasImage;l.resize({width:i||1,height:a||1});for(const h in this.patterns){const{bin:m}=this.patterns[h],v=m.x+1,x=m.y+1,P=this.getImage(h).data,I=P.width,k=P.height;o.R.copy(P,l,{x:0,y:0},{x:v,y:x},{width:I,height:k}),o.R.copy(P,l,{x:0,y:k-1},{x:v,y:x-1},{width:I,height:1}),o.R.copy(P,l,{x:0,y:0},{x:v,y:x+k},{width:I,height:1}),o.R.copy(P,l,{x:I-1,y:0},{x:v-1,y:x},{width:1,height:k}),o.R.copy(P,l,{x:0,y:0},{x:v+I,y:x},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const a=this.getImage(i);a||o.w(`Image with ID: "${i}" was not found`),kt(a)&&this.updateImage(i,a)}}}const Ci=1e20;function zi(u,e,i,a,l,h,m,v,x){for(let P=e;P<e+a;P++)er(u,i*h+P,h,l,m,v,x);for(let P=i;P<i+l;P++)er(u,P*h+e,1,a,m,v,x)}function er(u,e,i,a,l,h,m){h[0]=0,m[0]=-1e20,m[1]=Ci,l[0]=u[e];for(let v=1,x=0,P=0;v<a;v++){l[v]=u[e+v*i];const I=v*v;do{const k=h[x];P=(l[v]-l[k]+I-k*k)/(v-k)/2}while(P<=m[x]&&--x>-1);x++,h[x]=v,m[x]=P,m[x+1]=Ci}for(let v=0,x=0;v<a;v++){for(;m[x+1]<v;)x++;const P=h[x],I=v-P;u[e+v*i]=l[P]+I*I}}class mi{constructor(e,i){this.requestManager=e,this.localIdeographFontFamily=i,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,function*(){const i=[];for(const h in e)for(const m of e[h])i.push(this._getAndCacheGlyphsPromise(h,m));const a=yield Promise.all(i),l={};for(const{stack:h,id:m,glyph:v}of a)l[h]||(l[h]={}),l[h][m]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics};return l})}_getAndCacheGlyphsPromise(e,i){return o._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let l=a.glyphs[i];if(l!==void 0)return{stack:e,id:i,glyph:l};if(l=this._tinySDF(a,e,i),l)return a.glyphs[i]=l,{stack:e,id:i,glyph:l};const h=Math.floor(i/256);if(256*h>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[h])return{stack:e,id:i,glyph:l};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[h]){const v=mi.loadGlyphRange(e,h,this.url,this.requestManager);a.requests[h]=v}const m=yield a.requests[h];for(const v in m)this._doesCharSupportLocalGlyph(+v)||(a.glyphs[+v]=m[+v]);return a.ranges[h]=!0,{stack:e,id:i,glyph:m[i]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,i,a){const l=this.localIdeographFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let v="400";/bold/i.test(i)?v="900":/medium/i.test(i)?v="500":/light/i.test(i)&&(v="200"),h=e.tinySDF=new mi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:v})}const m=h.draw(String.fromCharCode(a));return{id:a,bitmap:new o.o({width:m.width||60,height:m.height||60},m.data),metrics:{width:m.glyphWidth/2||24,height:m.glyphHeight/2||24,left:m.glyphLeft/2+.5||0,top:m.glyphTop/2-27.5||-8,advance:m.glyphAdvance/2||24,isDoubleResolution:!0}}}}mi.loadGlyphRange=function(u,e,i,a){return o._(this,void 0,void 0,function*(){const l=256*e,h=l+255,m=a.transformRequest(i.replace("{fontstack}",u).replace("{range}",`${l}-${h}`),"Glyphs"),v=yield o.l(m,new AbortController);if(!v||!v.data)throw new Error(`Could not load glyph range. range: ${e}, ${l}-${h}`);const x={};for(const P of o.n(v.data))x[P.id]=P;return x})},mi.TinySDF=class{constructor({fontSize:u=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;const v=this.size=u+4*e,x=this._createCanvas(v),P=this.ctx=x.getContext("2d",{willReadFrequently:!0});P.font=`${m} ${h} ${u}px ${l}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(u){const e=document.createElement("canvas");return e.width=e.height=u,e}draw(u){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(u),m=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-l))),x=Math.min(this.size-this.buffer,m+Math.ceil(a)),P=v+2*this.buffer,I=x+2*this.buffer,k=Math.max(P*I,0),D=new Uint8ClampedArray(k),B={data:D,width:P,height:I,glyphWidth:v,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(v===0||x===0)return B;const{ctx:N,buffer:H,gridInner:G,gridOuter:W}=this;N.clearRect(H,H,v,x),N.fillText(u,H,H+m);const Y=N.getImageData(H,H,v,x);W.fill(Ci,0,k),G.fill(0,0,k);for(let re=0;re<x;re++)for(let ne=0;ne<v;ne++){const ae=Y.data[4*(re*v+ne)+3]/255;if(ae===0)continue;const ce=(re+H)*P+ne+H;if(ae===1)W[ce]=0,G[ce]=Ci;else{const le=.5-ae;W[ce]=le>0?le*le:0,G[ce]=le<0?le*le:0}}zi(W,0,0,P,I,P,this.f,this.v,this.z),zi(G,H,H,v,x,P,this.f,this.v,this.z);for(let re=0;re<k;re++){const ne=Math.sqrt(W[re])-Math.sqrt(G[re]);D[re]=Math.round(255-255*(ne/this.radius+this.cutoff))}return B}};class fn{constructor(){this.specification=o.v.light.position}possiblyEvaluate(e,i){return o.x(e.expression.evaluate(i))}interpolate(e,i,a){return{x:o.y.number(e.x,i.x,a),y:o.y.number(e.y,i.y,a),z:o.y.number(e.z,i.z,a)}}}let It;class Xr extends o.E{constructor(e){super(),It=It||new o.q({anchor:new o.D(o.v.light.anchor),position:new fn,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(It),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(o.r,e,i))for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,a){return(!a||a.validate!==!1)&&o.t(this,e.call(o.u,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Mr=new o.q({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class Dn extends o.E{constructor(e){super(),this._transitionable=new o.T(Mr),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.z(0))}setSky(e,i={}){if(!this._validate(o.B,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,a={}){return(a==null?void 0:a.validate)!==!1&&o.t(this,e.call(o.u,o.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ln{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,i){const a=e.join(",")+String(i);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,i)),this.dashEntry[a]}getDashRanges(e,i,a){const l=[];let h=e.length%2==1?-e[e.length-1]*a:0,m=e[0]*a,v=!0;l.push({left:h,right:m,isDash:v,zeroLength:e[0]===0});let x=e[0];for(let P=1;P<e.length;P++){v=!v;const I=e[P];h=x*a,x+=I,m=x*a,l.push({left:h,right:m,isDash:v,zeroLength:I===0})}return l}addRoundDash(e,i,a){const l=i/2;for(let h=-a;h<=a;h++){const m=this.width*(this.nextRow+a+h);let v=0,x=e[v];for(let P=0;P<this.width;P++){P/x.right>1&&(x=e[++v]);const I=Math.abs(P-x.left),k=Math.abs(P-x.right),D=Math.min(I,k);let B;const N=h/a*(l+1);if(x.isDash){const H=l-Math.abs(N);B=Math.sqrt(D*D+H*H)}else B=l-Math.sqrt(D*D+N*N);this.data[m+P]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e){for(let v=e.length-1;v>=0;--v){const x=e[v],P=e[v+1];x.zeroLength?e.splice(v,1):P&&P.isDash===x.isDash&&(P.left=x.left,e.splice(v,1))}const i=e[0],a=e[e.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);const l=this.width*this.nextRow;let h=0,m=e[h];for(let v=0;v<this.width;v++){v/m.right>1&&(m=e[++h]);const x=Math.abs(v-m.left),P=Math.abs(v-m.right),I=Math.min(x,P);this.data[l+v]=Math.max(0,Math.min(255,(m.isDash?I:-I)+128))}}addDash(e,i){const a=i?7:0,l=2*a+1;if(this.nextRow+l>this.height)return o.w("LineAtlas out of space"),null;let h=0;for(let v=0;v<e.length;v++)h+=e[v];if(h!==0){const v=this.width/h,x=this.getDashRanges(e,this.width,v);i?this.addRoundDash(x,v,a):this.addRegularDash(x)}const m={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:h};return this.nextRow+=l,this.dirty=!0,m}bind(e){const i=e.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.ALPHA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.ALPHA,this.width,this.height,0,i.ALPHA,i.UNSIGNED_BYTE,this.data))}}const vs="maplibre_preloaded_worker_pool";class jr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<jr.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[vs]}numActive(){return Object.keys(this.active).length}}const Ir=Math.floor(ie.hardwareConcurrency/2);let vr,Di;function Rn(){return vr||(vr=new jr),vr}jr.workerCount=o.C(globalThis)?Math.max(Math.min(Ir,3),1):1;class Fn{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const a=this.workerPool.acquire(i);for(let l=0;l<a.length;l++){const h=new o.F(a[l],i);h.name=`Worker ${l}`,this.actors.push(h)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i){const a=[];for(const l of this.actors)a.push(l.sendAsync({type:e,data:i}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(i=>{i.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,i){for(const a of this.actors)a.registerMessageHandler(e,i)}}function Bn(){return Di||(Di=new Fn(Rn(),o.G),Di.registerMessageHandler("GR",(u,e,i)=>o.m(e,i))),Di}function ar(u,e){const i=o.H();return o.J(i,i,[1,1,0]),o.K(i,i,[.5*u.width,.5*u.height,1]),u.calculatePosMatrix?o.L(i,i,u.calculatePosMatrix(e.toUnwrapped())):i}function ea(u,e,i,a,l,h){var m;const v=function(k,D,B){if(k)for(const N of k){const H=D[N];if(H&&H.source===B&&H.type==="fill-extrusion")return!0}else for(const N in D){const H=D[N];if(H.source===B&&H.type==="fill-extrusion")return!0}return!1}((m=l==null?void 0:l.layers)!==null&&m!==void 0?m:null,e,u.id),x=h.maxPitchScaleFactor(),P=u.tilesIn(a,x,v);P.sort(ji);const I=[];for(const k of P)I.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(e,i,u._state,k.queryGeometry,k.cameraQueryGeometry,k.scale,l,h,x,ar(u.transform,k.tileID))});return function(k,D){for(const B in k)for(const N of k[B])gi(N,D);return k}(function(k){const D={},B={};for(const N of k){const H=N.queryResults,G=N.wrappedTileID,W=B[G]=B[G]||{};for(const Y in H){const re=H[Y],ne=W[Y]=W[Y]||{},ae=D[Y]=D[Y]||[];for(const ce of re)ne[ce.featureIndex]||(ne[ce.featureIndex]=!0,ae.push(ce))}}return D}(I),u)}function ji(u,e){const i=u.tileID,a=e.tileID;return i.overscaledZ-a.overscaledZ||i.canonical.y-a.canonical.y||i.wrap-a.wrap||i.canonical.x-a.canonical.x}function gi(u,e){const i=u.feature,a=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=a}function Kr(u,e,i){return o._(this,void 0,void 0,function*(){let a=u;if(u.url?a=(yield o.h(e.transformRequest(u.url,"Source"),i)).data:yield ie.frameAsync(i),!a)return null;const l=o.M(o.e(a,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(l.vectorLayerIds=a.vector_layers.map(h=>h.id)),l})}class oi{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.N?new o.N(e.lng,e.lat):o.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.N?new o.N(e.lng,e.lat):o.N.convert(e),this}extend(e){const i=this._sw,a=this._ne;let l,h;if(e instanceof o.N)l=e,h=e;else{if(!(e instanceof oi))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(oi.convert(e)):this.extend(o.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.N.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return i||a?(i.lng=Math.min(l.lng,i.lng),i.lat=Math.min(l.lat,i.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new o.N(l.lng,l.lat),this._ne=new o.N(h.lng,h.lat)),this}getCenter(){return new o.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.N(this.getWest(),this.getNorth())}getSouthEast(){return new o.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=o.N.convert(e);let l=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return e instanceof oi?e:e&&new oi(e)}static fromLngLat(e,i=0){const a=360*i/40075017,l=a/Math.cos(Math.PI/180*e.lat);return new oi(new o.N(e.lng-l,e.lat-a),new o.N(e.lng+l,e.lat+a))}adjustAntiMeridian(){const e=new o.N(this._sw.lng,this._sw.lat),i=new o.N(this._ne.lng,this._ne.lat);return new oi(e,e.lng>i.lng?new o.N(i.lng+360,i.lat):i)}}class On{constructor(e,i,a){this.bounds=oi.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),a=Math.floor(o.O(this.bounds.getWest())*i),l=Math.floor(o.Q(this.bounds.getNorth())*i),h=Math.ceil(o.O(this.bounds.getEast())*i),m=Math.ceil(o.Q(this.bounds.getSouth())*i);return e.x>=a&&e.x<h&&e.y>=l&&e.y<m}}class jn extends o.E{constructor(e,i,a,l){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.M(i,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Kr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new On(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new o.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(i,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};a.request.collectResourceTiming=this._collectResourceTiming;let l="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((h,m)=>{e.reloadPromise={resolve:h,reject:m}})}else e.actor=this.dispatcher.getActor(),l="LT";e.abortController=new AbortController;try{const h=yield e.actor.sendAsync({type:l,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,h)}catch(h){if(delete e.abortController,e.aborted)return;if(h&&h.status!==404)throw h;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,i){if(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),i&&this.map._refreshExpiredTiles&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Er extends o.E{constructor(e,i,a,l){super(),this.id=e,this.dispatcher=a,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},i),o.e(this,o.M(i,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield Kr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(o.e(this,i),i.bounds&&(this.tileBounds=new On(i.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(i){this._tileJSONRequest=null,this.fire(new o.j(i))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield Je.getImage(this.map._requestManager.transformRequest(i,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const l=this.map.painter.context,h=l.gl,m=a.data;e.texture=this.map.painter.getTileTexture(m.width),e.texture?e.texture.update(m,{useMipmap:!0}):(e.texture=new ct(l,m,h.RGBA,{useMipmap:!0}),e.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class mn extends Er{constructor(e,i,a,l){super(e,i,a,l),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return o._(this,void 0,void 0,function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const l=yield Je.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){const h=l.data;this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const m=o.b(h)&&o.U()?h:yield this.readImageNow(h),v={type:this.type,uid:e.uid,source:this.id,rawImageData:m,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const x=yield e.actor.sendAsync({type:"LDT",data:v});e.dem=x,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}readImageNow(e){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.V()){const i=e.width+2,a=e.height+2;try{return new o.R({width:i,height:a},yield o.W(e,-1,-1,i,a))}catch{}}return ie.getImageData(e,1)})}_getNeighboringTiles(e){const i=e.canonical,a=Math.pow(2,i.z),l=(i.x-1+a)%a,h=i.x===0?e.wrap-1:e.wrap,m=(i.x+1+a)%a,v=i.x+1===a?e.wrap+1:e.wrap,x={};return x[new o.S(e.overscaledZ,h,i.z,l,i.y).key]={backfilled:!1},x[new o.S(e.overscaledZ,v,i.z,m,i.y).key]={backfilled:!1},i.y>0&&(x[new o.S(e.overscaledZ,h,i.z,l,i.y-1).key]={backfilled:!1},x[new o.S(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},x[new o.S(e.overscaledZ,v,i.z,m,i.y-1).key]={backfilled:!1}),i.y+1<a&&(x[new o.S(e.overscaledZ,h,i.z,l,i.y+1).key]={backfilled:!1},x[new o.S(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},x[new o.S(e.overscaledZ,v,i.z,m,i.y+1).key]={backfilled:!1}),x}unloadTile(e){return o._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class gn extends o.E{constructor(e,i,a,l){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(l),this._data=i.data,this._options=o.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,i.clusterMaxZoom!==void 0&&this.maxzoom<=i.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(i.buffer!==void 0?i.buffer:128),tolerance:this._pixelsToTileUnits(i.tolerance!==void 0?i.tolerance:.375),extent:o.X,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:o.X,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(o.X/this.tileSize)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return o._(this,void 0,void 0,function*(){const e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,i,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:i,offset:a}})}_updateWorkerData(e){return o._(this,void 0,void 0,function*(){const i=o.e({type:this.type},this.workerOptions);e?i.dataDiff=e:typeof this._data=="string"?(i.request=this.map._requestManager.transformRequest(ie.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let l=null;a.resourceTiming&&a.resourceTiming[this.id]&&(l=a.resourceTiming[this.id].slice(0));const h={dataType:"source"};this._collectResourceTiming&&l&&l.length>0&&o.e(h,{resourceTiming:l}),this.fire(new o.k("data",Object.assign(Object.assign({},h),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},h),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return o._(this,void 0,void 0,function*(){const i=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const l=yield this.actor.sendAsync({type:i,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(l,this.map.painter,i==="RT")})}abortTile(e){return o._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return o._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class or extends o.E{constructor(e,i,a,l){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(l),this.options=i}load(e){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const i=yield Je.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,i&&i.data&&(this.image=i.data,e&&(this.coordinates=e),this._finishLoading())}catch(i){this._request=null,this._loaded=!0,this.fire(new o.j(i))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(o.Y.fromLngLat);var a;return this.tileID=function(l){let h=1/0,m=1/0,v=-1/0,x=-1/0;for(const D of l)h=Math.min(h,D.x),m=Math.min(m,D.y),v=Math.max(v,D.x),x=Math.max(x,D.y);const P=Math.max(v-h,x-m),I=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),k=Math.pow(2,I);return new o.Z(I,Math.floor((h+v)/2*k),Math.floor((m+x)/2*k))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map(l=>this.tileID.getTilePoint(l)._round()),this.flippedWindingOrder=((a=this.tileCoords)[1].x-a[0].x)*(a[2].y-a[0].y)-(a[1].y-a[0].y)*(a[2].x-a[0].x)<0,this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new ct(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const h=this.tiles[l];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Nn extends or{constructor(e,i,a,l){super(e,i,a,l),this.roundZoom=!0,this.type="video",this.options=i}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,"Source").url);try{const i=yield o.a0(this.urls);if(this._loaded=!0,!i)return;this.video=i,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(i){this.fire(new o.j(i))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new o.j(new o.$(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new ct(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const h=this.tiles[l];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Vn extends or{constructor(e,i,a,l){super(e,i,a,l),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(h=>!Array.isArray(h)||h.length!==2||h.some(m=>typeof m!="number"))||this.fire(new o.j(new o.$(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.$(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new o.j(new o.$(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.$(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.$(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,a=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ct(i,this.canvas,a.RGBA,{premultiply:!0});let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const _n={},ta=u=>{switch(u){case"geojson":return gn;case"image":return or;case"raster":return Er;case"raster-dem":return mn;case"vector":return jn;case"video":return Nn;case"canvas":return Vn}return _n[u]},Un="RTLPluginLoaded";class Yr extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Bn()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(i=>{throw this.status="error",i})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,function*(i,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ie.resolveURL(i),!this.url)throw new Error(`requested url ${i} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(Un))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let $n=null;function Jr(){return $n||($n=new Yr),$n}class qn{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=o.a1(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const i=e+this.timeAdded;i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,h){const m={};if(!h)return m;for(const v of l){const x=v.layerIds.map(P=>h.getLayer(P)).filter(Boolean);if(x.length!==0){v.layers=x,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(P=>x.filter(I=>I.id===P)[0]));for(const P of x)m[P.id]=v}}return m}(e.buckets,i==null?void 0:i.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const h=this.buckets[l];if(h instanceof o.a3){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const h=this.buckets[l];if(h instanceof o.a3&&h.hasRTLText){this.hasRTLText=!0,Jr().lazyLoad();break}}this.queryPadding=0;for(const l in this.buckets){const h=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(l).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new o.a2}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ct(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ct(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,a,l,h,m,v,x,P,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:l,cameraQueryGeometry:h,scale:m,tileSize:this.tileSize,pixelPosMatrix:I,transform:x,params:v,queryPadding:this.queryPadding*P},e,i,a):{}}querySourceFeatures(e,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),h=i&&i.sourceLayer?i.sourceLayer:"",m=l._geojsonTileLayer||l[h];if(!m)return;const v=o.a4(i&&i.filter),{z:x,x:P,y:I}=this.tileID.canonical,k={z:x,x:P,y:I};for(let D=0;D<m.length;D++){const B=m.feature(D);if(v.needGeometry){const G=o.a5(B,!0);if(!v.filter(new o.z(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!v.filter(new o.z(this.tileID.overscaledZ),B))continue;const N=a.getId(B,h),H=new o.a6(B,x,P,I,N);H.tile=k,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const a=o.a7(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(i)if(this.expirationTime<i)l=!0;else{const h=this.expirationTime-i;h?this.expirationTime=a+Math.max(h,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const l in this.buckets){if(!i.style.hasLayer(l))continue;const h=this.buckets[l],m=h.layers[0].sourceLayer||"_geojsonTileLayer",v=a[m],x=e[m];if(!v||!x||Object.keys(x).length===0)continue;h.update(x,v,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=i&&i.style&&i.style.getLayer(l);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ie.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ie.now()+e}setDependencies(e,i){const a={};for(const l of i)a[l]=!0;this.dependencies[e]=a}hasDependency(e,i){for(const a of e){const l=this.dependencies[a];if(l){for(const h of i)if(l[h])return!0}}return!1}}class yn{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,a){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:i,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const a=e.wrapped().key,l=i===void 0?0:this.data[a].indexOf(i),h=this.data[a][l];return this.data[a].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const a in this.data)for(const l of this.data[a])e(l.value)||i.push(l);for(const a of i)this.remove(a.value.tileID,a)}}class bs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,a){const l=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},o.e(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==l&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const h in this.state[e][l])a[h]||(this.deletedStates[e][l][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][h]===null&&delete this.deletedStates[e][l][h]}removeFeatureState(e,i,a){if(this.deletedStates[e]===null)return;const l=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&i!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,i){const a=String(i),l=o.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][i];if(h===null)return{};for(const m in h)delete l[m]}return l}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const h={};for(const m in this.stateChanges[l])this.state[l][m]||(this.state[l][m]={}),o.e(this.state[l][m],this.stateChanges[l][m]),h[m]=this.state[l][m];a[l]=h}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const h={};if(this.deletedStates[l]===null)for(const m in this.state[l])h[m]={},this.state[l][m]={};else for(const m in this.deletedStates[l]){if(this.deletedStates[l][m]===null)this.state[l][m]={};else for(const v of Object.keys(this.deletedStates[l][m]))delete this.state[l][m][v];h[m]=this.state[l][m]}a[l]=a[l]||{},o.e(a[l],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in e)e[l].setFeatureState(a,i)}}function xs(u,e,i){const a=e.intersectsFrustum(u);if(!i)return a;const l=e.intersectsPlane(i);return a===0||l===0?0:a===2&&l===2?2:1}function ia(u,e,i,a,l){let h=u;const m=Math.atan(e/i),v=Math.hypot(e,i);return h=u+o.a8(a/v/Math.max(.5,Math.cos(o.aa(l/2)))),h+=1*o.a8(Math.cos(m))/2,h+=o.ab(u-h,-0,0),h}function vn(u,e){const i=(e.roundZoom?Math.round:Math.floor)(u.zoom+o.a8(u.tileSize/e.tileSize));return Math.max(0,i)}function Z(u,e){const i=u.getCameraFrustum(),a=u.getClippingPlane(),l=u.screenPointToMercatorCoordinate(u.getCameraPoint()),h=o.Y.fromLngLat(u.center,u.elevation);l.z=h.z+Math.cos(u.pitchInRadians)*u.cameraToCenterDistance/u.worldSize;const m=u.getCoveringTilesDetailsProvider(),v=m.allowVariableZoom(u,e),x=vn(u,e),P=e.minzoom||0,I=e.maxzoom!==void 0?e.maxzoom:u.maxZoom,k=Math.min(Math.max(0,x),I),D=Math.pow(2,k),B=[D*l.x,D*l.y,0],N=[D*h.x,D*h.y,0],H=Math.hypot(h.x-l.x,h.y-l.y),G=Math.abs(h.z-l.z),W=Math.hypot(H,G),Y=ae=>({zoom:0,x:0,y:0,wrap:ae,fullyVisible:!1}),re=[],ne=[];if(u.renderWorldCopies&&m.allowWorldCopies())for(let ae=1;ae<=3;ae++)re.push(Y(-ae)),re.push(Y(ae));for(re.push(Y(0));re.length>0;){const ae=re.pop(),ce=ae.x,le=ae.y;let ye=ae.fullyVisible;const be={x:ce,y:le,z:ae.zoom},Ie=m.getTileAABB(be,ae.wrap,u.elevation,e);if(!ye){const je=xs(i,Ie,a);if(je===0)continue;ye=je===2}const Ae=m.distanceToTile2d(l.x,l.y,be,Ie);let Se=x;v&&(Se=(e.calculateTileZoom||ia)(u.zoom+o.a8(u.tileSize/e.tileSize),Ae,G,W,u.fov)),Se=(e.roundZoom?Math.round:Math.floor)(Se),Se=Math.max(0,Se);const Ve=Math.min(Se,I);if(ae.wrap=m.getWrap(h,be,ae.wrap),ae.zoom>=Ve){if(ae.zoom<P)continue;const je=k-ae.zoom,De=B[0]-.5-(ce<<je),qe=B[1]-.5-(le<<je),_t=e.reparseOverscaled?Math.max(ae.zoom,Se):ae.zoom;ne.push({tileID:new o.S(ae.zoom===I?_t:ae.zoom,ae.wrap,ae.zoom,ce,le),distanceSq:o.a9([N[0]-.5-ce,N[1]-.5-le]),tileDistanceToCamera:Math.sqrt(De*De+qe*qe)})}else for(let je=0;je<4;je++)re.push({zoom:ae.zoom+1,x:(ce<<1)+je%2,y:(le<<1)+(je>>1),wrap:ae.wrap,fullyVisible:ye})}return ne.sort((ae,ce)=>ae.distanceSq-ce.distanceSq).map(ae=>ae.tileID)}class j extends o.E{constructor(e,i,a){super(),this.id=e,this.dispatcher=a,this.on("data",l=>this._dataHandler(l)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((l,h,m,v)=>{const x=new(ta(h.type))(l,h,m,v);if(x.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${x.id}`);return x})(e,i,a,this),this._tiles={},this._cache=new yn(0,l=>this._unloadTile(l)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new bs,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,a){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,a)}catch(l){e.state="errored",l.status!==404?this._source.fire(new o.j(l,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(V).map(e=>e.key)}getRenderableIds(e){const i=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&i.push(this._tiles[a]);return e?i.sort((a,l)=>{const h=a.tileID,m=l.tileID,v=new o.P(h.canonical.x,h.canonical.y)._rotate(-this.transform.bearingInRadians),x=new o.P(m.canonical.x,m.canonical.y)._rotate(-this.transform.bearingInRadians);return h.overscaledZ-m.overscaledZ||x.y-v.y||x.x-v.x}).map(a=>a.tileID.key):i.map(a=>a.tileID).sort(V).map(a=>a.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)(e||this._tiles[i].state!=="errored")&&this._reloadTile(i,"reloading")}}_reloadTile(e,i){return o._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=i),yield this._loadTile(a,e,i))})}_tileLoaded(e,i,a){e.timeAdded=ie.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const i=this.getRenderableIds();for(let l=0;l<i.length;l++){const h=i[l];if(e.neighboringTiles&&e.neighboringTiles[h]){const m=this.getTileByID(h);a(e,m),a(m,e)}}function a(l,h){l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0;let m=h.tileID.canonical.x-l.tileID.canonical.x;const v=h.tileID.canonical.y-l.tileID.canonical.y,x=Math.pow(2,l.tileID.canonical.z),P=h.tileID.key;m===0&&v===0||Math.abs(v)>1||(Math.abs(m)>1&&(Math.abs(m+x)===1?m+=x:Math.abs(m-x)===1&&(m-=x)),h.dem&&l.dem&&(l.dem.backfillBorder(h.dem,m,v),l.neighboringTiles&&l.neighboringTiles[P]&&(l.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,a,l){for(const h in this._tiles){let m=this._tiles[h];if(l[h]||!m.hasData()||m.tileID.overscaledZ<=i||m.tileID.overscaledZ>a)continue;let v=m.tileID;for(;m&&m.tileID.overscaledZ>i+1;){const P=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[P.key],m&&m.hasData()&&(v=P)}let x=v;for(;x.overscaledZ>i;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]||e[x.canonical.key]){l[v.key]=v;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=e.overscaledZ-1;a>=i;a--){const l=e.scaledTo(a),h=this._getLoadedTile(l);if(h)return h}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,l=Math.floor(i*a*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),h=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,l):l;this._cache.setMaxSize(h)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+i),a[h.tileID.key]=h}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(l,this._tiles[l])}}_updateCoveredAndRetainedTiles(e,i,a,l,h,m){const v={},x={},P=Object.keys(e),I=ie.now();for(const k of P){const D=e[k],B=this._tiles[k];if(!B||B.fadeEndTime!==0&&B.fadeEndTime<=I)continue;const N=this.findLoadedParent(D,i),H=this.findLoadedSibling(D),G=N||H||null;G&&(this._addTile(G.tileID),v[G.tileID.key]=G.tileID),x[k]=D}this._retainLoadedChildren(x,l,a,e);for(const k in v)e[k]||(this._coveredTiles[k]=!0,e[k]=v[k]);if(m){const k={},D={};for(const B of h)this._tiles[B.key].hasData()?k[B.key]=B:D[B.key]=B;for(const B in D){const N=D[B].children(this._source.maxzoom);this._tiles[N[0].key]&&this._tiles[N[1].key]&&this._tiles[N[2].key]&&this._tiles[N[3].key]&&(k[N[0].key]=e[N[0].key]=N[0],k[N[1].key]=e[N[1].key]=N[1],k[N[2].key]=e[N[2].key]=N[2],k[N[3].key]=e[N[3].key]=N[3],delete D[B])}for(const B in D){const N=D[B],H=this.findLoadedParent(N,this._source.minzoom),G=this.findLoadedSibling(N),W=H||G||null;if(W){k[W.tileID.key]=e[W.tileID.key]=W.tileID;for(const Y in k)k[Y].isChildOf(W.tileID)&&delete k[Y]}}for(const B in this._tiles)k[B]||(this._coveredTiles[B]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new o.S(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y)):(a=Z(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(a=a.filter(I=>this._source.hasTile(I)))):a=[];const l=vn(e,this._source),h=Math.max(l-j.maxOverzooming,this._source.minzoom),m=Math.max(l+j.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const k of a)if(k.canonical.z>this._source.minzoom){const D=k.scaledTo(k.canonical.z-1);I[D.key]=D;const B=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));I[B.key]=B}a=a.concat(Object.values(I))}const v=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,v&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const x=this._updateRetainedTiles(a,l);U(this._source.type)&&this._updateCoveredAndRetainedTiles(x,h,m,l,a,i);for(const I in x)this._tiles[I].clearFadeHold();const P=o.ac(this._tiles,x);for(const I of P){const k=this._tiles[I];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,i){var a;const l={},h={},m=Math.max(i-j.maxOverzooming,this._source.minzoom),v=Math.max(i+j.maxUnderzooming,this._source.minzoom),x={};for(const P of e){const I=this._addTile(P);l[P.key]=P,I.hasData()||i<this._source.maxzoom&&(x[P.key]=P)}this._retainLoadedChildren(x,i,v,l);for(const P of e){let I=this._tiles[P.key];if(I.hasData())continue;if(i+1>this._source.maxzoom){const D=P.children(this._source.maxzoom)[0],B=this.getTile(D);if(B&&B.hasData()){l[D.key]=D;continue}}else{const D=P.children(this._source.maxzoom);if(l[D[0].key]&&l[D[1].key]&&l[D[2].key]&&l[D[3].key])continue}let k=I.wasRequested();for(let D=P.overscaledZ-1;D>=m;--D){const B=P.scaledTo(D);if(h[B.key])break;if(h[B.key]=!0,I=this.getTile(B),!I&&k&&(I=this._addTile(B)),I){const N=I.hasData();if((N||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||k)&&(l[B.key]=B),k=I.wasRequested(),N)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}i.push(l.key);const h=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;l=h}for(const h of i)this._loadedParentTiles[h]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const i=this._tiles[e].tileID,a=this._getLoadedTile(i);this._loadedSiblingTiles[i.key]=a}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const a=i;return i||(i=new qn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,a||this._source.fire(new o.k("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=i.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}_dataHandler(e){const i=e.sourceDataType;e.dataType==="source"&&i==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&i==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,a){const l=[],h=this.transform;if(!h)return l;const m=a?h.getCameraQueryGeometry(e):e,v=e.map(N=>h.screenPointToMercatorCoordinate(N,this.terrain)),x=m.map(N=>h.screenPointToMercatorCoordinate(N,this.terrain)),P=this.getIds();let I=1/0,k=1/0,D=-1/0,B=-1/0;for(const N of x)I=Math.min(I,N.x),k=Math.min(k,N.y),D=Math.max(D,N.x),B=Math.max(B,N.y);for(let N=0;N<P.length;N++){const H=this._tiles[P[N]];if(H.holdingForFade())continue;const G=H.tileID,W=Math.pow(2,h.zoom-H.tileID.overscaledZ),Y=i*H.queryPadding*o.X/H.tileSize/W,re=[G.getTilePoint(new o.Y(I,k)),G.getTilePoint(new o.Y(D,B))];if(re[0].x-Y<o.X&&re[0].y-Y<o.X&&re[1].x+Y>=0&&re[1].y+Y>=0){const ne=v.map(ce=>G.getTilePoint(ce)),ae=x.map(ce=>G.getTilePoint(ce));l.push({tile:H,tileID:G,queryGeometry:ne,cameraQueryGeometry:ae,scale:W})}}return l}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);return this.transform&&this.transform.populateCache(i),i}hasTransition(){if(this._source.hasTransition())return!0;if(U(this._source.type)){const e=ie.now();for(const i in this._tiles)if(this._tiles[i].fadeEndTime>=e)return!0}return!1}setFeatureState(e,i,a){this._state.updateState(e=e||"_geojsonTileLayer",i,a)}removeFeatureState(e,i,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,a)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,a){const l=this._tiles[e];l&&l.setDependencies(i,a)}reloadTilesForDependencies(e,i){for(const a in this._tiles)this._tiles[a].hasDependency(e,i)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,i))}}function V(u,e){const i=Math.abs(2*u.wrap)-+(u.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return u.overscaledZ-e.overscaledZ||a-i||e.canonical.y-u.canonical.y||e.canonical.x-u.canonical.x}function U(u){return u==="raster"||u==="image"||u==="video"}j.maxOverzooming=10,j.maxUnderzooming=3;class Q{constructor(e,i){this.reset(e,i)}reset(e,i){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(i||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.ab(e,0,1);let i=1,a=this._distances[i];const l=e*this.paddedLength+this.padding;for(;a<l&&i<this._distances.length;)a=this._distances[++i];const h=i-1,m=this._distances[h],v=a-m,x=v>0?(l-m)/v:0;return this.points[h].mult(1-x).add(this.points[i].mult(x))}}function oe(u,e){let i=!0;return u==="always"||u!=="never"&&e!=="never"||(i=!1),i}class me{constructor(e,i,a){const l=this.boxCells=[],h=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(i/a);for(let m=0;m<this.xCellCount*this.yCellCount;m++)l.push([]),h.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=i,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/i,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,i,a,l,h){this._forEachCell(i,a,l,h,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h)}insertCircle(e,i,a,l){this._forEachCell(i-l,a-l,i+l,a+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(i),this.circles.push(a),this.circles.push(l)}_insertBoxCell(e,i,a,l,h,m){this.boxCells[h].push(m)}_insertCircleCell(e,i,a,l,h,m){this.circleCells[h].push(m)}_query(e,i,a,l,h,m,v){if(a<0||e>this.width||l<0||i>this.height)return[];const x=[];if(e<=0&&i<=0&&this.width<=a&&this.height<=l){if(h)return[{key:null,x1:e,y1:i,x2:a,y2:l}];for(let P=0;P<this.boxKeys.length;P++)x.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const I=this.circles[3*P],k=this.circles[3*P+1],D=this.circles[3*P+2];x.push({key:this.circleKeys[P],x1:I-D,y1:k-D,x2:I+D,y2:k+D})}}else this._forEachCell(e,i,a,l,this._queryCell,x,{hitTest:h,overlapMode:m,seenUids:{box:{},circle:{}}},v);return x}query(e,i,a,l){return this._query(e,i,a,l,!1,null)}hitTest(e,i,a,l,h,m){return this._query(e,i,a,l,!0,h,m).length>0}hitTestCircle(e,i,a,l,h){const m=e-a,v=e+a,x=i-a,P=i+a;if(v<0||m>this.width||P<0||x>this.height)return!1;const I=[];return this._forEachCell(m,x,v,P,this._queryCellCircle,I,{hitTest:!0,overlapMode:l,circle:{x:e,y:i,radius:a},seenUids:{box:{},circle:{}}},h),I.length>0}_queryCell(e,i,a,l,h,m,v,x){const{seenUids:P,hitTest:I,overlapMode:k}=v,D=this.boxCells[h];if(D!==null){const N=this.bboxes;for(const H of D)if(!P.box[H]){P.box[H]=!0;const G=4*H,W=this.boxKeys[H];if(e<=N[G+2]&&i<=N[G+3]&&a>=N[G+0]&&l>=N[G+1]&&(!x||x(W))&&(!I||!oe(k,W.overlapMode))&&(m.push({key:W,x1:N[G],y1:N[G+1],x2:N[G+2],y2:N[G+3]}),I))return!0}}const B=this.circleCells[h];if(B!==null){const N=this.circles;for(const H of B)if(!P.circle[H]){P.circle[H]=!0;const G=3*H,W=this.circleKeys[H];if(this._circleAndRectCollide(N[G],N[G+1],N[G+2],e,i,a,l)&&(!x||x(W))&&(!I||!oe(k,W.overlapMode))){const Y=N[G],re=N[G+1],ne=N[G+2];if(m.push({key:W,x1:Y-ne,y1:re-ne,x2:Y+ne,y2:re+ne}),I)return!0}}}return!1}_queryCellCircle(e,i,a,l,h,m,v,x){const{circle:P,seenUids:I,overlapMode:k}=v,D=this.boxCells[h];if(D!==null){const N=this.bboxes;for(const H of D)if(!I.box[H]){I.box[H]=!0;const G=4*H,W=this.boxKeys[H];if(this._circleAndRectCollide(P.x,P.y,P.radius,N[G+0],N[G+1],N[G+2],N[G+3])&&(!x||x(W))&&!oe(k,W.overlapMode))return m.push(!0),!0}}const B=this.circleCells[h];if(B!==null){const N=this.circles;for(const H of B)if(!I.circle[H]){I.circle[H]=!0;const G=3*H,W=this.circleKeys[H];if(this._circlesCollide(N[G],N[G+1],N[G+2],P.x,P.y,P.radius)&&(!x||x(W))&&!oe(k,W.overlapMode))return m.push(!0),!0}}}_forEachCell(e,i,a,l,h,m,v,x){const P=this._convertToXCellCoord(e),I=this._convertToYCellCoord(i),k=this._convertToXCellCoord(a),D=this._convertToYCellCoord(l);for(let B=P;B<=k;B++)for(let N=I;N<=D;N++)if(h.call(this,e,i,a,l,this.xCellCount*N+B,m,v,x))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,i,a,l,h,m){const v=l-e,x=h-i,P=a+m;return P*P>v*v+x*x}_circleAndRectCollide(e,i,a,l,h,m,v){const x=(m-l)/2,P=Math.abs(e-(l+x));if(P>x+a)return!1;const I=(v-h)/2,k=Math.abs(i-(h+I));if(k>I+a)return!1;if(P<=x||k<=I)return!0;const D=P-x,B=k-I;return D*D+B*B<=a*a}}function we(u,e,i){const a=o.H();if(!u){const{vecSouth:k,vecEast:D}=Me(e),B=se();B[0]=D[0],B[1]=D[1],B[2]=k[0],B[3]=k[1],l=B,(I=(m=(h=B)[0])*(P=h[3])-(x=h[2])*(v=h[1]))&&(l[0]=P*(I=1/I),l[1]=-v*I,l[2]=-x*I,l[3]=m*I),a[0]=B[0],a[1]=B[1],a[4]=B[2],a[5]=B[3]}var l,h,m,v,x,P,I;return o.K(a,a,[1/i,1/i,1]),a}function pe(u,e,i,a){if(u){const l=o.H();if(!e){const{vecSouth:h,vecEast:m}=Me(i);l[0]=m[0],l[1]=m[1],l[4]=h[0],l[5]=h[1]}return o.K(l,l,[a,a,1]),l}return i.pixelsToClipSpaceMatrix}function Me(u){const e=Math.cos(u.rollInRadians),i=Math.sin(u.rollInRadians),a=Math.cos(u.pitchInRadians),l=Math.cos(u.bearingInRadians),h=Math.sin(u.bearingInRadians),m=o.ad();m[0]=-l*a*i-h*e,m[1]=-h*a*i+l*e;const v=o.ae(m);v<1e-9?o.af(m):o.ag(m,m,1/v);const x=o.ad();x[0]=l*a*e-h*i,x[1]=h*a*e+l*i;const P=o.ae(x);return P<1e-9?o.af(x):o.ag(x,x,1/P),{vecEast:x,vecSouth:m}}function Pe(u,e,i,a){let l;a?(l=[u,e,a(u,e),1],o.al(l,l,i)):(l=[u,e,0,1],hi(l,l,i));const h=l[3];return{point:new o.P(l[0]/h,l[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function _e(u,e){return .5+u/e*.5}function de(u,e){return u.x>=-e[0]&&u.x<=e[0]&&u.y>=-e[1]&&u.y<=e[1]}function Ue(u,e,i,a,l,h,m,v,x,P,I,k,D){const B=i?u.textSizeData:u.iconSizeData,N=o.ah(B,e.transform.zoom),H=[256/e.width*2+1,256/e.height*2+1],G=i?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;G.clear();const W=u.lineVertexArray,Y=i?u.text.placedSymbolArray:u.icon.placedSymbolArray,re=e.transform.width/e.transform.height;let ne=!1;for(let ae=0;ae<Y.length;ae++){const ce=Y.get(ae);if(ce.hidden||ce.writingMode===o.ai.vertical&&!ne){_i(ce.numGlyphs,G);continue}ne=!1;const le=new o.P(ce.anchorX,ce.anchorY),ye={getElevation:D,pitchedLabelPlaneMatrix:a,lineVertexArray:W,pitchWithMap:h,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:le,unwrappedTileID:x,width:P,height:I,translation:k},be=Pt(ce.anchorX,ce.anchorY,ye);if(!de(be.point,H)){_i(ce.numGlyphs,G);continue}const Ie=_e(e.transform.cameraToCenterDistance,be.signedDistanceFromCamera),Ae=o.aj(B,N,ce),Se=h?Ae*e.transform.getPitchedTextCorrection(ce.anchorX,ce.anchorY,x)/Ie:Ae*Ie,Ve=dt({projectionContext:ye,pitchedLabelPlaneMatrixInverse:l,symbol:ce,fontSize:Se,flip:!1,keepUpright:m,glyphOffsetArray:u.glyphOffsetArray,dynamicLayoutVertexArray:G,aspectRatio:re,rotateToLine:v});ne=Ve.useVertical,(Ve.notEnoughRoom||ne||Ve.needsFlipping&&dt({projectionContext:ye,pitchedLabelPlaneMatrixInverse:l,symbol:ce,fontSize:Se,flip:!0,keepUpright:m,glyphOffsetArray:u.glyphOffsetArray,dynamicLayoutVertexArray:G,aspectRatio:re,rotateToLine:v}).notEnoughRoom)&&_i(ce.numGlyphs,G)}i?u.text.dynamicLayoutVertexBuffer.updateData(G):u.icon.dynamicLayoutVertexBuffer.updateData(G)}function Ne(u,e,i,a,l,h,m,v){const x=h.glyphStartIndex+h.numGlyphs,P=h.lineStartIndex,I=h.lineStartIndex+h.lineLength,k=e.getoffsetX(h.glyphStartIndex),D=e.getoffsetX(x-1),B=ri(u*k,i,a,l,h.segment,P,I,v,m);if(!B)return null;const N=ri(u*D,i,a,l,h.segment,P,I,v,m);return N?v.projectionCache.anyProjectionOccluded?null:{first:B,last:N}:null}function at(u,e,i,a){return u===o.ai.horizontal&&Math.abs(i.y-e.y)>Math.abs(i.x-e.x)*a?{useVertical:!0}:(u===o.ai.vertical?e.y<i.y:e.x>i.x)?{needsFlipping:!0}:null}function dt(u){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:i,symbol:a,fontSize:l,flip:h,keepUpright:m,glyphOffsetArray:v,dynamicLayoutVertexArray:x,aspectRatio:P,rotateToLine:I}=u,k=l/24,D=a.lineOffsetX*k,B=a.lineOffsetY*k;let N;if(a.numGlyphs>1){const H=a.glyphStartIndex+a.numGlyphs,G=a.lineStartIndex,W=a.lineStartIndex+a.lineLength,Y=Ne(k,v,D,B,h,a,I,e);if(!Y)return{notEnoughRoom:!0};const re=yt(Y.first.point.x,Y.first.point.y,e,i),ne=yt(Y.last.point.x,Y.last.point.y,e,i);if(m&&!h){const ae=at(a.writingMode,re,ne,P);if(ae)return ae}N=[Y.first];for(let ae=a.glyphStartIndex+1;ae<H-1;ae++)N.push(ri(k*v.getoffsetX(ae),D,B,h,a.segment,G,W,e,I));N.push(Y.last)}else{if(m&&!h){const G=Ye(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,W=a.lineStartIndex+a.segment+1,Y=new o.P(e.lineVertexArray.getx(W),e.lineVertexArray.gety(W)),re=Ye(Y.x,Y.y,e),ne=re.signedDistanceFromCamera>0?re.point:ke(e.tileAnchorPoint,Y,G,1,e),ae=yt(G.x,G.y,e,i),ce=yt(ne.x,ne.y,e,i),le=at(a.writingMode,ae,ce,P);if(le)return le}const H=ri(k*v.getoffsetX(a.glyphStartIndex),D,B,h,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,e,I);if(!H||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};N=[H]}for(const H of N)o.ak(x,H.point,H.angle);return{}}function ke(u,e,i,a,l){const h=u.add(u.sub(e)._unit()),m=Ye(h.x,h.y,l).point,v=i.sub(m);return i.add(v._mult(a/v.mag()))}function $e(u,e,i){const a=e.projectionCache;if(a.projections[u])return a.projections[u];const l=new o.P(e.lineVertexArray.getx(u),e.lineVertexArray.gety(u)),h=Ye(l.x,l.y,e);if(h.signedDistanceFromCamera>0)return a.projections[u]=h.point,a.anyProjectionOccluded=a.anyProjectionOccluded||h.isOccluded,h.point;const m=u-i.direction;return ke(i.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),l,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,e)}function Ye(u,e,i){const a=u+i.translation[0],l=e+i.translation[1];let h;return i.pitchWithMap?(h=Pe(a,l,i.pitchedLabelPlaneMatrix,i.getElevation),h.isOccluded=!1):(h=i.transform.projectTileCoordinates(a,l,i.unwrappedTileID,i.getElevation),h.point.x=(.5*h.point.x+.5)*i.width,h.point.y=(.5*-h.point.y+.5)*i.height),h}function yt(u,e,i,a){if(i.pitchWithMap){const l=[u,e,0,1];return o.al(l,l,a),i.transform.projectTileCoordinates(l[0]/l[3],l[1]/l[3],i.unwrappedTileID,i.getElevation).point}return{x:u/i.width*2-1,y:e/i.height*2-1}}function Pt(u,e,i){return i.transform.projectTileCoordinates(u,e,i.unwrappedTileID,i.getElevation)}function ut(u,e,i){return u._unit()._perp()._mult(e*i)}function We(u,e,i,a,l,h,m,v,x){if(v.projectionCache.offsets[u])return v.projectionCache.offsets[u];const P=i.add(e);if(u+x.direction<a||u+x.direction>=l)return v.projectionCache.offsets[u]=P,P;const I=$e(u+x.direction,v,x),k=ut(I.sub(i),m,x.direction),D=i.add(k),B=I.add(k);return v.projectionCache.offsets[u]=o.am(h,P,D,B)||P,v.projectionCache.offsets[u]}function ri(u,e,i,a,l,h,m,v,x){const P=a?u-e:u+e;let I=P>0?1:-1,k=0;a&&(I*=-1,k=Math.PI),I<0&&(k+=Math.PI);let D,B=I>0?h+l:h+l+1;v.projectionCache.cachedAnchorPoint?D=v.projectionCache.cachedAnchorPoint:(D=Ye(v.tileAnchorPoint.x,v.tileAnchorPoint.y,v).point,v.projectionCache.cachedAnchorPoint=D);let N,H,G=D,W=D,Y=0,re=0;const ne=Math.abs(P),ae=[];let ce;for(;Y+re<=ne;){if(B+=I,B<h||B>=m)return null;Y+=re,W=G,H=N;const be={absOffsetX:ne,direction:I,distanceFromAnchor:Y,previousVertex:W};if(G=$e(B,v,be),i===0)ae.push(W),ce=G.sub(W);else{let Ie;const Ae=G.sub(W);Ie=Ae.mag()===0?ut($e(B+I,v,be).sub(G),i,I):ut(Ae,i,I),H||(H=W.add(Ie)),N=We(B,Ie,G,h,m,H,i,v,be),ae.push(H),ce=N.sub(H)}re=ce.mag()}const le=ce._mult((ne-Y)/re)._add(H||W),ye=k+Math.atan2(G.y-W.y,G.x-W.x);return ae.push(le),{point:le,angle:x?ye:0,path:ae}}const bn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function _i(u,e){for(let i=0;i<u;i++){const a=e.length;e.resize(a+4),e.float32.set(bn,3*a)}}function hi(u,e,i){const a=e[0],l=e[1];return u[0]=i[0]*a+i[4]*l+i[12],u[1]=i[1]*a+i[5]*l+i[13],u[3]=i[3]*a+i[7]*l+i[15],u}const Ht=100;class lr{constructor(e,i=new me(e.width+200,e.height+200,25),a=new me(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=a,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ht,this.screenBottomBoundary=e.height+Ht,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,i,a,l,h,m,v,x,P,I,k,D){const B=this.projectAndGetPerspectiveRatio(e.anchorPointX+x[0],e.anchorPointY+x[1],h,I,D),N=a*B.perspectiveRatio;let H;if(m||v)H=this._projectCollisionBox(e,N,l,h,m,v,x,B,I,k,D);else{const ce=B.x+(k?k.x*N:0),le=B.y+(k?k.y*N:0);H={allPointsOccluded:!1,box:[ce+e.x1*N,le+e.y1*N,ce+e.x2*N,le+e.y2*N]}}const[G,W,Y,re]=H.box,ne=m?H.allPointsOccluded:B.isOccluded;let ae=ne;return ae||(ae=B.perspectiveRatio<this.perspectiveRatioCutoff),ae||(ae=!this.isInsideGrid(G,W,Y,re)),ae||i!=="always"&&this.grid.hitTest(G,W,Y,re,i,P)?{box:[G,W,Y,re],placeable:!1,offscreen:!1,occluded:ne}:{box:[G,W,Y,re],placeable:!0,offscreen:this.isOffscreen(G,W,Y,re),occluded:ne}}placeCollisionCircles(e,i,a,l,h,m,v,x,P,I,k,D,B,N){const H=[],G=new o.P(i.anchorX,i.anchorY),W=this.getPerspectiveRatio(G.x,G.y,m,N),Y=(P?h*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,m)/W:h*W)/o.as,re={getElevation:N,pitchedLabelPlaneMatrix:v,lineVertexArray:a,pitchWithMap:P,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:G,unwrappedTileID:m,width:this.transform.width,height:this.transform.height,translation:B},ne=Ne(Y,l,i.lineOffsetX*Y,i.lineOffsetY*Y,!1,i,!1,re);let ae=!1,ce=!1,le=!0;if(ne){const ye=.5*k*W+D,be=new o.P(-100,-100),Ie=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ae=new Q,Se=ne.first,Ve=ne.last;let je=[];for(let _t=Se.path.length-1;_t>=1;_t--)je.push(Se.path[_t]);for(let _t=1;_t<Ve.path.length;_t++)je.push(Ve.path[_t]);const De=2.5*ye;if(P){const _t=this.projectPathToScreenSpace(je,re);je=_t.some(Ct=>Ct.signedDistanceFromCamera<=0)?[]:_t.map(Ct=>Ct.point)}let qe=[];if(je.length>0){const _t=je[0].clone(),Ct=je[0].clone();for(let Yt=1;Yt<je.length;Yt++)_t.x=Math.min(_t.x,je[Yt].x),_t.y=Math.min(_t.y,je[Yt].y),Ct.x=Math.max(Ct.x,je[Yt].x),Ct.y=Math.max(Ct.y,je[Yt].y);qe=_t.x>=be.x&&Ct.x<=Ie.x&&_t.y>=be.y&&Ct.y<=Ie.y?[je]:Ct.x<be.x||_t.x>Ie.x||Ct.y<be.y||_t.y>Ie.y?[]:o.ao([je],be.x,be.y,Ie.x,Ie.y)}for(const _t of qe){Ae.reset(_t,.25*ye);let Ct=0;Ct=Ae.length<=.5*ye?1:Math.ceil(Ae.paddedLength/De)+1;for(let Yt=0;Yt<Ct;Yt++){const Lt=Yt/Math.max(Ct-1,1),Jt=Ae.lerp(Lt),Rt=Jt.x+Ht,zt=Jt.y+Ht;H.push(Rt,zt,ye,0);const Ft=Rt-ye,Li=zt-ye,di=Rt+ye,pi=zt+ye;if(le=le&&this.isOffscreen(Ft,Li,di,pi),ce=ce||this.isInsideGrid(Ft,Li,di,pi),e!=="always"&&this.grid.hitTestCircle(Rt,zt,ye,e,I)&&(ae=!0,!x))return{circles:[],offscreen:!1,collisionDetected:ae}}}}return{circles:!x&&ae||!ce||W<this.perspectiveRatioCutoff?[]:H,offscreen:le,collisionDetected:ae}}projectPathToScreenSpace(e,i){const a=function(l,h){const m=o.H();return o.an(m,h.pitchedLabelPlaneMatrix),l.map(v=>{const x=Pe(v.x,v.y,m,h.getElevation),P=h.transform.projectTileCoordinates(x.point.x,x.point.y,h.unwrappedTileID,h.getElevation);return P.point.x=(.5*P.point.x+.5)*h.width,P.point.y=(.5*-P.point.y+.5)*h.height,P})}(e,i);return function(l){let h=0,m=0,v=0,x=0;for(let P=0;P<l.length;P++)l[P].isOccluded?(v=P+1,x=0):(x++,x>m&&(m=x,h=v));return l.slice(h,h+m)}(a)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const i=[];let a=1/0,l=1/0,h=-1/0,m=-1/0;for(const I of e){const k=new o.P(I.x+Ht,I.y+Ht);a=Math.min(a,k.x),l=Math.min(l,k.y),h=Math.max(h,k.x),m=Math.max(m,k.y),i.push(k)}const v=this.grid.query(a,l,h,m).concat(this.ignoredGrid.query(a,l,h,m)),x={},P={};for(const I of v){const k=I.key;if(x[k.bucketInstanceId]===void 0&&(x[k.bucketInstanceId]={}),x[k.bucketInstanceId][k.featureIndex])continue;const D=[new o.P(I.x1,I.y1),new o.P(I.x2,I.y1),new o.P(I.x2,I.y2),new o.P(I.x1,I.y2)];o.ap(i,D)&&(x[k.bucketInstanceId][k.featureIndex]=!0,P[k.bucketInstanceId]===void 0&&(P[k.bucketInstanceId]=[]),P[k.bucketInstanceId].push(k.featureIndex))}return P}insertCollisionBox(e,i,a,l,h,m){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:h,collisionGroupID:m,overlapMode:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,i,a,l,h,m){const v=a?this.ignoredGrid:this.grid,x={bucketInstanceId:l,featureIndex:h,collisionGroupID:m,overlapMode:i};for(let P=0;P<e.length;P+=4)v.insertCircle(x,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,i,a,l,h){if(h){let m;l?(m=[e,i,l(e,i),1],o.al(m,m,h)):(m=[e,i,0,1],hi(m,m,h));const v=m[3];return{x:(m[0]/v+1)/2*this.transform.width+Ht,y:(-m[1]/v+1)/2*this.transform.height+Ht,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v*.5,isOccluded:!1,signedDistanceFromCamera:v}}{const m=this.transform.projectTileCoordinates(e,i,a,l);return{x:(m.point.x+1)/2*this.transform.width+Ht,y:(1-m.point.y)/2*this.transform.height+Ht,perspectiveRatio:.5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5,isOccluded:m.isOccluded,signedDistanceFromCamera:m.signedDistanceFromCamera}}}getPerspectiveRatio(e,i,a,l){const h=this.transform.projectTileCoordinates(e,i,a,l);return .5+this.transform.cameraToCenterDistance/h.signedDistanceFromCamera*.5}isOffscreen(e,i,a,l){return a<Ht||e>=this.screenRightBoundary||l<Ht||i>this.screenBottomBoundary}isInsideGrid(e,i,a,l){return a>=0&&e<this.gridRightBoundary&&l>=0&&i<this.gridBottomBoundary}getViewportMatrix(){const e=o.aq([]);return o.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,a,l,h,m,v,x,P,I,k){let D=1,B=0,N=0,H=1;const G=e.anchorPointX+v[0],W=e.anchorPointY+v[1];if(m&&!h){const je=this.projectAndGetPerspectiveRatio(G+1,W,l,P,k),De=je.x-x.x,qe=Math.atan((je.y-x.y)/De)+(De<0?Math.PI:0),_t=Math.sin(qe),Ct=Math.cos(qe);D=Ct,B=_t,N=-_t,H=Ct}else if(!m&&h){const je=Me(this.transform);D=je.vecEast[0],B=je.vecEast[1],N=je.vecSouth[0],H=je.vecSouth[1]}let Y=x.x,re=x.y,ne=i;h&&(Y=G,re=W,ne=Math.pow(2,-(this.transform.zoom-a.overscaledZ)),ne*=this.transform.getPitchedTextCorrection(G,W,l),I||(ne*=o.ab(.5+x.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),I&&(Y+=D*I.x*ne+N*I.y*ne,re+=B*I.x*ne+H*I.y*ne);const ae=e.x1*ne,ce=e.x2*ne,le=(ae+ce)/2,ye=e.y1*ne,be=e.y2*ne,Ie=(ye+be)/2,Ae=[{offsetX:ae,offsetY:ye},{offsetX:le,offsetY:ye},{offsetX:ce,offsetY:ye},{offsetX:ce,offsetY:Ie},{offsetX:ce,offsetY:be},{offsetX:le,offsetY:be},{offsetX:ae,offsetY:be},{offsetX:ae,offsetY:Ie}];let Se=[];for(const{offsetX:je,offsetY:De}of Ae)Se.push(new o.P(Y+D*je+N*De,re+B*je+H*De));let Ve=!1;if(h){const je=Se.map(De=>this.projectAndGetPerspectiveRatio(De.x,De.y,l,P,k));Ve=je.some(De=>!De.isOccluded),Se=je.map(De=>new o.P(De.x,De.y))}else Ve=!0;return{box:o.ar(Se),allPointsOccluded:!Ve}}}class Wt{constructor(e,i,a,l){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?i:-i))):l&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class ra{constructor(e,i,a,l,h){this.text=new Wt(e?e.text:null,i,a,h),this.icon=new Wt(e?e.icon:null,i,l,h)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ws{constructor(e,i,a){this.text=e,this.icon=i,this.skipFade=a}}class el{constructor(e,i,a,l,h){this.bucketInstanceId=e,this.featureIndex=i,this.sourceLayerIndex=a,this.bucketIndex=l,this.tileID=h}}class Zn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const i=++this.maxGroupID;this.collisionGroups[e]={ID:i,predicate:a=>a.collisionGroupID===i}}return this.collisionGroups[e]}}function Gn(u,e,i,a,l){const{horizontalAlign:h,verticalAlign:m}=o.ay(u);return new o.P(-(h-.5)*e+a[0]*l,-(m-.5)*i+a[1]*l)}class Zc{constructor(e,i,a,l,h){this.transform=e.clone(),this.terrain=i,this.collisionIndex=new lr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Zn(l),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const i=this.terrain;return i?(a,l)=>i.getElevation(e,a,l):null}getBucketParts(e,i,a,l){const h=a.getBucket(i),m=a.latestFeatureIndex;if(!h||!m||i.id!==h.layerIds[0])return;const v=a.collisionBoxArray,x=h.layers[0].layout,P=h.layers[0].paint,I=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),k=a.tileSize/o.X,D=a.tileID.toUnwrapped(),B=x.get("text-rotation-alignment")==="map",N=o.at(a,1,this.transform.zoom),H=o.au(this.collisionIndex.transform,a,P.get("text-translate"),P.get("text-translate-anchor")),G=o.au(this.collisionIndex.transform,a,P.get("icon-translate"),P.get("icon-translate-anchor")),W=we(B,this.transform,N);this.retainedQueryData[h.bucketInstanceId]=new el(h.bucketInstanceId,m,h.sourceLayerIndex,h.index,a.tileID);const Y={bucket:h,layout:x,translationText:H,translationIcon:G,unwrappedTileID:D,pitchedLabelPlaneMatrix:W,scale:I,textPixelRatio:k,holdingForFade:a.holdingForFade(),collisionBoxArray:v,partiallyEvaluatedTextSize:o.ah(h.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(h.sourceID)};if(l)for(const re of h.sortKeyRanges){const{sortKey:ne,symbolInstanceStart:ae,symbolInstanceEnd:ce}=re;e.push({sortKey:ne,symbolInstanceStart:ae,symbolInstanceEnd:ce,parameters:Y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:h.symbolInstances.length,parameters:Y})}attemptAnchorPlacement(e,i,a,l,h,m,v,x,P,I,k,D,B,N,H,G,W,Y,re,ne){const ae=o.av[e.textAnchor],ce=[e.textOffset0,e.textOffset1],le=Gn(ae,a,l,ce,h),ye=this.collisionIndex.placeCollisionBox(i,D,x,P,I,v,m,G,k.predicate,re,le,ne);if((!Y||this.collisionIndex.placeCollisionBox(Y,D,x,P,I,v,m,W,k.predicate,re,le,ne).placeable)&&ye.placeable){let be;if(this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(be=this.prevPlacement.variableOffsets[B.crossTileID].anchor),B.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[B.crossTileID]={textOffset:ce,width:a,height:l,anchor:ae,textBoxScale:h,prevAnchor:be},this.markUsedJustification(N,ae,B,H),N.allowVerticalPlacement&&(this.markUsedOrientation(N,H,B),this.placedOrientations[B.crossTileID]=H),{shift:le,placedGlyphBoxes:ye}}}placeLayerBucketPart(e,i,a){const{bucket:l,layout:h,translationText:m,translationIcon:v,unwrappedTileID:x,pitchedLabelPlaneMatrix:P,textPixelRatio:I,holdingForFade:k,collisionBoxArray:D,partiallyEvaluatedTextSize:B,collisionGroup:N}=e.parameters,H=h.get("text-optional"),G=h.get("icon-optional"),W=o.aw(h,"text-overlap","text-allow-overlap"),Y=W==="always",re=o.aw(h,"icon-overlap","icon-allow-overlap"),ne=re==="always",ae=h.get("text-rotation-alignment")==="map",ce=h.get("text-pitch-alignment")==="map",le=h.get("icon-text-fit")!=="none",ye=h.get("symbol-z-order")==="viewport-y",be=Y&&(ne||!l.hasIconData()||G),Ie=ne&&(Y||!l.hasTextData()||H);!l.collisionArrays&&D&&l.deserializeCollisionBoxes(D);const Ae=this.retainedQueryData[l.bucketInstanceId].tileID,Se=this._getTerrainElevationFunc(Ae),Ve=this.transform.getFastPathSimpleProjectionMatrix(Ae),je=(De,qe,_t)=>{var Ct,Yt;if(i[De.crossTileID])return;if(k)return void(this.placements[De.crossTileID]=new ws(!1,!1,!1));let Lt=!1,Jt=!1,Rt=!0,zt=null,Ft={box:null,placeable:!1,offscreen:null,occluded:!1},Li={placeable:!1},di=null,pi=null,Xi=null,an=0,Zr=0,ur=0;qe.textFeatureIndex?an=qe.textFeatureIndex:De.useRuntimeCollisionCircles&&(an=De.featureIndex),qe.verticalTextFeatureIndex&&(Zr=qe.verticalTextFeatureIndex);const on=qe.textBox;if(on){const ir=Bt=>{let Qt=o.ai.horizontal;if(l.allowVerticalPlacement&&!Bt&&this.prevPlacement){const dr=this.prevPlacement.placedOrientations[De.crossTileID];dr&&(this.placedOrientations[De.crossTileID]=dr,Qt=dr,this.markUsedOrientation(l,Qt,De))}return Qt},Pr=(Bt,Qt)=>{if(l.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&qe.verticalTextBox){for(const dr of l.writingModes)if(dr===o.ai.vertical?(Ft=Qt(),Li=Ft):Ft=Bt(),Ft&&Ft.placeable)break}else Ft=Bt()},Sr=De.textAnchorOffsetStartIndex,hr=De.textAnchorOffsetEndIndex;if(hr===Sr){const Bt=(Qt,dr)=>{const ti=this.collisionIndex.placeCollisionBox(Qt,W,I,Ae,x,ce,ae,m,N.predicate,Se,void 0,Ve);return ti&&ti.placeable&&(this.markUsedOrientation(l,dr,De),this.placedOrientations[De.crossTileID]=dr),ti};Pr(()=>Bt(on,o.ai.horizontal),()=>{const Qt=qe.verticalTextBox;return l.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&Qt?Bt(Qt,o.ai.vertical):{box:null,offscreen:null}}),ir(Ft&&Ft.placeable)}else{let Bt=o.av[(Yt=(Ct=this.prevPlacement)===null||Ct===void 0?void 0:Ct.variableOffsets[De.crossTileID])===null||Yt===void 0?void 0:Yt.anchor];const Qt=(ti,pd,$u)=>{const Jl=ti.x2-ti.x1,qu=ti.y2-ti.y1,ls=De.textBoxScale,cs=le&&re==="never"?pd:null;let Cn=null,Zu=W==="never"?1:2,Mo="never";Bt&&Zu++;for(let Ql=0;Ql<Zu;Ql++){for(let ec=Sr;ec<hr;ec++){const tc=l.textAnchorOffsets.get(ec);if(Bt&&tc.textAnchor!==Bt)continue;const ic=this.attemptAnchorPlacement(tc,ti,Jl,qu,ls,ae,ce,I,Ae,x,N,Mo,De,l,$u,m,v,cs,Se);if(ic&&(Cn=ic.placedGlyphBoxes,Cn&&Cn.placeable))return Lt=!0,zt=ic.shift,Cn}Bt?Bt=null:Mo=W}return a&&!Cn&&(Cn={box:this.collisionIndex.placeCollisionBox(on,"always",I,Ae,x,ce,ae,m,N.predicate,Se,void 0,Ve).box,offscreen:!1,placeable:!1,occluded:!1}),Cn};Pr(()=>Qt(on,qe.iconBox,o.ai.horizontal),()=>{const ti=qe.verticalTextBox;return l.allowVerticalPlacement&&(!Ft||!Ft.placeable)&&De.numVerticalGlyphVertices>0&&ti?Qt(ti,qe.verticalIconBox,o.ai.vertical):{box:null,occluded:!0,offscreen:null}}),Ft&&(Lt=Ft.placeable,Rt=Ft.offscreen);const dr=ir(Ft&&Ft.placeable);if(!Lt&&this.prevPlacement){const ti=this.prevPlacement.variableOffsets[De.crossTileID];ti&&(this.variableOffsets[De.crossTileID]=ti,this.markUsedJustification(l,ti.anchor,De,dr))}}}if(di=Ft,Lt=di&&di.placeable,Rt=di&&di.offscreen,De.useRuntimeCollisionCircles){const ir=l.text.placedSymbolArray.get(De.centerJustifiedTextSymbolIndex),Pr=o.aj(l.textSizeData,B,ir),Sr=h.get("text-padding");pi=this.collisionIndex.placeCollisionCircles(W,ir,l.lineVertexArray,l.glyphOffsetArray,Pr,x,P,a,ce,N.predicate,De.collisionCircleDiameter,Sr,m,Se),pi.circles.length&&pi.collisionDetected&&!a&&o.w("Collisions detected, but collision boxes are not shown"),Lt=Y||pi.circles.length>0&&!pi.collisionDetected,Rt=Rt&&pi.offscreen}if(qe.iconFeatureIndex&&(ur=qe.iconFeatureIndex),qe.iconBox){const ir=Pr=>this.collisionIndex.placeCollisionBox(Pr,re,I,Ae,x,ce,ae,v,N.predicate,Se,le&&zt?zt:void 0,Ve);Li&&Li.placeable&&qe.verticalIconBox?(Xi=ir(qe.verticalIconBox),Jt=Xi.placeable):(Xi=ir(qe.iconBox),Jt=Xi.placeable),Rt=Rt&&Xi.offscreen}const ka=H||De.numHorizontalGlyphVertices===0&&De.numVerticalGlyphVertices===0,Aa=G||De.numIconVertices===0;ka||Aa?Aa?ka||(Jt=Jt&&Lt):Lt=Jt&&Lt:Jt=Lt=Jt&&Lt;const Us=Jt&&Xi.placeable;if(Lt&&di.placeable&&this.collisionIndex.insertCollisionBox(di.box,W,h.get("text-ignore-placement"),l.bucketInstanceId,Li&&Li.placeable&&Zr?Zr:an,N.ID),Us&&this.collisionIndex.insertCollisionBox(Xi.box,re,h.get("icon-ignore-placement"),l.bucketInstanceId,ur,N.ID),pi&&Lt&&this.collisionIndex.insertCollisionCircles(pi.circles,W,h.get("text-ignore-placement"),l.bucketInstanceId,an,N.ID),a&&this.storeCollisionData(l.bucketInstanceId,_t,qe,di,Xi,pi),De.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(l.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[De.crossTileID]=new ws((Lt||be)&&!(di!=null&&di.occluded),(Jt||Ie)&&!(Xi!=null&&Xi.occluded),Rt||l.justReloaded),i[De.crossTileID]=!0};if(ye){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const De=l.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let qe=De.length-1;qe>=0;--qe){const _t=De[qe];je(l.symbolInstances.get(_t),l.collisionArrays[_t],_t)}}else for(let De=e.symbolInstanceStart;De<e.symbolInstanceEnd;De++)je(l.symbolInstances.get(De),l.collisionArrays[De],De);l.justReloaded=!1}storeCollisionData(e,i,a,l,h,m){if(a.textBox||a.iconBox){let v,x;this.collisionBoxArrays.has(e)?v=this.collisionBoxArrays.get(e):(v=new Map,this.collisionBoxArrays.set(e,v)),v.has(i)?x=v.get(i):(x={text:null,icon:null},v.set(i,x)),a.textBox&&(x.text=l.box),a.iconBox&&(x.icon=h.box)}if(m){let v=this.collisionCircleArrays[e];v===void 0&&(v=this.collisionCircleArrays[e]=[]);for(let x=0;x<m.circles.length;x+=4)v.push(m.circles[x+0]-Ht),v.push(m.circles[x+1]-Ht),v.push(m.circles[x+2]),v.push(m.collisionDetected?1:0)}}markUsedJustification(e,i,a,l){let h;h=l===o.ai.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[o.ax(i)];const m=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const v of m)v>=0&&(e.text.placedSymbolArray.get(v).crossTileID=h>=0&&v!==h?0:a.crossTileID)}markUsedOrientation(e,i,a){const l=i===o.ai.horizontal||i===o.ai.horizontalOnly?i:0,h=i===o.ai.vertical?i:0,m=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const v of m)e.text.placedSymbolArray.get(v).placedOrientation=l;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=h)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const i=this.prevPlacement;let a=!1;this.prevZoomAdjustment=i?i.zoomAdjustment(this.transform.zoom):0;const l=i?i.symbolFadeChange(e):1,h=i?i.opacities:{},m=i?i.variableOffsets:{},v=i?i.placedOrientations:{};for(const x in this.placements){const P=this.placements[x],I=h[x];I?(this.opacities[x]=new ra(I,l,P.text,P.icon),a=a||P.text!==I.text.placed||P.icon!==I.icon.placed):(this.opacities[x]=new ra(null,l,P.text,P.icon,P.skipFade),a=a||P.text||P.icon)}for(const x in h){const P=h[x];if(!this.opacities[x]){const I=new ra(P,l,!1,!1);I.isHidden()||(this.opacities[x]=I,a=a||P.text.placed||P.icon.placed)}}for(const x in m)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=m[x]);for(const x in v)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=v[x]);if(i&&i.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=i?i.lastPlacementChangeTime:e)}updateLayerOpacities(e,i){const a={};for(const l of i){const h=l.getBucket(e);h&&l.latestFeatureIndex&&e.id===h.layerIds[0]&&this.updateBucketOpacities(h,l.tileID,a,l.collisionBoxArray)}}updateBucketOpacities(e,i,a,l){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const h=e.layers[0],m=h.layout,v=new ra(null,0,!1,!1,!0),x=m.get("text-allow-overlap"),P=m.get("icon-allow-overlap"),I=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=m.get("text-rotation-alignment")==="map",D=m.get("text-pitch-alignment")==="map",B=m.get("icon-text-fit")!=="none",N=new ra(null,0,x&&(P||!e.hasIconData()||m.get("icon-optional")),P&&(x||!e.hasTextData()||m.get("text-optional")),!0);!e.collisionArrays&&l&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(l);const H=(W,Y,re)=>{for(let ne=0;ne<Y/4;ne++)W.opacityVertexArray.emplaceBack(re);W.hasVisibleVertices=W.hasVisibleVertices||re!==Hn},G=this.collisionBoxArrays.get(e.bucketInstanceId);for(let W=0;W<e.symbolInstances.length;W++){const Y=e.symbolInstances.get(W),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ne,crossTileID:ae}=Y;let ce=this.opacities[ae];a[ae]?ce=v:ce||(ce=N,this.opacities[ae]=ce),a[ae]=!0;const le=Y.numIconVertices>0,ye=this.placedOrientations[Y.crossTileID],be=ye===o.ai.vertical,Ie=ye===o.ai.horizontal||ye===o.ai.horizontalOnly;if(re>0||ne>0){const Se=il(ce.text);H(e.text,re,be?Hn:Se),H(e.text,ne,Ie?Hn:Se);const Ve=ce.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(qe=>{qe>=0&&(e.text.placedSymbolArray.get(qe).hidden=Ve||be?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=Ve||Ie?1:0);const je=this.variableOffsets[Y.crossTileID];je&&this.markUsedJustification(e,je.anchor,Y,ye);const De=this.placedOrientations[Y.crossTileID];De&&(this.markUsedJustification(e,"left",Y,De),this.markUsedOrientation(e,De,Y))}if(le){const Se=il(ce.icon),Ve=!(B&&Y.verticalPlacedIconSymbolIndex&&be);Y.placedIconSymbolIndex>=0&&(H(e.icon,Y.numIconVertices,Ve?Se:Hn),e.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=ce.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,Y.numVerticalIconVertices,Ve?Hn:Se),e.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}const Ae=G&&G.has(W)?G.get(W):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Se=e.collisionArrays[W];if(Se){let Ve=new o.P(0,0);if(Se.textBox||Se.verticalTextBox){let je=!0;if(I){const De=this.variableOffsets[ae];De?(Ve=Gn(De.anchor,De.width,De.height,De.textOffset,De.textBoxScale),k&&Ve._rotate(D?-this.transform.bearingInRadians:this.transform.bearingInRadians)):je=!1}if(Se.textBox||Se.verticalTextBox){let De;Se.textBox&&(De=be),Se.verticalTextBox&&(De=Ie),tl(e.textCollisionBox.collisionVertexArray,ce.text.placed,!je||De,Ae.text,Ve.x,Ve.y)}}if(Se.iconBox||Se.verticalIconBox){const je=!!(!Ie&&Se.verticalIconBox);let De;Se.iconBox&&(De=je),Se.verticalIconBox&&(De=!je),tl(e.iconCollisionBox.collisionVertexArray,ce.icon.placed,De,Ae.icon,B?Ve.x:0,B?Ve.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,i){const a=this.zoomAtLastRecencyCheck===i?1-this.zoomAdjustment(i):1;return this.zoomAtLastRecencyCheck=i,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function tl(u,e,i,a,l,h){a&&a.length!==0||(a=[0,0,0,0]);const m=a[0]-Ht,v=a[1]-Ht,x=a[2]-Ht,P=a[3]-Ht;u.emplaceBack(e?1:0,i?1:0,l||0,h||0,m,v),u.emplaceBack(e?1:0,i?1:0,l||0,h||0,x,v),u.emplaceBack(e?1:0,i?1:0,l||0,h||0,x,P),u.emplaceBack(e?1:0,i?1:0,l||0,h||0,m,P)}const Gc=Math.pow(2,25),Ts=Math.pow(2,24),Hc=Math.pow(2,17),Hh=Math.pow(2,16),Wh=Math.pow(2,9),Xh=Math.pow(2,8),Wc=Math.pow(2,1);function il(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const e=u.placed?1:0,i=Math.floor(127*u.opacity);return i*Gc+e*Ts+i*Hc+e*Hh+i*Wh+e*Xh+i*Wc+e}const Hn=0;class rl{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,i,a,l,h){const m=this._bucketParts;for(;this._currentTileIndex<e.length;)if(i.getBucketParts(m,l,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,h())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,m.sort((v,x)=>v.sortKey-x.sortKey));this._currentPartIndex<m.length;)if(i.placeLayerBucketPart(m[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,h())return!0;return!1}}class Xc{constructor(e,i,a,l,h,m,v,x){this.placement=new Zc(e,i,m,v,x),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=h,this._done=!1}isDone(){return this._done}continuePlacement(e,i,a){const l=ie.now(),h=()=>!this._forceFullPlacement&&ie.now()-l>2;for(;this._currentPlacementIndex>=0;){const m=i[e[this._currentPlacementIndex]],v=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=v)&&(!m.maxzoom||m.maxzoom>v)){if(this._inProgressLayer||(this._inProgressLayer=new rl(m)),this._inProgressLayer.continuePlacement(a[m.source],this.placement,this._showCollisionBoxes,m,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Wn=512/o.X/2;class nl{constructor(e,i,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const l=new Map;for(let h=0;h<i.length;h++){const m=i.get(h),v=m.key,x=l.get(v);x?x.push(m):l.set(v,[m])}for(const[h,m]of l){const v={positions:m.map(x=>({x:Math.floor(x.anchorX*Wn),y:Math.floor(x.anchorY*Wn)})),crossTileIDs:m.map(x=>x.crossTileID)};if(v.positions.length>128){const x=new o.az(v.positions.length,16,Uint16Array);for(const{x:P,y:I}of v.positions)x.add(P,I);x.finish(),delete v.positions,v.index=x}this._symbolsByKey[h]=v}}getScaledCoordinates(e,i){const{x:a,y:l,z:h}=this.tileID.canonical,{x:m,y:v,z:x}=i.canonical,P=Wn/Math.pow(2,x-h),I=(v*o.X+e.anchorY)*P,k=l*o.X*Wn;return{x:Math.floor((m*o.X+e.anchorX)*P-a*o.X*Wn),y:Math.floor(I-k)}}findMatches(e,i,a){const l=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z);for(let h=0;h<e.length;h++){const m=e.get(h);if(m.crossTileID)continue;const v=this._symbolsByKey[m.key];if(!v)continue;const x=this.getScaledCoordinates(m,i);if(v.index){const P=v.index.range(x.x-l,x.y-l,x.x+l,x.y+l).sort();for(const I of P){const k=v.crossTileIDs[I];if(!a[k]){a[k]=!0,m.crossTileID=k;break}}}else if(v.positions)for(let P=0;P<v.positions.length;P++){const I=v.positions[P],k=v.crossTileIDs[P];if(Math.abs(I.x-x.x)<=l&&Math.abs(I.y-x.y)<=l&&!a[k]){a[k]=!0,m.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ua{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const i=Math.round((e-this.lng)/360);if(i!==0)for(const a in this.indexes){const l=this.indexes[a],h={};for(const m in l){const v=l[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+i),h[v.tileID.key]=v}this.indexes[a]=h}this.lng=e}addBucket(e,i,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===i.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let h=0;h<i.symbolInstances.length;h++)i.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const l=this.usedCrossTileIDs[e.overscaledZ];for(const h in this.indexes){const m=this.indexes[h];if(Number(h)>e.overscaledZ)for(const v in m){const x=m[v];x.tileID.isChildOf(e)&&x.findMatches(i.symbolInstances,e,l)}else{const v=m[e.scaledTo(Number(h)).key];v&&v.findMatches(i.symbolInstances,e,l)}}for(let h=0;h<i.symbolInstances.length;h++){const m=i.symbolInstances.get(h);m.crossTileID||(m.crossTileID=a.generate(),l[m.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new nl(e,i.symbolInstances,i.bucketInstanceId),!0}removeBucketCrossTileIDs(e,i){for(const a of i.getCrossTileIDsLists())for(const l of a)delete this.usedCrossTileIDs[e][l]}removeStaleBuckets(e){let i=!1;for(const a in this.indexes){const l=this.indexes[a];for(const h in l)e[l[h].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,l[h]),delete l[h],i=!0)}return i}}class Xn{constructor(){this.layerIndexes={},this.crossTileIDs=new Ua,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,i,a){let l=this.layerIndexes[e.id];l===void 0&&(l=this.layerIndexes[e.id]=new Kc);let h=!1;const m={};l.handleWrapJump(a);for(const v of i){const x=v.getBucket(e);x&&e.id===x.layerIds[0]&&(x.bucketInstanceId||(x.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(v.tileID,x,this.crossTileIDs)&&(h=!0),m[x.bucketInstanceId]=!0)}return l.removeStaleBuckets(m)&&(h=!0),h}pruneUnusedLayers(e){const i={};e.forEach(a=>{i[a]=!0});for(const a in this.layerIndexes)i[a]||delete this.layerIndexes[a]}}var sl="void main() {fragColor=vec4(1.0);}";const Nr={prelude:vt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:vt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:vt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:vt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:vt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:vt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:vt(sl,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:vt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:vt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:vt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:vt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:vt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:vt(sl,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:vt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:vt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:vt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:vt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:vt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:vt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:vt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:vt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:vt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:vt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:vt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:vt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:vt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:vt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:vt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:vt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:vt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:vt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:vt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:vt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:vt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function vt(u,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/in ([\w]+) ([\w]+)/g),l=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=h?h.concat(l):l,v={};return{fragmentSource:u=u.replace(i,(x,P,I,k,D)=>(v[D]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
in ${I} ${k} ${D};
#else
uniform ${I} ${k} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${I} ${k} ${D} = u_${D};
#endif
`)),vertexSource:e=e.replace(i,(x,P,I,k,D)=>{const B=k==="float"?"vec2":"vec4",N=D.match(/color/)?"color":B;return v[D]?P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${I} ${B} a_${D};
out ${I} ${k} ${D};
#else
uniform ${I} ${k} u_${D};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${I} ${k} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${N}(a_${D}, u_${D}_t);
#else
    ${I} ${k} ${D} = u_${D};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${I} ${B} a_${D};
#else
uniform ${I} ${k} u_${D};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${I} ${k} ${D} = a_${D};
#else
    ${I} ${k} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${I} ${k} ${D} = unpack_mix_${N}(a_${D}, u_${D}_t);
#else
    ${I} ${k} ${D} = u_${D};
#endif
`}),staticAttributes:a,staticUniforms:m}}class Vr{constructor(e,i,a){this.vertexBuffer=e,this.indexBuffer=i,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var bt=o.aA([{name:"a_pos",type:"Int16",components:2}]);const $a="#define PROJECTION_MERCATOR",Yc="mercator";class na{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Yc}get shaderDefine(){return $a}get shaderPreludeCode(){return Nr.projectionMercator}get vertexShaderPreludeCode(){return Nr.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aB.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,a,l,h){if(this._cachedMesh)return this._cachedMesh;const m=new o.aC;m.emplaceBack(0,0),m.emplaceBack(o.X,0),m.emplaceBack(0,o.X),m.emplaceBack(o.X,o.X);const v=e.createVertexBuffer(m,bt.members),x=o.aD.simpleSegment(0,0,4,2),P=new o.aE;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3);const I=e.createIndexBuffer(P);return this._cachedMesh=new Vr(v,I,x),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}function si(u,e){const i=o.ab(e.lat,-85.051129,o.aF);return new o.P(o.O(e.lng)*u,o.Q(i)*u)}function yi(u,e){return new o.Y(e.x/u,e.y/u).toLngLat()}function ei(u){return u.cameraToCenterDistance*Math.min(.85*Math.tan(o.aa(90-u.pitch)),Math.tan(o.aa(89.25-u.pitch)))}function al(u,e){const i=u.canonical,a=e/o.aG(i.z),l=i.x+Math.pow(2,i.z)*u.wrap,h=o.aq(new Float64Array(16));return o.J(h,h,[l*a,i.y*a,0]),o.K(h,h,[a/o.X,a/o.X,1]),h}function Ni(u,e,i,a,l){const h=o.Y.fromLngLat(u,e),m=l*o.aH(1,u.lat),v=m*Math.cos(o.aa(i)),x=Math.sqrt(m*m-v*v),P=x*Math.sin(o.aa(-a)),I=x*Math.cos(o.aa(-a));return new o.Y(h.x+P,h.y+I,h.z+v)}class Vi{constructor(e=0,i=0,a=0,l=0){if(isNaN(e)||e<0||isNaN(i)||i<0||isNaN(a)||a<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=i,this.left=a,this.right=l}interpolate(e,i,a){return i.top!=null&&e.top!=null&&(this.top=o.y.number(e.top,i.top,a)),i.bottom!=null&&e.bottom!=null&&(this.bottom=o.y.number(e.bottom,i.bottom,a)),i.left!=null&&e.left!=null&&(this.left=o.y.number(e.left,i.left,a)),i.right!=null&&e.right!=null&&(this.right=o.y.number(e.right,i.right,a)),this}getCenter(e,i){const a=o.ab((this.left+e-this.right)/2,0,e),l=o.ab((this.top+i-this.bottom)/2,0,i);return new o.P(a,l)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Vi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ui(u,e){if(!u.renderWorldCopies||u.lngRange)return;const i=e.lng-u.center.lng;e.lng+=i>180?-360:i<-180?360:0}function ol(u){return Math.max(0,Math.floor(u))}class Kn{constructor(e,i,a,l,h,m){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=m===void 0||!!m,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=l??0,this._maxPitch=h??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.N(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ol(this._zoom),this._scale=o.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Vi,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,a){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=ol(this._zoom),this._scale=o.aG(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Vi(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!a&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=o.aI(e,-180,180)*Math.PI/180;var a,l,h,m,v,x,P,I,k;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=se(),a=this._rotationMatrix,h=-this._bearingInRadians,m=(l=this._rotationMatrix)[0],v=l[1],x=l[2],P=l[3],I=Math.sin(h),k=Math.cos(h),a[0]=m*k+x*I,a[1]=v*k+P*I,a[2]=m*-I+x*k,a[3]=v*-I+P*k)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=o.ab(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const i=e/180*Math.PI;this._rollInRadians!==i&&(this._unmodified=!1,this._rollInRadians=i,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aJ(this._fovInRadians)}setFov(e){e=o.ab(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=o.aa(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=o.aG(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,i){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=i,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,i,a){this._unmodified=!1,this._edgeInsets.interpolate(e,i,a),this._constrain(),this._calcMatrices()}resize(e,i,a=!0){this._width=e,this._height=i,a&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new oi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,o.aF])}getConstrained(e,i){return this._callbacks.getConstrained(e,i)}getCameraQueryGeometry(e,i){if(i.length===1)return[i[0],e];{let a=e.x,l=e.y,h=e.x,m=e.y;for(const v of i)a=Math.min(a,v.x),l=Math.min(l,v.y),h=Math.max(h,v.x),m=Math.max(m,v.y);return[new o.P(a,l),new o.P(h,l),new o.P(h,m),new o.P(a,m),new o.P(a,l)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:i,zoom:a}=this.getConstrained(this.center,this.zoom);this.setCenter(i),this.setZoom(a),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=o.aq(new Float64Array(16));o.K(e,e,[this._width/2,-this._height/2,1]),o.J(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=o.aq(new Float64Array(16)),o.K(e,e,[1,-1,1]),o.J(e,e,[-1,-1,0]),o.K(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,a,l){const h=a!==void 0?a:this.bearing,m=l=l!==void 0?l:this.pitch,v=o.Y.fromLngLat(e,i),x=-Math.cos(o.aa(m)),P=Math.sin(o.aa(m)),I=P*Math.sin(o.aa(h)),k=-P*Math.cos(o.aa(h));let D=this.elevation;const B=i-D;let N;x*B>=0||Math.abs(x)<.1?(N=1e4,D=i+N*x):N=-B/x;let H,G,W=o.aK(1,v.y),Y=0;do{if(Y+=1,Y>10)break;G=N/W,H=new o.Y(v.x+I*G,v.y+k*G),W=1/H.meterInMercatorCoordinateUnits()}while(Math.abs(N-G*W)>1e-12);return{center:H.toLngLat(),elevation:D,zoom:o.a8(this.height/2/Math.tan(this.fovInRadians/2)/G/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=o.aH(1,this.center.lat)*this.worldSize,a=this.cameraToCenterDistance/i,l=o.Y.fromLngLat(this.center,this.elevation),h=Ni(this.center,this.elevation,this.pitch,this.bearing,a);this._elevation=e;const m=this.calculateCenterFromCameraLngLatAlt(h.toLngLat(),o.aK(h.z,l.y),this.bearing,this.pitch);this._elevation=m.elevation,this._center=m.center,this.setZoom(m.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=o.aH(1,this.center.lat)*this.worldSize;return Ni(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/o.X,1/i/o.X]}}class Ut{constructor(e,i){this.min=e,this.max=i,this.center=o.aL([],o.aM([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=o.aN(this.min),l=o.aN(this.max);for(let h=0;h<i.length;h++)a[h]=i[h]?this.min[h]:this.center[h],l[h]=i[h]?this.center[h]:this.max[h];return l[2]=this.max[2],new Ut(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let i=!0;for(let a=0;a<e.planes.length;a++){const l=this.intersectsPlane(e.planes[a]);if(l===0)return 0;l===1&&(i=!1)}return i?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let i=e[3],a=e[3];for(let l=0;l<3;l++)e[l]>0?(i+=e[l]*this.min[l],a+=e[l]*this.max[l]):(a+=e[l]*this.min[l],i+=e[l]*this.max[l]);return i>=0?2:a<0?0:1}}class sa{distanceToTile2d(e,i,a,l){const h=l.distanceX([e,i]),m=l.distanceY([e,i]);return Math.hypot(h,m)}getWrap(e,i,a){return a}getTileAABB(e,i,a,l){var h,m;let v=a,x=a;if(l.terrain){const I=new o.S(e.z,i,e.z,e.x,e.y),k=l.terrain.getMinMaxElevation(I);v=(h=k.minElevation)!==null&&h!==void 0?h:a,x=(m=k.maxElevation)!==null&&m!==void 0?m:a}const P=1<<e.z;return new Ut([i+e.x/P,e.y/P,v],[i+(e.x+1)/P,(e.y+1)/P,x])}allowVariableZoom(e,i){const a=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,l=o.ab(78.5-a/2,0,60);return!!i.terrain||e.pitch>l||e.padding.top>=.1}allowWorldCopies(){return!0}recalculateCache(){}}class Ur{constructor(e,i,a){this.points=e,this.planes=i,this.aabb=a}static fromInvProjectionMatrix(e,i=1,a=0){const l=Math.pow(2,a),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const I=1/(P=o.al([],P,e))[3]/i*l;return o.aO(P,P,[I,I,1/P[3],I])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const I=o.aP([],h[P[0]],h[P[1]]),k=o.aP([],h[P[2]],h[P[1]]),D=o.aQ([],o.aR([],I,k)),B=-o.aS(D,h[P[1]]);return D.concat(B)}),v=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],x=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const P of h)for(let I=0;I<3;I++)v[I]=Math.min(v[I],P[I]),x[I]=Math.max(x[I],P[I]);return new Ur(h,m,new Ut(v,x))}}class Qr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,a=!0){this._helper.resize(e,i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,i){}constructor(e,i,a,l,h){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Kn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(m,v)=>this.getConstrained(m,v)},e,i,a,l,h),this._coveringTilesDetailsProvider=new sa}clone(){const e=new Qr;return e.apply(this),e}apply(e,i,a){this._helper.apply(e,i,a)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new o.aT(0,e)];if(this._helper._renderWorldCopies){const a=this.screenPointToMercatorCoordinate(new o.P(0,0)),l=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),h=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),m=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),v=Math.floor(Math.min(a.x,l.x,h.x,m.x)),x=Math.floor(Math.max(a.x,l.x,h.x,m.x)),P=1;for(let I=v-P;I<=x+P;I++)I!==0&&i.push(new o.aT(I,e))}return i}getCameraFrustum(){return Ur.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const i=this.screenPointToLocation(this.centerPoint,e),a=e?e.getElevationForLngLatZoom(i,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(a)}setLocationAtPoint(e,i){const a=o.aH(this.elevation,this.center.lat),l=this.screenPointToMercatorCoordinateAtZ(i,a),h=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,a),m=o.Y.fromLngLat(e),v=new o.Y(m.x-(l.x-h.x),m.y-(l.y-h.y));this.setCenter(v==null?void 0:v.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(o.Y.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.Y.fromLngLat(e))}screenPointToLocation(e,i){var a;return(a=this.screenPointToMercatorCoordinate(e,i))===null||a===void 0?void 0:a.toLngLat()}screenPointToMercatorCoordinate(e,i){if(i){const a=i.pointCoordinate(e);if(a!=null)return a}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const a=i||0,l=[e.x,e.y,0,1],h=[e.x,e.y,1,1];o.al(l,l,this._pixelMatrixInverse),o.al(h,h,this._pixelMatrixInverse);const m=l[3],v=h[3],x=l[1]/m,P=h[1]/v,I=l[2]/m,k=h[2]/v,D=I===k?0:(a-I)/(k-I);return new o.Y(o.y.number(l[0]/m,h[0]/v,D)/this.worldSize,o.y.number(x,P,D)/this.worldSize,a)}coordinatePoint(e,i=0,a=this._pixelMatrix){const l=[e.x*this.worldSize,e.y*this.worldSize,i,1];return o.al(l,l,a),new o.P(l[0]/l[3],l[1]/l[3])}getBounds(){const e=Math.max(0,this._helper._height/2-ei(this));return new oi().extend(this.screenPointToLocation(new o.P(0,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(e,i){return i?i.pointCoordinate(e)!=null:e.y>this.height/2-ei(this)}calculatePosMatrix(e,i=!1,a){var l;const h=(l=e.key)!==null&&l!==void 0?l:o.aU(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),m=i?this._alignedPosMatrixCache:this._posMatrixCache;if(m.has(h)){const P=m.get(h);return a?P.f32:P.f64}const v=al(e,this.worldSize);o.L(v,i?this._alignedProjMatrix:this._viewProjMatrix,v);const x={f64:v,f32:new Float32Array(v)};return m.set(h,x),a?x.f32:x.f64}calculateFogMatrix(e){const i=e.key,a=this._fogMatrixCacheF32;if(a.has(i))return a.get(i);const l=al(e,this.worldSize);return o.L(l,this._fogMatrix,l),a.set(i,new Float32Array(l)),a.get(i)}getConstrained(e,i){i=o.ab(+i,this.minZoom,this.maxZoom);const a={center:new o.N(e.lng,e.lat),zoom:i};let l=this._helper._lngRange;this._helper._renderWorldCopies||l!==null||(l=[-179.9999999999,180-1e-10]);const h=this.tileSize*o.aG(a.zoom);let m=0,v=h,x=0,P=h,I=0,k=0;const{x:D,y:B}=this.size;if(this._helper._latRange){const re=this._helper._latRange;m=o.Q(re[1])*h,v=o.Q(re[0])*h,v-m<B&&(I=B/(v-m))}l&&(x=o.aI(o.O(l[0])*h,0,h),P=o.aI(o.O(l[1])*h,0,h),P<x&&(P+=h),P-x<D&&(k=D/(P-x)));const{x:N,y:H}=si(h,e);let G,W;const Y=Math.max(k||0,I||0);if(Y){const re=new o.P(k?(P+x)/2:N,I?(v+m)/2:H);return a.center=yi(h,re).wrap(),a.zoom+=o.a8(Y),a}if(this._helper._latRange){const re=B/2;H-re<m&&(W=m+re),H+re>v&&(W=v-re)}if(l){const re=(x+P)/2;let ne=N;this._helper._renderWorldCopies&&(ne=o.aI(N,re-h/2,re+h/2));const ae=D/2;ne-ae<x&&(G=x+ae),ne+ae>P&&(G=P-ae)}if(G!==void 0||W!==void 0){const re=new o.P(G??N,W??H);a.center=yi(h,re).wrap()}return a}calculateCenterFromCameraLngLatAlt(e,i,a,l){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,l)}_calculateNearFarZIfNeeded(e,i,a){if(!this._helper.autoCalculateNearFarZ)return;const l=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),h=e-l*this._helper._pixelPerMeter/Math.cos(i),m=l<0?h:e,v=Math.PI/2+this.pitchInRadians,x=o.aa(this.fov)*(Math.abs(Math.cos(o.aa(this.roll)))*this.height+Math.abs(Math.sin(o.aa(this.roll)))*this.width)/this.height*(.5+a.y/this.height),P=Math.sin(x)*m/Math.sin(o.ab(Math.PI-v-x,.01,Math.PI-.01)),I=ei(this),k=Math.atan(I/this._helper.cameraToCenterDistance),D=o.aa(.75),B=k>D?2*k*(.5+a.y/(2*I)):D,N=Math.sin(B)*m/Math.sin(o.ab(Math.PI-v-B,.01,Math.PI-.01)),H=Math.min(P,N);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*H+m),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=si(this.worldSize,this.center),a=i.x,l=i.y;this._helper._pixelPerMeter=o.aH(1,this.center.lat)*this.worldSize;const h=o.aa(Math.min(this.pitch,89.25)),m=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(h));let v;this._calculateNearFarZIfNeeded(m,h,e),v=new Float64Array(16),o.aV(v,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.an(this._invProjMatrix,v),v[8]=2*-e.x/this._helper._width,v[9]=2*e.y/this._helper._height,this._projectionMatrix=o.aW(v),o.K(v,v,[1,-1,1]),o.J(v,v,[0,0,-this._helper.cameraToCenterDistance]),o.aX(v,v,-this.rollInRadians),o.aY(v,v,this.pitchInRadians),o.aX(v,v,-this.bearingInRadians),o.J(v,v,[-a,-l,0]),this._mercatorMatrix=o.K([],v,[this.worldSize,this.worldSize,this.worldSize]),o.K(v,v,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,v),o.J(v,v,[0,0,-this.elevation]),this._viewProjMatrix=v,this._invViewProjMatrix=o.an([],v);const x=[0,0,-1,1];o.al(x,x,this._invViewProjMatrix),this._cameraPosition=[x[0]/x[3],x[1]/x[3],x[2]/x[3]],this._fogMatrix=new Float64Array(16),o.aV(this._fogMatrix,this.fovInRadians,this.width/this.height,m,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,o.K(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.J(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.aX(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.aY(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.aX(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.J(this._fogMatrix,this._fogMatrix,[-a,-l,0]),o.K(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.J(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,v);const P=this._helper._width%2/2,I=this._helper._height%2/2,k=Math.cos(this.bearingInRadians),D=Math.sin(-this.bearingInRadians),B=a-Math.round(a)+k*P+D*I,N=l-Math.round(l)+k*I+D*P,H=new Float64Array(v);if(o.J(H,H,[B>.5?B-1:B,N>.5?N-1:N,0]),this._alignedProjMatrix=H,v=o.an(new Float64Array(16),this._pixelMatrix),!v)throw new Error("failed to invert matrix");this._pixelMatrixInverse=v,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new o.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.al(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=o.aH(1,this.center.lat)*this.worldSize;return Ni(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const a=o.Y.fromLngLat(e),l=[a.x*this.worldSize,a.y*this.worldSize,i,1];return o.al(l,l,this._viewProjMatrix),l[2]/l[3]}getProjectionData(e){const{overscaledTileID:i,aligned:a,applyTerrainMatrix:l}=e,h=this._helper.getMercatorTileCoordinates(i),m=i?this.calculatePosMatrix(i,a,!0):null;let v;return v=i&&i.terrainRttPosMatrix32f&&l?i.terrainRttPosMatrix32f:m||o.aZ(),{mainMatrix:v,tileMercatorCoords:h,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:v}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,i,a){return 1}transformLightDirection(e){return o.aN(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,a,l){const h=this.calculatePosMatrix(a);let m;l?(m=[e,i,l(e,i),1],o.al(m,m,h)):(m=[e,i,0,1],hi(m,m,h));const v=m[3];return{point:new o.P(m[0]/v,m[1]/v),signedDistanceFromCamera:v,isOccluded:!1}}populateCache(e){for(const i of e)this.calculatePosMatrix(i)}getMatrixForModel(e,i){const a=o.Y.fromLngLat(e,i),l=a.meterInMercatorCoordinateUnits(),h=o.a_();return o.J(h,h,[a.x,a.y,a.z]),o.aX(h,h,Math.PI),o.aY(h,h,Math.PI/2),o.K(h,h,[-l,l,l]),h}getProjectionDataForCustomLayer(e=!0){const i=new o.S(0,0,0,0,0),a=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),l=al(i,this.worldSize);o.L(l,this._viewProjMatrix,l),a.tileMercatorCoords=[0,0,1,1];const h=[o.X,o.X,this.worldSize/this._helper.pixelsPerMeter],m=o.a$();return o.K(m,l,h),a.fallbackMatrix=m,a.mainMatrix=m,a}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function br(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ll(u){if(u.useSlerp)if(u.k<1){const e=o.b0(u.startEulerAngles.roll,u.startEulerAngles.pitch,u.startEulerAngles.bearing),i=o.b0(u.endEulerAngles.roll,u.endEulerAngles.pitch,u.endEulerAngles.bearing),a=new Float64Array(4);o.b1(a,e,i,u.k);const l=o.b2(a);u.tr.setRoll(l.roll),u.tr.setPitch(l.pitch),u.tr.setBearing(l.bearing)}else u.tr.setRoll(u.endEulerAngles.roll),u.tr.setPitch(u.endEulerAngles.pitch),u.tr.setBearing(u.endEulerAngles.bearing);else u.tr.setRoll(o.y.number(u.startEulerAngles.roll,u.endEulerAngles.roll,u.k)),u.tr.setPitch(o.y.number(u.startEulerAngles.pitch,u.endEulerAngles.pitch,u.k)),u.tr.setBearing(o.y.number(u.startEulerAngles.bearing,u.endEulerAngles.bearing,u.k))}function en(u,e,i,a,l){const h=l.padding,m=si(l.worldSize,i.getNorthWest()),v=si(l.worldSize,i.getNorthEast()),x=si(l.worldSize,i.getSouthEast()),P=si(l.worldSize,i.getSouthWest()),I=o.aa(-a),k=m.rotate(I),D=v.rotate(I),B=x.rotate(I),N=P.rotate(I),H=new o.P(Math.max(k.x,D.x,N.x,B.x),Math.max(k.y,D.y,N.y,B.y)),G=new o.P(Math.min(k.x,D.x,N.x,B.x),Math.min(k.y,D.y,N.y,B.y)),W=H.sub(G),Y=(l.width-(h.left+h.right+e.left+e.right))/W.x,re=(l.height-(h.top+h.bottom+e.top+e.bottom))/W.y;if(re<0||Y<0)return void br();const ne=Math.min(o.a8(l.scale*Math.min(Y,re)),u.maxZoom),ae=o.P.convert(u.offset),ce=new o.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(o.aa(a)),le=ae.add(ce).mult(l.scale/o.aG(ne));return{center:yi(l.worldSize,m.add(x).div(2).sub(le)),zoom:ne,bearing:a}}class qa{get useGlobeControls(){return!1}handlePanInertia(e,i){return{easingOffset:e,easingCenter:i.center}}handleMapControlsRollPitchBearingZoom(e,i){e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta),e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta)}handleMapControlsPan(e,i,a){e.around.distSqr(i.centerPoint)<.01||i.setLocationAtPoint(a,e.around)}cameraForBoxAndBearing(e,i,a,l,h){return en(e,i,a,l,h)}handleJumpToCenterZoom(e,i){e.zoom!==(i.zoom!==void 0?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),i.center!==void 0&&e.setCenter(o.N.convert(i.center))}handleEaseTo(e,i){const a=e.zoom,l=e.padding,h={roll:e.roll,pitch:e.pitch,bearing:e.bearing},m={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},v=i.zoom!==void 0,x=!e.isPaddingEqual(i.padding);let P=!1;const I=v?+i.zoom:e.zoom;let k=e.centerPoint.add(i.offsetAsPoint);const D=e.screenPointToLocation(k),{center:B,zoom:N}=e.getConstrained(o.N.convert(i.center||D),I??a);Ui(e,B);const H=si(e.worldSize,D),G=si(e.worldSize,B).sub(H),W=o.aG(N-a);return P=N!==a,{easeFunc:Y=>{if(P&&e.setZoom(o.y.number(a,N,Y)),o.b3(h,m)||ll({startEulerAngles:h,endEulerAngles:m,tr:e,k:Y,useSlerp:h.roll!=m.roll}),x&&(e.interpolatePadding(l,i.padding,Y),k=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const re=o.aG(e.zoom-a),ne=N>a?Math.min(2,W):Math.max(.5,W),ae=Math.pow(ne,1-Y),ce=yi(e.worldSize,H.add(G.mult(Y*ae)).mult(re));e.setLocationAtPoint(e.renderWorldCopies?ce.wrap():ce,k)}},isZooming:P,elevationCenter:B}}handleFlyTo(e,i){const a=i.zoom!==void 0,l=e.zoom,h=e.getConstrained(o.N.convert(i.center||i.locationAtOffset),a?+i.zoom:l),m=h.center,v=h.zoom;Ui(e,m);const x=si(e.worldSize,i.locationAtOffset),P=si(e.worldSize,m).sub(x),I=P.mag(),k=o.aG(v-l);let D;if(i.minZoom!==void 0){const B=Math.min(+i.minZoom,l,v),N=e.getConstrained(m,B).zoom;D=o.aG(N-l)}return{easeFunc:(B,N,H,G)=>{e.setZoom(B===1?v:l+o.a8(N));const W=B===1?m:yi(e.worldSize,x.add(P.mult(H)).mult(N));e.setLocationAtPoint(e.renderWorldCopies?W.wrap():W,G)},scaleOfZoom:k,targetCenter:m,scaleOfMinZoom:D,pixelPathLength:I}}}class $t{constructor(e,i,a){this.blendFunction=e,this.blendColor=i,this.mask=a}}$t.Replace=[1,0],$t.disabled=new $t($t.Replace,o.b4.transparent,[!1,!1,!1,!1]),$t.unblended=new $t($t.Replace,o.b4.transparent,[!0,!0,!0,!0]),$t.alphaBlended=new $t([1,771],o.b4.transparent,[!0,!0,!0,!0]);const Ps=2305;class Tt{constructor(e,i,a){this.enable=e,this.mode=i,this.frontFace=a}}Tt.disabled=new Tt(!1,1029,Ps),Tt.backCCW=new Tt(!0,1029,Ps),Tt.frontCCW=new Tt(!0,1028,Ps);class gt{constructor(e,i,a){this.func=e,this.mask=i,this.range=a}}gt.ReadOnly=!1,gt.ReadWrite=!0,gt.disabled=new gt(519,gt.ReadOnly,[0,1]);const aa=7680;class St{constructor(e,i,a,l,h,m){this.test=e,this.ref=i,this.mask=a,this.fail=l,this.depthFail=h,this.pass=m}}St.disabled=new St({func:519,mask:0},0,0,aa,aa,aa);const Ss=new WeakMap;function kr(u){var e;if(Ss.has(u))return Ss.get(u);{const i=(e=u.getParameter(u.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ss.set(u,i),i}}class oa{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,a=i.gl;this._texFormat=a.RGBA,this._texType=a.UNSIGNED_BYTE;const l=new o.aC;l.emplaceBack(-1,-1),l.emplaceBack(2,-1),l.emplaceBack(-1,2);const h=new o.aE;h.emplaceBack(0,1,2),this._fullscreenTriangle=new Vr(i.createVertexBuffer(l,bt.members),i.createIndexBuffer(h),o.aD.simpleSegment(0,0,l.length,h.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(a.TEXTURE1);const m=a.createTexture();a.bindTexture(a.TEXTURE_2D,m),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(m),kr(a)&&(this._pbo=a.createBuffer(),a.bindBuffer(a.PIXEL_PACK_BUFFER,this._pbo),a.bufferData(a.PIXEL_PACK_BUFFER,4,a.STREAM_READ),a.bindBuffer(a.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,i){const a=this._updateCount;return this._readbackQueue?a>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():a>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,i),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,i=e.gl;e.activeTexture.set(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const a=this._cachedRenderContext.context,l=a.gl;if(this._bindFramebuffer(),a.viewport.set([0,0,this._texWidth,this._texHeight]),a.clear({color:o.b4.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(a,l.TRIANGLES,gt.disabled,St.disabled,$t.unblended,Tt.disabled,((h,m)=>({u_input:h,u_output_expected:m}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&kr(l)){l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.readBuffer(l.COLOR_ATTACHMENT0),l.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null);const h=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0);l.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:h}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&kr(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=oa._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let i=0;return i+=e[0]/256,i+=e[1]/65536,i+=e[2]/16777216,e[3]<127&&(i=-i),i/128}}const la=o.X/128;function ca(u,e){const i=u.granularity!==void 0?Math.max(u.granularity,1):1,a=i+(u.generateBorders?2:0),l=i+(u.extendToNorthPole||u.generateBorders?1:0)+(u.extendToSouthPole||u.generateBorders?1:0),h=a+1,m=l+1,v=u.generateBorders?-1:0,x=u.generateBorders||u.extendToNorthPole?-1:0,P=i+(u.generateBorders?1:0),I=i+(u.generateBorders||u.extendToSouthPole?1:0),k=h*m,D=a*l*6,B=h*m>65536;if(B&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const N=B||e==="32bit",H=new Int16Array(2*k);let G=0;for(let re=x;re<=I;re++)for(let ne=v;ne<=P;ne++){let ae=ne/i*o.X;ne===-1&&(ae=-64),ne===i+1&&(ae=o.X+la);let ce=re/i*o.X;re===-1&&(ce=u.extendToNorthPole?o.b6:-64),re===i+1&&(ce=u.extendToSouthPole?o.b7:o.X+la),H[G++]=ae,H[G++]=ce}const W=N?new Uint32Array(D):new Uint16Array(D);let Y=0;for(let re=0;re<l;re++)for(let ne=0;ne<a;ne++){const ae=ne+1+re*h,ce=ne+(re+1)*h,le=ne+1+(re+1)*h;W[Y++]=ne+re*h,W[Y++]=ce,W[Y++]=ae,W[Y++]=ae,W[Y++]=ce,W[Y++]=le}return{vertices:H.buffer.slice(0),indices:W.buffer.slice(0),uses32bitIndices:N}}const Yn=new o.aB({fill:new o.b8(128,2),line:new o.b8(512,0),tile:new o.b8(128,32),stencil:new o.b8(128,1),circle:3});class Jc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Nr.projectionGlobe}get vertexShaderPreludeCode(){return Nr.projectionMercator.vertexSource}get subdivisionGranularity(){return Yn}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new oa(e));const i=o.Q(this._errorQueryLatitudeDegrees),a=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,l=this._errorMeasurement.updateErrorLoop(i,a),h=ie.now();l!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=l,this._errorMeasurementLastChangeTime=h);const m=Math.min(Math.max((h-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.b9(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.ba(m))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,i,a,l,h){const m=(h==="stencil"?Yn.stencil:Yn.tile).getGranularityForZoomLevel(i.z);return this._getMesh(e,{granularity:m,generateBorders:a,extendToNorthPole:i.y===0&&l,extendToSouthPole:i.y===(1<<i.z)-1&&l})}_getMesh(e,i){const a=this._getMeshKey(i);if(a in this._tileMeshCache)return this._tileMeshCache[a];const l=function(h,m){const v=ca(m,"16bit"),x=o.aC.deserialize({arrayBuffer:v.vertices,length:v.vertices.byteLength/2/2}),P=o.aE.deserialize({arrayBuffer:v.indices,length:v.indices.byteLength/2/3});return new Vr(h.createVertexBuffer(x,bt.members),h.createIndexBuffer(P),o.aD.simpleSegment(0,0,x.length,P.length))}(e,i);return this._tileMeshCache[a]=l,l}recalculate(e){}hasTransition(){const e=ie.now();let i=!1;return i=i||(e-this._errorMeasurementLastChangeTime)/1e3<.7,i=i||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,i}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const cl=new o.q({type:new o.D(o.v.projection.type)});class ul extends o.E{constructor(e){super(),this._transitionable=new o.T(cl),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.z(0)),this._mercatorProjection=new na,this._verticalPerspectiveProjection=new Jc}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof o.bb){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,i,a,l,h){return this.currentProjection.getMeshFromTileID(e,i,a,l,h)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Qc(u){const e=Cs(u.worldSize,u.center.lat);return 2*Math.PI*e}function ua(u,e,i,a,l){const h=1/(1<<l),m=e/o.X*h+a*h,v=o.bd((u/o.X*h+i*h)*Math.PI*2+Math.PI,2*Math.PI),x=2*Math.atan(Math.exp(Math.PI-m*Math.PI*2))-.5*Math.PI,P=Math.cos(x),I=new Float64Array(3);return I[0]=Math.sin(v)*P,I[1]=Math.sin(x),I[2]=Math.cos(v)*P,I}function Ot(u){return function(e,i){const a=Math.cos(i),l=new Float64Array(3);return l[0]=Math.sin(e)*a,l[1]=Math.sin(i),l[2]=Math.cos(e)*a,l}(u.lng*Math.PI/180,u.lat*Math.PI/180)}function Cs(u,e){return u/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Ar(u){const e=Math.asin(u[1])/Math.PI*180,i=Math.sqrt(u[0]*u[0]+u[2]*u[2]);if(i>1e-6){const a=u[0]/i,l=Math.acos(u[2]/i),h=(a>0?l:-l)/Math.PI*180;return new o.N(o.aI(h,-180,180),e)}return new o.N(0,e)}function Jn(u){return Math.cos(u*Math.PI/180)}function vi(u,e){const i=Jn(u),a=Jn(e);return o.a8(a/i)}function hl(u,e){const i=u.rotate(e.bearingInRadians),a=e.zoom+vi(e.center.lat,0),l=o.b9(1/Jn(e.center.lat),1/Jn(Math.min(Math.abs(e.center.lat),60)),o.bc(a,7,3,0,1)),h=360/Qc({worldSize:e.worldSize,center:{lat:e.center.lat}});return new o.N(e.center.lng-i.x*h*l,o.ab(e.center.lat+i.y*h,-85.051129,o.aF))}function xn(u){const e=.5*u,i=Math.sin(e),a=Math.cos(e);return Math.log(i+a)-Math.log(a-i)}function eu(u,e,i,a){const l=u.lat+i*a;if(Math.abs(i)>1){const h=(Math.sign(u.lat+i)!==Math.sign(u.lat)?-Math.abs(u.lat):Math.abs(u.lat))*Math.PI/180,m=Math.abs(u.lat+i)*Math.PI/180,v=xn(h+a*(m-h)),x=xn(h),P=xn(m);return new o.N(u.lng+e*((v-x)/(P-x)),l)}return new o.N(u.lng+e*a,l)}class Kh{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,i,a,l){const h=`${e.z}_${e.x}_${e.y}`,m=this._cache.get(h);if(m)return m;const v=this._cachePrevious.get(h);if(v)return this._cache.set(h,v),v;const x=this._aabbFactory(e,i,a,l);return this._cache.set(h,x),this._hadAnyChanges=!0,x}}function Za(u,e,i){const a=u-e;return a<0?-a:Math.max(0,a-i)}function dl(u,e,i,a,l){const h=u-i;let m;return m=h<0?Math.min(-h,1+h-l):h>1?Math.min(Math.max(h-l,0),1-h):0,Math.max(m,Za(e,a,l))}class Yh{constructor(){this._aabbCache=new Kh(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,i,a,l){const h=1<<a.z,m=1/h,v=a.x/h,x=a.y/h;let P=2;return P=Math.min(P,dl(e,i,v,x,m)),P=Math.min(P,dl(e,i,v+.5,-x-m,m)),P=Math.min(P,dl(e,i,v+.5,2-x-m,m)),P}getWrap(e,i,a){const l=1<<i.z,h=1/l,m=i.x/l,v=Za(e.x,m,h),x=Za(e.x,m-1,h),P=Za(e.x,m+1,h),I=Math.min(v,x,P);return I===P?1:I===x?-1:0}allowVariableZoom(e,i){return vn(e,i)>4}allowWorldCopies(){return!1}getTileAABB(e,i,a,l){return this._aabbCache.getTileAABB(e,i,a,l)}_computeTileAABB(e,i,a,l){if(e.z<=0)return new Ut([-1,-1,-1],[1,1,1]);if(e.z===1)return new Ut([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{const h=[ua(0,0,e.x,e.y,e.z),ua(o.X,0,e.x,e.y,e.z),ua(o.X,o.X,e.x,e.y,e.z),ua(0,o.X,e.x,e.y,e.z)],m=[1,1,1],v=[-1,-1,-1];for(const x of h)for(let P=0;P<3;P++)m[P]=Math.min(m[P],x[P]),v[P]=Math.max(v[P],x[P]);if(e.y===0||e.y===(1<<e.z)-1){const x=[0,e.y===0?1:-1,0];for(let P=0;P<3;P++)m[P]=Math.min(m[P],x[P]),v[P]=Math.max(v[P],x[P])}return new Ut(m,v)}}}class Ga{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i){this._helper.resize(e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=o.be(),this._projectionMatrix=o.a_(),this._globeViewProjMatrix32f=o.aZ(),this._globeViewProjMatrixNoCorrection=o.a_(),this._globeViewProjMatrixNoCorrectionInverted=o.a_(),this._globeProjMatrixInverted=o.a_(),this._cameraPosition=o.bf(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Kn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._coveringTilesDetailsProvider=new Yh}clone(){const e=new Ga;return e.apply(this),e}apply(e,i){this._globeLatitudeErrorCorrectionRadians=i||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=o.bf();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:i,applyGlobeMatrix:a}=e,l=this._helper.getMercatorTileCoordinates(i);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:l,clippingPlane:this._cachedClippingPlane,projectionTransition:a?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,a=this.cameraToCenterDistance/e,l=Math.sin(i)*a,h=Math.cos(i)*a+1,m=1/Math.sqrt(l*l+h*h)*1;let v=-l,x=h;const P=Math.sqrt(v*v+x*x);v/=P,x/=P;const I=[0,v,x];return o.bg(I,I,[0,0,0],-this.bearingInRadians),o.bh(I,I,[0,0,0],-1*this.center.lat*Math.PI/180),o.bi(I,I,[0,0,0],this.center.lng*Math.PI/180),o.aL(I,I,.25),[...I,.25*-m]}isLocationOccluded(e){return!this.isSurfacePointVisible(Ot(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,a=this._helper._center.lat*Math.PI/180,l=Math.cos(a),h=[Math.sin(i)*l,Math.sin(a),Math.cos(i)*l],m=[h[2],0,-h[0]],v=[0,0,0];o.aR(v,m,h),o.aQ(m,m),o.aQ(v,v);const x=[0,0,0];return o.aQ(x,[m[0]*e[0]+v[0]*e[1]+h[0]*e[2],m[1]*e[0]+v[1]*e[1]+h[1]*e[2],m[2]*e[0]+v[2]*e[1]+h[2]*e[2]]),x}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,a){const l=function(v,x,P){const I=1/(1<<P.z);return new o.Y(v/o.X*I+P.x*I,x/o.X*I+P.y*I)}(e,i,a.canonical),h=(m=l.y,[o.bd(l.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-m*Math.PI*2))-.5*Math.PI]);var m;return this.getCircleRadiusCorrection()/Math.cos(h[1])}projectTileCoordinates(e,i,a,l){const h=a.canonical,m=ua(e,i,h.x,h.y,h.z),v=1+(l?l(e,i):0)/o.bo,x=[m[0]*v,m[1]*v,m[2]*v,1];o.al(x,x,this._globeViewProjMatrixNoCorrection);const P=this._cachedClippingPlane,I=P[0]*m[0]+P[1]*m[1]+P[2]*m[2]+P[3]<0;return{point:new o.P(x[0]/x[3],x[1]/x[3]),signedDistanceFromCamera:x[3],isOccluded:I}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Cs(this.worldSize,this.center.lat),i=o.a$(),a=o.a$();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),o.aV(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const l=this.centerOffset;i[8]=2*-l.x/this._helper._width,i[9]=2*l.y/this._helper._height,this._projectionMatrix=o.aW(i),this._globeProjMatrixInverted=o.a$(),o.an(this._globeProjMatrixInverted,i),o.J(i,i,[0,0,-this.cameraToCenterDistance]),o.aX(i,i,this.rollInRadians),o.aY(i,i,-this.pitchInRadians),o.aX(i,i,this.bearingInRadians),o.J(i,i,[0,0,-e]);const h=o.bf();h[0]=e,h[1]=e,h[2]=e,o.aY(a,i,this.center.lat*Math.PI/180),o.bj(a,a,-this.center.lng*Math.PI/180),o.K(a,a,h),this._globeViewProjMatrixNoCorrection=a,o.aY(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bj(i,i,-this.center.lng*Math.PI/180),o.K(i,i,h),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=o.a$(),o.an(this._globeViewProjMatrixNoCorrectionInverted,a);const m=o.bf();this._cameraPosition=o.bf(),this._cameraPosition[2]=this.cameraToCenterDistance/e,o.bg(this._cameraPosition,this._cameraPosition,m,-this.rollInRadians),o.bh(this._cameraPosition,this._cameraPosition,m,this.pitchInRadians),o.bg(this._cameraPosition,this._cameraPosition,m,-this.bearingInRadians),o.aM(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bh(this._cameraPosition,this._cameraPosition,m,-this.center.lat*Math.PI/180),o.bi(this._cameraPosition,this._cameraPosition,m,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const v=o.aW(this._globeViewProjMatrixNoCorrectionInverted);o.K(v,v,[1,1,-1]),this._cachedFrustum=Ur.fromInvProjectionMatrix(v)}calculateFogMatrix(e){o.w("calculateFogMatrix is not supported on globe projection.");const i=o.a$();return o.aq(i),i}getVisibleUnwrappedCoordinates(e){return[new o.aT(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const a=Ot(e);o.aL(a,a,1+i/o.bo);const l=o.be();return o.al(l,[a[0],a[1],a[2],1],this._globeViewProjMatrixNoCorrection),l[2]/l[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,a=[new o.P(0,0),new o.P(e,0),new o.P(this.width,0),new o.P(this.width,i),new o.P(this.width,this.height),new o.P(e,this.height),new o.P(0,this.height),new o.P(0,i)],l=[];for(const k of a)l.push(this.unprojectScreenPoint(k));let h=0,m=0,v=0,x=0;const P=this.center;for(const k of l){const D=o.bk(P.lng,k.lng),B=o.bk(P.lat,k.lat);D<m&&(m=D),D>h&&(h=D),B<x&&(x=B),B>v&&(v=B)}const I=[P.lng+m,P.lat+x,P.lng+h,P.lat+v];return this.isSurfacePointOnScreen([0,1,0])&&(I[3]=90,I[0]=-180,I[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(I[1]=-90,I[0]=-180,I[2]=180),new oi(I)}getConstrained(e,i){const a=o.ab(e.lat,-85.051129,o.aF),l=o.ab(+i,this.minZoom+vi(0,a),this.maxZoom);return{center:new o.N(e.lng,a),zoom:l}}calculateCenterFromCameraLngLatAlt(e,i,a,l){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,l)}setLocationAtPoint(e,i){const a=Ot(this.unprojectScreenPoint(i)),l=Ot(e),h=o.bf();o.bl(h);const m=o.bf();o.bi(m,a,h,-this.center.lng*Math.PI/180),o.bh(m,m,h,this.center.lat*Math.PI/180);const v=l[0]*l[0]+l[2]*l[2],x=m[0]*m[0];if(v<x)return;const P=Math.sqrt(v-x),I=-P,k=o.bm(l[0],l[2],m[0],P),D=o.bm(l[0],l[2],m[0],I),B=o.bf();o.bi(B,l,h,-k);const N=o.bm(B[1],B[2],m[1],m[2]),H=o.bf();o.bi(H,l,h,-D);const G=o.bm(H[1],H[2],m[1],m[2]),W=.5*Math.PI,Y=N>=-W&&N<=W,re=G>=-W&&G<=W;let ne,ae;if(Y&&re){const be=this.center.lng*Math.PI/180,Ie=this.center.lat*Math.PI/180;o.bp(k,be)+o.bp(N,Ie)<o.bp(D,be)+o.bp(G,Ie)?(ne=k,ae=N):(ne=D,ae=G)}else if(Y)ne=k,ae=N;else{if(!re)return;ne=D,ae=G}const ce=ne/Math.PI*180,le=ae/Math.PI*180,ye=this.center.lat;this.setCenter(new o.N(ce,o.ab(le,-90,90))),this.setZoom(this.zoom+vi(ye,this.center.lat))}locationToScreenPoint(e,i){const a=Ot(e);if(i){const l=i.getElevationForLngLatZoom(e,this._helper._tileZoom);o.aL(a,a,1+l/o.bo)}return this._projectSurfacePointToScreen(a)}_projectSurfacePointToScreen(e){const i=o.be();return o.al(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new o.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const a=i.pointCoordinate(e);if(a)return a}return o.Y.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,i){var a;return(a=this.screenPointToMercatorCoordinate(e,i))===null||a===void 0?void 0:a.toLngLat()}isPointOnMapSurface(e,i){const a=this._cameraPosition,l=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(a,l)}getRayDirectionFromPixel(e){const i=o.be();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,o.al(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const a=o.bf();a[0]=i[0]-this._cameraPosition[0],a[1]=i[1]-this._cameraPosition[1],a[2]=i[2]-this._cameraPosition[2];const l=o.bf();return o.aQ(l,a),l}isSurfacePointVisible(e){const i=this._cachedClippingPlane;return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=o.be();return o.al(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const a=o.aS(e,i),l=o.bf(),h=o.bf();o.aL(h,i,a),o.aP(l,e,h);const m=1-o.aS(l,l);if(m<0)return null;const v=o.aS(e,e)-1,x=-a+(a<0?1:-1)*Math.sqrt(m),P=v/x,I=x;return{tMin:Math.min(P,I),tMax:Math.max(P,I)}}unprojectScreenPoint(e){const i=this._cameraPosition,a=this.getRayDirectionFromPixel(e),l=this.rayPlanetIntersection(i,a);if(l){const P=o.bf();o.aM(P,i,[a[0]*l.tMin,a[1]*l.tMin,a[2]*l.tMin]);const I=o.bf();return o.aQ(I,P),Ar(I)}const h=this._cachedClippingPlane[0]*a[0]+this._cachedClippingPlane[1]*a[1]+this._cachedClippingPlane[2]*a[2],m=-o.bn(this._cachedClippingPlane,i)/h,v=o.bf();if(m>0)o.aM(v,i,[a[0]*m,a[1]*m,a[2]*m]);else{const P=o.bf();o.aM(P,i,[2*a[0],2*a[1],2*a[2]]);const I=o.bn(this._cachedClippingPlane,P);o.aP(v,P,[this._cachedClippingPlane[0]*I,this._cachedClippingPlane[1]*I,this._cachedClippingPlane[2]*I])}const x=o.bf();return o.aQ(x,v),Ar(x)}getMatrixForModel(e,i){const a=o.N.convert(e),l=1/o.bo,h=o.a_();return o.bj(h,h,a.lng/180*Math.PI),o.aY(h,h,-a.lat/180*Math.PI),o.J(h,h,[0,0,1+i/o.bo]),o.aY(h,h,.5*Math.PI),o.K(h,h,[l,l,l]),h}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new o.S(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class Qn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,i,a){return this._helper.interpolatePadding(e,i,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,i,a=!0){this._helper.resize(e,i,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,i){this._helper.overrideNearFarZ(e,i)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,i){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=i,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Kn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,i)=>this.getConstrained(e,i)}),this._globeness=1,this._mercatorTransform=new Qr,this._verticalPerspectiveTransform=new Ga}clone(){const e=new Qn;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const i=this._mercatorTransform.getProjectionData(e),a=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?a.mainMatrix:i.mainMatrix,clippingPlane:a.clippingPlane,tileMercatorCoords:a.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:i.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return o.b9(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.b9(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,a){const l=this._mercatorTransform.getPitchedTextCorrection(e,i,a),h=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,a);return o.b9(l,h,this._globeness)}projectTileCoordinates(e,i,a,l){return this.currentTransform.projectTileCoordinates(e,i,a,l)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){return this.currentTransform.lngLatToCameraDepth(e,i)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,i){return this.currentTransform.getConstrained(e,i)}calculateCenterFromCameraLngLatAlt(e,i,a,l){return this._helper.calculateCenterFromCameraLngLatAlt(e,i,a,l)}setLocationAtPoint(e,i){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,i),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,i),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,i){return this.currentTransform.locationToScreenPoint(e,i)}screenPointToMercatorCoordinate(e,i){return this.currentTransform.screenPointToMercatorCoordinate(e,i)}screenPointToLocation(e,i){return this.currentTransform.screenPointToLocation(e,i)}isPointOnMapSurface(e,i){return this.currentTransform.isPointOnMapSurface(e,i)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,i){return this.currentTransform.getMatrixForModel(e,i)}getProjectionDataForCustomLayer(e=!0){const i=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return i;const a=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return a.fallbackMatrix=i.mainMatrix,a}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class cr{get useGlobeControls(){return!0}handlePanInertia(e,i){const a=hl(e,i);return Math.abs(a.lng-i.center.lng)>180&&(a.lng=i.center.lng+179.5*Math.sign(a.lng-i.center.lng)),{easingCenter:a,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const a=e.around,l=i.screenPointToLocation(a);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const h=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const m=i.zoom-h;if(m===0)return;const v=o.bk(i.center.lng,l.lng),x=v/(Math.abs(v/180)+1),P=o.bk(i.center.lat,l.lat),I=i.getRayDirectionFromPixel(a),k=i.cameraPosition,D=-1*o.aS(k,I),B=o.bf();o.aM(B,k,[I[0]*D,I[1]*D,I[2]*D]);const N=o.bq(B)-1,H=Math.exp(.5*-Math.max(N-.3,0)),G=Cs(i.worldSize,i.center.lat)/Math.min(i.width,i.height),W=o.bc(G,.9,.5,1,.25),Y=(1-o.aG(-m))*Math.min(H,W),re=i.center.lat,ne=i.zoom,ae=new o.N(i.center.lng+x*Y,o.ab(i.center.lat+P*Y,-85.051129,o.aF));i.setLocationAtPoint(l,a);const ce=i.center,le=o.bc(Math.abs(v),45,85,0,1),ye=o.bc(G,.75,.35,0,1),be=Math.pow(Math.max(le,ye),.25),Ie=o.bk(ce.lng,ae.lng),Ae=o.bk(ce.lat,ae.lat);i.setCenter(new o.N(ce.lng+Ie*be,ce.lat+Ae*be).wrap()),i.setZoom(ne+vi(re,i.center.lat))}handleMapControlsPan(e,i,a){if(!e.panDelta)return;const l=i.center.lat,h=i.zoom;i.setCenter(hl(e.panDelta,i).wrap()),i.setZoom(h+vi(l,i.center.lat))}cameraForBoxAndBearing(e,i,a,l,h){const m=en(e,i,a,l,h),v=i.left/h.width*2-1,x=(h.width-i.right)/h.width*2-1,P=i.top/h.height*-2+1,I=(h.height-i.bottom)/h.height*-2+1,k=o.bk(a.getWest(),a.getEast())<0,D=k?a.getEast():a.getWest(),B=k?a.getWest():a.getEast(),N=Math.max(a.getNorth(),a.getSouth()),H=Math.min(a.getNorth(),a.getSouth()),G=D+.5*o.bk(D,B),W=N+.5*o.bk(N,H),Y=h.clone();Y.setCenter(m.center),Y.setBearing(m.bearing),Y.setPitch(0),Y.setRoll(0),Y.setZoom(m.zoom);const re=Y.modelViewProjectionMatrix,ne=[Ot(a.getNorthWest()),Ot(a.getNorthEast()),Ot(a.getSouthWest()),Ot(a.getSouthEast()),Ot(new o.N(B,W)),Ot(new o.N(D,W)),Ot(new o.N(G,N)),Ot(new o.N(G,H))],ae=Ot(m.center);let ce=Number.POSITIVE_INFINITY;for(const le of ne)v<0&&(ce=cr.getLesserNonNegativeNonNull(ce,cr.solveVectorScale(le,ae,re,"x",v))),x>0&&(ce=cr.getLesserNonNegativeNonNull(ce,cr.solveVectorScale(le,ae,re,"x",x))),P>0&&(ce=cr.getLesserNonNegativeNonNull(ce,cr.solveVectorScale(le,ae,re,"y",P))),I<0&&(ce=cr.getLesserNonNegativeNonNull(ce,cr.solveVectorScale(le,ae,re,"y",I)));if(Number.isFinite(ce)&&ce!==0)return m.zoom=Y.zoom+o.a8(ce),m;br()}handleJumpToCenterZoom(e,i){const a=e.center.lat,l=e.getConstrained(i.center?o.N.convert(i.center):e.center,e.zoom).center;e.setCenter(l.wrap());const h=i.zoom!==void 0?+i.zoom:e.zoom+vi(a,l.lat);e.zoom!==h&&e.setZoom(h)}handleEaseTo(e,i){const a=e.zoom,l=e.center,h=e.padding,m={roll:e.roll,pitch:e.pitch,bearing:e.bearing},v={roll:i.roll===void 0?e.roll:i.roll,pitch:i.pitch===void 0?e.pitch:i.pitch,bearing:i.bearing===void 0?e.bearing:i.bearing},x=i.zoom!==void 0,P=!e.isPaddingEqual(i.padding);let I=!1;const k=i.center?o.N.convert(i.center):l,D=e.getConstrained(k,a).center;Ui(e,D);const B=e.clone();B.setCenter(D),B.setZoom(x?+i.zoom:a+vi(l.lat,k.lat)),B.setBearing(i.bearing);const N=new o.P(o.ab(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),o.ab(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));B.setLocationAtPoint(D,N);const H=(i.offset&&i.offsetAsPoint.mag())>0?B.center:D,G=x?+i.zoom:a+vi(l.lat,H.lat),W=a+vi(l.lat,0),Y=G+vi(H.lat,0),re=o.bk(l.lng,H.lng),ne=o.bk(l.lat,H.lat),ae=o.aG(Y-W);return I=G!==a,{easeFunc:ce=>{if(o.b3(m,v)||ll({startEulerAngles:m,endEulerAngles:v,tr:e,k:ce,useSlerp:m.roll!=v.roll}),P&&e.interpolatePadding(h,i.padding,ce),i.around)o.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const le=Y>W?Math.min(2,ae):Math.max(.5,ae),ye=Math.pow(le,1-ce),be=eu(l,re,ne,ce*ye);e.setCenter(be.wrap())}if(I){const le=o.y.number(W,Y,ce)+vi(0,e.center.lat);e.setZoom(le)}},isZooming:I,elevationCenter:H}}handleFlyTo(e,i){const a=i.zoom!==void 0,l=e.center,h=e.zoom,m=!e.isPaddingEqual(i.padding),v=e.getConstrained(o.N.convert(i.center||i.locationAtOffset),h).center,x=a?+i.zoom:e.zoom+vi(e.center.lat,v.lat),P=e.clone();P.setCenter(v),m&&P.setPadding(i.padding),P.setZoom(x),P.setBearing(i.bearing);const I=new o.P(o.ab(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),o.ab(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));P.setLocationAtPoint(v,I);const k=P.center;Ui(e,k);const D=function(re,ne,ae){const ce=Ot(ne),le=Ot(ae),ye=o.aS(ce,le),be=Math.acos(ye),Ie=Qc(re);return be/(2*Math.PI)*Ie}(e,l,k),B=h+vi(l.lat,0),N=x+vi(k.lat,0),H=o.aG(N-B);let G;if(typeof i.minZoom=="number"){const re=+i.minZoom+vi(k.lat,0),ne=Math.min(re,B,N)+vi(0,k.lat),ae=e.getConstrained(k,ne).zoom+vi(k.lat,0);G=o.aG(ae-B)}const W=o.bk(l.lng,k.lng),Y=o.bk(l.lat,k.lat);return{easeFunc:(re,ne,ae,ce)=>{const le=eu(l,W,Y,ae),ye=re===1?k:le;e.setCenter(ye.wrap());const be=B+o.a8(ne);e.setZoom(re===1?x:be+vi(0,ye.lat))},scaleOfZoom:H,targetCenter:k,scaleOfMinZoom:G,pixelPathLength:D}}static solveVectorScale(e,i,a,l,h){const m=l==="x"?[a[0],a[4],a[8],a[12]]:[a[1],a[5],a[9],a[13]],v=[a[3],a[7],a[11],a[15]],x=e[0]*m[0]+e[1]*m[1]+e[2]*m[2],P=e[0]*v[0]+e[1]*v[1]+e[2]*v[2],I=i[0]*m[0]+i[1]*m[1]+i[2]*m[2],k=i[0]*v[0]+i[1]*v[1]+i[2]*v[2];return I+h*P===x+h*k||v[3]*(x-I)+m[3]*(k-P)+x*k==I*P?null:(I+m[3]-h*k-h*v[3])/(I-x-h*k+h*P)}static getLesserNonNegativeNonNull(e,i){return i!==null&&i>=0&&i<e?i:e}}class ha{constructor(e){this._globe=e,this._mercatorCameraHelper=new qa,this._verticalPerspectiveCameraHelper=new cr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,i){return this.currentHelper.handlePanInertia(e,i)}handleMapControlsRollPitchBearingZoom(e,i){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,i)}handleMapControlsPan(e,i,a){this.currentHelper.handleMapControlsPan(e,i,a)}cameraForBoxAndBearing(e,i,a,l,h){return this.currentHelper.cameraForBoxAndBearing(e,i,a,l,h)}handleJumpToCenterZoom(e,i){this.currentHelper.handleJumpToCenterZoom(e,i)}handleEaseTo(e,i){return this.currentHelper.handleEaseTo(e,i)}handleFlyTo(e,i){return this.currentHelper.handleFlyTo(e,i)}}const Ms=(u,e)=>o.t(u,e&&e.filter(i=>i.identifier!=="source.canvas")),pl=o.br();class xr extends o.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const l=this.sourceCaches[a].getSource().type;l!=="vector"&&l!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new Fn(Rn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,l)=>this.getGlyphs(a,l)),this.dispatcher.registerMessageHandler("GI",(a,l)=>this.getImages(a,l)),this.imageManager=new Qi,this.imageManager.setEventedParent(this),this.glyphManager=new mi(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new Ln(256,512),this.crossTileSymbolIndex=new Xn,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bs,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.bt()),Jr().on(Un,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const l=this.sourceCaches[a.sourceId];if(!l)return;const h=l.getSource();if(h&&h.vectorLayerIds)for(const m in this._layers){const v=this._layers[m];v.source===h.id&&this._validateLayer(v)}})}loadURL(e,i={},a){this.fire(new o.k("dataloading",{dataType:"style"})),i.validate=typeof i.validate!="boolean"||i.validate;const l=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const h=this._loadStyleRequest;o.h(l,this._loadStyleRequest).then(m=>{this._loadStyleRequest=null,this._load(m.data,i,a)}).catch(m=>{this._loadStyleRequest=null,m&&!h.signal.aborted&&this.fire(new o.j(m))})}loadJSON(e,i={},a){this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ie.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,i.validate=i.validate!==!1,this._load(e,i,a)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(pl,{validate:!1})}_load(e,i,a){var l,h;const m=i.transformStyle?i.transformStyle(a,e):e;if(!i.validate||!Ms(this,o.u(m))){this._loaded=!0,this.stylesheet=m;for(const v in m.sources)this.addSource(v,m.sources[v],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new Xr(this.stylesheet.light),this._setProjectionInternal(((l=this.stylesheet.projection)===null||l===void 0?void 0:l.type)||"mercator"),this.sky=new Dn(this.stylesheet.sky),this.map.setTerrain((h=this.stylesheet.terrain)!==null&&h!==void 0?h:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const e=o.bu(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(i=>i.id),this._layers={},this._serializedLayers=null;for(const i of e){const a=o.bv(i);a.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=a}}_loadSprite(e,i=!1,a=void 0){let l;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(h,m,v,x){return o._(this,void 0,void 0,function*(){const P=ft(h),I=v>1?"@2x":"",k={},D={};for(const{id:B,url:N}of P){const H=m.transformRequest(et(N,I,".json"),"SpriteJSON");k[B]=o.h(H,x);const G=m.transformRequest(et(N,I,".png"),"SpriteImage");D[B]=Je.getImage(G,x)}return yield Promise.all([...Object.values(k),...Object.values(D)]),function(B,N){return o._(this,void 0,void 0,function*(){const H={};for(const G in B){H[G]={};const W=ie.getImageCanvasContext((yield N[G]).data),Y=(yield B[G]).data;for(const re in Y){const{width:ne,height:ae,x:ce,y:le,sdf:ye,pixelRatio:be,stretchX:Ie,stretchY:Ae,content:Se,textFitWidth:Ve,textFitHeight:je}=Y[re];H[G][re]={data:null,pixelRatio:be,sdf:ye,stretchX:Ie,stretchY:Ae,content:Se,textFitWidth:Ve,textFitHeight:je,spriteData:{width:ne,height:ae,x:ce,y:le,context:W}}}}return H})}(k,D)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(h=>{if(this._spriteRequest=null,h)for(const m in h){this._spritesImagesIds[m]=[];const v=this._spritesImagesIds[m]?this._spritesImagesIds[m].filter(x=>!(x in h)):[];for(const x of v)this.imageManager.removeImage(x),this._changedImages[x]=!0;for(const x in h[m]){const P=m==="default"?x:`${m}:${x}`;this._spritesImagesIds[m].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,h[m][x],!1):this.imageManager.addImage(P,h[m][x]),i&&(this._changedImages[P]=!0)}}}).catch(h=>{this._spriteRequest=null,l=h,this.fire(new o.j(l))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),a&&a(l)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const a=e.sourceLayer;if(!a)return;const l=i.getSource();(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(a)===-1)&&this.fire(new o.j(new Error(`Source layer "${a}" does not exist on source "${l.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(i?o.bw(a):a);const l=[];for(const h of e)if(a[h]){const m=i?o.bw(a[h]):a[h];l.push(m)}return l}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const i=Object.keys(this._layers);for(const a of i){const l=this._layers[a];l.type!=="custom"&&(e[a]=l.serialize())}return e}hasTransitions(){var e,i,a;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((i=this.sky)===null||i===void 0)&&i.hasTransition()||!((a=this.projection)===null||a===void 0)&&a.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const l=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);(l.length||h.length)&&this._updateWorkerLayers(l,h);for(const m in this._updatedSources){const v=this._updatedSources[m];if(v==="reload")this._reloadSource(m);else{if(v!=="clear")throw new Error(`Invalid action ${v}`);this._clearSource(m)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const m in this._updatedPaintProps)this._layers[m].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const l in this.sourceCaches){const h=this.sourceCaches[l];a[l]=h.used,h.used=!1}for(const l of this._order){const h=this._layers[l];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}for(const l in a){const h=this.sourceCaches[l];!!a[l]!=!!h.used&&h.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:l}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,i){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:i})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var a;this._checkLoaded();const l=this.serialize();if(e=i.transformStyle?i.transformStyle(l,e):e,((a=i.validate)===null||a===void 0||a)&&Ms(this,o.u(e)))return!1;(e=o.bw(e)).layers=o.bu(e.layers);const h=o.bx(l,e),m=this._getOperationsToPerform(h);if(m.unimplemented.length>0)throw new Error(`Unimplemented: ${m.unimplemented.join(", ")}.`);if(m.operations.length===0)return!1;for(const v of m.operations)v();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const i=[],a=[];for(const l of e)switch(l.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":i.push(()=>this.addLayer.apply(this,l.args));break;case"removeLayer":i.push(()=>this.removeLayer.apply(this,l.args));break;case"setPaintProperty":i.push(()=>this.setPaintProperty.apply(this,l.args));break;case"setLayoutProperty":i.push(()=>this.setLayoutProperty.apply(this,l.args));break;case"setFilter":i.push(()=>this.setFilter.apply(this,l.args));break;case"addSource":i.push(()=>this.addSource.apply(this,l.args));break;case"removeSource":i.push(()=>this.removeSource.apply(this,l.args));break;case"setLayerZoomRange":i.push(()=>this.setLayerZoomRange.apply(this,l.args));break;case"setLight":i.push(()=>this.setLight.apply(this,l.args));break;case"setGeoJSONSourceData":i.push(()=>this.setGeoJSONSourceData.apply(this,l.args));break;case"setGlyphs":i.push(()=>this.setGlyphs.apply(this,l.args));break;case"setSprite":i.push(()=>this.setSprite.apply(this,l.args));break;case"setTerrain":i.push(()=>this.map.setTerrain.apply(this,l.args));break;case"setSky":i.push(()=>this.setSky.apply(this,l.args));break;case"setProjection":this.setProjection.apply(this,l.args);break;case"setTransition":i.push(()=>{});break;default:a.push(l.command)}return{operations:i,unimplemented:a}}addImage(e,i){if(this.getImage(e))return this.fire(new o.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,i){this.imageManager.updateImage(e,i)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(o.u.source,`sources.${e}`,i,null,a))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const l=this.sourceCaches[e]=new j(e,i,this.dispatcher);l.style=this,l.setEventedParent(this,()=>({isSourceLoaded:l.loaded(),source:l.serialize(),sourceId:e})),l.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new o.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,i){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(i),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,a={}){this._checkLoaded();const l=e.id;if(this.getLayer(l))return void this.fire(new o.j(new Error(`Layer "${l}" already exists on this map.`)));let h;if(e.type==="custom"){if(Ms(this,o.by(e)))return;h=o.bv(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(l,e.source),e=o.bw(e),e=o.e(e,{source:l})),this._validate(o.u.layer,`layers.${l}`,e,{arrayIndex:-1},a))return;h=o.bv(e),this._validateLayer(h),h.setEventedParent(this,{layer:{id:l}})}const m=i?this._order.indexOf(i):this._order.length;if(i&&m===-1)this.fire(new o.j(new Error(`Cannot add layer "${l}" before non-existing layer "${i}".`)));else{if(this._order.splice(m,0,l),this._layerOrderChanged=!0,this._layers[l]=h,this._removedLayers[l]&&h.source&&h.type!=="custom"){const v=this._removedLayers[l];delete this._removedLayers[l],v.type!==h.type?this._updatedSources[h.source]="clear":(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause())}this._updateLayer(h),h.onAdd&&h.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const a=this._order.indexOf(e);this._order.splice(a,1);const l=i?this._order.indexOf(i):this._order.length;i&&l===-1?this.fire(new o.j(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(l,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,a){this._checkLoaded();const l=this.getLayer(e);l?l.minzoom===i&&l.maxzoom===a||(i!=null&&(l.minzoom=i),a!=null&&(l.maxzoom=a),this._updateLayer(l)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,a={}){this._checkLoaded();const l=this.getLayer(e);if(l){if(!o.bz(l.filter,i))return i==null?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(o.u.filter,`layers.${l.id}.filter`,i,null,a)||(l.filter=o.bw(i),this._updateLayer(l)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.bw(this.getLayer(e).filter)}setLayoutProperty(e,i,a,l={}){this._checkLoaded();const h=this.getLayer(e);h?o.bz(h.getLayoutProperty(i),a)||(h.setLayoutProperty(i,a,l),this._updateLayer(h)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const a=this.getLayer(e);if(a)return a.getLayoutProperty(i);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,a,l={}){this._checkLoaded();const h=this.getLayer(e);h?o.bz(h.getPaintProperty(i),a)||(h.setPaintProperty(i,a,l)&&this._updateLayer(h),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,i){return this.getLayer(e).getPaintProperty(i)}setFeatureState(e,i){this._checkLoaded();const a=e.source,l=e.sourceLayer,h=this.sourceCaches[a];if(h===void 0)return void this.fire(new o.j(new Error(`The source '${a}' does not exist in the map's style.`)));const m=h.getSource().type;m==="geojson"&&l?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):m!=="vector"||l?(e.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),h.setFeatureState(l,e.id,i)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const a=e.source,l=this.sourceCaches[a];if(l===void 0)return void this.fire(new o.j(new Error(`The source '${a}' does not exist in the map's style.`)));const h=l.getSource().type,m=h==="vector"?e.sourceLayer:void 0;h!=="vector"||m?i&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):l.removeFeatureState(m,e.id,i):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,a=e.sourceLayer,l=this.sourceCaches[i];if(l!==void 0)return l.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),l.getFeatureState(a,e.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=o.bA(this.sourceCaches,h=>h.serialize()),i=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,l=this.stylesheet;return o.bB({version:l.version,name:l.name,metadata:l.metadata,light:l.light,sky:l.sky,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,projection:l.projection,sources:e,layers:i,terrain:a},h=>h!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const i=m=>this._layers[m].type==="fill-extrusion",a={},l=[];for(let m=this._order.length-1;m>=0;m--){const v=this._order[m];if(i(v)){a[v]=m;for(const x of e){const P=x[v];if(P)for(const I of P)l.push(I)}}}l.sort((m,v)=>v.intersectionZ-m.intersectionZ);const h=[];for(let m=this._order.length-1;m>=0;m--){const v=this._order[m];if(i(v))for(let x=l.length-1;x>=0;x--){const P=l[x].feature;if(a[P.layer.id]<m)break;h.push(P),l.pop()}else for(const x of e){const P=x[v];if(P)for(const I of P)h.push(I.feature)}}return h}queryRenderedFeatures(e,i,a){i&&i.filter&&this._validate(o.u.filter,"queryRenderedFeatures.filter",i.filter,null,i);const l={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new o.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const P of i.layers){const I=this._layers[P];if(!I)return this.fire(new o.j(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];l[I.source]=!0}}const h=[];i.availableImages=this._availableImages;const m=this._serializedAllLayers(),v=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,x=Object.assign(Object.assign({},i),{layers:v});for(const P in this.sourceCaches)i.layers&&!l[P]||h.push(ea(this.sourceCaches[P],this._layers,m,e,x,a));return this.placement&&h.push(function(P,I,k,D,B,N,H){const G={},W=N.queryRenderedSymbols(D),Y=[];for(const re of Object.keys(W).map(Number))Y.push(H[re]);Y.sort(ji);for(const re of Y){const ne=re.featureIndex.lookupSymbolFeatures(W[re.bucketInstanceId],I,re.bucketIndex,re.sourceLayerIndex,B.filter,B.layers,B.availableImages,P);for(const ae in ne){const ce=G[ae]=G[ae]||[],le=ne[ae];le.sort((ye,be)=>{const Ie=re.featureSortOrder;if(Ie){const Ae=Ie.indexOf(ye.featureIndex);return Ie.indexOf(be.featureIndex)-Ae}return be.featureIndex-ye.featureIndex});for(const ye of le)ce.push(ye)}}return function(re,ne,ae){for(const ce in re)for(const le of re[ce])gi(le,ae[ne[ce].source]);return re}(G,P,k)}(this._layers,m,this.sourceCaches,e,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(h)}querySourceFeatures(e,i){i&&i.filter&&this._validate(o.u.filter,"querySourceFeatures.filter",i.filter,null,i);const a=this.sourceCaches[e];return a?function(l,h){const m=l.getRenderableIds().map(P=>l.getTileByID(P)),v=[],x={};for(let P=0;P<m.length;P++){const I=m[P],k=I.tileID.canonical.key;x[k]||(x[k]=!0,I.querySourceFeatures(v,h))}return v}(a,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const m in e)if(!o.bz(e[m],a[m])){l=!0;break}if(!l)return;const h={now:ie.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(h)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const a=this.getSky();let l=!1;if(!e&&!a)return;if(e&&!a)l=!0;else if(!e&&a)l=!0;else for(const m in e)if(!o.bz(e[m],a[m])){l=!0;break}if(!l)return;const h={now:ie.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(h)}_setProjectionInternal(e){const i=function(a){if(Array.isArray(a)){const l=new ul({type:a});return{projection:l,transform:new Qn,cameraHelper:new ha(l)}}switch(a){case"mercator":return{projection:new na,transform:new Qr,cameraHelper:new qa};case"globe":{const l=new ul({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:l,transform:new Qn,cameraHelper:new ha(l)}}case"vertical-perspective":return{projection:new Jc,transform:new Ga,cameraHelper:new cr};default:return o.w(`Unknown projection name: ${a}. Falling back to mercator projection.`),{projection:new na,transform:new Qr,cameraHelper:new qa}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const a in this.sourceCaches)this.sourceCaches[a].reload()}_validate(e,i,a,l,h={}){return(!h||h.validate!==!1)&&Ms(this,e.call(o.u,o.e({key:i,style:this.serialize(),value:a,styleSpec:o.v},l)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Jr().off(Un,this._rtlPluginLoaded);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this.sourceCaches){const a=this.sourceCaches[i];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const i in this.sourceCaches)this.sourceCaches[i].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,i,a,l,h=!1){let m=!1,v=!1;const x={};for(const P of this._order){const I=this._layers[P];if(I.type!=="symbol")continue;if(!x[I.source]){const D=this.sourceCaches[I.source];x[I.source]=D.getRenderableIds(!0).map(B=>D.getTileByID(B)).sort((B,N)=>N.tileID.overscaledZ-B.tileID.overscaledZ||(B.tileID.isLessThan(N.tileID)?-1:1))}const k=this.crossTileSymbolIndex.addLayer(I,x[I.source],e.center.lng);m=m||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((h=h||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ie.now(),e.zoom))&&(this.pauseablePlacement=new Xc(e,this.map.terrain,this._order,h,i,a,l,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,x),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ie.now()),v=!0),m&&this.pauseablePlacement.placement.setStale()),v||m)for(const P of this._order){const I=this._layers[P];I.type==="symbol"&&this.placement.updateLayerOpacities(I,x[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ie.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return o._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const l=this.sourceCaches[i.source];return l&&l.setDependencies(i.tileID.key,i.type,i.icons),a})}getGlyphs(e,i){return o._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(i.stacks),l=this.sourceCaches[i.source];return l&&l.setDependencies(i.tileID.key,i.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(o.u.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,a={},l){this._checkLoaded();const h=[{id:e,url:i}],m=[...ft(this.stylesheet.sprite),...h];this._validate(o.u.sprite,"sprite",m,null,a)||(this.stylesheet.sprite=m,this._loadSprite(h,!0,l))}removeSprite(e){this._checkLoaded();const i=ft(this.stylesheet.sprite);if(i.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;i.splice(i.findIndex(a=>a.id===e),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ft(this.stylesheet.sprite)}setSprite(e,i={},a){this._checkLoaded(),e&&this._validate(o.u.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var Jh=o.aA([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class fl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,i,a,l,h,m,v,x,P){this.context=e;let I=this.boundPaintVertexBuffers.length!==l.length;for(let k=0;!I&&k<l.length;k++)this.boundPaintVertexBuffers[k]!==l[k]&&(I=!0);!this.vao||this.boundProgram!==i||this.boundLayoutVertexBuffer!==a||I||this.boundIndexBuffer!==h||this.boundVertexOffset!==m||this.boundDynamicVertexBuffer!==v||this.boundDynamicVertexBuffer2!==x||this.boundDynamicVertexBuffer3!==P?this.freshBind(i,a,l,h,m,v,x,P):(e.bindVertexArray.set(this.vao),v&&v.bind(),h&&h.dynamicDraw&&h.bind(),x&&x.bind(),P&&P.bind())}freshBind(e,i,a,l,h,m,v,x){const P=e.numAttributes,I=this.context,k=I.gl;this.vao&&this.destroy(),this.vao=I.createVertexArray(),I.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=i,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=l,this.boundVertexOffset=h,this.boundDynamicVertexBuffer=m,this.boundDynamicVertexBuffer2=v,this.boundDynamicVertexBuffer3=x,i.enableAttributes(k,e);for(const D of a)D.enableAttributes(k,e);m&&m.enableAttributes(k,e),v&&v.enableAttributes(k,e),x&&x.enableAttributes(k,e),i.bind(),i.setVertexAttribPointers(k,e,h);for(const D of a)D.bind(),D.setVertexAttribPointers(k,e,h);m&&(m.bind(),m.setVertexAttribPointers(k,e,h)),l&&l.bind(),v&&(v.bind(),v.setVertexAttribPointers(k,e,h)),x&&(x.bind(),x.setVertexAttribPointers(k,e,h)),I.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const da=(u,e,i,a,l)=>({u_texture:0,u_ele_delta:u,u_fog_matrix:e,u_fog_color:i?i.properties.get("fog-color"):o.b4.white,u_fog_ground_blend:i?i.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?0:i?i.calculateFogBlendOpacity(a):0,u_horizon_color:i?i.properties.get("horizon-color"):o.b4.white,u_horizon_fog_blend:i?i.properties.get("horizon-fog-blend"):1,u_is_globe_mode:l?1:0}),pa={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ha(u){const e=[];for(let i=0;i<u.length;i++){if(u[i]===null)continue;const a=u[i].split(" ");e.push(a.pop())}return e}class Wa{constructor(e,i,a,l,h,m,v,x){const P=e.gl;this.program=P.createProgram();const I=Ha(i.staticAttributes),k=a?a.getBinderAttributes():[],D=I.concat(k),B=Nr.prelude.staticUniforms?Ha(Nr.prelude.staticUniforms):[],N=v.staticUniforms?Ha(v.staticUniforms):[],H=i.staticUniforms?Ha(i.staticUniforms):[],G=a?a.getBinderUniforms():[],W=B.concat(N).concat(H).concat(G),Y=[];for(const be of W)Y.indexOf(be)<0&&Y.push(be);const re=a?a.defines():[];kr(P)&&re.unshift("#version 300 es"),h&&re.push("#define OVERDRAW_INSPECTOR;"),m&&re.push("#define TERRAIN3D;"),x&&re.push(x);let ne=re.concat(Nr.prelude.fragmentSource,v.fragmentSource,i.fragmentSource).join(`
`),ae=re.concat(Nr.prelude.vertexSource,v.vertexSource,i.vertexSource).join(`
`);kr(P)||(ne=function(be){return be.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ne),ae=function(be){return be.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ae));const ce=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(ce,ne),P.compileShader(ce),!P.getShaderParameter(ce,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(ce)}`);P.attachShader(this.program,ce);const le=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(le,ae),P.compileShader(le),!P.getShaderParameter(le,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(le)}`);P.attachShader(this.program,le),this.attributes={};const ye={};this.numAttributes=D.length;for(let be=0;be<this.numAttributes;be++)D[be]&&(P.bindAttribLocation(this.program,be,D[be]),this.attributes[D[be]]=be);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(le),P.deleteShader(ce);for(let be=0;be<Y.length;be++){const Ie=Y[be];if(Ie&&!ye[Ie]){const Ae=P.getUniformLocation(this.program,Ie);Ae&&(ye[Ie]=Ae)}}this.fixedUniforms=l(e,ye),this.terrainUniforms=((be,Ie)=>({u_depth:new o.bC(be,Ie.u_depth),u_terrain:new o.bC(be,Ie.u_terrain),u_terrain_dim:new o.b5(be,Ie.u_terrain_dim),u_terrain_matrix:new o.bD(be,Ie.u_terrain_matrix),u_terrain_unpack:new o.bE(be,Ie.u_terrain_unpack),u_terrain_exaggeration:new o.b5(be,Ie.u_terrain_exaggeration)}))(e,ye),this.projectionUniforms=((be,Ie)=>({u_projection_matrix:new o.bD(be,Ie.u_projection_matrix),u_projection_tile_mercator_coords:new o.bE(be,Ie.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bE(be,Ie.u_projection_clipping_plane),u_projection_transition:new o.b5(be,Ie.u_projection_transition),u_projection_fallback_matrix:new o.bD(be,Ie.u_projection_fallback_matrix)}))(e,ye),this.binderUniforms=a?a.getUniforms(e,ye):[]}draw(e,i,a,l,h,m,v,x,P,I,k,D,B,N,H,G,W,Y,re){const ne=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(l),e.setColorMode(h),e.setCullFace(m),x){e.activeTexture.set(ne.TEXTURE2),ne.bindTexture(ne.TEXTURE_2D,x.depthTexture),e.activeTexture.set(ne.TEXTURE3),ne.bindTexture(ne.TEXTURE_2D,x.texture);for(const ce in this.terrainUniforms)this.terrainUniforms[ce].set(x[ce])}if(P)for(const ce in P)this.projectionUniforms[pa[ce]].set(P[ce]);if(v)for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(v[ce]);G&&G.setUniforms(e,this.binderUniforms,N,{zoom:H});let ae=0;switch(i){case ne.LINES:ae=2;break;case ne.TRIANGLES:ae=3;break;case ne.LINE_STRIP:ae=1}for(const ce of B.get()){const le=ce.vaos||(ce.vaos={});(le[I]||(le[I]=new fl)).bind(e,this,k,G?G.getPaintVertexBuffers():[],D,ce.vertexOffset,W,Y,re),ne.drawElements(i,ce.primitiveLength*ae,ne.UNSIGNED_SHORT,ce.primitiveOffset*ae*2)}}}function tu(u,e,i){const a=1/o.at(i,1,e.transform.tileZoom),l=Math.pow(2,i.tileID.overscaledZ),h=i.tileSize*Math.pow(2,e.transform.tileZoom)/l,m=h*(i.tileID.canonical.x+i.tileID.wrap*l),v=h*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[a,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[m>>16,v>>16],u_pixel_coord_lower:[65535&m,65535&v]}}const es=(u,e,i,a)=>{const l=u.style.light,h=l.properties.get("position"),m=[h.x,h.y,h.z],v=o.bI();l.properties.get("anchor")==="viewport"&&o.bJ(v,u.transform.bearingInRadians),o.bK(m,m,v);const x=u.transform.transformLightDirection(m),P=l.properties.get("color");return{u_lightpos:m,u_lightpos_globe:x,u_lightintensity:l.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+e,u_opacity:i,u_fill_translate:a}},Qh=(u,e,i,a,l,h,m)=>o.e(es(u,e,i,a),tu(h,u,m),{u_height_factor:-Math.pow(2,l.overscaledZ)/m.tileSize/8}),ml=(u,e,i,a)=>o.e(tu(e,u,i),{u_fill_translate:a}),ed=(u,e)=>({u_world:u,u_fill_translate:e}),iu=(u,e,i,a,l)=>o.e(ml(u,e,i,l),{u_world:a}),gl=(u,e,i,a,l)=>{const h=u.transform;let m,v,x=0;if(i.paint.get("circle-pitch-alignment")==="map"){const P=o.at(e,1,h.zoom);m=!0,v=[P,P],x=P/(o.X*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*l}else m=!1,v=h.pixelsToGLUnits;return{u_camera_to_center_distance:h.cameraToCenterDistance,u_scale_with_map:+(i.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+m,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:v,u_globe_extrude_scale:x,u_translate:a}},ru=u=>({u_pixel_extrude_scale:[1/u.width,1/u.height]}),nu=u=>({u_viewport_size:[u.width,u.height]}),_l=(u,e=1)=>({u_color:u,u_overlay:0,u_overlay_scale:e}),yl=(u,e,i,a)=>{const l=o.at(u,1,e)/(o.X*Math.pow(2,u.tileID.overscaledZ))*2*Math.PI*a;return{u_extrude_scale:o.at(u,1,e),u_intensity:i,u_globe_extrude_scale:l}},wn=(u,e,i,a)=>{const l=o.H();o.bL(l,0,u.width,u.height,0,0,1);const h=u.context.gl;return{u_matrix:l,u_world:[h.drawingBufferWidth,h.drawingBufferHeight],u_image:i,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}},su=(u,e,i)=>{const a=i.paint.get("hillshade-shadow-color"),l=i.paint.get("hillshade-highlight-color"),h=i.paint.get("hillshade-accent-color");let m=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);return i.paint.get("hillshade-illumination-anchor")==="viewport"&&(m+=u.transform.bearingInRadians),{u_image:0,u_latrange:fa(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),m],u_shadow:a,u_highlight:l,u_accent:h}},au=(u,e)=>{const i=e.stride,a=o.H();return o.bL(a,0,o.X,-8192,0,0,1),o.J(a,a,[0,-8192,0]),{u_matrix:a,u_image:1,u_dimension:[i,i],u_zoom:u.overscaledZ,u_unpack:e.getUnpackVector()}};function fa(u,e){const i=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new o.Y(0,a/i).toLngLat().lat,new o.Y(0,(a+1)/i).toLngLat().lat]}const vl=(u,e,i,a)=>{const l=u.transform;return{u_translation:xl(u,e,i),u_ratio:a/o.at(e,1,l.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]]}},Xa=(u,e,i,a,l)=>o.e(vl(u,e,i,a),{u_image:0,u_image_height:l}),td=(u,e,i,a,l)=>{const h=u.transform,m=bl(e,h);return{u_translation:xl(u,e,i),u_texsize:e.imageAtlasTexture.size,u_ratio:a/o.at(e,1,h.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[m,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},id=(u,e,i,a,l,h)=>{const m=u.lineAtlas,v=bl(e,u.transform),x=i.layout.get("line-cap")==="round",P=m.getDash(l.from,x),I=m.getDash(l.to,x),k=P.width*h.fromScale,D=I.width*h.toScale;return o.e(vl(u,e,i,a),{u_patternscale_a:[v/k,-P.height/2],u_patternscale_b:[v/D,-I.height/2],u_sdfgamma:m.width/(256*Math.min(k,D)*u.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:I.y,u_mix:h.t})};function bl(u,e){return 1/o.at(u,1,e.tileZoom)}function xl(u,e,i){return o.au(u.transform,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const ou=(u,e,i,a,l)=>{return{u_tl_parent:u,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*a.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:a.paint.get("raster-brightness-min"),u_brightness_high:a.paint.get("raster-brightness-max"),u_saturation_factor:(m=a.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(h=a.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:wl(a.paint.get("raster-hue-rotate")),u_coords_top:[l[0].x,l[0].y,l[1].x,l[1].y],u_coords_bottom:[l[3].x,l[3].y,l[2].x,l[2].y]};var h,m};function wl(u){u*=Math.PI/180;const e=Math.sin(u),i=Math.cos(u);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Tl=(u,e,i,a,l,h,m,v,x,P,I,k,D)=>{const B=m.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:B.cameraToCenterDistance,u_pitch:B.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:B.width/B.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_label_plane_matrix:v,u_coord_matrix:x,u_is_text:+I,u_pitch_with_map:+a,u_is_along_line:l,u_is_variable_anchor:h,u_texsize:k,u_texture:0,u_translation:P,u_pitched_scale:D}},ma=(u,e,i,a,l,h,m,v,x,P,I,k,D,B)=>{const N=m.transform;return o.e(Tl(u,e,i,a,l,h,m,v,x,P,I,k,B),{u_gamma_scale:a?Math.cos(N.pitch*Math.PI/180)*N.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:1})},tn=(u,e,i,a,l,h,m,v,x,P,I,k,D)=>o.e(ma(u,e,i,a,l,h,m,v,x,P,!0,I,0,D),{u_texsize_icon:k,u_texture_icon:1}),Pl=(u,e)=>({u_opacity:u,u_color:e}),Sl=(u,e,i,a,l)=>o.e(function(h,m,v,x){const P=v.imageManager.getPattern(h.from.toString()),I=v.imageManager.getPattern(h.to.toString()),{width:k,height:D}=v.imageManager.getPixelSize(),B=Math.pow(2,x.tileID.overscaledZ),N=x.tileSize*Math.pow(2,v.transform.tileZoom)/B,H=N*(x.tileID.canonical.x+x.tileID.wrap*B),G=N*x.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[k,D],u_mix:m.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:m.fromScale,u_scale_b:m.toScale,u_tile_units_to_pixels:1/o.at(x,1,v.transform.tileZoom),u_pixel_coord_upper:[H>>16,G>>16],u_pixel_coord_lower:[65535&H,65535&G]}}(i,l,e,a),{u_opacity:u}),Ka=(u,e)=>{},lu={fillExtrusion:(u,e)=>({u_lightpos:new o.bG(u,e.u_lightpos),u_lightpos_globe:new o.bG(u,e.u_lightpos_globe),u_lightintensity:new o.b5(u,e.u_lightintensity),u_lightcolor:new o.bG(u,e.u_lightcolor),u_vertical_gradient:new o.b5(u,e.u_vertical_gradient),u_opacity:new o.b5(u,e.u_opacity),u_fill_translate:new o.bH(u,e.u_fill_translate)}),fillExtrusionPattern:(u,e)=>({u_lightpos:new o.bG(u,e.u_lightpos),u_lightpos_globe:new o.bG(u,e.u_lightpos_globe),u_lightintensity:new o.b5(u,e.u_lightintensity),u_lightcolor:new o.bG(u,e.u_lightcolor),u_vertical_gradient:new o.b5(u,e.u_vertical_gradient),u_height_factor:new o.b5(u,e.u_height_factor),u_opacity:new o.b5(u,e.u_opacity),u_fill_translate:new o.bH(u,e.u_fill_translate),u_image:new o.bC(u,e.u_image),u_texsize:new o.bH(u,e.u_texsize),u_pixel_coord_upper:new o.bH(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(u,e.u_pixel_coord_lower),u_scale:new o.bG(u,e.u_scale),u_fade:new o.b5(u,e.u_fade)}),fill:(u,e)=>({u_fill_translate:new o.bH(u,e.u_fill_translate)}),fillPattern:(u,e)=>({u_image:new o.bC(u,e.u_image),u_texsize:new o.bH(u,e.u_texsize),u_pixel_coord_upper:new o.bH(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(u,e.u_pixel_coord_lower),u_scale:new o.bG(u,e.u_scale),u_fade:new o.b5(u,e.u_fade),u_fill_translate:new o.bH(u,e.u_fill_translate)}),fillOutline:(u,e)=>({u_world:new o.bH(u,e.u_world),u_fill_translate:new o.bH(u,e.u_fill_translate)}),fillOutlinePattern:(u,e)=>({u_world:new o.bH(u,e.u_world),u_image:new o.bC(u,e.u_image),u_texsize:new o.bH(u,e.u_texsize),u_pixel_coord_upper:new o.bH(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(u,e.u_pixel_coord_lower),u_scale:new o.bG(u,e.u_scale),u_fade:new o.b5(u,e.u_fade),u_fill_translate:new o.bH(u,e.u_fill_translate)}),circle:(u,e)=>({u_camera_to_center_distance:new o.b5(u,e.u_camera_to_center_distance),u_scale_with_map:new o.bC(u,e.u_scale_with_map),u_pitch_with_map:new o.bC(u,e.u_pitch_with_map),u_extrude_scale:new o.bH(u,e.u_extrude_scale),u_device_pixel_ratio:new o.b5(u,e.u_device_pixel_ratio),u_globe_extrude_scale:new o.b5(u,e.u_globe_extrude_scale),u_translate:new o.bH(u,e.u_translate)}),collisionBox:(u,e)=>({u_pixel_extrude_scale:new o.bH(u,e.u_pixel_extrude_scale)}),collisionCircle:(u,e)=>({u_viewport_size:new o.bH(u,e.u_viewport_size)}),debug:(u,e)=>({u_color:new o.bF(u,e.u_color),u_overlay:new o.bC(u,e.u_overlay),u_overlay_scale:new o.b5(u,e.u_overlay_scale)}),depth:Ka,clippingMask:Ka,heatmap:(u,e)=>({u_extrude_scale:new o.b5(u,e.u_extrude_scale),u_intensity:new o.b5(u,e.u_intensity),u_globe_extrude_scale:new o.b5(u,e.u_globe_extrude_scale)}),heatmapTexture:(u,e)=>({u_matrix:new o.bD(u,e.u_matrix),u_world:new o.bH(u,e.u_world),u_image:new o.bC(u,e.u_image),u_color_ramp:new o.bC(u,e.u_color_ramp),u_opacity:new o.b5(u,e.u_opacity)}),hillshade:(u,e)=>({u_image:new o.bC(u,e.u_image),u_latrange:new o.bH(u,e.u_latrange),u_light:new o.bH(u,e.u_light),u_shadow:new o.bF(u,e.u_shadow),u_highlight:new o.bF(u,e.u_highlight),u_accent:new o.bF(u,e.u_accent)}),hillshadePrepare:(u,e)=>({u_matrix:new o.bD(u,e.u_matrix),u_image:new o.bC(u,e.u_image),u_dimension:new o.bH(u,e.u_dimension),u_zoom:new o.b5(u,e.u_zoom),u_unpack:new o.bE(u,e.u_unpack)}),line:(u,e)=>({u_translation:new o.bH(u,e.u_translation),u_ratio:new o.b5(u,e.u_ratio),u_device_pixel_ratio:new o.b5(u,e.u_device_pixel_ratio),u_units_to_pixels:new o.bH(u,e.u_units_to_pixels)}),lineGradient:(u,e)=>({u_translation:new o.bH(u,e.u_translation),u_ratio:new o.b5(u,e.u_ratio),u_device_pixel_ratio:new o.b5(u,e.u_device_pixel_ratio),u_units_to_pixels:new o.bH(u,e.u_units_to_pixels),u_image:new o.bC(u,e.u_image),u_image_height:new o.b5(u,e.u_image_height)}),linePattern:(u,e)=>({u_translation:new o.bH(u,e.u_translation),u_texsize:new o.bH(u,e.u_texsize),u_ratio:new o.b5(u,e.u_ratio),u_device_pixel_ratio:new o.b5(u,e.u_device_pixel_ratio),u_image:new o.bC(u,e.u_image),u_units_to_pixels:new o.bH(u,e.u_units_to_pixels),u_scale:new o.bG(u,e.u_scale),u_fade:new o.b5(u,e.u_fade)}),lineSDF:(u,e)=>({u_translation:new o.bH(u,e.u_translation),u_ratio:new o.b5(u,e.u_ratio),u_device_pixel_ratio:new o.b5(u,e.u_device_pixel_ratio),u_units_to_pixels:new o.bH(u,e.u_units_to_pixels),u_patternscale_a:new o.bH(u,e.u_patternscale_a),u_patternscale_b:new o.bH(u,e.u_patternscale_b),u_sdfgamma:new o.b5(u,e.u_sdfgamma),u_image:new o.bC(u,e.u_image),u_tex_y_a:new o.b5(u,e.u_tex_y_a),u_tex_y_b:new o.b5(u,e.u_tex_y_b),u_mix:new o.b5(u,e.u_mix)}),raster:(u,e)=>({u_tl_parent:new o.bH(u,e.u_tl_parent),u_scale_parent:new o.b5(u,e.u_scale_parent),u_buffer_scale:new o.b5(u,e.u_buffer_scale),u_fade_t:new o.b5(u,e.u_fade_t),u_opacity:new o.b5(u,e.u_opacity),u_image0:new o.bC(u,e.u_image0),u_image1:new o.bC(u,e.u_image1),u_brightness_low:new o.b5(u,e.u_brightness_low),u_brightness_high:new o.b5(u,e.u_brightness_high),u_saturation_factor:new o.b5(u,e.u_saturation_factor),u_contrast_factor:new o.b5(u,e.u_contrast_factor),u_spin_weights:new o.bG(u,e.u_spin_weights),u_coords_top:new o.bE(u,e.u_coords_top),u_coords_bottom:new o.bE(u,e.u_coords_bottom)}),symbolIcon:(u,e)=>({u_is_size_zoom_constant:new o.bC(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bC(u,e.u_is_size_feature_constant),u_size_t:new o.b5(u,e.u_size_t),u_size:new o.b5(u,e.u_size),u_camera_to_center_distance:new o.b5(u,e.u_camera_to_center_distance),u_pitch:new o.b5(u,e.u_pitch),u_rotate_symbol:new o.bC(u,e.u_rotate_symbol),u_aspect_ratio:new o.b5(u,e.u_aspect_ratio),u_fade_change:new o.b5(u,e.u_fade_change),u_label_plane_matrix:new o.bD(u,e.u_label_plane_matrix),u_coord_matrix:new o.bD(u,e.u_coord_matrix),u_is_text:new o.bC(u,e.u_is_text),u_pitch_with_map:new o.bC(u,e.u_pitch_with_map),u_is_along_line:new o.bC(u,e.u_is_along_line),u_is_variable_anchor:new o.bC(u,e.u_is_variable_anchor),u_texsize:new o.bH(u,e.u_texsize),u_texture:new o.bC(u,e.u_texture),u_translation:new o.bH(u,e.u_translation),u_pitched_scale:new o.b5(u,e.u_pitched_scale)}),symbolSDF:(u,e)=>({u_is_size_zoom_constant:new o.bC(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bC(u,e.u_is_size_feature_constant),u_size_t:new o.b5(u,e.u_size_t),u_size:new o.b5(u,e.u_size),u_camera_to_center_distance:new o.b5(u,e.u_camera_to_center_distance),u_pitch:new o.b5(u,e.u_pitch),u_rotate_symbol:new o.bC(u,e.u_rotate_symbol),u_aspect_ratio:new o.b5(u,e.u_aspect_ratio),u_fade_change:new o.b5(u,e.u_fade_change),u_label_plane_matrix:new o.bD(u,e.u_label_plane_matrix),u_coord_matrix:new o.bD(u,e.u_coord_matrix),u_is_text:new o.bC(u,e.u_is_text),u_pitch_with_map:new o.bC(u,e.u_pitch_with_map),u_is_along_line:new o.bC(u,e.u_is_along_line),u_is_variable_anchor:new o.bC(u,e.u_is_variable_anchor),u_texsize:new o.bH(u,e.u_texsize),u_texture:new o.bC(u,e.u_texture),u_gamma_scale:new o.b5(u,e.u_gamma_scale),u_device_pixel_ratio:new o.b5(u,e.u_device_pixel_ratio),u_is_halo:new o.bC(u,e.u_is_halo),u_translation:new o.bH(u,e.u_translation),u_pitched_scale:new o.b5(u,e.u_pitched_scale)}),symbolTextAndIcon:(u,e)=>({u_is_size_zoom_constant:new o.bC(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bC(u,e.u_is_size_feature_constant),u_size_t:new o.b5(u,e.u_size_t),u_size:new o.b5(u,e.u_size),u_camera_to_center_distance:new o.b5(u,e.u_camera_to_center_distance),u_pitch:new o.b5(u,e.u_pitch),u_rotate_symbol:new o.bC(u,e.u_rotate_symbol),u_aspect_ratio:new o.b5(u,e.u_aspect_ratio),u_fade_change:new o.b5(u,e.u_fade_change),u_label_plane_matrix:new o.bD(u,e.u_label_plane_matrix),u_coord_matrix:new o.bD(u,e.u_coord_matrix),u_is_text:new o.bC(u,e.u_is_text),u_pitch_with_map:new o.bC(u,e.u_pitch_with_map),u_is_along_line:new o.bC(u,e.u_is_along_line),u_is_variable_anchor:new o.bC(u,e.u_is_variable_anchor),u_texsize:new o.bH(u,e.u_texsize),u_texsize_icon:new o.bH(u,e.u_texsize_icon),u_texture:new o.bC(u,e.u_texture),u_texture_icon:new o.bC(u,e.u_texture_icon),u_gamma_scale:new o.b5(u,e.u_gamma_scale),u_device_pixel_ratio:new o.b5(u,e.u_device_pixel_ratio),u_is_halo:new o.bC(u,e.u_is_halo),u_translation:new o.bH(u,e.u_translation),u_pitched_scale:new o.b5(u,e.u_pitched_scale)}),background:(u,e)=>({u_opacity:new o.b5(u,e.u_opacity),u_color:new o.bF(u,e.u_color)}),backgroundPattern:(u,e)=>({u_opacity:new o.b5(u,e.u_opacity),u_image:new o.bC(u,e.u_image),u_pattern_tl_a:new o.bH(u,e.u_pattern_tl_a),u_pattern_br_a:new o.bH(u,e.u_pattern_br_a),u_pattern_tl_b:new o.bH(u,e.u_pattern_tl_b),u_pattern_br_b:new o.bH(u,e.u_pattern_br_b),u_texsize:new o.bH(u,e.u_texsize),u_mix:new o.b5(u,e.u_mix),u_pattern_size_a:new o.bH(u,e.u_pattern_size_a),u_pattern_size_b:new o.bH(u,e.u_pattern_size_b),u_scale_a:new o.b5(u,e.u_scale_a),u_scale_b:new o.b5(u,e.u_scale_b),u_pixel_coord_upper:new o.bH(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bH(u,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.b5(u,e.u_tile_units_to_pixels)}),terrain:(u,e)=>({u_texture:new o.bC(u,e.u_texture),u_ele_delta:new o.b5(u,e.u_ele_delta),u_fog_matrix:new o.bD(u,e.u_fog_matrix),u_fog_color:new o.bF(u,e.u_fog_color),u_fog_ground_blend:new o.b5(u,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.b5(u,e.u_fog_ground_blend_opacity),u_horizon_color:new o.bF(u,e.u_horizon_color),u_horizon_fog_blend:new o.b5(u,e.u_horizon_fog_blend),u_is_globe_mode:new o.b5(u,e.u_is_globe_mode)}),terrainDepth:(u,e)=>({u_ele_delta:new o.b5(u,e.u_ele_delta)}),terrainCoords:(u,e)=>({u_texture:new o.bC(u,e.u_texture),u_terrain_coords_id:new o.b5(u,e.u_terrain_coords_id),u_ele_delta:new o.b5(u,e.u_ele_delta)}),projectionErrorMeasurement:(u,e)=>({u_input:new o.b5(u,e.u_input),u_output_expected:new o.b5(u,e.u_output_expected)}),atmosphere:(u,e)=>({u_sun_pos:new o.bG(u,e.u_sun_pos),u_atmosphere_blend:new o.b5(u,e.u_atmosphere_blend),u_globe_position:new o.bG(u,e.u_globe_position),u_globe_radius:new o.b5(u,e.u_globe_radius),u_inv_proj_matrix:new o.bD(u,e.u_inv_proj_matrix)}),sky:(u,e)=>({u_sky_color:new o.bF(u,e.u_sky_color),u_horizon_color:new o.bF(u,e.u_horizon_color),u_horizon:new o.bH(u,e.u_horizon),u_horizon_normal:new o.bH(u,e.u_horizon_normal),u_sky_horizon_blend:new o.b5(u,e.u_sky_horizon_blend),u_sky_blend:new o.b5(u,e.u_sky_blend)})};class Cl{constructor(e,i,a){this.context=e;const l=e.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const i=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ts={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ml{constructor(e,i,a,l){this.length=i.length,this.attributes=a,this.itemSize=i.bytesPerElement,this.dynamicDraw=l,this.context=e;const h=e.gl;this.buffer=h.createBuffer(),e.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete i.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const i=this.context.gl;this.bind(),i.bufferSubData(i.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,i){for(let a=0;a<this.attributes.length;a++){const l=i.attributes[this.attributes[a].name];l!==void 0&&e.enableVertexAttribArray(l)}}setVertexAttribPointers(e,i,a){for(let l=0;l<this.attributes.length;l++){const h=this.attributes[l],m=i.attributes[h.name];m!==void 0&&e.vertexAttribPointer(m,h.components,e[ts[h.type]],!1,this.itemSize,h.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Et{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class rd extends Et{getDefault(){return o.b4.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class nd extends Et{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class sd extends Et{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class cu extends Et{getDefault(){return[!0,!0,!0,!0]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ad extends Et{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class uu extends Et{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ya extends Et{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const i=this.current;(e.func!==i.func||e.ref!==i.ref||e.mask!==i.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Ja extends Et{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Qa extends Et{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.current=e,this.dirty=!1}}class Il extends Et{getDefault(){return[0,1]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class is extends Et{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),this.current=e,this.dirty=!1}}class Is extends Et{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class wr extends Et{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.BLEND):i.disable(i.BLEND),this.current=e,this.dirty=!1}}class hu extends Et{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class du extends Et{getDefault(){return o.b4.transparent}set(e){const i=this.current;(e.r!==i.r||e.g!==i.g||e.b!==i.b||e.a!==i.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class El extends Et{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class rs extends Et{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;e?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),this.current=e,this.dirty=!1}}class eo extends Et{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class to extends Et{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ga extends Et{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class io extends Et{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class pu extends Et{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const i=this.current;(e[0]!==i[0]||e[1]!==i[1]||e[2]!==i[2]||e[3]!==i[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Es extends Et{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class ks extends Et{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindRenderbuffer(i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fu extends Et{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindTexture(i.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class kl extends Et{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Mt extends Et{getDefault(){return null}set(e){const i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ro extends Et{getDefault(){return null}set(e){var i;if(e===this.current&&!this.dirty)return;const a=this.gl;kr(a)?a.bindVertexArray(e):(i=a.getExtension("OES_vertex_array_object"))===null||i===void 0||i.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class od extends Et{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class mu extends Et{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class _a extends Et{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const i=this.gl;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Al extends Et{constructor(e,i){super(e),this.context=e,this.parent=i}getDefault(){return null}}class ld extends Al{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class gu extends Al{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class cd extends Al{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const i=this.gl;i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const no="Framebuffer is not complete";class so{constructor(e,i,a,l,h){this.context=e,this.width=i,this.height=a;const m=e.gl,v=this.framebuffer=m.createFramebuffer();if(this.colorAttachment=new ld(e,v),l)this.depthAttachment=h?new cd(e,v):new gu(e,v);else if(h)throw new Error("Stencil cannot be set without depth");if(m.checkFramebufferStatus(m.FRAMEBUFFER)!==m.FRAMEBUFFER_COMPLETE)throw new Error(no)}destroy(){const e=this.context.gl,i=this.colorAttachment.get();if(i&&e.deleteTexture(i),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class ao{constructor(e){var i,a;if(this.gl=e,this.clearColor=new rd(this),this.clearDepth=new nd(this),this.clearStencil=new sd(this),this.colorMask=new cu(this),this.depthMask=new ad(this),this.stencilMask=new uu(this),this.stencilFunc=new Ya(this),this.stencilOp=new Ja(this),this.stencilTest=new Qa(this),this.depthRange=new Il(this),this.depthTest=new is(this),this.depthFunc=new Is(this),this.blend=new wr(this),this.blendFunc=new hu(this),this.blendColor=new du(this),this.blendEquation=new El(this),this.cullFace=new rs(this),this.cullFaceSide=new eo(this),this.frontFace=new to(this),this.program=new ga(this),this.activeTexture=new io(this),this.viewport=new pu(this),this.bindFramebuffer=new Es(this),this.bindRenderbuffer=new ks(this),this.bindTexture=new fu(this),this.bindVertexBuffer=new kl(this),this.bindElementBuffer=new Mt(this),this.bindVertexArray=new ro(this),this.pixelStoreUnpack=new od(this),this.pixelStoreUnpackPremultiplyAlpha=new mu(this),this.pixelStoreUnpackFlipY=new _a(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),kr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const l=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(i=e.RGBA16F)!==null&&i!==void 0?i:l==null?void 0:l.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:l==null?void 0:l.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const l=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=l==null?void 0:l.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i){return new Cl(this,e,i)}createVertexBuffer(e,i,a){return new Ml(this,e,i,a)}createRenderbuffer(e,i,a){const l=this.gl,h=l.createRenderbuffer();return this.bindRenderbuffer.set(h),l.renderbufferStorage(l.RENDERBUFFER,e,i,a),this.bindRenderbuffer.set(null),h}createFramebuffer(e,i,a,l){return new so(this,e,i,a,l)}clear({color:e,depth:i,stencil:a}){const l=this.gl;let h=0;e&&(h|=l.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),i!==void 0&&(h|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),a!==void 0&&(h|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),l.clear(h)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.bz(e.blendFunction,$t.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return kr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var i;return kr(this.gl)?this.gl.deleteVertexArray(e):(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let As;function oo(u,e,i,a,l){const h=u.context,m=u.transform,v=h.gl,x=u.useProgram("collisionBox"),P=[];let I=0,k=0;for(let W=0;W<a.length;W++){const Y=a[W],re=e.getTile(Y).getBucket(i);if(!re)continue;const ne=l?re.textCollisionBox:re.iconCollisionBox,ae=re.collisionCircleArray;ae.length>0&&(P.push({circleArray:ae,circleOffset:k,coord:Y}),I+=ae.length/4,k=I),ne&&x.draw(h,v.LINES,gt.disabled,St.disabled,u.colorModeForRenderPass(),Tt.disabled,ru(u.transform),u.style.map.terrain&&u.style.map.terrain.getTerrainData(Y),m.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),i.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,null,u.transform.zoom,null,null,ne.collisionVertexBuffer)}if(!l||!P.length)return;const D=u.useProgram("collisionCircle"),B=new o.bM;B.resize(4*I),B._trim();let N=0;for(const W of P)for(let Y=0;Y<W.circleArray.length/4;Y++){const re=4*Y,ne=W.circleArray[re+0],ae=W.circleArray[re+1],ce=W.circleArray[re+2],le=W.circleArray[re+3];B.emplace(N++,ne,ae,ce,le,0),B.emplace(N++,ne,ae,ce,le,1),B.emplace(N++,ne,ae,ce,le,2),B.emplace(N++,ne,ae,ce,le,3)}(!As||As.length<2*I)&&(As=function(W){const Y=2*W,re=new o.bO;re.resize(Y),re._trim();for(let ne=0;ne<Y;ne++){const ae=6*ne;re.uint16[ae+0]=4*ne+0,re.uint16[ae+1]=4*ne+1,re.uint16[ae+2]=4*ne+2,re.uint16[ae+3]=4*ne+2,re.uint16[ae+4]=4*ne+3,re.uint16[ae+5]=4*ne+0}return re}(I));const H=h.createIndexBuffer(As,!0),G=h.createVertexBuffer(B,o.bN.members,!0);for(const W of P){const Y=nu(u.transform);D.draw(h,v.TRIANGLES,gt.disabled,St.disabled,u.colorModeForRenderPass(),Tt.disabled,Y,u.style.map.terrain&&u.style.map.terrain.getTerrainData(W.coord),null,i.id,G,H,o.aD.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,u.transform.zoom,null,null,null)}G.destroy(),H.destroy()}const _u=o.aq(new Float32Array(16));function lo(u,e,i,a,l,h){const{horizontalAlign:m,verticalAlign:v}=o.ay(u);return new o.P((-(m-.5)*e/l+a[0])*h,(-(v-.5)*i/l+a[1])*h)}function co(u,e,i,a,l,h){const m=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let v=a.mult(h);i||(v=v.rotate(-l));const x=m.add(v);return Pe(x.x,x.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(i){const v=Ye(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(u),x=Math.atan(v.y/v.x)+(v.x<0?Math.PI:0);return u.add(a.rotate(x))}return u.add(a)}function zl(u,e,i,a,l,h,m,v,x,P,I,k){const D=u.text.placedSymbolArray,B=u.text.dynamicLayoutVertexArray,N=u.icon.dynamicLayoutVertexArray,H={};B.clear();for(let G=0;G<D.length;G++){const W=D.get(G),Y=W.hidden||!W.crossTileID||u.allowVerticalPlacement&&!W.placedOrientation?null:a[W.crossTileID];if(Y){const re=new o.P(W.anchorX,W.anchorY),ne={getElevation:k,width:l.width,height:l.height,pitchedLabelPlaneMatrix:h,pitchWithMap:i,transform:l,tileAnchorPoint:re,translation:P,unwrappedTileID:I},ae=i?Pt(re.x,re.y,ne):Ye(re.x,re.y,ne),ce=_e(l.cameraToCenterDistance,ae.signedDistanceFromCamera);let le=o.aj(u.textSizeData,v,W)*ce/o.as;i&&(le*=u.tilePixelRatio/m);const{width:ye,height:be,anchor:Ie,textOffset:Ae,textBoxScale:Se}=Y,Ve=lo(Ie,ye,be,Ae,Se,le),je=l.getPitchedTextCorrection(re.x+P[0],re.y+P[1],I),De=co(ae.point,ne,e,Ve,-l.bearingInRadians,je),qe=u.allowVerticalPlacement&&W.placedOrientation===o.ai.vertical?Math.PI/2:0;for(let _t=0;_t<W.numGlyphs;_t++)o.ak(B,De,qe);x&&W.associatedIconIndex>=0&&(H[W.associatedIconIndex]={shiftedAnchor:De,angle:qe})}else _i(W.numGlyphs,B)}if(x){N.clear();const G=u.icon.placedSymbolArray;for(let W=0;W<G.length;W++){const Y=G.get(W);if(Y.hidden)_i(Y.numGlyphs,N);else{const re=H[W];if(re)for(let ne=0;ne<Y.numGlyphs;ne++)o.ak(N,re.shiftedAnchor,re.angle);else _i(Y.numGlyphs,N)}}u.icon.dynamicLayoutVertexBuffer.updateData(N)}u.text.dynamicLayoutVertexBuffer.updateData(B)}function ud(u,e,i){return i.iconsInText&&e?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function uo(u,e,i,a,l,h,m,v,x,P,I,k,D){const B=u.context,N=B.gl,H=u.transform,G=v==="map",W=x==="map",Y=v!=="viewport"&&i.layout.get("symbol-placement")!=="point",re=G&&!W&&!Y,ne=!i.layout.get("symbol-sort-key").isConstant();let ae=!1;const ce=u.getDepthModeForSublayer(0,gt.ReadOnly),le=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ye=[],be=H.getCircleRadiusCorrection();for(const Ie of a){const Ae=e.getTile(Ie),Se=Ae.getBucket(i);if(!Se)continue;const Ve=l?Se.text:Se.icon;if(!Ve||!Ve.segments.get().length||!Ve.hasVisibleVertices)continue;const je=Ve.programConfigurations.get(i.id),De=l||Se.sdfIcons,qe=l?Se.textSizeData:Se.iconSizeData,_t=W||H.pitch!==0,Ct=u.useProgram(ud(De,l,Se),je),Yt=o.ah(qe,H.zoom),Lt=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Ie);let Jt,Rt,zt,Ft,Li=[0,0],di=null;if(l)Rt=Ae.glyphAtlasTexture,zt=N.LINEAR,Jt=Ae.glyphAtlasTexture.size,Se.iconsInText&&(Li=Ae.imageAtlasTexture.size,di=Ae.imageAtlasTexture,Ft=_t||u.options.rotating||u.options.zooming||qe.kind==="composite"||qe.kind==="camera"?N.LINEAR:N.NEAREST);else{const Bt=i.layout.get("icon-size").constantOr(0)!==1||Se.iconsNeedLinear;Rt=Ae.imageAtlasTexture,zt=De||u.options.rotating||u.options.zooming||Bt||_t?N.LINEAR:N.NEAREST,Jt=Ae.imageAtlasTexture.size}const pi=o.at(Ae,1,u.transform.zoom),Xi=we(G,u.transform,pi),an=o.H();o.an(an,Xi);const Zr=pe(W,G,u.transform,pi),ur=o.au(H,Ae,h,m),on=H.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),ka=le&&Se.hasTextData(),Aa=i.layout.get("icon-text-fit")!=="none"&&ka&&Se.hasIconData();if(Y){const Bt=u.style.map.terrain?(dr,ti)=>u.style.map.terrain.getElevation(Ie,dr,ti):null,Qt=i.layout.get("text-rotation-alignment")==="map";Ue(Se,u,l,Xi,an,W,P,Qt,Ie.toUnwrapped(),H.width,H.height,ur,Bt)}const Us=l&&le||Aa,ir=Y||Us?_u:W?Xi:u.transform.clipSpaceToPixelsMatrix,Pr=De&&i.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Sr;Sr=De?Se.iconsInText?tn(qe.kind,Yt,re,W,Y,Us,u,ir,Zr,ur,Jt,Li,be):ma(qe.kind,Yt,re,W,Y,Us,u,ir,Zr,ur,l,Jt,0,be):Tl(qe.kind,Yt,re,W,Y,Us,u,ir,Zr,ur,l,Jt,be);const hr={program:Ct,buffers:Ve,uniformValues:Sr,projectionData:on,atlasTexture:Rt,atlasTextureIcon:di,atlasInterpolation:zt,atlasInterpolationIcon:Ft,isSDF:De,hasHalo:Pr};if(ne&&Se.canOverlap){ae=!0;const Bt=Ve.segments.get();for(const Qt of Bt)ye.push({segments:new o.aD([Qt]),sortKey:Qt.sortKey,state:hr,terrainData:Lt})}else ye.push({segments:Ve.segments,sortKey:0,state:hr,terrainData:Lt})}ae&&ye.sort((Ie,Ae)=>Ie.sortKey-Ae.sortKey);for(const Ie of ye){const Ae=Ie.state;if(B.activeTexture.set(N.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,N.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(B.activeTexture.set(N.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,N.CLAMP_TO_EDGE)),Ae.isSDF){const Se=Ae.uniformValues;Ae.hasHalo&&(Se.u_is_halo=1,yu(Ae.buffers,Ie.segments,i,u,Ae.program,ce,I,k,Se,Ae.projectionData,Ie.terrainData)),Se.u_is_halo=0}yu(Ae.buffers,Ie.segments,i,u,Ae.program,ce,I,k,Ae.uniformValues,Ae.projectionData,Ie.terrainData)}}function yu(u,e,i,a,l,h,m,v,x,P,I){const k=a.context;l.draw(k,k.gl.TRIANGLES,h,m,v,Tt.backCCW,x,I,P,i.id,u.layoutVertexBuffer,u.indexBuffer,e,i.paint,a.transform.zoom,u.programConfigurations.get(i.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function vu(u,e,i,a,l){const h=u.context,m=h.gl,v=St.disabled,x=new $t([m.ONE,m.ONE],o.b4.transparent,[!0,!0,!0,!0]),P=e.getBucket(i);if(!P)return;const I=a.key;let k=i.heatmapFbos.get(I);k||(k=po(h,e.tileSize,e.tileSize),i.heatmapFbos.set(I,k)),h.bindFramebuffer.set(k.framebuffer),h.viewport.set([0,0,e.tileSize,e.tileSize]),h.clear({color:o.b4.transparent});const D=P.programConfigurations.get(i.id),B=u.useProgram("heatmap",D,!l),N=u.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),H=u.style.map.terrain.getTerrainData(a);B.draw(h,m.TRIANGLES,gt.disabled,v,x,Tt.disabled,yl(e,u.transform.zoom,i.paint.get("heatmap-intensity"),1),H,N,i.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,i.paint,u.transform.zoom,D)}function ho(u,e,i,a,l){const h=u.context,m=h.gl,v=u.transform;h.setColorMode(u.colorModeForRenderPass());const x=Dl(h,e),P=i.key,I=e.heatmapFbos.get(P);if(!I)return;h.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,I.colorAttachment.get()),h.activeTexture.set(m.TEXTURE1),x.bind(m.LINEAR,m.CLAMP_TO_EDGE);const k=v.getProjectionData({overscaledTileID:i,applyTerrainMatrix:l,applyGlobeMatrix:!a});u.useProgram("heatmapTexture").draw(h,m.TRIANGLES,gt.disabled,St.disabled,u.colorModeForRenderPass(),Tt.disabled,wn(u,e,0,1),null,k,e.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments,e.paint,v.zoom),I.destroy(),e.heatmapFbos.delete(P)}function po(u,e,i){var a,l;const h=u.gl,m=h.createTexture();h.bindTexture(h.TEXTURE_2D,m),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);const v=(a=u.HALF_FLOAT)!==null&&a!==void 0?a:h.UNSIGNED_BYTE,x=(l=u.RGBA16F)!==null&&l!==void 0?l:h.RGBA;h.texImage2D(h.TEXTURE_2D,0,x,e,i,0,h.RGBA,v,null);const P=u.createFramebuffer(e,i,!1,!1);return P.colorAttachment.set(m),P}function Dl(u,e){return e.colorRampTexture||(e.colorRampTexture=new ct(u,e.colorRamp,u.gl.RGBA)),e.colorRampTexture}function Ll(u,e,i,a,l){if(!i||!a||!a.imageAtlas)return;const h=a.imageAtlas.patternPositions;let m=h[i.to.toString()],v=h[i.from.toString()];if(!m&&v&&(m=v),!v&&m&&(v=m),!m||!v){const x=l.getPaintProperty(e);m=h[x],v=h[x]}m&&v&&u.setConstantPatternPositions(m,v)}function ya(u,e,i,a,l,h,m,v){const x=u.context.gl,P="fill-pattern",I=i.paint.get(P),k=I&&I.constantOr(1),D=i.getCrossfadeParameters();let B,N,H,G,W;const Y=u.transform,re=i.paint.get("fill-translate"),ne=i.paint.get("fill-translate-anchor");m?(N=k&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=x.LINES):(N=k?"fillPattern":"fill",B=x.TRIANGLES);const ae=I.constantOr(null);for(const ce of a){const le=e.getTile(ce);if(k&&!le.patternsLoaded())continue;const ye=le.getBucket(i);if(!ye)continue;const be=ye.programConfigurations.get(i.id),Ie=u.useProgram(N,be),Ae=u.style.map.terrain&&u.style.map.terrain.getTerrainData(ce);k&&(u.context.activeTexture.set(x.TEXTURE0),le.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),be.updatePaintBuffers(D)),Ll(be,P,ae,le,i);const Se=Y.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!v,applyTerrainMatrix:!0}),Ve=o.au(Y,le,re,ne);if(m){G=ye.indexBuffer2,W=ye.segments2;const De=[x.drawingBufferWidth,x.drawingBufferHeight];H=N==="fillOutlinePattern"&&k?iu(u,D,le,De,Ve):ed(De,Ve)}else G=ye.indexBuffer,W=ye.segments,H=k?ml(u,D,le,Ve):{u_fill_translate:Ve};let je;if(u.renderPass==="translucent"&&v){const[De]=u.getStencilConfigForOverlapAndUpdateStencilID(a);je=De[ce.overscaledZ]}else je=u.stencilModeForClipping(ce);Ie.draw(u.context,B,l,je,h,Tt.backCCW,H,Ae,Se,i.id,ye.layoutVertexBuffer,G,W,i.paint,u.transform.zoom,be)}}function va(u,e,i,a,l,h,m,v){const x=u.context,P=x.gl,I="fill-extrusion-pattern",k=i.paint.get(I),D=k.constantOr(1),B=i.getCrossfadeParameters(),N=i.paint.get("fill-extrusion-opacity"),H=k.constantOr(null),G=u.transform;for(const W of a){const Y=e.getTile(W),re=Y.getBucket(i);if(!re)continue;const ne=u.style.map.terrain&&u.style.map.terrain.getTerrainData(W),ae=re.programConfigurations.get(i.id),ce=u.useProgram(D?"fillExtrusionPattern":"fillExtrusion",ae);D&&(u.context.activeTexture.set(P.TEXTURE0),Y.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ae.updatePaintBuffers(B));const le=G.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!v,applyTerrainMatrix:!0});Ll(ae,I,H,Y,i);const ye=o.au(G,Y,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),be=i.paint.get("fill-extrusion-vertical-gradient"),Ie=D?Qh(u,be,N,ye,W,B,Y):es(u,be,N,ye);ce.draw(x,x.gl.TRIANGLES,l,h,m,Tt.backCCW,Ie,ne,le,i.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,i.paint,u.transform.zoom,ae,u.style.map.terrain&&re.centroidVertexBuffer)}}function Rl(u,e,i,a,l,h,m,v,x){var P;const I=u.style.projection,k=u.context,D=u.transform,B=k.gl,N=u.useProgram("hillshade"),H=!u.options.moving;for(const G of a){const W=e.getTile(G),Y=W.fbo;if(!Y)continue;const re=I.getMeshFromTileID(k,G.canonical,v,!0,"raster"),ne=(P=u.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(G);k.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,Y.colorAttachment.get());const ae=D.getProjectionData({overscaledTileID:G,aligned:H,applyGlobeMatrix:!x,applyTerrainMatrix:!0});N.draw(k,B.TRIANGLES,h,l[G.overscaledZ],m,Tt.backCCW,su(u,W,i),ne,ae,i.id,re.vertexBuffer,re.indexBuffer,re.segments)}}const fo=[new o.P(0,0),new o.P(o.X,0),new o.P(o.X,o.X),new o.P(0,o.X)];function Xt(u,e,i,a,l,h,m,v,x=!1,P=!1){const I=a[a.length-1].overscaledZ,k=u.context,D=k.gl,B=u.useProgram("raster"),N=u.transform,H=u.style.projection,G=u.colorModeForRenderPass(),W=!u.options.moving;for(const Y of a){const re=u.getDepthModeForSublayer(Y.overscaledZ-I,i.paint.get("raster-opacity")===1?gt.ReadWrite:gt.ReadOnly,D.LESS),ne=e.getTile(Y);ne.registerFadeDuration(i.paint.get("raster-fade-duration"));const ae=e.findLoadedParent(Y,0),ce=e.findLoadedSibling(Y),le=ns(ne,ae||ce||null,e,i,u.transform,u.style.map.terrain);let ye,be;const Ie=i.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;k.activeTexture.set(D.TEXTURE0),ne.texture.bind(Ie,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(D.TEXTURE1),ae?(ae.texture.bind(Ie,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),ye=Math.pow(2,ae.tileID.overscaledZ-ne.tileID.overscaledZ),be=[ne.tileID.canonical.x*ye%1,ne.tileID.canonical.y*ye%1]):ne.texture.bind(Ie,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),ne.texture.useMipmap&&k.extTextureFilterAnisotropic&&u.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const Ae=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Y),Se=N.getProjectionData({overscaledTileID:Y,aligned:W,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),Ve=ou(be||[0,0],ye||1,le,i,v),je=H.getMeshFromTileID(k,Y.canonical,h,m,"raster");B.draw(k,D.TRIANGLES,re,l?l[Y.overscaledZ]:St.disabled,G,x?Tt.frontCCW:Tt.backCCW,Ve,Ae,Se,i.id,je.vertexBuffer,je.indexBuffer,je.segments)}}function ns(u,e,i,a,l,h){const m=a.paint.get("raster-fade-duration");if(!h&&m>0){const v=ie.now(),x=(v-u.timeAdded)/m,P=e?(v-e.timeAdded)/m:-1,I=i.getSource(),k=vn(l,{tileSize:I.tileSize,roundZoom:I.roundZoom}),D=!e||Math.abs(e.tileID.overscaledZ-k)>Math.abs(u.tileID.overscaledZ-k),B=D&&u.refreshedUponExpiration?1:o.ab(D?x:1-P,0,1);return u.refreshedUponExpiration&&x>=1&&(u.refreshedUponExpiration=!1),e?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}const Tr=new o.b4(1,0,0,1),Fl=new o.b4(0,1,0,1),Bl=new o.b4(0,0,1,1),bu=new o.b4(1,0,1,1),zs=new o.b4(0,1,1,1);function Ds(u,e,i,a){ba(u,0,e+i/2,u.transform.width,i,a)}function mo(u,e,i,a){ba(u,e-i/2,0,i,u.transform.height,a)}function ba(u,e,i,a,l,h){const m=u.context,v=m.gl;v.enable(v.SCISSOR_TEST),v.scissor(e*u.pixelRatio,i*u.pixelRatio,a*u.pixelRatio,l*u.pixelRatio),m.clear({color:h}),v.disable(v.SCISSOR_TEST)}function xu(u,e,i){const a=u.context,l=a.gl,h=u.useProgram("debug"),m=gt.disabled,v=St.disabled,x=u.colorModeForRenderPass(),P="$debug",I=u.style.map.terrain&&u.style.map.terrain.getTerrainData(i);a.activeTexture.set(l.TEXTURE0);const k=e.getTileByID(i.key).latestRawTileData,D=Math.floor((k&&k.byteLength||0)/1024),B=e.getTile(i).tileSize,N=512/Math.min(B,512)*(i.overscaledZ/u.transform.zoom)*.5;let H=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(H+=` => ${i.overscaledZ}`),function(W,Y){W.initDebugOverlayCanvas();const re=W.debugOverlayCanvas,ne=W.context.gl,ae=W.debugOverlayCanvas.getContext("2d");ae.clearRect(0,0,re.width,re.height),ae.shadowColor="white",ae.shadowBlur=2,ae.lineWidth=1.5,ae.strokeStyle="white",ae.textBaseline="top",ae.font="bold 36px Open Sans, sans-serif",ae.fillText(Y,5,5),ae.strokeText(Y,5,5),W.debugOverlayTexture.update(re),W.debugOverlayTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE)}(u,`${H} ${D}kB`);const G=u.transform.getProjectionData({overscaledTileID:i,applyGlobeMatrix:!0,applyTerrainMatrix:!0});h.draw(a,l.TRIANGLES,m,v,$t.alphaBlended,Tt.disabled,_l(o.b4.transparent,N),null,G,P,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),h.draw(a,l.LINE_STRIP,m,v,x,Tt.disabled,_l(o.b4.red),I,G,P,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function Ol(u,e,i,a){const{isRenderingGlobe:l}=a,h=u.context,m=h.gl,v=u.transform,x=u.colorModeForRenderPass(),P=u.getDepthModeFor3D(),I=u.useProgram("terrain");h.bindFramebuffer.set(null),h.viewport.set([0,0,u.width,u.height]);for(const k of i){const D=e.getTerrainMesh(k.tileID),B=u.renderToTexture.getTexture(k),N=e.getTerrainData(k.tileID);h.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,B.texture);const H=e.getMeshFrameDelta(v.zoom),G=v.calculateFogMatrix(k.tileID.toUnwrapped()),W=da(H,G,u.style.sky,v.pitch,l),Y=v.getProjectionData({overscaledTileID:k.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});I.draw(h,m.TRIANGLES,P,St.disabled,x,Tt.backCCW,W,N,Y,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}function jl(u,e){if(!e.mesh){const i=new o.aC;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1);const a=new o.aE;a.emplaceBack(0,1,2),a.emplaceBack(0,2,3),e.mesh=new Vr(u.createVertexBuffer(i,bt.members),u.createIndexBuffer(a),o.aD.simpleSegment(0,0,i.length,a.length))}return e.mesh}class wu{constructor(e,i){this.context=new ao(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.aq(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=j.maxUnderzooming+j.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Xn}resize(e,i,a){if(this.width=Math.floor(e*a),this.height=Math.floor(i*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const l of this.style._order)this.style._layers[l].resize()}setup(){const e=this.context,i=new o.aC;i.emplaceBack(0,0),i.emplaceBack(o.X,0),i.emplaceBack(0,o.X),i.emplaceBack(o.X,o.X),this.tileExtentBuffer=e.createVertexBuffer(i,bt.members),this.tileExtentSegments=o.aD.simpleSegment(0,0,4,2);const a=new o.aC;a.emplaceBack(0,0),a.emplaceBack(o.X,0),a.emplaceBack(0,o.X),a.emplaceBack(o.X,o.X),this.debugBuffer=e.createVertexBuffer(a,bt.members),this.debugSegments=o.aD.simpleSegment(0,0,4,5);const l=new o.bT;l.emplaceBack(0,0,0,0),l.emplaceBack(o.X,0,o.X,0),l.emplaceBack(0,o.X,0,o.X),l.emplaceBack(o.X,o.X,o.X,o.X),this.rasterBoundsBuffer=e.createVertexBuffer(l,Jh.members),this.rasterBoundsSegments=o.aD.simpleSegment(0,0,4,2);const h=new o.aC;h.emplaceBack(0,0),h.emplaceBack(o.X,0),h.emplaceBack(0,o.X),h.emplaceBack(o.X,o.X),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(h,bt.members),this.rasterBoundsSegmentsPosOnly=o.aD.simpleSegment(0,0,4,5);const m=new o.aC;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(m,bt.members),this.viewportSegments=o.aD.simpleSegment(0,0,4,2);const v=new o.bU;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const x=new o.aE;x.emplaceBack(1,0,2),x.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(x);const P=this.context.gl;this.stencilClearMode=new St({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.tileExtentMesh=new Vr(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=o.H();o.bL(a,0,this.width,this.height,0,0,1),o.K(a,a,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const l={mainMatrix:a,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,gt.disabled,this.stencilClearMode,$t.disabled,Tt.disabled,null,null,l,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,i,a){if(this.currentStencilSource===e.source||!e.isTileClipped()||!i||!i.length)return;this.currentStencilSource=e.source,this.nextStencilID+i.length>256&&this.clearStencil();const l=this.context;l.setColorMode($t.disabled),l.setDepthMode(gt.disabled);const h={};for(const m of i)h[m.key]=this.nextStencilID++;this._renderTileMasks(h,i,a,!0),this._renderTileMasks(h,i,a,!1),this._tileClippingMaskIDs=h}_renderTileMasks(e,i,a,l){const h=this.context,m=h.gl,v=this.style.projection,x=this.transform,P=this.useProgram("clippingMask");for(const I of i){const k=e[I.key],D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),B=v.getMeshFromTileID(this.context,I.canonical,l,!0,"stencil"),N=x.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!0,applyTerrainMatrix:!0});P.draw(h,m.TRIANGLES,gt.disabled,new St({func:m.ALWAYS,mask:0},k,255,m.KEEP,m.KEEP,m.REPLACE),$t.disabled,a?Tt.disabled:Tt.backCCW,null,D,N,"$clipping",B.vertexBuffer,B.indexBuffer,B.segments)}}_renderTilesDepthBuffer(){const e=this.context,i=e.gl,a=this.style.projection,l=this.transform,h=this.useProgram("depth"),m=this.getDepthModeFor3D(),v=Z(l,{tileSize:l.tileSize});for(const x of v){const P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x),I=a.getMeshFromTileID(this.context,x.canonical,!0,!0,"raster"),k=l.getProjectionData({overscaledTileID:x,applyGlobeMatrix:!0,applyTerrainMatrix:!0});h.draw(e,i.TRIANGLES,m,St.disabled,$t.disabled,Tt.backCCW,null,P,k,"$clipping",I.vertexBuffer,I.indexBuffer,I.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new St({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){const i=this.context.gl;return new St({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const i=this.context.gl,a=e.sort((m,v)=>v.overscaledZ-m.overscaledZ),l=a[a.length-1].overscaledZ,h=a[0].overscaledZ-l+1;if(h>1){this.currentStencilSource=void 0,this.nextStencilID+h>256&&this.clearStencil();const m={};for(let v=0;v<h;v++)m[v+l]=new St({func:i.GEQUAL,mask:255},v+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=h,[m,a]}return[{[l]:St.disabled},a]}stencilConfigForOverlapTwoPass(e){const i=this.context.gl,a=e.sort((m,v)=>v.overscaledZ-m.overscaledZ),l=a[a.length-1].overscaledZ,h=a[0].overscaledZ-l+1;if(this.clearStencil(),h>1){const m={},v={};for(let x=0;x<h;x++)m[x+l]=new St({func:i.GREATER,mask:255},h+1+x,255,i.KEEP,i.KEEP,i.REPLACE),v[x+l]=new St({func:i.GREATER,mask:255},1+x,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID=2*h+1,[m,v,a]}return this.nextStencilID=3,[{[l]:new St({func:i.GREATER,mask:255},2,255,i.KEEP,i.KEEP,i.REPLACE)},{[l]:new St({func:i.GREATER,mask:255},1,255,i.KEEP,i.KEEP,i.REPLACE)},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new $t([e.CONSTANT_COLOR,e.ONE],new o.b4(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$t.unblended:$t.alphaBlended}getDepthModeForSublayer(e,i,a){if(!this.opaquePassEnabledForLayer())return gt.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new gt(a||this.context.gl.LEQUAL,i,[l,l])}getDepthModeFor3D(){return new gt(this.context.gl.LEQUAL,gt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var a,l;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ie.now()),this.imageManager.beginFrame();const h=this.style._order,m=this.style.sourceCaches,v={},x={},P={},I={isRenderingToTexture:!1,isRenderingGlobe:((a=e.projection)===null||a===void 0?void 0:a.transitionState)>0};for(const D in m){const B=m[D];B.used&&B.prepare(this.context),v[D]=B.getVisibleCoordinates(!1),x[D]=v[D].slice().reverse(),P[D]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<h.length;D++)if(this.style._layers[h[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of h){const B=this.style._layers[D];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const N=x[B.source];(B.type==="custom"||N.length)&&this.renderLayer(this,m[B.source],B,N,I)}if((l=this.style.projection)===null||l===void 0||l.updateGPUdependent({context:this.context,useProgram:D=>this.useProgram(D)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?o.b4.black:o.b4.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(D,B){const N=D.context,H=N.gl,G=((ce,le,ye)=>{const be=Math.cos(le.rollInRadians),Ie=Math.sin(le.rollInRadians),Ae=ei(le),Se=le.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ce.properties.get("sky-color"),u_horizon_color:ce.properties.get("horizon-color"),u_horizon:[(le.width/2-Ae*Ie)*ye,(le.height/2+Ae*be)*ye],u_horizon_normal:[-Ie,be],u_sky_horizon_blend:ce.properties.get("sky-horizon-blend")*le.height/2*ye,u_sky_blend:Se}})(B,D.style.map.transform,D.pixelRatio),W=new gt(H.LEQUAL,gt.ReadWrite,[0,1]),Y=St.disabled,re=D.colorModeForRenderPass(),ne=D.useProgram("sky"),ae=jl(N,B);ne.draw(N,H.TRIANGLES,W,Y,re,Tt.disabled,G,null,void 0,"sky",ae.vertexBuffer,ae.indexBuffer,ae.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[h[this.currentLayer]],B=m[D.source],N=v[D.source];this._renderTileClippingMasks(D,N,!1),this.renderLayer(this,B,D,N,I)}this.renderPass="translucent";let k=!1;for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const D=this.style._layers[h[this.currentLayer]],B=m[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D,I))continue;this.opaquePassEnabledForLayer()||k||(k=!0,I.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const N=(D.type==="symbol"?P:x)[D.source];this._renderTileClippingMasks(D,v[D.source],!1),this.renderLayer(this,B,D,N,I)}if(I.isRenderingGlobe&&function(D,B,N){const H=D.context,G=H.gl,W=D.useProgram("atmosphere"),Y=new gt(G.LEQUAL,gt.ReadOnly,[0,1]),re=D.transform,ne=function(Se,Ve){const je=Se.properties.get("position"),De=[-je.x,-je.y,-je.z],qe=o.aq(new Float64Array(16));return Se.properties.get("anchor")==="map"&&(o.aX(qe,qe,Ve.rollInRadians),o.aY(qe,qe,-Ve.pitchInRadians),o.aX(qe,qe,Ve.bearingInRadians),o.aY(qe,qe,Ve.center.lat*Math.PI/180),o.bj(qe,qe,-Ve.center.lng*Math.PI/180)),o.bS(De,De,qe),De}(N,D.transform),ae=re.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ce=B.properties.get("atmosphere-blend")*ae.projectionTransition;if(ce===0)return;const le=Cs(re.worldSize,re.center.lat),ye=re.inverseProjectionMatrix,be=new Float64Array(4);be[3]=1,o.al(be,be,re.modelViewProjectionMatrix),be[0]/=be[3],be[1]/=be[3],be[2]/=be[3],be[3]=1,o.al(be,be,ye),be[0]/=be[3],be[1]/=be[3],be[2]/=be[3],be[3]=1;const Ie=((Se,Ve,je,De,qe)=>({u_sun_pos:Se,u_atmosphere_blend:Ve,u_globe_position:je,u_globe_radius:De,u_inv_proj_matrix:qe}))(ne,ce,[be[0],be[1],be[2]],le,ye),Ae=jl(H,B);W.draw(H,G.TRIANGLES,Y,St.disabled,$t.alphaBlended,Tt.disabled,Ie,null,null,"atmosphere",Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const D=function(B,N){let H=null;const G=Object.values(B._layers).flatMap(ne=>ne.source&&!ne.isHidden(N)?[B.sourceCaches[ne.source]]:[]),W=G.filter(ne=>ne.getSource().type==="vector"),Y=G.filter(ne=>ne.getSource().type!=="vector"),re=ne=>{(!H||H.getSource().maxzoom<ne.getSource().maxzoom)&&(H=ne)};return W.forEach(ne=>re(ne)),H||Y.forEach(ne=>re(ne)),H}(this.style,this.transform.zoom);D&&function(B,N,H){for(let G=0;G<H.length;G++)xu(B,N,H[G])}(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const B=D.transform.padding;Ds(D,D.transform.height-(B.top||0),3,Tr),Ds(D,B.bottom||0,3,Fl),mo(D,B.left||0,3,Bl),mo(D,D.transform.width-(B.right||0),3,bu);const N=D.transform.centerPoint;(function(H,G,W,Y){ba(H,G-1,W-10,2,20,Y),ba(H,G-10,W-1,20,2,Y)})(D,N.x,D.transform.height-N.y,zs)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let l=this.terrainFacilitator.dirty;l||(l=e?!o.bV(i,a):!o.bW(i,a)),l||(l=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),l&&(o.bX(i,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(h,m){const v=h.context,x=v.gl,P=h.transform,I=$t.unblended,k=new gt(x.LEQUAL,gt.ReadWrite,[0,1]),D=m.sourceCache.getRenderableTiles(),B=h.useProgram("terrainDepth");v.bindFramebuffer.set(m.getFramebuffer("depth").framebuffer),v.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),v.clear({color:o.b4.transparent,depth:1});for(const N of D){const H=m.getTerrainMesh(N.tileID),G=m.getTerrainData(N.tileID),W=P.getProjectionData({overscaledTileID:N.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Y={u_ele_delta:m.getMeshFrameDelta(P.zoom)};B.draw(v,x.TRIANGLES,k,St.disabled,I,Tt.backCCW,Y,G,W,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain),function(h,m){const v=h.context,x=v.gl,P=h.transform,I=$t.unblended,k=new gt(x.LEQUAL,gt.ReadWrite,[0,1]),D=m.getCoordsTexture(),B=m.sourceCache.getRenderableTiles(),N=h.useProgram("terrainCoords");v.bindFramebuffer.set(m.getFramebuffer("coords").framebuffer),v.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),v.clear({color:o.b4.transparent,depth:1}),m.coordsIndex=[];for(const H of B){const G=m.getTerrainMesh(H.tileID),W=m.getTerrainData(H.tileID);v.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,D.texture);const Y={u_terrain_coords_id:(255-m.coordsIndex.length)/255,u_texture:0,u_ele_delta:m.getMeshFrameDelta(P.zoom)},re=P.getProjectionData({overscaledTileID:H.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});N.draw(v,x.TRIANGLES,k,St.disabled,I,Tt.backCCW,Y,W,re,"terrain",G.vertexBuffer,G.indexBuffer,G.segments),m.coordsIndex.push(H.tileID.key)}v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain))}renderLayer(e,i,a,l,h){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(l||[]).length)&&(this.id=a.id,o.bY(a)?function(m,v,x,P,I,k){if(m.renderPass!=="translucent")return;const{isRenderingToTexture:D}=k,B=St.disabled,N=m.colorModeForRenderPass();(x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(H,G,W,Y,re,ne,ae,ce,le){const ye=G.transform,be=G.style.map.terrain,Ie=re==="map",Ae=ne==="map";for(const Se of H){const Ve=Y.getTile(Se),je=Ve.getBucket(W);if(!je||!je.text||!je.text.segments.get().length)continue;const De=o.ah(je.textSizeData,ye.zoom),qe=o.at(Ve,1,G.transform.zoom),_t=we(Ie,G.transform,qe),Ct=W.layout.get("icon-text-fit")!=="none"&&je.hasIconData();{const Yt=Math.pow(2,ye.zoom-Ve.tileID.overscaledZ),Lt=be?(Jt,Rt)=>be.getElevation(Se,Jt,Rt):null;zl(je,Ie,Ae,le,ye,_t,Yt,De,Ct,o.au(ye,Ve,ae,ce),Se.toUnwrapped(),Lt)}}}(P,m,x,v,x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),I),x.paint.get("icon-opacity").constantOr(1)!==0&&uo(m,v,x,P,!1,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),x.layout.get("icon-rotation-alignment"),x.layout.get("icon-pitch-alignment"),x.layout.get("icon-keep-upright"),B,N,D),x.paint.get("text-opacity").constantOr(1)!==0&&uo(m,v,x,P,!0,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.layout.get("text-keep-upright"),B,N,D),v.map.showCollisionBoxes&&(oo(m,v,x,P,!0),oo(m,v,x,P,!1))}(e,i,a,l,this.style.placement.variableOffsets,h):o.bZ(a)?function(m,v,x,P,I){if(m.renderPass!=="translucent")return;const{isRenderingToTexture:k}=I,D=x.paint.get("circle-opacity"),B=x.paint.get("circle-stroke-width"),N=x.paint.get("circle-stroke-opacity"),H=!x.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(B.constantOr(1)===0||N.constantOr(1)===0))return;const G=m.context,W=G.gl,Y=m.transform,re=m.getDepthModeForSublayer(0,gt.ReadOnly),ne=St.disabled,ae=m.colorModeForRenderPass(),ce=[],le=Y.getCircleRadiusCorrection();for(let ye=0;ye<P.length;ye++){const be=P[ye],Ie=v.getTile(be),Ae=Ie.getBucket(x);if(!Ae)continue;const Se=x.paint.get("circle-translate"),Ve=x.paint.get("circle-translate-anchor"),je=o.au(Y,Ie,Se,Ve),De=Ae.programConfigurations.get(x.id),qe=m.useProgram("circle",De),_t=Ae.layoutVertexBuffer,Ct=Ae.indexBuffer,Yt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(be),Lt={programConfiguration:De,program:qe,layoutVertexBuffer:_t,indexBuffer:Ct,uniformValues:gl(m,Ie,x,je,le),terrainData:Yt,projectionData:Y.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!k,applyTerrainMatrix:!0})};if(H){const Jt=Ae.segments.get();for(const Rt of Jt)ce.push({segments:new o.aD([Rt]),sortKey:Rt.sortKey,state:Lt})}else ce.push({segments:Ae.segments,sortKey:0,state:Lt})}H&&ce.sort((ye,be)=>ye.sortKey-be.sortKey);for(const ye of ce){const{programConfiguration:be,program:Ie,layoutVertexBuffer:Ae,indexBuffer:Se,uniformValues:Ve,terrainData:je,projectionData:De}=ye.state;Ie.draw(G,W.TRIANGLES,re,ne,ae,Tt.backCCW,Ve,je,De,x.id,Ae,Se,ye.segments,x.paint,m.transform.zoom,be)}}(e,i,a,l,h):o.b_(a)?function(m,v,x,P,I){if(x.paint.get("heatmap-opacity")===0)return;const k=m.context,{isRenderingToTexture:D,isRenderingGlobe:B}=I;if(m.style.map.terrain){for(const N of P){const H=v.getTile(N);v.hasRenderableParent(N)||(m.renderPass==="offscreen"?vu(m,H,x,N,B):m.renderPass==="translucent"&&ho(m,x,N,D,B))}k.viewport.set([0,0,m.width,m.height])}else m.renderPass==="offscreen"?function(N,H,G,W){const Y=N.context,re=Y.gl,ne=N.transform,ae=St.disabled,ce=new $t([re.ONE,re.ONE],o.b4.transparent,[!0,!0,!0,!0]);(function(le,ye,be){const Ie=le.gl;le.activeTexture.set(Ie.TEXTURE1),le.viewport.set([0,0,ye.width/4,ye.height/4]);let Ae=be.heatmapFbos.get(o.bP);Ae?(Ie.bindTexture(Ie.TEXTURE_2D,Ae.colorAttachment.get()),le.bindFramebuffer.set(Ae.framebuffer)):(Ae=po(le,ye.width/4,ye.height/4),be.heatmapFbos.set(o.bP,Ae))})(Y,N,G),Y.clear({color:o.b4.transparent});for(let le=0;le<W.length;le++){const ye=W[le];if(H.hasRenderableParent(ye))continue;const be=H.getTile(ye),Ie=be.getBucket(G);if(!Ie)continue;const Ae=Ie.programConfigurations.get(G.id),Se=N.useProgram("heatmap",Ae),Ve=ne.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),je=ne.getCircleRadiusCorrection();Se.draw(Y,re.TRIANGLES,gt.disabled,ae,ce,Tt.backCCW,yl(be,ne.zoom,G.paint.get("heatmap-intensity"),je),null,Ve,G.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,G.paint,ne.zoom,Ae)}Y.viewport.set([0,0,N.width,N.height])}(m,v,x,P):m.renderPass==="translucent"&&function(N,H){const G=N.context,W=G.gl;G.setColorMode(N.colorModeForRenderPass());const Y=H.heatmapFbos.get(o.bP);Y&&(G.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_2D,Y.colorAttachment.get()),G.activeTexture.set(W.TEXTURE1),Dl(G,H).bind(W.LINEAR,W.CLAMP_TO_EDGE),N.useProgram("heatmapTexture").draw(G,W.TRIANGLES,gt.disabled,St.disabled,N.colorModeForRenderPass(),Tt.disabled,wn(N,H,0,1),null,null,H.id,N.viewportBuffer,N.quadTriangleIndexBuffer,N.viewportSegments,H.paint,N.transform.zoom))}(m,x)}(e,i,a,l,h):o.b$(a)?function(m,v,x,P,I){if(m.renderPass!=="translucent")return;const{isRenderingToTexture:k}=I,D=x.paint.get("line-opacity"),B=x.paint.get("line-width");if(D.constantOr(1)===0||B.constantOr(1)===0)return;const N=m.getDepthModeForSublayer(0,gt.ReadOnly),H=m.colorModeForRenderPass(),G=x.paint.get("line-dasharray"),W=x.paint.get("line-pattern"),Y=W.constantOr(1),re=x.paint.get("line-gradient"),ne=x.getCrossfadeParameters(),ae=Y?"linePattern":G?"lineSDF":re?"lineGradient":"line",ce=m.context,le=ce.gl,ye=m.transform;let be=!0;for(const Ie of P){const Ae=v.getTile(Ie);if(Y&&!Ae.patternsLoaded())continue;const Se=Ae.getBucket(x);if(!Se)continue;const Ve=Se.programConfigurations.get(x.id),je=m.context.program.get(),De=m.useProgram(ae,Ve),qe=be||De.program!==je,_t=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ie),Ct=W.constantOr(null);if(Ct&&Ae.imageAtlas){const zt=Ae.imageAtlas,Ft=zt.patternPositions[Ct.to.toString()],Li=zt.patternPositions[Ct.from.toString()];Ft&&Li&&Ve.setConstantPatternPositions(Ft,Li)}const Yt=ye.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),Lt=ye.getPixelScale(),Jt=Y?td(m,Ae,x,Lt,ne):G?id(m,Ae,x,Lt,G,ne):re?Xa(m,Ae,x,Lt,Se.lineClipsArray.length):vl(m,Ae,x,Lt);if(Y)ce.activeTexture.set(le.TEXTURE0),Ae.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Ve.updatePaintBuffers(ne);else if(G&&(qe||m.lineAtlas.dirty))ce.activeTexture.set(le.TEXTURE0),m.lineAtlas.bind(ce);else if(re){const zt=Se.gradients[x.id];let Ft=zt.texture;if(x.gradientVersion!==zt.version){let Li=256;if(x.stepInterpolant){const di=v.getSource().maxzoom,pi=Ie.canonical.z===di?Math.ceil(1<<m.transform.maxZoom-Ie.canonical.z):1;Li=o.ab(o.bQ(Se.maxLineLength/o.X*1024*pi),256,ce.maxTextureSize)}zt.gradient=o.bR({expression:x.gradientExpression(),evaluationKey:"lineProgress",resolution:Li,image:zt.gradient||void 0,clips:Se.lineClipsArray}),zt.texture?zt.texture.update(zt.gradient):zt.texture=new ct(ce,zt.gradient,le.RGBA),zt.version=x.gradientVersion,Ft=zt.texture}ce.activeTexture.set(le.TEXTURE0),Ft.bind(x.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}let Rt;if(k){const[zt]=m.getStencilConfigForOverlapAndUpdateStencilID(P);Rt=zt[Ie.overscaledZ]}else Rt=m.stencilModeForClipping(Ie);De.draw(ce,le.TRIANGLES,N,Rt,H,Tt.disabled,Jt,_t,Yt,x.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,x.paint,m.transform.zoom,Ve,Se.layoutVertexBuffer2),be=!1}}(e,i,a,l,h):o.c0(a)?function(m,v,x,P,I){const k=x.paint.get("fill-color"),D=x.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const{isRenderingToTexture:B}=I,N=m.colorModeForRenderPass(),H=x.paint.get("fill-pattern"),G=m.opaquePassEnabledForLayer()&&!H.constantOr(1)&&k.constantOr(o.b4.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===G){const W=m.getDepthModeForSublayer(1,m.renderPass==="opaque"?gt.ReadWrite:gt.ReadOnly);ya(m,v,x,P,W,N,!1,B)}if(m.renderPass==="translucent"&&x.paint.get("fill-antialias")){const W=m.getDepthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,gt.ReadOnly);ya(m,v,x,P,W,N,!0,B)}}(e,i,a,l,h):o.c1(a)?function(m,v,x,P,I){const k=x.paint.get("fill-extrusion-opacity");if(k===0)return;const{isRenderingToTexture:D}=I;if(m.renderPass==="translucent"){const B=new gt(m.context.gl.LEQUAL,gt.ReadWrite,m.depthRangeFor3D);if(k!==1||x.paint.get("fill-extrusion-pattern").constantOr(1))va(m,v,x,P,B,St.disabled,$t.disabled,D),va(m,v,x,P,B,m.stencilModeFor3D(),m.colorModeForRenderPass(),D);else{const N=m.colorModeForRenderPass();va(m,v,x,P,B,St.disabled,N,D)}}}(e,i,a,l,h):o.c2(a)?function(m,v,x,P,I){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const{isRenderingToTexture:k}=I,D=m.context,B=m.style.projection.useSubdivision,N=m.getDepthModeForSublayer(0,gt.ReadOnly),H=m.colorModeForRenderPass();if(m.renderPass==="offscreen")(function(G,W,Y,re,ne,ae,ce){const le=G.context,ye=le.gl;for(const be of Y){const Ie=W.getTile(be),Ae=Ie.dem;if(!Ae||!Ae.data||!Ie.needsHillshadePrepare)continue;const Se=Ae.dim,Ve=Ae.stride,je=Ae.getPixels();if(le.activeTexture.set(ye.TEXTURE1),le.pixelStoreUnpackPremultiplyAlpha.set(!1),Ie.demTexture=Ie.demTexture||G.getTileTexture(Ve),Ie.demTexture){const qe=Ie.demTexture;qe.update(je,{premultiply:!1}),qe.bind(ye.NEAREST,ye.CLAMP_TO_EDGE)}else Ie.demTexture=new ct(le,je,ye.RGBA,{premultiply:!1}),Ie.demTexture.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);le.activeTexture.set(ye.TEXTURE0);let De=Ie.fbo;if(!De){const qe=new ct(le,{width:Se,height:Se,data:null},ye.RGBA);qe.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),De=Ie.fbo=le.createFramebuffer(Se,Se,!0,!1),De.colorAttachment.set(qe.texture)}le.bindFramebuffer.set(De.framebuffer),le.viewport.set([0,0,Se,Se]),G.useProgram("hillshadePrepare").draw(le,ye.TRIANGLES,ne,ae,ce,Tt.disabled,au(Ie.tileID,Ae),null,null,re.id,G.rasterBoundsBuffer,G.quadTriangleIndexBuffer,G.rasterBoundsSegments),Ie.needsHillshadePrepare=!1}})(m,v,P,x,N,St.disabled,H),D.viewport.set([0,0,m.width,m.height]);else if(m.renderPass==="translucent")if(B){const[G,W,Y]=m.stencilConfigForOverlapTwoPass(P);Rl(m,v,x,Y,G,N,H,!1,k),Rl(m,v,x,Y,W,N,H,!0,k)}else{const[G,W]=m.getStencilConfigForOverlapAndUpdateStencilID(P);Rl(m,v,x,W,G,N,H,!1,k)}}(e,i,a,l,h):o.c3(a)?function(m,v,x,P,I){if(m.renderPass!=="translucent"||x.paint.get("raster-opacity")===0||!P.length)return;const{isRenderingToTexture:k}=I,D=v.getSource(),B=m.style.projection.useSubdivision;if(D instanceof or)Xt(m,v,x,P,null,!1,!1,D.tileCoords,D.flippedWindingOrder,k);else if(B){const[N,H,G]=m.stencilConfigForOverlapTwoPass(P);Xt(m,v,x,G,N,!1,!0,fo,!1,k),Xt(m,v,x,G,H,!0,!0,fo,!1,k)}else{const[N,H]=m.getStencilConfigForOverlapAndUpdateStencilID(P);Xt(m,v,x,H,N,!1,!0,fo,!1,k)}}(e,i,a,l,h):o.c4(a)?function(m,v,x,P,I){const k=x.paint.get("background-color"),D=x.paint.get("background-opacity");if(D===0)return;const{isRenderingToTexture:B}=I,N=m.context,H=N.gl,G=m.style.projection,W=m.transform,Y=W.tileSize,re=x.paint.get("background-pattern");if(m.isPatternMissing(re))return;const ne=!re&&k.a===1&&D===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==ne)return;const ae=St.disabled,ce=m.getDepthModeForSublayer(0,ne==="opaque"?gt.ReadWrite:gt.ReadOnly),le=m.colorModeForRenderPass(),ye=m.useProgram(re?"backgroundPattern":"background"),be=P||Z(W,{tileSize:Y,terrain:m.style.map.terrain});re&&(N.activeTexture.set(H.TEXTURE0),m.imageManager.bind(m.context));const Ie=x.getCrossfadeParameters();for(const Ae of be){const Se=W.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Ve=re?Sl(D,m,re,{tileID:Ae,tileSize:Y},Ie):Pl(D,k),je=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Ae),De=G.getMeshFromTileID(N,Ae.canonical,!1,!0,"raster");ye.draw(N,H.TRIANGLES,ce,ae,le,Tt.backCCW,Ve,je,Se,x.id,De.vertexBuffer,De.indexBuffer,De.segments)}}(e,0,a,l,h):o.c5(a)&&function(m,v,x,P){const{isRenderingGlobe:I}=P,k=m.context,D=x.implementation,B=m.style.projection,N=m.transform,H=N.getProjectionDataForCustomLayer(I),G={farZ:N.farZ,nearZ:N.nearZ,fov:N.fov*Math.PI/180,modelViewProjectionMatrix:N.modelViewProjectionMatrix,projectionMatrix:N.projectionMatrix,shaderData:{variantName:B.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${B.shaderPreludeCode.vertexSource}`,define:B.shaderDefine},defaultProjectionData:H},W=D.renderingMode?D.renderingMode:"2d";if(m.renderPass==="offscreen"){const Y=D.prerender;Y&&(m.setCustomLayerDefaults(),k.setColorMode(m.colorModeForRenderPass()),Y.call(D,k.gl,G),k.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),k.setColorMode(m.colorModeForRenderPass()),k.setStencilMode(St.disabled);const Y=W==="3d"?m.getDepthModeFor3D():m.getDepthModeForSublayer(0,gt.ReadOnly);k.setDepthMode(Y),D.render(k.gl,G),k.setDirty(),m.setBaseState(),k.bindFramebuffer.set(null)}}(e,0,a,h))}saveTileTexture(e){const i=this._tileTextures[e.size[0]];i?i.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const i=this._tileTextures[e];return i&&i.length>0?i.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const i=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!i||!a}useProgram(e,i,a=!1){this.cache=this.cache||{};const l=!!this.style.map.terrain,h=this.style.projection,m=e+(i?i.cacheKey:"")+`/${a?Yc:h.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(l?"/terrain":"");return this.cache[m]||(this.cache[m]=new Wa(this.context,Nr[e],i,lu[e],this._showOverdrawInspector,l,a?Nr.projectionMercator:h.shaderPreludeCode,a?$a:h.shaderDefine)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ct(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:i}=this.context.gl;return this.width!==e||this.height!==i}}function Tn(u,e){let i,a=!1,l=null,h=null;const m=()=>{l=null,a&&(u.apply(h,i),l=setTimeout(m,e),a=!1)};return(...v)=>(a=!0,h=this,i=v,l||m(),l)}class Nl{constructor(e){this._getCurrentHash=()=>{const i=window.location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(l=>l.split("=")).forEach(l=>{l[0]===this._hashName&&(a=l)}),(a&&a[1]||"").split("/")}return i.split("/")},this._onHashChange=()=>{const i=this._getCurrentHash();if(!this._isValidHash(i))return!1;const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:a,pitch:+(i[4]||0)}),!0},this._updateHashUnthrottled=()=>{const i=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,i)},this._removeHash=()=>{const i=this._getCurrentHash();if(i.length===0)return;const a=i.join("/");let l=a;l.split("&").length>0&&(l=l.split("&")[0]),this._hashName&&(l=`${this._hashName}=${a}`);let h=window.location.hash.replace(l,"");h.startsWith("#&")?h=h.slice(0,1)+h.slice(2):h==="#"&&(h="");let m=window.location.href.replace(/(#.+)?$/,h);m=m.replace("&&","&"),window.history.replaceState(window.history.state,null,m)},this._updateHash=Tn(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const i=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,l=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,l),m=Math.round(i.lng*h)/h,v=Math.round(i.lat*h)/h,x=this._map.getBearing(),P=this._map.getPitch();let I="";if(I+=e?`/${m}/${v}/${a}`:`${a}/${v}/${m}`,(x||P)&&(I+="/"+Math.round(10*x)/10),P&&(I+=`/${Math.round(P)}`),this._hashName){const k=this._hashName;let D=!1;const B=window.location.hash.slice(1).split("&").map(N=>{const H=N.split("=")[0];return H===k?(D=!0,`${H}=${I}`):N}).filter(N=>N);return D||B.push(`${k}=${I}`),`#${B.join("&")}`}return`#${I}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new o.N(+e[2],+e[1])}catch{return!1}const i=+e[0],a=+(e[3]||0),l=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&a>=0&&a<=180&&l>=this._map.getMinPitch()&&l<=this._map.getMaxPitch()}}const Ls={linearity:.3,easing:o.c6(0,0,.3,1)},Tu=o.e({deceleration:2500,maxSpeed:1400},Ls),Pu=o.e({deceleration:20,maxSpeed:1400},Ls),Su=o.e({deceleration:1e3,maxSpeed:360},Ls),Cu=o.e({deceleration:1e3,maxSpeed:90},Ls),Mu=o.e({deceleration:1e3,maxSpeed:360},Ls);class go{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ie.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=ie.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:h}of this._inertiaBuffer)i.zoom+=h.zoomDelta||0,i.bearing+=h.bearingDelta||0,i.pitch+=h.pitchDelta||0,i.roll+=h.rollDelta||0,h.panDelta&&i.pan._add(h.panDelta),h.around&&(i.around=h.around),h.pinchAround&&(i.pinchAround=h.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(i.pan.mag()){const h=Wi(i.pan.mag(),a,o.e({},Tu,e||{})),m=i.pan.mult(h.amount/i.pan.mag()),v=this._map.cameraHelper.handlePanInertia(m,this._map.transform);l.center=v.easingCenter,l.offset=v.easingOffset,Rs(l,h)}if(i.zoom){const h=Wi(i.zoom,a,Pu);l.zoom=this._map.transform.zoom+h.amount,Rs(l,h)}if(i.bearing){const h=Wi(i.bearing,a,Su);l.bearing=this._map.transform.bearing+o.ab(h.amount,-179,179),Rs(l,h)}if(i.pitch){const h=Wi(i.pitch,a,Cu);l.pitch=this._map.transform.pitch+h.amount,Rs(l,h)}if(i.roll){const h=Wi(i.roll,a,Mu);l.roll=this._map.transform.roll+o.ab(h.amount,-179,179),Rs(l,h)}if(l.zoom||l.bearing){const h=i.pinchAround===void 0?i.around:i.pinchAround;l.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),o.e(l,{noMoveStart:!0})}}function Rs(u,e){(!u.duration||u.duration<e.duration)&&(u.duration=e.duration,u.easing=e.easing)}function Wi(u,e,i){const{maxSpeed:a,linearity:l,deceleration:h}=i,m=o.ab(u*l/(e/1e3),-a,a),v=Math.abs(m)/(h*l);return{easing:i.easing,duration:1e3*v,amount:m*(v/2)}}class ai extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a,l={}){const h=K.mousePos(i.getCanvas(),a),m=i.unproject(h);super(e,o.e({point:h,lngLat:m,originalEvent:a},l)),this._defaultPrevented=!1,this.target=i}}class Fs extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a){const l=e==="touchend"?a.changedTouches:a.touches,h=K.touchPos(i.getCanvasContainer(),l),m=h.map(x=>i.unproject(x)),v=h.reduce((x,P,I,k)=>x.add(P.div(k.length)),new o.P(0,0));super(e,{points:h,point:v,lngLats:m,lngLat:i.unproject(v),originalEvent:a}),this._defaultPrevented=!1}}class zr extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class Bs{constructor(e,i){this._map=e,this._clickTolerance=i.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new zr(e.type,this._map,e))}mousedown(e,i){return this._mousedownPos=i,this._firePreventable(new ai(e.type,this._map,e))}mouseup(e){this._map.fire(new ai(e.type,this._map,e))}click(e,i){this._mousedownPos&&this._mousedownPos.dist(i)>=this._clickTolerance||this._map.fire(new ai(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ai(e.type,this._map,e))}mouseover(e){this._map.fire(new ai(e.type,this._map,e))}mouseout(e){this._map.fire(new ai(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Fs(e.type,this._map,e))}touchmove(e){this._map.fire(new Fs(e.type,this._map,e))}touchend(e){this._map.fire(new Fs(e.type,this._map,e))}touchcancel(e){this._map.fire(new Fs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hd{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ai(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ai("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ai(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xa{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(o.P.convert(e),this._map.terrain)}}class Iu{constructor(e,i){this._map=e,this._tr=new xa(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=i.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,i){this.isEnabled()&&e.shiftKey&&e.button===0&&(K.disableDrag(),this._startPos=this._lastPos=i,this._active=!0)}mousemoveWindow(e,i){if(!this._active)return;const a=i;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const l=this._startPos;this._lastPos=a,this._box||(this._box=K.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const h=Math.min(l.x,a.x),m=Math.max(l.x,a.x),v=Math.min(l.y,a.y),x=Math.max(l.y,a.y);K.setTransform(this._box,`translate(${h}px,${v}px)`),this._box.style.width=m-h+"px",this._box.style.height=x-v+"px"}mouseupWindow(e,i){if(!this._active||e.button!==0)return;const a=this._startPos,l=i;if(this.reset(),K.suppressClick(),a.x!==l.x||a.y!==l.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:e})),{cameraAnimation:h=>h.fitScreenCoordinates(a,l,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new o.k(e,{originalEvent:i}))}}function Vl(u,e){if(u.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${e.length}`);const i={};for(let a=0;a<u.length;a++)i[u[a].identifier]=e[a];return i}class Eu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(l){const h=new o.P(0,0);for(const m of l)h._add(m);return h.div(l.length)}(i),this.touches=Vl(a,i)))}touchmove(e,i,a){if(this.aborted||!this.centroid)return;const l=Vl(a,i);for(const h in this.touches){const m=l[h];(!m||m.dist(this.touches[h])>30)&&(this.aborted=!0)}}touchend(e,i,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class ss{constructor(e){this.singleTap=new Eu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,i,a){this.singleTap.touchstart(e,i,a)}touchmove(e,i,a){this.singleTap.touchmove(e,i,a)}touchend(e,i,a){const l=this.singleTap.touchend(e,i,a);if(l){const h=e.timeStamp-this.lastTime<500,m=!this.lastTap||this.lastTap.dist(l)<30;if(h&&m||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class rn{constructor(e){this._tr=new xa(e),this._zoomIn=new ss({numTouches:1,numTaps:2}),this._zoomOut=new ss({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,i,a){this._zoomIn.touchstart(e,i,a),this._zoomOut.touchstart(e,i,a)}touchmove(e,i,a){this._zoomIn.touchmove(e,i,a),this._zoomOut.touchmove(e,i,a)}touchend(e,i,a){const l=this._zoomIn.touchend(e,i,a),h=this._zoomOut.touchend(e,i,a),m=this._tr;return l?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:m.zoom+1,around:m.unproject(l)},{originalEvent:e})}):h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:m.zoom-1,around:m.unproject(h)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ge{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const i=this._moveFunction(...e);if(i.bearingDelta||i.pitchDelta||i.rollDelta||i.around||i.panDelta)return this._active=!0,i}dragStart(e,i){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(i)?i[0]:i,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,i){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const l=Array.isArray(i)?i[0]:i;return!this._moved&&l.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=l,this._move(a,l))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&K.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ku={0:1,2:2};class as{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const i=K.mouseButton(e);this._eventButton=i}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(i,a){const l=ku[a];return i.buttons===void 0||(i.buttons&l)!==l}(e,this._eventButton)}isValidEndEvent(e){return K.mouseButton(e)===this._eventButton}}class Au{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class wa{constructor(e=new as({checkCorrectEvent:()=>!0}),i=new Au){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=i}_executeRelevantHandler(e,i,a){return e instanceof MouseEvent?i(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?a(e):void 0}startMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.startMove(i),i=>this.oneFingerTouchMoveStateManager.startMove(i))}endMove(e){this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.endMove(i),i=>this.oneFingerTouchMoveStateManager.endMove(i))}isValidStartEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidStartEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidStartEvent(i))}isValidMoveEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidMoveEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(i))}isValidEndEvent(e){return this._executeRelevantHandler(e,i=>this.mouseMoveStateManager.isValidEndEvent(i),i=>this.oneFingerTouchMoveStateManager.isValidEndEvent(i))}}const Pn=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=e=>{e.preventDefault()}};class zu{constructor(e,i){this._clickTolerance=e.clickTolerance||1,this._map=i,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,i,a){return this._calculateTransform(e,i,a)}touchmove(e,i,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,i,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,i,a){this._calculateTransform(e,i,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,a){a.length>0&&(this._active=!0);const l=Vl(a,i),h=new o.P(0,0),m=new o.P(0,0);let v=0;for(const P in l){const I=l[P],k=this._touches[P];k&&(h._add(I),m._add(I.sub(k)),v++,l[P]=I)}if(this._touches=l,this._shouldBePrevented(v)||!m.mag())return;const x=m.div(v);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(v),panDelta:x}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,i,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([i[0],i[1]]))}touchmove(e,i,a){if(!this._firstTwoTouches)return;e.preventDefault();const[l,h]=this._firstTwoTouches,m=Os(a,i,l),v=Os(a,i,h);if(!m||!v)return;const x=this._aroundCenter?null:m.add(v).div(2);return this._move([m,v],x,e)}touchend(e,i,a){if(!this._firstTwoTouches)return;const[l,h]=this._firstTwoTouches,m=Os(a,i,l),v=Os(a,i,h);m&&v||(this._active&&K.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Os(u,e,i){for(let a=0;a<u.length;a++)if(u[a].identifier===i)return e[a]}function Du(u,e){return Math.log(u/e)/Math.LN2}class _o extends xt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,i){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Du(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Du(this._distance,a),pinchAround:i}}}function Lu(u,e){return 180*u.angleWith(e)/Math.PI}class Ru extends xt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,i,a){const l=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Lu(this._vector,l),pinchAround:i}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const i=25/(Math.PI*this._minDiameter)*360,a=Lu(e,this._startVector);return Math.abs(a)<i}}function yo(u){return Math.abs(u.y)>Math.abs(u.x)}class vo extends xt{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,i,a){super.touchstart(e,i,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,yo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,i,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const l=e[0].sub(this._lastPoints[0]),h=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(l,h,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(l.y+h.y)/2*-.5}):void 0}gestureBeginsVertically(e,i,a){if(this._valid!==void 0)return this._valid;const l=e.mag()>=2,h=i.mag()>=2;if(!l&&!h)return;if(!l||!h)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const m=e.y>0==i.y>0;return yo(e)&&yo(i)&&m}}const Fu={panStep:100,bearingStep:15,pitchStep:10};class Bu{constructor(e){this._tr=new xa(e);const i=Fu;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let i=0,a=0,l=0,h=0,m=0;switch(e.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),h=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),h=1);break;case 38:e.shiftKey?l=1:(e.preventDefault(),m=-1);break;case 40:e.shiftKey?l=-1:(e.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(a=0,l=0),{cameraAnimation:v=>{const x=this._tr;v.easeTo({duration:300,easeId:"keyboardHandler",easing:Ou,zoom:i?Math.round(x.zoom)+i*(e.shiftKey?2:1):x.zoom,bearing:x.bearing+a*this._bearingStep,pitch:x.pitch+l*this._pitchStep,offset:[-h*this._panStep,-m*this._panStep],center:x.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ou(u){return u*(2-u)}const ju=4.000244140625;class Nu{constructor(e,i){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new xa(e),this._triggerRenderFrame=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=ie.now(),l=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,i!==0&&i%ju==0?this._type="wheel":i!==0&&Math.abs(i)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(l*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=K.mousePos(this._map.getCanvas(),e),a=this._tr;this._aroundPoint=this._aroundCenter?a.transform.locationToScreenPoint(o.N.convert(a.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const v=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=v),typeof this._targetZoom=="number"&&(this._targetZoom+=v)}if(this._delta!==0){const v=this._type==="wheel"&&Math.abs(this._delta)>ju?this._wheelZoomRate:this._defaultZoomRate;let x=2/(1+Math.exp(-Math.abs(this._delta*v)));this._delta<0&&x!==0&&(x=1/x);const P=typeof this._targetZoom!="number"?e.scale:o.aG(this._targetZoom);this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,o.a8(P*x))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,a=this._startZoom,l=this._easing;let h,m=!1;if(this._type==="wheel"&&a&&l){const v=ie.now()-this._lastWheelEventTime,x=Math.min((v+5)/200,1),P=l(x);h=o.y.number(a,i,P),x<1?this._frameId||(this._frameId=!0):m=!0}else h=i,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=h,{noInertia:!0,needsRenderFrame:!m,zoomDelta:h-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=o.c8;if(this._prevEase){const a=this._prevEase,l=(ie.now()-a.start)/a.duration,h=a.easing(l+.01)-a.easing(l),m=.27/Math.sqrt(h*h+1e-4)*.01,v=Math.sqrt(.0729-m*m);i=o.c6(m,v,.25,1)}return this._prevEase={start:ie.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class nn{constructor(e,i){this._clickZoom=e,this._tapZoom=i}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kt{constructor(e){this._tr=new xa(e),this.reset()}reset(){this._active=!1}dblclick(e,i){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(i)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bo{constructor(){this._tap=new ss({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,i,a){if(!this._swipePoint)if(this._tapTime){const l=i[0],h=e.timeStamp-this._tapTime<500,m=this._tapPoint.dist(l)<30;h&&m?a.length>0&&(this._swipePoint=l,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,i,a)}touchmove(e,i,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const l=i[0],h=l.y-this._swipePoint.y;return this._swipePoint=l,e.preventDefault(),this._active=!0,{zoomDelta:h/128}}}else this._tap.touchmove(e,i,a)}touchend(e,i,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const l=this._tap.touchend(e,i,a);l&&(this._tapTime=e.timeStamp,this._tapPoint=l)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xo{constructor(e,i,a){this._el=e,this._mousePan=i,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ul{constructor(e,i,a,l){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=i,this._mousePitch=a,this._mouseRoll=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class $l{constructor(e,i,a,l){this._el=e,this._touchZoom=i,this._touchRotate=a,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ql{constructor(e,i){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=i,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=K.create("div","maplibregl-cooperative-gesture-screen",e);let i=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(i=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),l=document.createElement("div");l.className="maplibregl-desktop-message",l.textContent=i,this._container.appendChild(l);const h=document.createElement("div");h.className="maplibregl-mobile-message",h.textContent=a,this._container.appendChild(h),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(K.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new o.k("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const wo=u=>u.zoom||u.drag||u.roll||u.pitch||u.rotate;class $r extends o.k{}function js(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta||u.rollDelta}class it{constructor(e,i){this.handleWindowEvent=l=>{this.handleEvent(l,`${l.type}Window`)},this.handleEvent=(l,h)=>{if(l.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const m=l.type==="renderFrame"?void 0:l,v={needsRenderFrame:!1},x={},P={},I=l.touches,k=I?this._getMapTouches(I):void 0,D=k?K.touchPos(this._map.getCanvas(),k):K.mousePos(this._map.getCanvas(),l);for(const{handlerName:H,handler:G,allowed:W}of this._handlers){if(!G.isEnabled())continue;let Y;this._blockedByActive(P,W,H)?G.reset():G[h||l.type]&&(Y=G[h||l.type](l,D,k),this.mergeHandlerResult(v,x,Y,H,m),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||G.isActive())&&(P[H]=G)}const B={};for(const H in this._previousActiveHandlers)P[H]||(B[H]=m);this._previousActiveHandlers=P,(Object.keys(B).length||js(v))&&(this._changes.push([v,x,B]),this._triggerRenderFrame()),(Object.keys(P).length||js(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=v;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new go(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[l,h,m]of this._listeners)K.addEventListener(l,h,l===document?this.handleWindowEvent:this.handleEvent,m)}destroy(){for(const[e,i,a]of this._listeners)K.removeEventListener(e,i,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const i=this._map,a=i.getCanvasContainer();this._add("mapEvent",new Bs(i,e));const l=i.boxZoom=new Iu(i,e);this._add("boxZoom",l),e.interactive&&e.boxZoom&&l.enable();const h=i.cooperativeGestures=new ql(i,e.cooperativeGestures);this._add("cooperativeGestures",h),e.cooperativeGestures&&h.enable();const m=new rn(i),v=new Kt(i);i.doubleClickZoom=new nn(v,m),this._add("tapZoom",m),this._add("clickZoom",v),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const x=new bo;this._add("tapDragZoom",x);const P=i.touchPitch=new vo(i);this._add("touchPitch",P),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const I=()=>i.project(i.getCenter()),k=function({enable:ne,clickTolerance:ae,aroundCenter:ce=!0,minPixelCenterThreshold:le=100,rotateDegreesPerPixelMoved:ye=.8},be){const Ie=new as({checkCorrectEvent:Ae=>K.mouseButton(Ae)===0&&Ae.ctrlKey||K.mouseButton(Ae)===2&&!Ae.ctrlKey});return new Ge({clickTolerance:ae,move:(Ae,Se)=>{const Ve=be();if(ce&&Math.abs(Ve.y-Ae.y)>le)return{bearingDelta:o.c7(new o.P(Ae.x,Se.y),Se,Ve)};let je=(Se.x-Ae.x)*ye;return ce&&Se.y<Ve.y&&(je=-je),{bearingDelta:je}},moveStateManager:Ie,enable:ne,assignEvents:Pn})}(e,I),D=function({enable:ne,clickTolerance:ae,pitchDegreesPerPixelMoved:ce=-.5}){const le=new as({checkCorrectEvent:ye=>K.mouseButton(ye)===0&&ye.ctrlKey||K.mouseButton(ye)===2});return new Ge({clickTolerance:ae,move:(ye,be)=>({pitchDelta:(be.y-ye.y)*ce}),moveStateManager:le,enable:ne,assignEvents:Pn})}(e),B=function({enable:ne,clickTolerance:ae,rollDegreesPerPixelMoved:ce=.3},le){const ye=new as({checkCorrectEvent:be=>K.mouseButton(be)===2&&be.ctrlKey});return new Ge({clickTolerance:ae,move:(be,Ie)=>{const Ae=le();let Se=(Ie.x-be.x)*ce;return Ie.y<Ae.y&&(Se=-Se),{rollDelta:Se}},moveStateManager:ye,enable:ne,assignEvents:Pn})}(e,I);i.dragRotate=new Ul(e,k,D,B),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",D,["mouseRotate","mouseRoll"]),this._add("mouseRoll",B,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const N=function({enable:ne,clickTolerance:ae}){const ce=new as({checkCorrectEvent:le=>K.mouseButton(le)===0&&!le.ctrlKey});return new Ge({clickTolerance:ae,move:(le,ye)=>({around:ye,panDelta:ye.sub(le)}),activateOnStart:!0,moveStateManager:ce,enable:ne,assignEvents:Pn})}(e),H=new zu(e,i);i.dragPan=new xo(a,N,H),this._add("mousePan",N),this._add("touchPan",H,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const G=new Ru,W=new _o;i.touchZoomRotate=new $l(a,W,G,x),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const Y=i.scrollZoom=new Nu(i,()=>this._triggerRenderFrame());this._add("scrollZoom",Y,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const re=i.keyboard=new Bu(i);this._add("keyboard",re),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new hd(i))}_add(e,i,a){this._handlers.push({handlerName:e,handler:i,allowed:a}),this._handlersById[e]=i}stop(e){if(!this._updatingCamera){for(const{handler:i}of this._handlers)i.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wo(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,i,a){for(const l in e)if(l!==a&&(!i||i.indexOf(l)<0))return!0;return!1}_getMapTouches(e){const i=[];for(const a of e)this._el.contains(a.target)&&i.push(a);return i}mergeHandlerResult(e,i,a,l,h){if(!a)return;o.e(e,a);const m={handlerName:l,originalEvent:a.originalEvent||h};a.zoomDelta!==void 0&&(i.zoom=m),a.panDelta!==void 0&&(i.drag=m),a.rollDelta!==void 0&&(i.roll=m),a.pitchDelta!==void 0&&(i.pitch=m),a.bearingDelta!==void 0&&(i.rotate=m)}_applyChanges(){const e={},i={},a={};for(const[l,h,m]of this._changes)l.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(l.panDelta)),l.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+l.pitchDelta),l.rollDelta&&(e.rollDelta=(e.rollDelta||0)+l.rollDelta),l.around!==void 0&&(e.around=l.around),l.pinchAround!==void 0&&(e.pinchAround=l.pinchAround),l.noInertia&&(e.noInertia=l.noInertia),o.e(i,h),o.e(a,m);this._updateMapTransform(e,i,a),this._changes=[]}_updateMapTransform(e,i,a){const l=this._map,h=l._getTransformForUpdate(),m=l.terrain;if(!(js(e)||m&&this._terrainMovement))return this._fireEvents(i,a,!0);l._stop(!0);let{panDelta:v,zoomDelta:x,bearingDelta:P,pitchDelta:I,rollDelta:k,around:D,pinchAround:B}=e;B!==void 0&&(D=B),D=D||l.transform.centerPoint,m&&!h.isPointOnMapSurface(D)&&(D=h.centerPoint);const N={panDelta:v,zoomDelta:x,rollDelta:k,pitchDelta:I,bearingDelta:P,around:D};this._map.cameraHelper.useGlobeControls&&!h.isPointOnMapSurface(D)&&(D=h.centerPoint);const H=D.distSqr(h.centerPoint)<.01?h.center:h.screenPointToLocation(v?D.sub(v):D);m?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(N,h),this._terrainMovement||!i.drag&&!i.zoom?i.drag&&this._terrainMovement?h.setCenter(h.screenPointToLocation(h.centerPoint.sub(v))):this._map.cameraHelper.handleMapControlsPan(N,h,H):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(N,h,H))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(N,h),this._map.cameraHelper.handleMapControlsPan(N,h,H)),l._applyUpdatedTransform(h),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,a,!0)}_fireEvents(e,i,a){const l=wo(this._eventsInProgress),h=wo(e),m={};for(const k in e){const{originalEvent:D}=e[k];this._eventsInProgress[k]||(m[`${k}start`]=D),this._eventsInProgress[k]=e[k]}!l&&h&&this._fireEvent("movestart",h.originalEvent);for(const k in m)this._fireEvent(k,m[k]);h&&this._fireEvent("move",h.originalEvent);for(const k in e){const{originalEvent:D}=e[k];this._fireEvent(k,D)}const v={};let x;for(const k in this._eventsInProgress){const{handlerName:D,originalEvent:B}=this._eventsInProgress[k];this._handlersById[D].isActive()||(delete this._eventsInProgress[k],x=i[D]||B,v[`${k}end`]=x)}for(const k in v)this._fireEvent(k,v[k]);const P=wo(this._eventsInProgress),I=(l||h)&&!P;if(I&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const k=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&k.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(k)}if(a&&I){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;!k||!k.essential&&ie.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:x})),D(this._map.getBearing())&&this._map.resetNorth()):(D(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:x})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new o.k(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new $r("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ot extends o.E{constructor(e,i,a){super(),this._renderFrameCallback=()=>{const l=Math.min((ie.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=a.bearingSnap,this.cameraHelper=i,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,i){e.apply(this.transform),this.transform=e,this.cameraHelper=i}getCenter(){return new o.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,i){return this.jumpTo({center:e},i)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,i){return this.jumpTo({elevation:e},i),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,a){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},i),a)}panTo(e,i,a){return this.easeTo(o.e({center:e},i),a)}getZoom(){return this.transform.zoom}setZoom(e,i){return this.jumpTo({zoom:e},i),this}zoomTo(e,i,a){return this.easeTo(o.e({zoom:e},i),a)}zoomIn(e,i){return this.zoomTo(this.getZoom()+1,e,i),this}zoomOut(e,i){return this.zoomTo(this.getZoom()-1,e,i),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new o.k("movestart",i)).fire(new o.k("move",i)).fire(new o.k("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,i){return this.jumpTo({bearing:e},i),this}getPadding(){return this.transform.padding}setPadding(e,i){return this.jumpTo({padding:e},i),this}rotateTo(e,i,a){return this.easeTo(o.e({bearing:e},i),a)}resetNorth(e,i){return this.rotateTo(0,o.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,i){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,i):this}getPitch(){return this.transform.pitch}setPitch(e,i){return this.jumpTo({pitch:e},i),this}getRoll(){return this.transform.roll}setRoll(e,i){return this.jumpTo({roll:e},i),this}cameraForBounds(e,i){e=oi.convert(e).adjustAntiMeridian();const a=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,i)}_cameraForBoxAndBearing(e,i,a,l){const h={top:0,bottom:0,right:0,left:0};if(typeof(l=o.e({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const P=l.padding;l.padding={top:P,bottom:P,right:P,left:P}}const m=o.e(h,l.padding);l.padding=m;const v=this.transform,x=new oi(e,i);return this.cameraHelper.cameraForBoxAndBearing(l,m,x,a,v)}fitBounds(e,i,a){return this._fitInternal(this.cameraForBounds(e,i),i,a)}fitScreenCoordinates(e,i,a,l,h){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(e)),this.transform.screenPointToLocation(o.P.convert(i)),a,l),l,h)}_fitInternal(e,i,a){return e?(delete(i=o.e(e,i)).padding,i.linear?this.easeTo(i,a):this.flyTo(i,a)):this}jumpTo(e,i){this.stop();const a=this._getTransformForUpdate();let l=!1,h=!1,m=!1;const v=a.zoom;this.cameraHelper.handleJumpToCenterZoom(a,e);const x=a.zoom!==v;return"elevation"in e&&a.elevation!==+e.elevation&&a.setElevation(+e.elevation),"bearing"in e&&a.bearing!==+e.bearing&&(l=!0,a.setBearing(+e.bearing)),"pitch"in e&&a.pitch!==+e.pitch&&(h=!0,a.setPitch(+e.pitch)),"roll"in e&&a.roll!==+e.roll&&(m=!0,a.setRoll(+e.roll)),e.padding==null||a.isPaddingEqual(e.padding)||a.setPadding(e.padding),this._applyUpdatedTransform(a),this.fire(new o.k("movestart",i)).fire(new o.k("move",i)),x&&this.fire(new o.k("zoomstart",i)).fire(new o.k("zoom",i)).fire(new o.k("zoomend",i)),l&&this.fire(new o.k("rotatestart",i)).fire(new o.k("rotate",i)).fire(new o.k("rotateend",i)),h&&this.fire(new o.k("pitchstart",i)).fire(new o.k("pitch",i)).fire(new o.k("pitchend",i)),m&&this.fire(new o.k("rollstart",i)).fire(new o.k("roll",i)).fire(new o.k("rollend",i)),this.fire(new o.k("moveend",i))}calculateCameraOptionsFromTo(e,i,a,l=0){const h=o.Y.fromLngLat(e,i),m=o.Y.fromLngLat(a,l),v=m.x-h.x,x=m.y-h.y,P=m.z-h.z,I=Math.hypot(v,x,P);if(I===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(v,x),D=o.a8(this.transform.cameraToCenterDistance/I/this.transform.tileSize),B=180*Math.atan2(v,-x)/Math.PI;let N=180*Math.acos(k/I)/Math.PI;return N=P<0?90-N:90+N,{center:m.toLngLat(),elevation:l,zoom:D,pitch:N,bearing:B}}calculateCameraOptionsFromCameraLngLatAltRotation(e,i,a,l,h){const m=this.transform.calculateCenterFromCameraLngLatAlt(e,i,a,l);return{center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:a,pitch:l,roll:h}}easeTo(e,i){this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.c8},e)).animate===!1||!e.essential&&ie.prefersReducedMotion)&&(e.duration=0);const a=this._getTransformForUpdate(),l=this.getBearing(),h=a.pitch,m=a.roll,v="bearing"in e?this._normalizeBearing(e.bearing,l):l,x="pitch"in e?+e.pitch:h,P="roll"in e?this._normalizeBearing(e.roll,m):m,I="padding"in e?e.padding:a.padding,k=o.P.convert(e.offset);let D,B;e.around&&(D=o.N.convert(e.around),B=a.locationToScreenPoint(D));const N={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},H=this.cameraHelper.handleEaseTo(a,{bearing:v,pitch:x,roll:P,padding:I,around:D,aroundPoint:B,offsetAsPoint:k,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||l!==v,this._pitching=this._pitching||x!==h,this._rolling=this._rolling||P!==m,this._padding=!a.isPaddingEqual(I),this._zooming=this._zooming||H.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,N),this.terrain&&this._prepareElevation(H.elevationCenter),this._ease(G=>{H.easeFunc(G),this.terrain&&!e.freezeElevation&&this._updateElevation(G),this._applyUpdatedTransform(a),this._fireMoveEvents(i)},G=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,G)},e),this}_prepareEase(e,i,a={}){this._moving=!0,i||a.moving||this.fire(new o.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new o.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new o.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new o.k("pitchstart",e)),this._rolling&&!a.rolling&&this.fire(new o.k("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(i-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(o.y.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const i=e.getCameraLngLat(),a=e.getCameraAltitude(),l=this.terrain?this.terrain.getElevationForLngLatZoom(i,e.zoom):0;if(a<l){const h=this.calculateCameraOptionsFromTo(i,l,e.center,e.elevation);return{pitch:h.pitch,zoom:h.zoom}}return{}}_applyUpdatedTransform(e){const i=[];if(i.push(l=>this._elevateCameraIfInsideTerrain(l)),this.transformCameraUpdate&&i.push(l=>this.transformCameraUpdate(l)),!i.length)return;const a=e.clone();for(const l of i){const h=a.clone(),{center:m,zoom:v,roll:x,pitch:P,bearing:I,elevation:k}=l(h);m&&h.setCenter(m),k!==void 0&&h.setElevation(k),v!==void 0&&h.setZoom(v),x!==void 0&&h.setRoll(x),P!==void 0&&h.setPitch(P),I!==void 0&&h.setBearing(I),a.apply(h)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new o.k("move",e)),this._zooming&&this.fire(new o.k("zoom",e)),this._rotating&&this.fire(new o.k("rotate",e)),this._pitching&&this.fire(new o.k("pitch",e)),this._rolling&&this.fire(new o.k("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const a=this._zooming,l=this._rotating,h=this._pitching,m=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,a&&this.fire(new o.k("zoomend",e)),l&&this.fire(new o.k("rotateend",e)),h&&this.fire(new o.k("pitchend",e)),m&&this.fire(new o.k("rollend",e)),this.fire(new o.k("moveend",e))}flyTo(e,i){if(!e.essential&&ie.prefersReducedMotion){const Se=o.M(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Se,i)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.c8},e);const a=this._getTransformForUpdate(),l=a.bearing,h=a.pitch,m=a.roll,v=a.padding,x="bearing"in e?this._normalizeBearing(e.bearing,l):l,P="pitch"in e?+e.pitch:h,I="roll"in e?this._normalizeBearing(e.roll,m):m,k="padding"in e?e.padding:a.padding,D=o.P.convert(e.offset);let B=a.centerPoint.add(D);const N=a.screenPointToLocation(B),H=this.cameraHelper.handleFlyTo(a,{bearing:x,pitch:P,roll:I,padding:k,locationAtOffset:N,offsetAsPoint:D,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let G=e.curve;const W=Math.max(a.width,a.height),Y=W/H.scaleOfZoom,re=H.pixelPathLength;typeof H.scaleOfMinZoom=="number"&&(G=Math.sqrt(W/H.scaleOfMinZoom/re*2));const ne=G*G;function ae(Se){const Ve=(Y*Y-W*W+(Se?-1:1)*ne*ne*re*re)/(2*(Se?Y:W)*ne*re);return Math.log(Math.sqrt(Ve*Ve+1)-Ve)}function ce(Se){return(Math.exp(Se)-Math.exp(-Se))/2}function le(Se){return(Math.exp(Se)+Math.exp(-Se))/2}const ye=ae(!1);let be=function(Se){return le(ye)/le(ye+G*Se)},Ie=function(Se){return W*((le(ye)*(ce(Ve=ye+G*Se)/le(Ve))-ce(ye))/ne)/re;var Ve},Ae=(ae(!0)-ye)/G;if(Math.abs(re)<2e-6||!isFinite(Ae)){if(Math.abs(W-Y)<1e-6)return this.easeTo(e,i);const Se=Y<W?-1:1;Ae=Math.abs(Math.log(Y/W))/G,Ie=()=>0,be=Ve=>Math.exp(Se*G*Ve)}return e.duration="duration"in e?+e.duration:1e3*Ae/("screenSpeed"in e?+e.screenSpeed/G:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=l!==x,this._pitching=P!==h,this._rolling=I!==m,this._padding=!a.isPaddingEqual(k),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(H.targetCenter),this._ease(Se=>{const Ve=Se*Ae,je=1/be(Ve),De=Ie(Ve);this._rotating&&a.setBearing(o.y.number(l,x,Se)),this._pitching&&a.setPitch(o.y.number(h,P,Se)),this._rolling&&a.setRoll(o.y.number(m,I,Se)),this._padding&&(a.interpolatePadding(v,k,Se),B=a.centerPoint.add(D)),H.easeFunc(Se,je,De,B),this.terrain&&!e.freezeElevation&&this._updateElevation(Se),this._applyUpdatedTransform(a),this._fireMoveEvents(i)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,i){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,i)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,i,a){a.animate===!1||a.duration===0?(e(1),i()):(this._easeStart=ie.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=o.aI(e,-180,180);const a=Math.abs(e-i);return Math.abs(e-360-i)<a&&(e-=360),Math.abs(e+360-i)<a&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.N.convert(e),this.transform.tileZoom):null}}const Ta={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class To{constructor(e=Ta){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=i=>{!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=K.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=K.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(e,i){const a=this._map._getUIString(`AttributionControl.${i}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(l=>typeof l!="string"?"":l)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const i=this._map.style.sourceCaches;for(const l in i){const h=i[l];if(h.used||h.usedForTerrain){const m=h.getSource();m.attribution&&e.indexOf(m.attribution)<0&&e.push(m.attribution)}}e=e.filter(l=>String(l).trim()),e.sort((l,h)=>l.length-h.length),e=e.filter((l,h)=>{for(let m=h+1;m<e.length;m++)if(e[m].indexOf(l)>=0)return!1;return!0});const a=e.join(" | ");a!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=K.sanitize(a),e.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Po{constructor(e={}){this._updateCompact=()=>{const i=this._container.children;if(i.length){const a=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=K.create("div","maplibregl-ctrl");const i=K.create("a","maplibregl-ctrl-logo");return i.target="_blank",i.rel="noopener nofollow",i.href="https://maplibre.org/",i.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),i.setAttribute("rel","noopener nofollow"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){K.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class tr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const i=++this._id;return this._queue.push({callback:e,id:i,cancelled:!1}),i}remove(e){const i=this._currentlyRunning,a=i?this._queue.concat(i):this._queue;for(const l of a)if(l.id===e)return void(l.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const i=this._currentlyRunning=this._queue;this._queue=[];for(const a of i)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Vu=o.aA([{name:"a_pos3d",type:"Int16",components:3}]);class qr extends o.E{constructor(e){super(),this._lastTilesetChange=ie.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const a={};for(const l of Z(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))a[l.key]=!0,this._renderableTilesKeys.push(l.key),this._tiles[l.key]||(l.terrainRttPosMatrix32f=new Float64Array(16),o.bL(l.terrainRttPosMatrix32f,0,o.X,o.X,0,0,1),this._tiles[l.key]=new qn(l,this.tileSize),this._lastTilesetChange=ie.now());for(const l in this._tiles)a[l]||delete this._tiles[l]}freeRtt(e){for(const i in this._tiles){const a=this._tiles[i];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const i={};for(const a of this._renderableTilesKeys){const l=this._tiles[a].tileID,h=e.clone(),m=o.a$();if(l.canonical.equals(e.canonical))o.bL(m,0,o.X,o.X,0,0,1);else if(l.canonical.isChildOf(e.canonical)){const v=l.canonical.z-e.canonical.z,x=l.canonical.x-(l.canonical.x>>v<<v),P=l.canonical.y-(l.canonical.y>>v<<v),I=o.X>>v;o.bL(m,0,I,I,0,0,1),o.J(m,m,[-x*I,-P*I,0])}else{if(!e.canonical.isChildOf(l.canonical))continue;{const v=e.canonical.z-l.canonical.z,x=e.canonical.x-(e.canonical.x>>v<<v),P=e.canonical.y-(e.canonical.y>>v<<v),I=o.X>>v;o.bL(m,0,o.X,o.X,0,0,1),o.J(m,m,[x*I,P*I,0]),o.K(m,m,[1/2**v,1/2**v,0])}}h.terrainRttPosMatrix32f=new Float32Array(m),i[a]=h}return i}getSourceTile(e,i){const a=this.sourceCache._source;let l=e.overscaledZ-this.deltaZoom;if(l>a.maxzoom&&(l=a.maxzoom),l<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(l).key);let h=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!h||!h.dem)&&i)for(;l>=a.minzoom&&(!h||!h.dem);)h=this.sourceCache.getTileByID(e.scaledTo(l--).key);return h}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}}class dd{constructor(e,i,a){this._meshCache={},this.painter=e,this.sourceCache=new qr(i),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,a,l=o.X){var h;if(!(i>=0&&i<l&&a>=0&&a<l))return 0;const m=this.getTerrainData(e),v=(h=m.tile)===null||h===void 0?void 0:h.dem;if(!v)return 0;const x=o.c9([],[i/l*o.X,a/l*o.X],m.u_terrain_matrix),P=[x[0]*v.dim,x[1]*v.dim],I=Math.floor(P[0]),k=Math.floor(P[1]),D=P[0]-I,B=P[1]-k;return v.get(I,k)*(1-D)*(1-B)+v.get(I+1,k)*D*(1-B)+v.get(I,k+1)*(1-D)*B+v.get(I+1,k+1)*D*B}getElevationForLngLatZoom(e,i){if(!o.ca(i,e.wrap()))return 0;const{tileID:a,mercatorX:l,mercatorY:h}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(a,l%o.X,h%o.X,o.X)}getElevation(e,i,a,l=o.X){return this.getDEMElevation(e,i,a,l)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const l=this.painter.context,h=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ct(l,h,l.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ct(l,new o.R({width:1,height:1}),l.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.aq([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const l=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new ct(l,i.dem.getPixels(),l.gl.RGBA,{premultiply:!1}),i.demTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const a=i&&i+i.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const l=this.sourceCache.sourceCache._source.maxzoom;let h=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=l?h=e.canonical.z-l:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const m=e.canonical.x-(e.canonical.x>>h<<h),v=e.canonical.y-(e.canonical.y>>h<<h),x=o.cb(new Float64Array(16),[1/(o.X<<h),1/(o.X<<h),0]);o.J(x,x,[m*o.X,v*o.X,0]),this._demMatrixCache[e.key]={matrix:x,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const i=this.painter,a=i.width/devicePixelRatio,l=i.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===l||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ct(i.context,{width:a,height:l,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ct(i.context,{width:a,height:l,data:null},i.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(i.context.gl.NEAREST,i.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=i.context.createFramebuffer(a,l,!0,!1),this._fbo.depthAttachment.set(i.context.createRenderbuffer(i.context.gl.DEPTH_COMPONENT16,a,l))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let h=0,m=0;h<this._coordsTextureSize;h++)for(let v=0;v<this._coordsTextureSize;v++,m+=4)i[m+0]=255&v,i[m+1]=255&h,i[m+2]=v>>8<<4|h>>8,i[m+3]=0;const a=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),l=new ct(e,a,e.gl.RGBA,{premultiply:!1});return l.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=l,l}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),a=this.painter.context,l=a.gl,h=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),m=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),v=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),l.readPixels(h,v-m-1,1,1,l.RGBA,l.UNSIGNED_BYTE,i),a.bindFramebuffer.set(null);const x=i[0]+(i[2]>>4<<8),P=i[1]+((15&i[2])<<8),I=this.coordsIndex[255-i[3]],k=I&&this.sourceCache.getTileByID(I);if(!k)return null;const D=this._coordsTextureSize,B=(1<<k.tileID.canonical.z)*D;return new o.Y((k.tileID.canonical.x*D+x)/B+k.tileID.wrap,(k.tileID.canonical.y*D+P)/B,this.getElevation(k.tileID,x,P,D))}depthAtPoint(e){const i=new Uint8Array(4),a=this.painter.context,l=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),l.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,i),a.bindFramebuffer.set(null),(i[0]/16777216+i[1]/65536+i[2]/256+i[3])/256}getTerrainMesh(e){var i;const a=((i=this.painter.style.projection)===null||i===void 0?void 0:i.transitionState)>0,l=a&&e.canonical.y===0,h=a&&e.canonical.y===(1<<e.canonical.z)-1,m=`m_${l?"n":""}_${h?"s":""}`;if(this._meshCache[m])return this._meshCache[m];const v=this.painter.context,x=new o.cc,P=new o.aE,I=this.meshSize,k=o.X/I,D=I*I;for(let le=0;le<=I;le++)for(let ye=0;ye<=I;ye++)x.emplaceBack(ye*k,le*k,0);for(let le=0;le<D;le+=I+1)for(let ye=0;ye<I;ye++)P.emplaceBack(ye+le,I+ye+le+1,I+ye+le+2),P.emplaceBack(ye+le,I+ye+le+2,ye+le+1);const B=x.length,N=B+(I+1),H=(I+1)*I,G=l?o.b6:0,W=l?0:1,Y=h?o.b7:o.X,re=h?0:1;for(let le=0;le<=I;le++)x.emplaceBack(le*k,G,W);for(let le=0;le<=I;le++)x.emplaceBack(le*k,Y,re);for(let le=0;le<I;le++)P.emplaceBack(H+le,N+le,N+le+1),P.emplaceBack(H+le,N+le+1,H+le+1),P.emplaceBack(0+le,B+le+1,B+le),P.emplaceBack(0+le,0+le+1,B+le+1);const ne=x.length,ae=ne+2*(I+1);for(const le of[0,1])for(let ye=0;ye<=I;ye++)for(const be of[0,1])x.emplaceBack(le*o.X,ye*k,be);for(let le=0;le<2*I;le+=2)P.emplaceBack(ne+le,ne+le+1,ne+le+3),P.emplaceBack(ne+le,ne+le+3,ne+le+2),P.emplaceBack(ae+le,ae+le+3,ae+le+1),P.emplaceBack(ae+le,ae+le+2,ae+le+3);const ce=new Vr(v.createVertexBuffer(x,Vu.members),v.createIndexBuffer(P),o.aD.simpleSegment(0,0,x.length,P.length));return this._meshCache[m]=ce,ce}getMeshFrameDelta(e){return 2*Math.PI*o.bo/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,i){var a;const{tileID:l}=this._getOverscaledTileIDFromLngLatZoom(e,i);return(a=this.getMinMaxElevation(l).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const i=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return i&&i.dem&&(a.minElevation=i.dem.min*this.exaggeration,a.maxElevation=i.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,i){const a=o.Y.fromLngLat(e.wrap()),l=(1<<i)*o.X,h=a.x*l,m=a.y*l,v=Math.floor(h/o.X),x=Math.floor(m/o.X);return{tileID:new o.S(i,0,i,v,x),mercatorX:h,mercatorY:m}}}class Pa{constructor(e,i,a){this._context=e,this._size=i,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const i=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new ct(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),i.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),i.colorAttachment.set(a.texture),{id:e,fbo:i,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(i=>e.id!==i),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const i of this._recentlyUsed)if(!this._objects[i].inUse)return this._objects[i];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const jt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class li{constructor(e,i){this.painter=e,this.terrain=i,this.pool=new Pa(e.context,30,i.sourceCache.tileSize*i.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,i){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(i)),this._coordsAscending={};for(const a in e.sourceCaches){this._coordsAscending[a]={};const l=e.sourceCaches[a].getVisibleCoordinates();for(const h of l){const m=this.terrain.sourceCache.getTerrainCoords(h);for(const v in m)this._coordsAscending[a][v]||(this._coordsAscending[a][v]=[]),this._coordsAscending[a][v].push(m[v])}}this._coordsAscendingStr={};for(const a of e._order){const l=e._layers[a],h=l.source;if(jt[l.type]&&!this._coordsAscendingStr[h]){this._coordsAscendingStr[h]={};for(const m in this._coordsAscending[h])this._coordsAscendingStr[h][m]=this._coordsAscending[h][m].map(v=>v.key).sort().join()}}for(const a of this._renderableTiles)for(const l in this._coordsAscendingStr){const h=this._coordsAscendingStr[l][a.tileID.key];h&&h!==a.rttCoords[l]&&(a.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const a=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),l=e.type,h=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(jt[l]&&(this._prevType&&jt[this._prevType]||this._stacks.push([]),this._prevType=l,this._stacks[this._stacks.length-1].push(e.id),!m))return!0;if(jt[this._prevType]||jt[l]&&m){this._prevType=l;const v=this._stacks.length-1,x=this._stacks[v]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(Ol(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[v]){const k=this.pool.getObjectForId(P.rtt[v].id);if(k.stamp===P.rtt[v].stamp){this.pool.useObject(k);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),P.rtt[v]={id:I.id,stamp:I.stamp},h.context.bindFramebuffer.set(I.fbo.framebuffer),h.context.clear({color:o.b4.transparent,stencil:0}),h.currentStencilSource=void 0;for(let k=0;k<x.length;k++){const D=h.style._layers[x[k]],B=D.source?this._coordsAscending[D.source][P.tileID.key]:[P.tileID];h.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),h._renderTileClippingMasks(D,B,!0),h.renderLayer(h,h.style.sourceCaches[D.source],D,B,a),D.source&&(P.rttCoords[D.source]=this._coordsAscendingStr[D.source][P.tileID.key])}}return Ol(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects(),jt[l]}return!1}}const Uu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Sa=he,Ca={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ta,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Zl={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Gl{constructor(e,i,a=!1){this.mousedown=h=>{this.startMove(h,K.mousePos(this.element,h)),K.addEventListener(window,"mousemove",this.mousemove),K.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=h=>{this.move(h,K.mousePos(this.element,h))},this.mouseup=h=>{this._rotatePitchHanlder.dragEnd(h),this.offTemp()},this.touchstart=h=>{h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,h.targetTouches)[0],this.startMove(h,this._startPos),K.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.addEventListener(window,"touchend",this.touchend))},this.touchmove=h=>{h.targetTouches.length!==1?this.reset():(this._lastPos=K.touchPos(this.element,h.targetTouches)[0],this.move(h,this._lastPos))},this.touchend=h=>{h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const l=new wa;this._rotatePitchHanlder=new Ge({clickTolerance:3,move:(h,m)=>{const v=i.getBoundingClientRect(),x=new o.P((v.bottom-v.top)/2,(v.right-v.left)/2);return{bearingDelta:o.c7(new o.P(h.x,m.y),m,x),pitchDelta:a?-.5*(m.y-h.y):void 0}},moveStateManager:l,enable:!0,assignEvents:()=>{}}),this.map=e,K.addEventListener(i,"mousedown",this.mousedown),K.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(i,"touchcancel",this.reset)}startMove(e,i){this._rotatePitchHanlder.dragStart(e,i),K.disableDrag()}move(e,i){const a=this.map,{bearingDelta:l,pitchDelta:h}=this._rotatePitchHanlder.dragMove(e,i)||{};l&&a.setBearing(a.getBearing()+l),h&&a.setPitch(a.getPitch()+h)}off(){const e=this.element;K.removeEventListener(e,"mousedown",this.mousedown),K.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend),K.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){K.enableDrag(),K.removeEventListener(window,"mousemove",this.mousemove),K.removeEventListener(window,"mouseup",this.mouseup),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend)}}let sn;function Ns(u,e,i){const a=new o.N(u.lng,u.lat);if(u=new o.N(u.lng,u.lat),e){const l=new o.N(u.lng-360,u.lat),h=new o.N(u.lng+360,u.lat),m=i.locationToScreenPoint(u).distSqr(e);i.locationToScreenPoint(l).distSqr(e)<m?u=l:i.locationToScreenPoint(h).distSqr(e)<m&&(u=h)}for(;Math.abs(u.lng-i.center.lng)>180;){const l=i.locationToScreenPoint(u);if(l.x>=0&&l.y>=0&&l.x<=i.width&&l.y<=i.height)break;u.lng>i.center.lng?u.lng-=360:u.lng+=360}return u.lng!==a.lng&&i.isPointOnMapSurface(i.locationToScreenPoint(u))?u:a}const Ma={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function So(u,e,i){const a=u.classList;for(const l in Ma)a.remove(`maplibregl-${i}-anchor-${l}`);a.add(`maplibregl-${i}-anchor-${e}`)}class Ia extends o.E{constructor(e){if(super(),this._onKeyPress=i=>{const a=i.code,l=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&l!==32&&l!==13||this.togglePopup()},this._onMapClick=i=>{const a=i.originalEvent.target,l=this._element;this._popup&&(a===l||l.contains(a))&&this.togglePopup()},this._update=i=>{var a;if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((i==null?void 0:i.type)==="terrain"||(i==null?void 0:i.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ns(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||i&&i.type!=="moveend"||(this._pos=this._pos.round()),K.setTransform(this._element,`${Ma[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${h}`),ie.frameAsync(new AbortController).then(()=>{this._updateOpacity(i&&i.type==="moveend")}).catch(()=>{})},this._onMove=i=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=i=>{this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div");const i=K.createNS("http://www.w3.org/2000/svg","svg"),a=41,l=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${a}px`),i.setAttributeNS(null,"width",`${l}px`),i.setAttributeNS(null,"viewBox",`0 0 ${l} ${a}`);const h=K.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");const m=K.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");const v=K.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"transform","translate(3.0, 29.0)"),v.setAttributeNS(null,"fill","#000000");const x=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const W of x){const Y=K.createNS("http://www.w3.org/2000/svg","ellipse");Y.setAttributeNS(null,"opacity","0.04"),Y.setAttributeNS(null,"cx","10.5"),Y.setAttributeNS(null,"cy","5.80029008"),Y.setAttributeNS(null,"rx",W.rx),Y.setAttributeNS(null,"ry",W.ry),v.appendChild(Y)}const P=K.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const I=K.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(I);const k=K.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const D=K.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(D);const B=K.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(6.0, 7.0)"),B.setAttributeNS(null,"fill","#FFFFFF");const N=K.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=K.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const G=K.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#FFFFFF"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962"),N.appendChild(H),N.appendChild(G),m.appendChild(v),m.appendChild(P),m.appendChild(k),m.appendChild(B),m.appendChild(N),i.appendChild(m),i.setAttributeNS(null,"height",a*this._scale+"px"),i.setAttributeNS(null,"width",l*this._scale+"px"),this._element.appendChild(i),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",i=>{i.preventDefault()}),this._element.addEventListener("mousedown",i=>{i.preventDefault()}),So(this._element,this._anchor,"marker"),e&&e.className)for(const i of e.className.split(" "))this._element.classList.add(i);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const l=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(38.1-13.5+l)],"bottom-right":[-l,-1*(38.1-13.5+l)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,a;if(!(!((i=this._map)===null||i===void 0)&&i.terrain)){const k=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==k&&(this._element.style.opacity=k))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const l=this._map,h=l.terrain.depthAtPoint(this._pos),m=l.terrain.getElevationForLngLatZoom(this._lngLat,l.transform.tileZoom);if(l.transform.lngLatToCameraDepth(this._lngLat,m)-h<.006)return void(this._element.style.opacity=this._opacity);const v=-this._offset.y/l.transform.pixelsPerMeter,x=Math.sin(l.getPitch()*Math.PI/180)*v,P=l.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),I=l.transform.lngLatToCameraDepth(this._lngLat,m+x)-P>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&I&&this._popup.remove(),this._element.style.opacity=I?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,i){return e===void 0&&i===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),i!==void 0&&(this._opacityWhenCovered=i),this._map&&this._updateOpacity(!0),this}}const Hl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Vs=0,os=!1;const Wl={maxWidth:100,unit:"metric"};function Co(u,e,i){const a=i&&i.maxWidth||100,l=u._container.clientHeight/2,h=u._container.clientWidth/2,m=u.unproject([h-a/2,l]),v=u.unproject([h+a/2,l]),x=Math.round(u.project(v).x-u.project(m).x),P=Math.min(a,x,u._container.clientWidth),I=m.distanceTo(v);if(i&&i.unit==="imperial"){const k=3.2808*I;k>5280?Sn(e,P,k/5280,u._getUIString("ScaleControl.Miles")):Sn(e,P,k,u._getUIString("ScaleControl.Feet"))}else i&&i.unit==="nautical"?Sn(e,P,I/1852,u._getUIString("ScaleControl.NauticalMiles")):I>=1e3?Sn(e,P,I/1e3,u._getUIString("ScaleControl.Kilometers")):Sn(e,P,I,u._getUIString("ScaleControl.Meters"))}function Sn(u,e,i,a){const l=function(h){const m=Math.pow(10,`${Math.floor(h)}`.length-1);let v=h/m;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:v>=1?1:function(x){const P=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*P)/P}(v),m*v}(i);u.style.width=e*(l/i)+"px",u.innerHTML=`${l}&nbsp;${a}`}const Xl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Kl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ea(u){if(u){if(typeof u=="number"){const e=Math.round(Math.abs(u)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,u),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-u),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(u,0),right:new o.P(-u,0)}}if(u instanceof o.P||Array.isArray(u)){const e=o.P.convert(u);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(u.center||[0,0]),top:o.P.convert(u.top||[0,0]),"top-left":o.P.convert(u["top-left"]||[0,0]),"top-right":o.P.convert(u["top-right"]||[0,0]),bottom:o.P.convert(u.bottom||[0,0]),"bottom-left":o.P.convert(u["bottom-left"]||[0,0]),"bottom-right":o.P.convert(u["bottom-right"]||[0,0]),left:o.P.convert(u.left||[0,0]),right:o.P.convert(u.right||[0,0])}}return Ea(new o.P(0,0))}const Yl=he;T.AJAXError=o.cg,T.Event=o.k,T.Evented=o.E,T.LngLat=o.N,T.MercatorCoordinate=o.Y,T.Point=o.P,T.addProtocol=o.ch,T.config=o.a,T.removeProtocol=o.ci,T.AttributionControl=To,T.BoxZoomHandler=Iu,T.CanvasSource=Vn,T.CooperativeGesturesHandler=ql,T.DoubleClickZoomHandler=nn,T.DragPanHandler=xo,T.DragRotateHandler=Ul,T.EdgeInsets=Vi,T.FullscreenControl=class extends o.E{constructor(u={}){super(),this._onFullscreenChange=()=>{var e;let i=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=i==null?void 0:i.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)i=i.shadowRoot.fullscreenElement;i===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){K.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=K.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);K.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},T.GeoJSONSource=gn,T.GeolocateControl=class extends o.E{constructor(u){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new o.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,l=this._map.getBearing(),h=o.e({bearing:l},this.options.fitBoundsOptions),m=oi.fromLngLat(i,a);this._map.fitBounds(m,h,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new o.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&os)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=K.create("button","maplibregl-ctrl-geolocate",this._container),K.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ia({element:this._dotElement}),this._circleElement=K.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ia({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")),this.fire(new o.k("userlocationlostfocus")))})}},this.options=o.e({},Hl,u)}onAdd(u){return this._map=u,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function*(e=!1){if(sn!==void 0&&!e)return sn;if(window.navigator.permissions===void 0)return sn=!!window.navigator.geolocation,sn;try{sn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{sn=!!window.navigator.geolocation}return sn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Vs=0,os=!1}_isOutOfMapMaxBounds(u){const e=this._map.getMaxBounds(),i=u.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const u=this._map.getBounds(),e=u.getSouthEast(),i=u.getNorthEast(),a=e.distanceTo(i),l=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Vs--,os=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart")),this.fire(new o.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Vs++,Vs>1?(u={maximumAge:6e5,timeout:0},os=!0):(u=this.options.positionOptions,os=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},T.GlobeControl=class{constructor(){this._toggleProjection=()=>{var u;const e=(u=this._map.getProjection())===null||u===void 0?void 0:u.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var u;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((u=this._map.getProjection())===null||u===void 0?void 0:u.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(u){return this._map=u,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=K.create("button","maplibregl-ctrl-globe",this._container),K.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},T.Hash=Nl,T.ImageSource=or,T.KeyboardHandler=Bu,T.LngLatBounds=oi,T.LogoControl=Po,T.Map=class extends ot{constructor(u){var e,i;o.cd.mark(o.ce.create);const a=Object.assign(Object.assign(Object.assign({},Ca),u),{canvasContextAttributes:Object.assign(Object.assign({},Ca.canvasContextAttributes),u.canvasContextAttributes)});if(a.minZoom!=null&&a.maxZoom!=null&&a.minZoom>a.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(a.minPitch!=null&&a.maxPitch!=null&&a.minPitch>a.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(a.minPitch!=null&&a.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(a.maxPitch!=null&&a.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const l=new Qr,h=new qa;if(a.minZoom!==void 0&&l.setMinZoom(a.minZoom),a.maxZoom!==void 0&&l.setMaxZoom(a.maxZoom),a.minPitch!==void 0&&l.setMinPitch(a.minPitch),a.maxPitch!==void 0&&l.setMaxPitch(a.maxPitch),a.renderWorldCopies!==void 0&&l.setRenderWorldCopies(a.renderWorldCopies),super(l,h,{bearingSnap:a.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new tr,this._controls=[],this._mapId=o.a1(),this._contextLost=v=>{v.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:v}))},this._contextRestored=v=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:v}))},this._onMapScroll=v=>{if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=a.interactive,this._maxTileCacheSize=a.maxTileCacheSize,this._maxTileCacheZoomLevels=a.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},a.canvasContextAttributes),this._trackResize=a.trackResize===!0,this._bearingSnap=a.bearingSnap,this._centerClampedToGround=a.centerClampedToGround,this._refreshExpiredTiles=a.refreshExpiredTiles===!0,this._fadeDuration=a.fadeDuration,this._crossSourceCollisions=a.crossSourceCollisions===!0,this._collectResourceTiming=a.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Uu),a.locale),this._clickTolerance=a.clickTolerance,this._overridePixelRatio=a.pixelRatio,this._maxCanvasSize=a.maxCanvasSize,this.transformCameraUpdate=a.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=a.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Je.addThrottleControl(()=>this.isMoving()),this._requestManager=new lt(a.transformRequest),typeof a.container=="string"){if(this._container=document.getElementById(a.container),!this._container)throw new Error(`Container '${a.container}' not found.`)}else{if(!(a.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=a.container}if(a.maxBounds&&this.setMaxBounds(a.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let v=!1;const x=Tn(P=>{this._trackResize&&!this._removed&&(this.resize(P),this.redraw())},50);this._resizeObserver=new ResizeObserver(P=>{v?x(P):v=!0}),this._resizeObserver.observe(this._container)}this.handlers=new it(this,a),this._hash=a.hash&&new Nl(typeof a.hash=="string"&&a.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:a.center,elevation:a.elevation,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,roll:a.roll}),a.bounds&&(this.resize(),this.fitBounds(a.bounds,o.e({},a.fitBoundsOptions,{duration:0}))));const m=typeof a.style=="string"||((i=(e=a.style)===null||e===void 0?void 0:e.projection)===null||i===void 0?void 0:i.type)!=="globe";this.resize(null,m),this._localIdeographFontFamily=a.localIdeographFontFamily,this._validateStyle=a.validateStyle,a.style&&this.setStyle(a.style,{localIdeographFontFamily:a.localIdeographFontFamily}),a.attributionControl&&this.addControl(new To(typeof a.attributionControl=="boolean"?void 0:a.attributionControl)),a.maplibreLogo&&this.addControl(new Po,a.logoPosition),this.on("style.load",()=>{if(m||this._resizeTransform(),this.transform.unmodified){const v=o.M(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(v)}}),this.on("data",v=>{this._update(v.dataType==="style"),this.fire(new o.k(`${v.dataType}data`,v))}),this.on("dataloading",v=>{this.fire(new o.k(`${v.dataType}dataloading`,v))}),this.on("dataabort",v=>{this.fire(new o.k("sourcedataabort",v))})}_getMapId(){return this._mapId}addControl(u,e){if(e===void 0&&(e=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=u.onAdd(this);this._controls.push(u);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(i,a.firstChild):a.appendChild(i),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(u);return e>-1&&this._controls.splice(e,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}calculateCameraOptionsFromTo(u,e,i,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,e,i,a)}resize(u,e=!0){const[i,a]=this._containerDimensions(),l=this._getClampedPixelRatio(i,a);if(this._resizeCanvas(i,a,l),this.painter.resize(i,a,l),this.painter.overLimit()){const m=this.painter.context.gl;this._maxCanvasSize=[m.drawingBufferWidth,m.drawingBufferHeight];const v=this._getClampedPixelRatio(i,a);this._resizeCanvas(i,a,v),this.painter.resize(i,a,v)}this._resizeTransform(e);const h=!this._moving;return h&&(this.stop(),this.fire(new o.k("movestart",u)).fire(new o.k("move",u))),this.fire(new o.k("resize",u)),h&&this.fire(new o.k("moveend",u)),this}_resizeTransform(u=!0){var e;const[i,a]=this._containerDimensions();this.transform.resize(i,a,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(i,a,u)}_getClampedPixelRatio(u,e){const{0:i,1:a}=this._maxCanvasSize,l=this.getPixelRatio(),h=u*l,m=e*l;return Math.min(h>i?i/h:1,m>a?a/m:1)*l}getPixelRatio(){var u;return(u=this._overridePixelRatio)!==null&&u!==void 0?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(oi.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.setMinZoom(u),this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.setMaxZoom(u),this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.setMinPitch(u),this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(u>=this.transform.minPitch)return this.transform.setMaxPitch(u),this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.setRenderWorldCopies(u),this._update()}project(u){return this.transform.locationToScreenPoint(o.N.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.screenPointToLocation(o.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||((u=this.handlers)===null||u===void 0?void 0:u.isMoving())}isZooming(){var u;return this._zooming||((u=this.handlers)===null||u===void 0?void 0:u.isZooming())}isRotating(){var u;return this._rotating||((u=this.handlers)===null||u===void 0?void 0:u.isRotating())}_createDelegatedListener(u,e,i){if(u==="mouseenter"||u==="mouseover"){let a=!1;return{layers:e,listener:i,delegates:{mousemove:h=>{const m=e.filter(x=>this.getLayer(x)),v=m.length!==0?this.queryRenderedFeatures(h.point,{layers:m}):[];v.length?a||(a=!0,i.call(this,new ai(u,this,h.originalEvent,{features:v}))):a=!1},mouseout:()=>{a=!1}}}}if(u==="mouseleave"||u==="mouseout"){let a=!1;return{layers:e,listener:i,delegates:{mousemove:m=>{const v=e.filter(x=>this.getLayer(x));(v.length!==0?this.queryRenderedFeatures(m.point,{layers:v}):[]).length?a=!0:a&&(a=!1,i.call(this,new ai(u,this,m.originalEvent)))},mouseout:m=>{a&&(a=!1,i.call(this,new ai(u,this,m.originalEvent)))}}}}{const a=l=>{const h=e.filter(v=>this.getLayer(v)),m=h.length!==0?this.queryRenderedFeatures(l.point,{layers:h}):[];m.length&&(l.features=m,i.call(this,l),delete l.features)};return{layers:e,listener:i,delegates:{[u]:a}}}}_saveDelegatedListener(u,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(e)}_removeDelegatedListener(u,e,i){if(!this._delegatedListeners||!this._delegatedListeners[u])return;const a=this._delegatedListeners[u];for(let l=0;l<a.length;l++){const h=a[l];if(h.listener===i&&h.layers.length===e.length&&h.layers.every(m=>e.includes(m))){for(const m in h.delegates)this.off(m,h.delegates[m]);return void a.splice(l,1)}}}on(u,e,i){if(i===void 0)return super.on(u,e);const a=typeof e=="string"?[e]:e,l=this._createDelegatedListener(u,a,i);this._saveDelegatedListener(u,l);for(const h in l.delegates)this.on(h,l.delegates[h]);return{unsubscribe:()=>{this._removeDelegatedListener(u,a,i)}}}once(u,e,i){if(i===void 0)return super.once(u,e);const a=typeof e=="string"?[e]:e,l=this._createDelegatedListener(u,a,i);for(const h in l.delegates){const m=l.delegates[h];l.delegates[h]=(...v)=>{this._removeDelegatedListener(u,a,i),m(...v)}}this._saveDelegatedListener(u,l);for(const h in l.delegates)this.once(h,l.delegates[h]);return this}off(u,e,i){return i===void 0?super.off(u,e):(this._removeDelegatedListener(u,typeof e=="string"?[e]:e,i),this)}queryRenderedFeatures(u,e){if(!this.style)return[];let i;const a=u instanceof o.P||Array.isArray(u),l=a?u:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:u)||{},l instanceof o.P||typeof l[0]=="number")i=[o.P.convert(l)];else{const h=o.P.convert(l[0]),m=o.P.convert(l[1]);i=[h,new o.P(m.x,h.y),m,new o.P(h.x,m.y),h]}return this.style.queryRenderedFeatures(i,e,this.transform)}querySourceFeatures(u,e){return this.style.querySourceFeatures(u,e)}setStyle(u,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(u,e))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const e=this._locale[u];if(e==null)throw new Error(`Missing UI string '${u}'`);return e}_updateStyle(u,e){var i,a;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(u,e));const l=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new xr(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u,e,l):this.style.loadJSON(u,e,l),this):((a=(i=this.style)===null||i===void 0?void 0:i.projection)===null||a===void 0||a.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,e){if(typeof u=="string"){const i=this._requestManager.transformRequest(u,"Style");o.h(i,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new o.j(a))})}else typeof u=="object"&&this._updateDiff(u,e)}_updateDiff(u,e){try{this.style.setState(u,e)&&this._update(!0)}catch(i){o.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(u,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(u,e){return this._lazyInitEmptyStyle(),this.style.addSource(u,e),this._update(!0)}isSourceLoaded(u){const e=this.style&&this.style.sourceCaches[u];if(e!==void 0)return e.loaded();this.fire(new o.j(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const e=this.style.sourceCaches[u.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);this.terrain===null&&e.reload();for(const i in this.style._layers){const a=this.style._layers[i];a.type==="hillshade"&&a.source===u.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new dd(this.painter,e,u),this.painter.renderToTexture=new li(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=i=>{i.dataType==="style"?this.terrain.sourceCache.freeRtt():i.dataType==="source"&&i.tile&&(i.sourceId!==u.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(i.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.k("terrain",{terrain:u})),this}getTerrain(){var u,e;return(e=(u=this.terrain)===null||u===void 0?void 0:u.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const e in u){const i=u[e]._tiles;for(const a in i){const l=i[a];if(l.state!=="loaded"&&l.state!=="errored")return!1}}return!0}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,e,i={}){const{pixelRatio:a=1,sdf:l=!1,stretchX:h,stretchY:m,content:v,textFitWidth:x,textFitHeight:P}=i;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:k,data:D}=e,B=e;return this.style.addImage(u,{data:new o.R({width:I,height:k},new Uint8Array(D)),pixelRatio:a,stretchX:h,stretchY:m,content:v,textFitWidth:x,textFitHeight:P,sdf:l,version:0,userImage:B}),B.onAdd&&B.onAdd(this,u),this}}{const{width:I,height:k,data:D}=ie.getImageData(e);this.style.addImage(u,{data:new o.R({width:I,height:k},D),pixelRatio:a,stretchX:h,stretchY:m,content:v,textFitWidth:x,textFitHeight:P,sdf:l,version:0})}}updateImage(u,e){const i=this.style.getImage(u);if(!i)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||o.b(e)?ie.getImageData(e):e,{width:l,height:h,data:m}=a;if(l===void 0||h===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(l!==i.data.width||h!==i.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const v=!(e instanceof HTMLImageElement||o.b(e));return i.data.replace(m,v),this.style.updateImage(u,i),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u){return Je.getImage(this._requestManager.transformRequest(u,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(u,e){return this._lazyInitEmptyStyle(),this.style.addLayer(u,e),this._update(!0)}moveLayer(u,e){return this.style.moveLayer(u,e),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,e,i){return this.style.setLayerZoomRange(u,e,i),this._update(!0)}setFilter(u,e,i={}){return this.style.setFilter(u,e,i),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,e,i,a={}){return this.style.setPaintProperty(u,e,i,a),this._update(!0)}getPaintProperty(u,e){return this.style.getPaintProperty(u,e)}setLayoutProperty(u,e,i,a={}){return this.style.setLayoutProperty(u,e,i,a),this._update(!0)}getLayoutProperty(u,e){return this.style.getLayoutProperty(u,e)}setGlyphs(u,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,e,i,a=>{a||this._update(!0)}),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,e,i=>{i||this._update(!0)}),this}setLight(u,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(u,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(u,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(u,e){return this.style.setFeatureState(u,e),this._update()}removeFeatureState(u,e){return this.style.removeFeatureState(u,e),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,e=0;return this._container&&(u=this._container.clientWidth||400,e=this._container.clientHeight||300),[u,e]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const e=this._canvasContainer=K.create("div","maplibregl-canvas-container",u);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=K.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),a=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],a);const l=this._controlContainer=K.create("div","maplibregl-control-container",u),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{h[m]=K.create("div",`maplibregl-ctrl-${m} `,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,e,i){this._canvas.width=Math.floor(i*u),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const u=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:u},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,u):this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u),!i){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new wu(i,this.transform),ge.testSupport(i)}migrateProjection(u,e){super.migrateProjection(u,e),this.painter.transform=u,this.fire(new o.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){var e,i,a,l,h;const m=this._idleTriggered?this._fadeDuration:0,v=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,D=ie.now();this.style.zoomHistory.update(k,D);const B=new o.z(k,{now:D,fadeDuration:m,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),N=B.crossFadingFactor();N===1&&N===this._crossFadingFactor||(x=!0,this._crossFadingFactor=N),this.style.update(B)}const P=((i=this.style.projection)===null||i===void 0?void 0:i.transitionState)>0!==v;(a=this.style.projection)===null||a===void 0||a.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((l=this.style.projection)===null||l===void 0?void 0:l.transitionState,(h=this.style.projection)===null||h===void 0?void 0:h.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||P)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,m,this._crossSourceCollisions,P),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cd.mark(o.ce.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const I=this._sourcesDirty||this._styleDirty||this._placementDirty;return I||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,o.cd.mark(o.ce.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Je.removeThrottleControl(this._imageQueueHandle),(u=this._resizeObserver)===null||u===void 0||u.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),K.remove(this._canvasContainer),K.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cd.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ie.frame(this._frameRequest,u=>{o.cd.frame(u),this._frameRequest=null;try{this._render(u)}catch(e){if(!o.cf(e)&&!function(i){return i.message===no}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return Sa}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(u){return this._lazyInitEmptyStyle(),this.style.setProjection(u),this._update(!0)}},T.MapMouseEvent=ai,T.MapTouchEvent=Fs,T.MapWheelEvent=zr,T.Marker=Ia,T.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const e=this._map.getZoom(),i=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,i)=>{const a=this._map._getUIString(`NavigationControl.${i}`);e.title=a,e.setAttribute("aria-label",a)},this.options=o.e({},Zl,u),this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),K.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),K.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=K.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Gl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,e){const i=K.create("button",u,this._container);return i.type="button",i.addEventListener("click",e),i}},T.Popup=class extends o.E{constructor(u){super(),this.remove=()=>(this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var i;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=K.create("div","maplibregl-popup",this._map.getContainer()),this._tip=K.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ns(this._lngLat,this._flatPos,this._map.transform):(i=this._lngLat)===null||i===void 0?void 0:i.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=Ea(this.options.offset);if(!l){const v=this._container.offsetWidth,x=this._container.offsetHeight;let P;P=a.y+h.bottom.y<x?["top"]:a.y>this._map.transform.height-x?["bottom"]:[],a.x<v/2?P.push("left"):a.x>this._map.transform.width-v/2&&P.push("right"),l=P.length===0?"bottom":P.join("-")}let m=a.add(h[l]);this.options.subpixelPositioning||(m=m.round()),K.setTransform(this._container,`${Ma[l]} translate(${m.x}px,${m.y}px)`),So(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Xl),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=o.N.convert(u),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const e=document.createDocumentFragment(),i=document.createElement("body");let a;for(i.innerHTML=u;a=i.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var u;return(u=this._container)===null||u===void 0?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){return this._container&&this._container.classList.add(u),this}removeClassName(u){return this._container&&this._container.classList.remove(u),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}setSubpixelPositioning(u){this.options.subpixelPositioning=u}_createCloseButton(){this.options.closeButton&&(this._closeButton=K.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Kl);u&&u.focus()}},T.RasterDEMTileSource=mn,T.RasterTileSource=Er,T.ScaleControl=class{constructor(u){this._onMove=()=>{Co(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Co(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Wl),u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},T.ScrollZoomHandler=Nu,T.Style=xr,T.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=u}onAdd(u){return this._map=u,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=K.create("button","maplibregl-ctrl-terrain",this._container),K.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){K.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},T.TwoFingersTouchPitchHandler=vo,T.TwoFingersTouchRotateHandler=Ru,T.TwoFingersTouchZoomHandler=_o,T.TwoFingersTouchZoomRotateHandler=$l,T.VectorTileSource=jn,T.VideoSource=Nn,T.addSourceType=(u,e)=>o._(void 0,void 0,void 0,function*(){if(ta(u))throw new Error(`A source type called "${u}" already exists.`);((i,a)=>{_n[i]=a})(u,e)}),T.clearPrewarmedResources=function(){const u=vr;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(vs),vr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},T.createTileMesh=ca,T.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},T.getRTLTextPluginStatus=function(){return Jr().getRTLTextPluginStatus()},T.getVersion=function(){return Yl},T.getWorkerCount=function(){return jr.workerCount},T.getWorkerUrl=function(){return o.a.WORKER_URL},T.importScriptInWorkers=function(u){return Bn().broadcast("IS",u)},T.prewarm=function(){Rn().acquire(vs)},T.setMaxParallelImageRequests=function(u){o.a.MAX_PARALLEL_IMAGE_REQUESTS=u},T.setRTLTextPlugin=function(u,e){return Jr().setRTLTextPlugin(u,e)},T.setWorkerCount=function(u){jr.workerCount=u},T.setWorkerUrl=function(u){o.a.WORKER_URL=u}});var A=_;return A})}(yh)),yh.exports}var p0=d0();const f0=u0(p0),m0=(p,y)=>{y(y().mapExpanded=!0,!0),y(y().currentVideo=null,!0)};var g0=Ji('<button aria-label="Expand map"></button> <div id="map"></div>',1);function _0(p,y){Jo(y,!0);let _=$h(y,"contentState",15),C=yr(o0()),E=Sc(!1),A,T;const o="line-layer",he="line-source";Rp(()=>(A=new f0.Map({container:T.id,style:"https://api.maptiler.com/maps/streets-v2/style.json?key=6XCcjC6WVLlf4xovwI6t",center:[36.12893,56.7269449],zoom:9.7}),A.on("load",()=>{C.then(K=>se(K))}),()=>A.remove()));const se=K=>{A.addSource(he,{type:"geojson",data:K}),A.addLayer({id:o,source:he,type:"line",paint:{"line-color":"#c11","line-width":2}}),A.on("click",ge=>{const Oe=[[ge.point.x-5,ge.point.y-5],[ge.point.x+5,ge.point.y+5]];A.queryRenderedFeatures(Oe,{layers:[o]}).length!=0?_().videoBarVisible||_(_().videoBarVisible=!0,!0):_().videoBarVisible&&_(_().videoBarVisible=!1,!0)}),A.on("mousemove",ge=>{const Oe=[[ge.point.x-5,ge.point.y-5],[ge.point.x+5,ge.point.y+5]];A.queryRenderedFeatures(Oe,{layers:[o]}).length!=0?Ai(E,!0):Ai(E,!1)})};var fe=g0(),xe=Ic(fe);xe.__click=[m0,_];var ie=Yi(xe,2);_h(ie,K=>T=K,()=>T),Js(()=>{zc(xe,`map__expand-bttn 
        ${(!_().mapExpanded&&!_().videoPlaying?"map__expand-bttn_touchable":"")??""} svelte-1p39aua`),zc(ie,`map 
        ${(_().mapExpanded&&!_().videoPlaying?"map_touchable":"")??""}
        ${(ht(E)?"map_feature-over":"")??""} svelte-1p39aua`)}),Gi(p,fe),Qo()}Dp(["click"]);const y0=(p,y,_,C)=>{if(ht(y)==null||ht(_)==null)return;const E=window.getComputedStyle(ht(y)),A=ht(y).offsetWidth+parseInt(E.marginLeft)*2;Ai(C,yr(ht(C)-A<-ht(_).scrollWidth+ht(_).offsetWidth?-ht(_).scrollWidth+ht(_).offsetWidth:ht(C)-A))},v0=(p,y,_,C)=>{if(ht(y)==null||ht(_)==null)return;const E=window.getComputedStyle(ht(y)),A=ht(y).offsetWidth+parseInt(E.marginLeft)*2;Ai(C,yr(ht(C)+A>0?0:ht(C)+A))};var b0=Ji('<button class="video-bar__thumbnail-wrapper svelte-vm0bfr" style="opacity: 0.5;"><div class="video-bar__thumbnail-date-wrapper svelte-vm0bfr"> </div> <img alt="Video thumbnail" class="video-bar__thumbnail svelte-vm0bfr"></button>'),x0=(p,y,_)=>y(ht(_)),w0=Ji('<button class="video-bar__thumbnail-wrapper svelte-vm0bfr"><div class="video-bar__thumbnail-date-wrapper svelte-vm0bfr"> </div> <img alt="Video thumbnail" class="video-bar__thumbnail svelte-vm0bfr"></button>'),T0=Ji('<button class="video-bar__bttn-left svelte-vm0bfr" aria-label="Scroll left"><i class="bi-chevron-left"></i></button> <button class="video-bar__bttn-right svelte-vm0bfr" aria-label="Scroll right"><i class="bi-chevron-right"></i></button> <div class="video-bar__thumbnails-list svelte-vm0bfr"></div>',1),P0=Ji('<div class="video-bar__thumbnail-wrapper svelte-vm0bfr"></div>'),S0=Ji('<div class="video-bar__thumbnails-list svelte-vm0bfr"></div>'),C0=Ji('<div class="video-bar svelte-vm0bfr"><!></div>');function M0(p,y){Jo(y,!0);let _=$h(y,"contentState",15),C=yr(a0()),E=Sc(null),A=Sc(null),T=Sc(0);const o=xe=>{_(_().mapExpanded=!1,!0),_(_().videoBarVisible=!1,!0),_(_().currentVideo=xe,!0)},he=()=>{Ai(T,0)};Rp(()=>(window.addEventListener("resize",he),()=>window.removeEventListener("resize",he)));var se=C0(),fe=Si(se);Vv(fe,()=>C,xe=>{var ie=S0();pp(ie,20,()=>Array.from({length:10}),Tg,(K,ge)=>{var Oe=P0();Gi(K,Oe)}),Gi(xe,ie)},(xe,ie)=>{var K=T0(),ge=Ic(K);ge.__click=[v0,E,A,T];var Oe=Yi(ge,2);Oe.__click=[y0,E,A,T];var He=Yi(Oe,2);pp(He,21,()=>ht(ie),Ze=>Ze.id,(Ze,Re)=>{var rt=Bv(),Je=Ic(rt);{var lt=et=>{var ct=b0(),kt=Si(ct),Qi=Si(kt),Ci=Yi(kt,2);_h(ct,zi=>Ai(E,zi),()=>ht(E)),Js(()=>{kh(Qi,ht(Re).formatedDate),Cc(Ci,"src",ht(Re).thumbUrl)}),Gi(et,ct)},ft=et=>{var ct=w0();ct.__click=[x0,o,Re];var kt=Si(ct),Qi=Si(kt),Ci=Yi(kt,2);_h(ct,zi=>Ai(E,zi),()=>ht(E)),Js(()=>{kh(Qi,ht(Re).formatedDate),Cc(Ci,"src",ht(Re).thumbUrl)}),Gi(et,ct)};Lp(Je,et=>{var ct,kt;ht(Re).id==((kt=(ct=_())==null?void 0:ct.currentVideo)==null?void 0:kt.id)?et(lt):et(ft,!1)})}Gi(Ze,rt)}),_h(He,Ze=>Ai(A,Ze),()=>ht(A)),Js(()=>Cc(He,"style",`transform: translateX(${ht(T)??""}px);`)),fp(3,ge,()=>zm,()=>({duration:300})),fp(3,Oe,()=>zm,()=>({duration:300})),Gi(xe,K)}),Gi(p,se),Qo()}Dp(["click"]);function Qe(p,y,_){return(y=E0(y))in p?Object.defineProperty(p,y,{value:_,enumerable:!0,configurable:!0,writable:!0}):p[y]=_,p}function I0(p,y){if(typeof p!="object"||p===null)return p;var _=p[Symbol.toPrimitive];if(_!==void 0){var C=_.call(p,y);if(typeof C!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(p)}function E0(p){var y=I0(p,"string");return typeof y=="symbol"?y:String(y)}function k0(p,y){if(!(p instanceof y))throw new TypeError("Cannot call a class as a function")}function Fm(p,y){for(var _=0;_<y.length;_++){var C=y[_];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(p,C.key,C)}}function A0(p,y,_){return y&&Fm(p.prototype,y),_&&Fm(p,_),p}function z0(p,y,_){return y in p?Object.defineProperty(p,y,{value:_,enumerable:!0,configurable:!0,writable:!0}):p[y]=_,p}function Bm(p,y){var _=Object.keys(p);if(Object.getOwnPropertySymbols){var C=Object.getOwnPropertySymbols(p);y&&(C=C.filter(function(E){return Object.getOwnPropertyDescriptor(p,E).enumerable})),_.push.apply(_,C)}return _}function Om(p){for(var y=1;y<arguments.length;y++){var _=arguments[y]!=null?arguments[y]:{};y%2?Bm(Object(_),!0).forEach(function(C){z0(p,C,_[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(_)):Bm(Object(_)).forEach(function(C){Object.defineProperty(p,C,Object.getOwnPropertyDescriptor(_,C))})}return p}var jm={addCSS:!0,thumbWidth:15,watch:!0};function D0(p,y){return(function(){return Array.from(document.querySelectorAll(y)).includes(this)}).call(p,y)}function L0(p,y){if(p&&y){var _=new Event(y,{bubbles:!0});p.dispatchEvent(_)}}var Uc=function(p){return p!=null?p.constructor:null},Fp=function(p,y){return!!(p&&y&&p instanceof y)},Cg=function(p){return p==null},Mg=function(p){return Uc(p)===Object},R0=function(p){return Uc(p)===Number&&!Number.isNaN(p)},Ig=function(p){return Uc(p)===String},F0=function(p){return Uc(p)===Boolean},B0=function(p){return Uc(p)===Function},Eg=function(p){return Array.isArray(p)},kg=function(p){return Fp(p,NodeList)},O0=function(p){return Fp(p,Element)},j0=function(p){return Fp(p,Event)},N0=function(p){return Cg(p)||(Ig(p)||Eg(p)||kg(p))&&!p.length||Mg(p)&&!Object.keys(p).length},nr={nullOrUndefined:Cg,object:Mg,number:R0,string:Ig,boolean:F0,function:B0,array:Eg,nodeList:kg,element:O0,event:j0,empty:N0};function V0(p){var y="".concat(p).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return y?Math.max(0,(y[1]?y[1].length:0)-(y[2]?+y[2]:0)):0}function U0(p,y){if(1>y){var _=V0(y);return parseFloat(p.toFixed(_))}return Math.round(p/y)*y}var $0=function(){function p(y,_){k0(this,p),nr.element(y)?this.element=y:nr.string(y)&&(this.element=document.querySelector(y)),nr.element(this.element)&&nr.empty(this.element.rangeTouch)&&(this.config=Om({},jm,{},_),this.init())}return A0(p,[{key:"init",value:function(){p.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){p.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(y){var _=this,C=y?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach(function(E){_.element[C](E,function(A){return _.set(A)},!1)})}},{key:"get",value:function(y){if(!p.enabled||!nr.event(y))return null;var _,C=y.target,E=y.changedTouches[0],A=parseFloat(C.getAttribute("min"))||0,T=parseFloat(C.getAttribute("max"))||100,o=parseFloat(C.getAttribute("step"))||1,he=C.getBoundingClientRect(),se=100/he.width*(this.config.thumbWidth/2)/100;return 0>(_=100/he.width*(E.clientX-he.left))?_=0:100<_&&(_=100),50>_?_-=(100-2*_)*se:50<_&&(_+=2*(_-50)*se),A+U0(_/100*(T-A),o)}},{key:"set",value:function(y){p.enabled&&nr.event(y)&&!y.target.disabled&&(y.preventDefault(),y.target.value=this.get(y),L0(y.target,y.type==="touchend"?"change":"input"))}}],[{key:"setup",value:function(y){var _=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},C=null;if(nr.empty(y)||nr.string(y)?C=Array.from(document.querySelectorAll(nr.string(y)?y:'input[type="range"]')):nr.element(y)?C=[y]:nr.nodeList(y)?C=Array.from(y):nr.array(y)&&(C=y.filter(nr.element)),nr.empty(C))return null;var E=Om({},jm,{},_);if(nr.string(y)&&E.watch){var A=new MutationObserver(function(T){Array.from(T).forEach(function(o){Array.from(o.addedNodes).forEach(function(he){nr.element(he)&&D0(he,y)&&new p(he,E)})})});A.observe(document.body,{childList:!0,subtree:!0})}return C.map(function(T){return new p(T,_)})}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}]),p}();const $c=p=>p!=null?p.constructor:null,gs=(p,y)=>!!(p&&y&&p instanceof y),Bp=p=>p==null,Ag=p=>$c(p)===Object,q0=p=>$c(p)===Number&&!Number.isNaN(p),qh=p=>$c(p)===String,Z0=p=>$c(p)===Boolean,zg=p=>typeof p=="function",Dg=p=>Array.isArray(p),G0=p=>gs(p,WeakMap),Lg=p=>gs(p,NodeList),H0=p=>$c(p)===Text,W0=p=>gs(p,Event),X0=p=>gs(p,KeyboardEvent),K0=p=>gs(p,window.TextTrackCue)||gs(p,window.VTTCue),Y0=p=>gs(p,TextTrack)||!Bp(p)&&qh(p.kind),J0=p=>gs(p,Promise)&&zg(p.then),Q0=p=>p!==null&&typeof p=="object"&&p.nodeType===1&&typeof p.style=="object"&&typeof p.ownerDocument=="object",Rg=p=>Bp(p)||(qh(p)||Dg(p)||Lg(p))&&!p.length||Ag(p)&&!Object.keys(p).length,eb=p=>{if(gs(p,window.URL))return!0;if(!qh(p))return!1;let y=p;p.startsWith("http://")&&p.startsWith("https://")||(y=`http://${p}`);try{return!Rg(new URL(y).hostname)}catch{return!1}};var J={nullOrUndefined:Bp,object:Ag,number:q0,string:qh,boolean:Z0,function:zg,array:Dg,weakMap:G0,nodeList:Lg,element:Q0,textNode:H0,event:W0,keyboardEvent:X0,cue:K0,track:Y0,promise:J0,url:eb,empty:Rg};const gp=(()=>{const p=document.createElement("span"),y={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},_=Object.keys(y).find(C=>p.style[C]!==void 0);return!!J.string(_)&&y[_]})();function Fg(p,y){setTimeout(()=>{try{p.hidden=!0,p.offsetHeight,p.hidden=!1}catch{}},y)}const tb=!!window.document.documentMode,ib=/Edge/g.test(navigator.userAgent),rb="WebkitAppearance"in document.documentElement.style&&!/Edge/g.test(navigator.userAgent),nb=/iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1,sb=navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,ab=/iPad|iPhone|iPod/gi.test(navigator.userAgent)&&navigator.maxTouchPoints>1;var Hi={isIE:tb,isEdge:ib,isWebKit:rb,isIPhone:nb,isIPadOS:sb,isIos:ab};function ob(p){return JSON.parse(JSON.stringify(p))}function Bg(p,y){return y.split(".").reduce((_,C)=>_&&_[C],p)}function Ti(p={},...y){if(!y.length)return p;const _=y.shift();return J.object(_)?(Object.keys(_).forEach(C=>{J.object(_[C])?(Object.keys(p).includes(C)||Object.assign(p,{[C]:{}}),Ti(p[C],_[C])):Object.assign(p,{[C]:_[C]})}),Ti(p,...y)):p}function Og(p,y){const _=p.length?p:[p];Array.from(_).reverse().forEach((C,E)=>{const A=E>0?y.cloneNode(!0):y,T=C.parentNode,o=C.nextSibling;A.appendChild(C),o?T.insertBefore(A,o):T.appendChild(A)})}function _p(p,y){J.element(p)&&!J.empty(y)&&Object.entries(y).filter(([,_])=>!J.nullOrUndefined(_)).forEach(([_,C])=>p.setAttribute(_,C))}function pt(p,y,_){const C=document.createElement(p);return J.object(y)&&_p(C,y),J.string(_)&&(C.innerText=_),C}function lb(p,y){J.element(p)&&J.element(y)&&y.parentNode.insertBefore(p,y.nextSibling)}function Nm(p,y,_,C){J.element(y)&&y.appendChild(pt(p,_,C))}function ps(p){J.nodeList(p)||J.array(p)?Array.from(p).forEach(ps):J.element(p)&&J.element(p.parentNode)&&p.parentNode.removeChild(p)}function vh(p){if(!J.element(p))return;let{length:y}=p.childNodes;for(;y>0;)p.removeChild(p.lastChild),y-=1}function Ah(p,y){return J.element(y)&&J.element(y.parentNode)&&J.element(p)?(y.parentNode.replaceChild(p,y),p):null}function En(p,y){if(!J.string(p)||J.empty(p))return{};const _={},C=Ti({},y);return p.split(",").forEach(E=>{const A=E.trim(),T=A.replace(".",""),o=A.replace(/[[\]]/g,"").split("="),[he]=o,se=o.length>1?o[1].replace(/["']/g,""):"";switch(A.charAt(0)){case".":J.string(C.class)?_.class=`${C.class} ${T}`:_.class=T;break;case"#":_.id=A.replace("#","");break;case"[":_[he]=se}}),Ti(C,_)}function Ba(p,y){if(!J.element(p))return;let _=y;J.boolean(_)||(_=!p.hidden),p.hidden=_}function Nt(p,y,_){if(J.nodeList(p))return Array.from(p).map(C=>Nt(C,y,_));if(J.element(p)){let C="toggle";return _!==void 0&&(C=_?"add":"remove"),p.classList[C](y),p.classList.contains(y)}return!1}function zh(p,y){return J.element(p)&&p.classList.contains(y)}function ja(p,y){const{prototype:_}=Element;return(_.matches||_.webkitMatchesSelector||_.mozMatchesSelector||_.msMatchesSelector||function(){return Array.from(document.querySelectorAll(y)).includes(this)}).call(p,y)}function cb(p,y){const{prototype:_}=Element;return(_.closest||function(){let C=this;do{if(ja.matches(C,y))return C;C=C.parentElement||C.parentNode}while(C!==null&&C.nodeType===1);return null}).call(p,y)}function Dc(p){return this.elements.container.querySelectorAll(p)}function Oi(p){return this.elements.container.querySelector(p)}function np(p=null,y=!1){J.element(p)&&p.focus({preventScroll:!0,focusVisible:y})}const Vm={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},Pi={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check(p,y){const _=Pi[p]||y!=="html5";return{api:_,ui:_&&Pi.rangeInput}},pip:!(Hi.isIPhone||!J.function(pt("video").webkitSetPresentationMode)&&(!document.pictureInPictureEnabled||pt("video").disablePictureInPicture)),airplay:J.function(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime(p){if(J.empty(p))return!1;const[y]=p.split("/");let _=p;if(!this.isHTML5||y!==this.type)return!1;Object.keys(Vm).includes(_)&&(_+=`; codecs="${Vm[p]}"`);try{return!!(_&&this.media.canPlayType(_).replace(/no/,""))}catch{return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(()=>{const p=document.createElement("input");return p.type="range",p.type==="range"})(),touch:"ontouchstart"in document.documentElement,transitions:gp!==!1,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},ub=(()=>{let p=!1;try{const y=Object.defineProperty({},"passive",{get:()=>(p=!0,null)});window.addEventListener("test",null,y),window.removeEventListener("test",null,y)}catch{}return p})();function Lc(p,y,_,C=!1,E=!0,A=!1){if(!p||!("addEventListener"in p)||J.empty(y)||!J.function(_))return;const T=y.split(" ");let o=A;ub&&(o={passive:E,capture:A}),T.forEach(he=>{this&&this.eventListeners&&C&&this.eventListeners.push({element:p,type:he,callback:_,options:o}),p[C?"addEventListener":"removeEventListener"](he,_,o)})}function At(p,y="",_,C=!0,E=!1){Lc.call(this,p,y,_,!0,C,E)}function Zh(p,y="",_,C=!0,E=!1){Lc.call(this,p,y,_,!1,C,E)}function Op(p,y="",_,C=!0,E=!1){const A=(...T)=>{Zh(p,y,A,C,E),_.apply(this,T)};Lc.call(this,p,y,A,!0,C,E)}function mt(p,y="",_=!1,C={}){if(!J.element(p)||J.empty(y))return;const E=new CustomEvent(y,{bubbles:_,detail:{...C,plyr:this}});p.dispatchEvent(E)}function hb(){this&&this.eventListeners&&(this.eventListeners.forEach(p=>{const{element:y,type:_,callback:C,options:E}=p;y.removeEventListener(_,C,E)}),this.eventListeners=[])}function db(){return new Promise(p=>this.ready?setTimeout(p,0):At.call(this,this.elements.container,"ready",p)).then(()=>{})}function kn(p){J.promise(p)&&p.then(null,()=>{})}function yp(p){return J.array(p)?p.filter((y,_)=>p.indexOf(y)===_):p}function jg(p,y){return J.array(p)&&p.length?p.reduce((_,C)=>Math.abs(C-y)<Math.abs(_-y)?C:_):null}function Ng(p){return!(!window||!window.CSS)&&window.CSS.supports(p)}const Um=[[1,1],[4,3],[3,4],[5,4],[4,5],[3,2],[2,3],[16,10],[10,16],[16,9],[9,16],[21,9],[9,21],[32,9],[9,32]].reduce((p,[y,_])=>({...p,[y/_]:[y,_]}),{});function Vg(p){return J.array(p)||J.string(p)&&p.includes(":")?(J.array(p)?p:p.split(":")).map(Number).every(J.number):!1}function Dh(p){if(!J.array(p)||!p.every(J.number))return null;const[y,_]=p,C=(A,T)=>T===0?A:C(T,A%T),E=C(y,_);return[y/E,_/E]}function jp(p){const y=C=>Vg(C)?C.split(":").map(Number):null;let _=y(p);if(_===null&&(_=y(this.config.ratio)),_===null&&!J.empty(this.embed)&&J.array(this.embed.ratio)&&({ratio:_}=this.embed),_===null&&this.isHTML5){const{videoWidth:C,videoHeight:E}=this.media;_=[C,E]}return Dh(_)}function Xo(p){if(!this.isVideo)return{};const{wrapper:y}=this.elements,_=jp.call(this,p);if(!J.array(_))return{};const[C,E]=Dh(_),A=100/C*E;if(Ng(`aspect-ratio: ${C}/${E}`)?y.style.aspectRatio=`${C}/${E}`:y.style.paddingBottom=`${A}%`,this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){const T=100/this.media.offsetWidth*parseInt(window.getComputedStyle(this.media).paddingBottom,10),o=(T-A)/(T/50);this.fullscreen.active?y.style.paddingBottom=null:this.media.style.transform=`translateY(-${o}%)`}else this.isHTML5&&y.classList.add(this.config.classNames.videoFixedRatio);return{padding:A,ratio:_}}function Ug(p,y,_=.05){const C=p/y,E=jg(Object.keys(Um),C);return Math.abs(E-C)<=_?Um[E]:[p,y]}function pb(){return[Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)]}const Ys={getSources(){return this.isHTML5?Array.from(this.media.querySelectorAll("source")).filter(p=>{const y=p.getAttribute("type");return!!J.empty(y)||Pi.mime.call(this,y)}):[]},getQualityOptions(){return this.config.quality.forced?this.config.quality.options:Ys.getSources.call(this).map(p=>Number(p.getAttribute("size"))).filter(Boolean)},setup(){if(!this.isHTML5)return;const p=this;p.options.speed=p.config.speed.options,J.empty(this.config.ratio)||Xo.call(p),Object.defineProperty(p.media,"quality",{get(){const y=Ys.getSources.call(p).find(_=>_.getAttribute("src")===p.source);return y&&Number(y.getAttribute("size"))},set(y){if(p.quality!==y){if(p.config.quality.forced&&J.function(p.config.quality.onChange))p.config.quality.onChange(y);else{const _=Ys.getSources.call(p).find(he=>Number(he.getAttribute("size"))===y);if(!_)return;const{currentTime:C,paused:E,preload:A,readyState:T,playbackRate:o}=p.media;p.media.src=_.getAttribute("src"),(A!=="none"||T)&&(p.once("loadedmetadata",()=>{p.speed=o,p.currentTime=C,E||kn(p.play())}),p.media.load())}mt.call(p,p.media,"qualitychange",!1,{quality:y})}}})},cancelRequests(){this.isHTML5&&(ps(Ys.getSources.call(this)),this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}};function fb(p){return`${p}-${Math.floor(1e4*Math.random())}`}function vp(p,...y){return J.empty(p)?p:p.toString().replace(/{(\d+)}/g,(_,C)=>y[C].toString())}function mb(p,y){return p===0||y===0||Number.isNaN(p)||Number.isNaN(y)?0:(p/y*100).toFixed(2)}const Mc=(p="",y="",_="")=>p.replace(new RegExp(y.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),_.toString()),$g=(p="")=>p.toString().replace(/\w\S*/g,y=>y.charAt(0).toUpperCase()+y.slice(1).toLowerCase());function gb(p=""){let y=p.toString();return y=Mc(y,"-"," "),y=Mc(y,"_"," "),y=$g(y),Mc(y," ","")}function _b(p=""){let y=p.toString();return y=gb(y),y.charAt(0).toLowerCase()+y.slice(1)}function yb(p){const y=document.createDocumentFragment(),_=document.createElement("div");return y.appendChild(_),_.innerHTML=p,y.firstChild.innerText}function vb(p){const y=document.createElement("div");return y.appendChild(p),y.innerHTML}const $m={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},Zi={get(p="",y={}){if(J.empty(p)||J.empty(y))return"";let _=Bg(y.i18n,p);if(J.empty(_))return Object.keys($m).includes(p)?$m[p]:"";const C={"{seektime}":y.seekTime,"{title}":y.title};return Object.entries(C).forEach(([E,A])=>{_=Mc(_,E,A)}),_}};class Rc{constructor(y){Qe(this,"get",_=>{if(!Rc.supported||!this.enabled)return null;const C=window.localStorage.getItem(this.key);if(J.empty(C))return null;const E=JSON.parse(C);return J.string(_)&&_.length?E[_]:E}),Qe(this,"set",_=>{if(!Rc.supported||!this.enabled||!J.object(_))return;let C=this.get();J.empty(C)&&(C={}),Ti(C,_);try{window.localStorage.setItem(this.key,JSON.stringify(C))}catch{}}),this.enabled=y.config.storage.enabled,this.key=y.config.storage.key}static get supported(){try{if(!("localStorage"in window))return!1;const y="___test";return window.localStorage.setItem(y,y),window.localStorage.removeItem(y),!0}catch{return!1}}}function qc(p,y="text"){return new Promise((_,C)=>{try{const E=new XMLHttpRequest;if(!("withCredentials"in E))return;E.addEventListener("load",()=>{if(y==="text")try{_(JSON.parse(E.responseText))}catch{_(E.responseText)}else _(E.response)}),E.addEventListener("error",()=>{throw new Error(E.status)}),E.open("GET",p,!0),E.responseType=y,E.send()}catch(E){C(E)}})}function qg(p,y){if(!J.string(p))return;const _="cache",C=J.string(y);let E=!1;const A=()=>document.getElementById(y)!==null,T=(o,he)=>{o.innerHTML=he,C&&A()||document.body.insertAdjacentElement("afterbegin",o)};if(!C||!A()){const o=Rc.supported,he=document.createElement("div");if(he.setAttribute("hidden",""),C&&he.setAttribute("id",y),o){const se=window.localStorage.getItem(`${_}-${y}`);if(E=se!==null,E){const fe=JSON.parse(se);T(he,fe.content)}}qc(p).then(se=>{if(!J.empty(se)){if(o)try{window.localStorage.setItem(`${_}-${y}`,JSON.stringify({content:se}))}catch{}T(he,se)}}).catch(()=>{})}}const Zg=p=>Math.trunc(p/60/60%60,10),bb=p=>Math.trunc(p/60%60,10),xb=p=>Math.trunc(p%60,10);function Gh(p=0,y=!1,_=!1){if(!J.number(p))return Gh(void 0,y,_);const C=o=>`0${o}`.slice(-2);let E=Zg(p);const A=bb(p),T=xb(p);return E=y||E>0?`${E}:`:"",`${_&&p>0?"-":""}${E}${C(A)}:${C(T)}`}const Xe={getIconUrl(){const p=new URL(this.config.iconUrl,window.location),y=window.location.host?window.location.host:window.top.location.host,_=p.host!==y||Hi.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:_}},findElements(){try{return this.elements.controls=Oi.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:Dc.call(this,this.config.selectors.buttons.play),pause:Oi.call(this,this.config.selectors.buttons.pause),restart:Oi.call(this,this.config.selectors.buttons.restart),rewind:Oi.call(this,this.config.selectors.buttons.rewind),fastForward:Oi.call(this,this.config.selectors.buttons.fastForward),mute:Oi.call(this,this.config.selectors.buttons.mute),pip:Oi.call(this,this.config.selectors.buttons.pip),airplay:Oi.call(this,this.config.selectors.buttons.airplay),settings:Oi.call(this,this.config.selectors.buttons.settings),captions:Oi.call(this,this.config.selectors.buttons.captions),fullscreen:Oi.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=Oi.call(this,this.config.selectors.progress),this.elements.inputs={seek:Oi.call(this,this.config.selectors.inputs.seek),volume:Oi.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:Oi.call(this,this.config.selectors.display.buffer),currentTime:Oi.call(this,this.config.selectors.display.currentTime),duration:Oi.call(this,this.config.selectors.display.duration)},J.element(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(`.${this.config.classNames.tooltip}`)),!0}catch(p){return this.debug.warn("It looks like there is a problem with your custom controls HTML",p),this.toggleNativeControls(!0),!1}},createIcon(p,y){const _="http://www.w3.org/2000/svg",C=Xe.getIconUrl.call(this),E=`${C.cors?"":C.url}#${this.config.iconPrefix}`,A=document.createElementNS(_,"svg");_p(A,Ti(y,{"aria-hidden":"true",focusable:"false"}));const T=document.createElementNS(_,"use"),o=`${E}-${p}`;return"href"in T&&T.setAttributeNS("http://www.w3.org/1999/xlink","href",o),T.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o),A.appendChild(T),A},createLabel(p,y={}){const _=Zi.get(p,this.config);return pt("span",{...y,class:[y.class,this.config.classNames.hidden].filter(Boolean).join(" ")},_)},createBadge(p){if(J.empty(p))return null;const y=pt("span",{class:this.config.classNames.menu.value});return y.appendChild(pt("span",{class:this.config.classNames.menu.badge},p)),y},createButton(p,y){const _=Ti({},y);let C=_b(p);const E={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach(T=>{Object.keys(_).includes(T)&&(E[T]=_[T],delete _[T])}),E.element!=="button"||Object.keys(_).includes("type")||(_.type="button"),Object.keys(_).includes("class")?_.class.split(" ").some(T=>T===this.config.classNames.control)||Ti(_,{class:`${_.class} ${this.config.classNames.control}`}):_.class=this.config.classNames.control,p){case"play":E.toggle=!0,E.label="play",E.labelPressed="pause",E.icon="play",E.iconPressed="pause";break;case"mute":E.toggle=!0,E.label="mute",E.labelPressed="unmute",E.icon="volume",E.iconPressed="muted";break;case"captions":E.toggle=!0,E.label="enableCaptions",E.labelPressed="disableCaptions",E.icon="captions-off",E.iconPressed="captions-on";break;case"fullscreen":E.toggle=!0,E.label="enterFullscreen",E.labelPressed="exitFullscreen",E.icon="enter-fullscreen",E.iconPressed="exit-fullscreen";break;case"play-large":_.class+=` ${this.config.classNames.control}--overlaid`,C="play",E.label="play",E.icon="play";break;default:J.empty(E.label)&&(E.label=C),J.empty(E.icon)&&(E.icon=p)}const A=pt(E.element);return E.toggle?(A.appendChild(Xe.createIcon.call(this,E.iconPressed,{class:"icon--pressed"})),A.appendChild(Xe.createIcon.call(this,E.icon,{class:"icon--not-pressed"})),A.appendChild(Xe.createLabel.call(this,E.labelPressed,{class:"label--pressed"})),A.appendChild(Xe.createLabel.call(this,E.label,{class:"label--not-pressed"}))):(A.appendChild(Xe.createIcon.call(this,E.icon)),A.appendChild(Xe.createLabel.call(this,E.label))),Ti(_,En(this.config.selectors.buttons[C],_)),_p(A,_),C==="play"?(J.array(this.elements.buttons[C])||(this.elements.buttons[C]=[]),this.elements.buttons[C].push(A)):this.elements.buttons[C]=A,A},createRange(p,y){const _=pt("input",Ti(En(this.config.selectors.inputs[p]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":Zi.get(p,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},y));return this.elements.inputs[p]=_,Xe.updateRangeFill.call(this,_),$0.setup(_),_},createProgress(p,y){const _=pt("progress",Ti(En(this.config.selectors.display[p]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":!0},y));if(p!=="volume"){_.appendChild(pt("span",null,"0"));const C={played:"played",buffer:"buffered"}[p],E=C?Zi.get(C,this.config):"";_.innerText=`% ${E.toLowerCase()}`}return this.elements.display[p]=_,_},createTime(p,y){const _=En(this.config.selectors.display[p],y),C=pt("div",Ti(_,{class:`${_.class?_.class:""} ${this.config.classNames.display.time} `.trim(),"aria-label":Zi.get(p,this.config),role:"timer"}),"00:00");return this.elements.display[p]=C,C},bindMenuItemShortcuts(p,y){At.call(this,p,"keydown keyup",_=>{if(![" ","ArrowUp","ArrowDown","ArrowRight"].includes(_.key)||(_.preventDefault(),_.stopPropagation(),_.type==="keydown"))return;const C=ja(p,'[role="menuitemradio"]');if(!C&&[" ","ArrowRight"].includes(_.key))Xe.showMenuPanel.call(this,y,!0);else{let E;_.key!==" "&&(_.key==="ArrowDown"||C&&_.key==="ArrowRight"?(E=p.nextElementSibling,J.element(E)||(E=p.parentNode.firstElementChild)):(E=p.previousElementSibling,J.element(E)||(E=p.parentNode.lastElementChild)),np.call(this,E,!0))}},!1),At.call(this,p,"keyup",_=>{_.key==="Return"&&Xe.focusFirstMenuItem.call(this,null,!0)})},createMenuItem({value:p,list:y,type:_,title:C,badge:E=null,checked:A=!1}){const T=En(this.config.selectors.inputs[_]),o=pt("button",Ti(T,{type:"button",role:"menuitemradio",class:`${this.config.classNames.control} ${T.class?T.class:""}`.trim(),"aria-checked":A,value:p})),he=pt("span");he.innerHTML=C,J.element(E)&&he.appendChild(E),o.appendChild(he),Object.defineProperty(o,"checked",{enumerable:!0,get:()=>o.getAttribute("aria-checked")==="true",set(se){se&&Array.from(o.parentNode.children).filter(fe=>ja(fe,'[role="menuitemradio"]')).forEach(fe=>fe.setAttribute("aria-checked","false")),o.setAttribute("aria-checked",se?"true":"false")}}),this.listeners.bind(o,"click keyup",se=>{if(!J.keyboardEvent(se)||se.key===" "){switch(se.preventDefault(),se.stopPropagation(),o.checked=!0,_){case"language":this.currentTrack=Number(p);break;case"quality":this.quality=p;break;case"speed":this.speed=parseFloat(p)}Xe.showMenuPanel.call(this,"home",J.keyboardEvent(se))}},_,!1),Xe.bindMenuItemShortcuts.call(this,o,_),y.appendChild(o)},formatTime(p=0,y=!1){return J.number(p)?Gh(p,Zg(this.duration)>0,y):p},updateTimeDisplay(p=null,y=0,_=!1){J.element(p)&&J.number(y)&&(p.innerText=Xe.formatTime(y,_))},updateVolume(){this.supported.ui&&(J.element(this.elements.inputs.volume)&&Xe.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),J.element(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||this.volume===0))},setRange(p,y=0){J.element(p)&&(p.value=y,Xe.updateRangeFill.call(this,p))},updateProgress(p){if(!this.supported.ui||!J.event(p))return;let y=0;const _=(C,E)=>{const A=J.number(E)?E:0,T=J.element(C)?C:this.elements.display.buffer;if(J.element(T)){T.value=A;const o=T.getElementsByTagName("span")[0];J.element(o)&&(o.childNodes[0].nodeValue=A)}};if(p)switch(p.type){case"timeupdate":case"seeking":case"seeked":y=mb(this.currentTime,this.duration),p.type==="timeupdate"&&Xe.setRange.call(this,this.elements.inputs.seek,y);break;case"playing":case"progress":_(this.elements.display.buffer,100*this.buffered)}},updateRangeFill(p){const y=J.event(p)?p.target:p;if(J.element(y)&&y.getAttribute("type")==="range"){if(ja(y,this.config.selectors.inputs.seek)){y.setAttribute("aria-valuenow",this.currentTime);const _=Xe.formatTime(this.currentTime),C=Xe.formatTime(this.duration),E=Zi.get("seekLabel",this.config);y.setAttribute("aria-valuetext",E.replace("{currentTime}",_).replace("{duration}",C))}else if(ja(y,this.config.selectors.inputs.volume)){const _=100*y.value;y.setAttribute("aria-valuenow",_),y.setAttribute("aria-valuetext",`${_.toFixed(1)}%`)}else y.setAttribute("aria-valuenow",y.value);(Hi.isWebKit||Hi.isIPadOS)&&y.style.setProperty("--value",y.value/y.max*100+"%")}},updateSeekTooltip(p){var y,_;if(!this.config.tooltips.seek||!J.element(this.elements.inputs.seek)||!J.element(this.elements.display.seekTooltip)||this.duration===0)return;const C=this.elements.display.seekTooltip,E=`${this.config.classNames.tooltip}--visible`,A=fe=>Nt(C,E,fe);if(this.touch)return void A(!1);let T=0;const o=this.elements.progress.getBoundingClientRect();if(J.event(p))T=100/o.width*(p.pageX-o.left);else{if(!zh(C,E))return;T=parseFloat(C.style.left,10)}T<0?T=0:T>100&&(T=100);const he=this.duration/100*T;C.innerText=Xe.formatTime(he);const se=(y=this.config.markers)===null||y===void 0||(_=y.points)===null||_===void 0?void 0:_.find(({time:fe})=>fe===Math.round(he));se&&C.insertAdjacentHTML("afterbegin",`${se.label}<br>`),C.style.left=`${T}%`,J.event(p)&&["mouseenter","mouseleave"].includes(p.type)&&A(p.type==="mouseenter")},timeUpdate(p){const y=!J.element(this.elements.display.duration)&&this.config.invertTime;Xe.updateTimeDisplay.call(this,this.elements.display.currentTime,y?this.duration-this.currentTime:this.currentTime,y),p&&p.type==="timeupdate"&&this.media.seeking||Xe.updateProgress.call(this,p)},durationUpdate(){if(!this.supported.ui||!this.config.invertTime&&this.currentTime)return;if(this.duration>=2**32)return Ba(this.elements.display.currentTime,!0),void Ba(this.elements.progress,!0);J.element(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);const p=J.element(this.elements.display.duration);!p&&this.config.displayDuration&&this.paused&&Xe.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),p&&Xe.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),this.config.markers.enabled&&Xe.setMarkers.call(this),Xe.updateSeekTooltip.call(this)},toggleMenuButton(p,y){Ba(this.elements.settings.buttons[p],!y)},updateSetting(p,y,_){const C=this.elements.settings.panels[p];let E=null,A=y;if(p==="captions")E=this.currentTrack;else{if(E=J.empty(_)?this[p]:_,J.empty(E)&&(E=this.config[p].default),!J.empty(this.options[p])&&!this.options[p].includes(E))return void this.debug.warn(`Unsupported value of '${E}' for ${p}`);if(!this.config[p].options.includes(E))return void this.debug.warn(`Disabled value of '${E}' for ${p}`)}if(J.element(A)||(A=C&&C.querySelector('[role="menu"]')),!J.element(A))return;this.elements.settings.buttons[p].querySelector(`.${this.config.classNames.menu.value}`).innerHTML=Xe.getLabel.call(this,p,E);const T=A&&A.querySelector(`[value="${E}"]`);J.element(T)&&(T.checked=!0)},getLabel(p,y){switch(p){case"speed":return y===1?Zi.get("normal",this.config):`${y}&times;`;case"quality":if(J.number(y)){const _=Zi.get(`qualityLabel.${y}`,this.config);return _.length?_:`${y}p`}return $g(y);case"captions":return Dt.getLabel.call(this);default:return null}},setQualityMenu(p){if(!J.element(this.elements.settings.panels.quality))return;const y="quality",_=this.elements.settings.panels.quality.querySelector('[role="menu"]');J.array(p)&&(this.options.quality=yp(p).filter(A=>this.config.quality.options.includes(A)));const C=!J.empty(this.options.quality)&&this.options.quality.length>1;if(Xe.toggleMenuButton.call(this,y,C),vh(_),Xe.checkMenu.call(this),!C)return;const E=A=>{const T=Zi.get(`qualityBadge.${A}`,this.config);return T.length?Xe.createBadge.call(this,T):null};this.options.quality.sort((A,T)=>{const o=this.config.quality.options;return o.indexOf(A)>o.indexOf(T)?1:-1}).forEach(A=>{Xe.createMenuItem.call(this,{value:A,list:_,type:y,title:Xe.getLabel.call(this,"quality",A),badge:E(A)})}),Xe.updateSetting.call(this,y,_)},setCaptionsMenu(){if(!J.element(this.elements.settings.panels.captions))return;const p="captions",y=this.elements.settings.panels.captions.querySelector('[role="menu"]'),_=Dt.getTracks.call(this),C=!!_.length;if(Xe.toggleMenuButton.call(this,p,C),vh(y),Xe.checkMenu.call(this),!C)return;const E=_.map((A,T)=>({value:T,checked:this.captions.toggled&&this.currentTrack===T,title:Dt.getLabel.call(this,A),badge:A.language&&Xe.createBadge.call(this,A.language.toUpperCase()),list:y,type:"language"}));E.unshift({value:-1,checked:!this.captions.toggled,title:Zi.get("disabled",this.config),list:y,type:"language"}),E.forEach(Xe.createMenuItem.bind(this)),Xe.updateSetting.call(this,p,y)},setSpeedMenu(){if(!J.element(this.elements.settings.panels.speed))return;const p="speed",y=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter(C=>C>=this.minimumSpeed&&C<=this.maximumSpeed);const _=!J.empty(this.options.speed)&&this.options.speed.length>1;Xe.toggleMenuButton.call(this,p,_),vh(y),Xe.checkMenu.call(this),_&&(this.options.speed.forEach(C=>{Xe.createMenuItem.call(this,{value:C,list:y,type:p,title:Xe.getLabel.call(this,"speed",C)})}),Xe.updateSetting.call(this,p,y))},checkMenu(){const{buttons:p}=this.elements.settings,y=!J.empty(p)&&Object.values(p).some(_=>!_.hidden);Ba(this.elements.settings.menu,!y)},focusFirstMenuItem(p,y=!1){if(this.elements.settings.popup.hidden)return;let _=p;J.element(_)||(_=Object.values(this.elements.settings.panels).find(E=>!E.hidden));const C=_.querySelector('[role^="menuitem"]');np.call(this,C,y)},toggleMenu(p){const{popup:y}=this.elements.settings,_=this.elements.buttons.settings;if(!J.element(y)||!J.element(_))return;const{hidden:C}=y;let E=C;if(J.boolean(p))E=p;else if(J.keyboardEvent(p)&&p.key==="Escape")E=!1;else if(J.event(p)){const A=J.function(p.composedPath)?p.composedPath()[0]:p.target,T=y.contains(A);if(T||!T&&p.target!==_&&E)return}_.setAttribute("aria-expanded",E),Ba(y,!E),Nt(this.elements.container,this.config.classNames.menu.open,E),E&&J.keyboardEvent(p)?Xe.focusFirstMenuItem.call(this,null,!0):E||C||np.call(this,_,J.keyboardEvent(p))},getMenuSize(p){const y=p.cloneNode(!0);y.style.position="absolute",y.style.opacity=0,y.removeAttribute("hidden"),p.parentNode.appendChild(y);const _=y.scrollWidth,C=y.scrollHeight;return ps(y),{width:_,height:C}},showMenuPanel(p="",y=!1){const _=this.elements.container.querySelector(`#plyr-settings-${this.id}-${p}`);if(!J.element(_))return;const C=_.parentNode,E=Array.from(C.children).find(A=>!A.hidden);if(Pi.transitions&&!Pi.reducedMotion){C.style.width=`${E.scrollWidth}px`,C.style.height=`${E.scrollHeight}px`;const A=Xe.getMenuSize.call(this,_),T=o=>{o.target===C&&["width","height"].includes(o.propertyName)&&(C.style.width="",C.style.height="",Zh.call(this,C,gp,T))};At.call(this,C,gp,T),C.style.width=`${A.width}px`,C.style.height=`${A.height}px`}Ba(E,!0),Ba(_,!1),Xe.focusFirstMenuItem.call(this,_,y)},setDownloadUrl(){const p=this.elements.buttons.download;J.element(p)&&p.setAttribute("href",this.download)},create(p){const{bindMenuItemShortcuts:y,createButton:_,createProgress:C,createRange:E,createTime:A,setQualityMenu:T,setSpeedMenu:o,showMenuPanel:he}=Xe;this.elements.controls=null,J.array(this.config.controls)&&this.config.controls.includes("play-large")&&this.elements.container.appendChild(_.call(this,"play-large"));const se=pt("div",En(this.config.selectors.controls.wrapper));this.elements.controls=se;const fe={class:"plyr__controls__item"};return yp(J.array(this.config.controls)?this.config.controls:[]).forEach(xe=>{if(xe==="restart"&&se.appendChild(_.call(this,"restart",fe)),xe==="rewind"&&se.appendChild(_.call(this,"rewind",fe)),xe==="play"&&se.appendChild(_.call(this,"play",fe)),xe==="fast-forward"&&se.appendChild(_.call(this,"fast-forward",fe)),xe==="progress"){const ie=pt("div",{class:`${fe.class} plyr__progress__container`}),K=pt("div",En(this.config.selectors.progress));if(K.appendChild(E.call(this,"seek",{id:`plyr-seek-${p.id}`})),K.appendChild(C.call(this,"buffer")),this.config.tooltips.seek){const ge=pt("span",{class:this.config.classNames.tooltip},"00:00");K.appendChild(ge),this.elements.display.seekTooltip=ge}this.elements.progress=K,ie.appendChild(this.elements.progress),se.appendChild(ie)}if(xe==="current-time"&&se.appendChild(A.call(this,"currentTime",fe)),xe==="duration"&&se.appendChild(A.call(this,"duration",fe)),xe==="mute"||xe==="volume"){let{volume:ie}=this.elements;if(J.element(ie)&&se.contains(ie)||(ie=pt("div",Ti({},fe,{class:`${fe.class} plyr__volume`.trim()})),this.elements.volume=ie,se.appendChild(ie)),xe==="mute"&&ie.appendChild(_.call(this,"mute")),xe==="volume"&&!Hi.isIos&&!Hi.isIPadOS){const K={max:1,step:.05,value:this.config.volume};ie.appendChild(E.call(this,"volume",Ti(K,{id:`plyr-volume-${p.id}`})))}}if(xe==="captions"&&se.appendChild(_.call(this,"captions",fe)),xe==="settings"&&!J.empty(this.config.settings)){const ie=pt("div",Ti({},fe,{class:`${fe.class} plyr__menu`.trim(),hidden:""}));ie.appendChild(_.call(this,"settings",{"aria-haspopup":!0,"aria-controls":`plyr-settings-${p.id}`,"aria-expanded":!1}));const K=pt("div",{class:"plyr__menu__container",id:`plyr-settings-${p.id}`,hidden:""}),ge=pt("div"),Oe=pt("div",{id:`plyr-settings-${p.id}-home`}),He=pt("div",{role:"menu"});Oe.appendChild(He),ge.appendChild(Oe),this.elements.settings.panels.home=Oe,this.config.settings.forEach(Ze=>{const Re=pt("button",Ti(En(this.config.selectors.buttons.settings),{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--forward`,role:"menuitem","aria-haspopup":!0,hidden:""}));y.call(this,Re,Ze),At.call(this,Re,"click",()=>{he.call(this,Ze,!1)});const rt=pt("span",null,Zi.get(Ze,this.config)),Je=pt("span",{class:this.config.classNames.menu.value});Je.innerHTML=p[Ze],rt.appendChild(Je),Re.appendChild(rt),He.appendChild(Re);const lt=pt("div",{id:`plyr-settings-${p.id}-${Ze}`,hidden:""}),ft=pt("button",{type:"button",class:`${this.config.classNames.control} ${this.config.classNames.control}--back`});ft.appendChild(pt("span",{"aria-hidden":!0},Zi.get(Ze,this.config))),ft.appendChild(pt("span",{class:this.config.classNames.hidden},Zi.get("menuBack",this.config))),At.call(this,lt,"keydown",et=>{et.key==="ArrowLeft"&&(et.preventDefault(),et.stopPropagation(),he.call(this,"home",!0))},!1),At.call(this,ft,"click",()=>{he.call(this,"home",!1)}),lt.appendChild(ft),lt.appendChild(pt("div",{role:"menu"})),ge.appendChild(lt),this.elements.settings.buttons[Ze]=Re,this.elements.settings.panels[Ze]=lt}),K.appendChild(ge),ie.appendChild(K),se.appendChild(ie),this.elements.settings.popup=K,this.elements.settings.menu=ie}if(xe==="pip"&&Pi.pip&&se.appendChild(_.call(this,"pip",fe)),xe==="airplay"&&Pi.airplay&&se.appendChild(_.call(this,"airplay",fe)),xe==="download"){const ie=Ti({},fe,{element:"a",href:this.download,target:"_blank"});this.isHTML5&&(ie.download="");const{download:K}=this.config.urls;!J.url(K)&&this.isEmbed&&Ti(ie,{icon:`logo-${this.provider}`,label:this.provider}),se.appendChild(_.call(this,"download",ie))}xe==="fullscreen"&&se.appendChild(_.call(this,"fullscreen",fe))}),this.isHTML5&&T.call(this,Ys.getQualityOptions.call(this)),o.call(this),se},inject(){if(this.config.loadSprite){const E=Xe.getIconUrl.call(this);E.cors&&qg(E.url,"sprite-plyr")}this.id=Math.floor(1e4*Math.random());let p=null;this.elements.controls=null;const y={id:this.id,seektime:this.config.seekTime,title:this.config.title};let _=!0;J.function(this.config.controls)&&(this.config.controls=this.config.controls.call(this,y)),this.config.controls||(this.config.controls=[]),J.element(this.config.controls)||J.string(this.config.controls)?p=this.config.controls:(p=Xe.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:Dt.getLabel.call(this)}),_=!1);let C;if(_&&J.string(this.config.controls)&&(p=(E=>{let A=E;return Object.entries(y).forEach(([T,o])=>{A=Mc(A,`{${T}}`,o)}),A})(p)),J.string(this.config.selectors.controls.container)&&(C=document.querySelector(this.config.selectors.controls.container)),J.element(C)||(C=this.elements.container),C[J.element(p)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",p),J.element(this.elements.controls)||Xe.findElements.call(this),!J.empty(this.elements.buttons)){const E=A=>{const T=this.config.classNames.controlPressed;A.setAttribute("aria-pressed","false"),Object.defineProperty(A,"pressed",{configurable:!0,enumerable:!0,get:()=>zh(A,T),set(o=!1){Nt(A,T,o),A.setAttribute("aria-pressed",o?"true":"false")}})};Object.values(this.elements.buttons).filter(Boolean).forEach(A=>{J.array(A)||J.nodeList(A)?Array.from(A).filter(Boolean).forEach(E):E(A)})}if(Hi.isEdge&&Fg(C),this.config.tooltips.controls){const{classNames:E,selectors:A}=this.config,T=`${A.controls.wrapper} ${A.labels} .${E.hidden}`,o=Dc.call(this,T);Array.from(o).forEach(he=>{Nt(he,this.config.classNames.hidden,!1),Nt(he,this.config.classNames.tooltip,!0)})}},setMediaMetadata(){try{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new window.MediaMetadata({title:this.config.mediaMetadata.title,artist:this.config.mediaMetadata.artist,album:this.config.mediaMetadata.album,artwork:this.config.mediaMetadata.artwork}))}catch{}},setMarkers(){var p,y;if(!this.duration||this.elements.markers)return;const _=(p=this.config.markers)===null||p===void 0||(y=p.points)===null||y===void 0?void 0:y.filter(({time:he})=>he>0&&he<this.duration);if(_==null||!_.length)return;const C=document.createDocumentFragment(),E=document.createDocumentFragment();let A=null;const T=`${this.config.classNames.tooltip}--visible`,o=he=>Nt(A,T,he);_.forEach(he=>{const se=pt("span",{class:this.config.classNames.marker},""),fe=he.time/this.duration*100+"%";A&&(se.addEventListener("mouseenter",()=>{he.label||(A.style.left=fe,A.innerHTML=he.label,o(!0))}),se.addEventListener("mouseleave",()=>{o(!1)})),se.addEventListener("click",()=>{this.currentTime=he.time}),se.style.left=fe,E.appendChild(se)}),C.appendChild(E),this.config.tooltips.seek||(A=pt("span",{class:this.config.classNames.tooltip},""),C.appendChild(A)),this.elements.markers={points:E,tip:A},this.elements.progress.appendChild(C)}};function Gg(p,y=!0){let _=p;if(y){const C=document.createElement("a");C.href=_,_=C.href}try{return new URL(_)}catch{return null}}function Hg(p){const y=new URLSearchParams;return J.object(p)&&Object.entries(p).forEach(([_,C])=>{y.set(_,C)}),y}const Dt={setup(){if(!this.supported.ui)return;if(!this.isVideo||this.isYouTube||this.isHTML5&&!Pi.textTracks)return void(J.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&Xe.setCaptionsMenu.call(this));if(J.element(this.elements.captions)||(this.elements.captions=pt("div",En(this.config.selectors.captions)),this.elements.captions.setAttribute("dir","auto"),lb(this.elements.captions,this.elements.wrapper)),Hi.isIE&&window.URL){const C=this.media.querySelectorAll("track");Array.from(C).forEach(E=>{const A=E.getAttribute("src"),T=Gg(A);T!==null&&T.hostname!==window.location.href.hostname&&["http:","https:"].includes(T.protocol)&&qc(A,"blob").then(o=>{E.setAttribute("src",window.URL.createObjectURL(o))}).catch(()=>{ps(E)})})}const p=yp((navigator.languages||[navigator.language||navigator.userLanguage||"en"]).map(C=>C.split("-")[0]));let y=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();y==="auto"&&([y]=p);let _=this.storage.get("captions");if(J.boolean(_)||({active:_}=this.config.captions),Object.assign(this.captions,{toggled:!1,active:_,language:y,languages:p}),this.isHTML5){const C=this.config.captions.update?"addtrack removetrack":"removetrack";At.call(this,this.media.textTracks,C,Dt.update.bind(this))}setTimeout(Dt.update.bind(this),0)},update(){const p=Dt.getTracks.call(this,!0),{active:y,language:_,meta:C,currentTrackNode:E}=this.captions,A=!!p.find(T=>T.language===_);this.isHTML5&&this.isVideo&&p.filter(T=>!C.get(T)).forEach(T=>{this.debug.log("Track added",T),C.set(T,{default:T.mode==="showing"}),T.mode==="showing"&&(T.mode="hidden"),At.call(this,T,"cuechange",()=>Dt.updateCues.call(this))}),(A&&this.language!==_||!p.includes(E))&&(Dt.setLanguage.call(this,_),Dt.toggle.call(this,y&&A)),this.elements&&Nt(this.elements.container,this.config.classNames.captions.enabled,!J.empty(p)),J.array(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&Xe.setCaptionsMenu.call(this)},toggle(p,y=!0){if(!this.supported.ui)return;const{toggled:_}=this.captions,C=this.config.classNames.captions.active,E=J.nullOrUndefined(p)?!_:p;if(E!==_){if(y||(this.captions.active=E,this.storage.set({captions:E})),!this.language&&E&&!y){const A=Dt.getTracks.call(this),T=Dt.findTrack.call(this,[this.captions.language,...this.captions.languages],!0);return this.captions.language=T.language,void Dt.set.call(this,A.indexOf(T))}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=E),Nt(this.elements.container,C,E),this.captions.toggled=E,Xe.updateSetting.call(this,"captions"),mt.call(this,this.media,E?"captionsenabled":"captionsdisabled")}setTimeout(()=>{E&&this.captions.toggled&&(this.captions.currentTrackNode.mode="hidden")})},set(p,y=!0){const _=Dt.getTracks.call(this);if(p!==-1)if(J.number(p))if(p in _){if(this.captions.currentTrack!==p){this.captions.currentTrack=p;const C=_[p],{language:E}=C||{};this.captions.currentTrackNode=C,Xe.updateSetting.call(this,"captions"),y||(this.captions.language=E,this.storage.set({language:E})),this.isVimeo&&this.embed.enableTextTrack(E),mt.call(this,this.media,"languagechange")}Dt.toggle.call(this,!0,y),this.isHTML5&&this.isVideo&&Dt.updateCues.call(this)}else this.debug.warn("Track not found",p);else this.debug.warn("Invalid caption argument",p);else Dt.toggle.call(this,!1,y)},setLanguage(p,y=!0){if(!J.string(p))return void this.debug.warn("Invalid language argument",p);const _=p.toLowerCase();this.captions.language=_;const C=Dt.getTracks.call(this),E=Dt.findTrack.call(this,[_]);Dt.set.call(this,C.indexOf(E),y)},getTracks(p=!1){return Array.from((this.media||{}).textTracks||[]).filter(y=>!this.isHTML5||p||this.captions.meta.has(y)).filter(y=>["captions","subtitles"].includes(y.kind))},findTrack(p,y=!1){const _=Dt.getTracks.call(this),C=T=>Number((this.captions.meta.get(T)||{}).default),E=Array.from(_).sort((T,o)=>C(o)-C(T));let A;return p.every(T=>(A=E.find(o=>o.language===T),!A)),A||(y?E[0]:void 0)},getCurrentTrack(){return Dt.getTracks.call(this)[this.currentTrack]},getLabel(p){let y=p;return!J.track(y)&&Pi.textTracks&&this.captions.toggled&&(y=Dt.getCurrentTrack.call(this)),J.track(y)?J.empty(y.label)?J.empty(y.language)?Zi.get("enabled",this.config):p.language.toUpperCase():y.label:Zi.get("disabled",this.config)},updateCues(p){if(!this.supported.ui)return;if(!J.element(this.elements.captions))return void this.debug.warn("No captions element to render to");if(!J.nullOrUndefined(p)&&!Array.isArray(p))return void this.debug.warn("updateCues: Invalid input",p);let y=p;if(!y){const C=Dt.getCurrentTrack.call(this);y=Array.from((C||{}).activeCues||[]).map(E=>E.getCueAsHTML()).map(vb)}const _=y.map(C=>C.trim()).join(`
`);if(_!==this.elements.captions.innerHTML){vh(this.elements.captions);const C=pt("span",En(this.config.selectors.caption));C.innerHTML=_,this.elements.captions.appendChild(C),mt.call(this,this.media,"cuechange")}}},Wg={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.7.8/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:!1,onChange:null},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/oembed.json?url={0}"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",marker:"plyr__progress__marker",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id",hash:"data-plyr-embed-hash"}},ads:{enabled:!1,publisherId:"",tagUrl:""},previewThumbnails:{enabled:!1,src:""},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,customControls:!0,referrerPolicy:null,premium:!1},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:!0,noCookie:!1},mediaMetadata:{title:"",artist:"",album:"",artwork:[]},markers:{enabled:!1,points:[]}},sp={active:"picture-in-picture",inactive:"inline"},Xs={html5:"html5",youtube:"youtube",vimeo:"vimeo"},ap={audio:"audio",video:"video"};function wb(p){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(p)?Xs.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(p)?Xs.vimeo:null}const op=()=>{};class Tb{constructor(y=!1){this.enabled=window.console&&y,this.enabled&&this.log("Debugging enabled")}get log(){return this.enabled?Function.prototype.bind.call(console.log,console):op}get warn(){return this.enabled?Function.prototype.bind.call(console.warn,console):op}get error(){return this.enabled?Function.prototype.bind.call(console.error,console):op}}class dn{constructor(y){Qe(this,"onChange",()=>{if(!this.supported)return;const _=this.player.elements.buttons.fullscreen;J.element(_)&&(_.pressed=this.active);const C=this.target===this.player.media?this.target:this.player.elements.container;mt.call(this.player,C,this.active?"enterfullscreen":"exitfullscreen",!0)}),Qe(this,"toggleFallback",(_=!1)=>{if(_?this.scrollPosition={x:window.scrollX??0,y:window.scrollY??0}:window.scrollTo(this.scrollPosition.x,this.scrollPosition.y),document.body.style.overflow=_?"hidden":"",Nt(this.target,this.player.config.classNames.fullscreen.fallback,_),Hi.isIos){let C=document.head.querySelector('meta[name="viewport"]');const E="viewport-fit=cover";C||(C=document.createElement("meta"),C.setAttribute("name","viewport"));const A=J.string(C.content)&&C.content.includes(E);_?(this.cleanupViewport=!A,A||(C.content+=`,${E}`)):this.cleanupViewport&&(C.content=C.content.split(",").filter(T=>T.trim()!==E).join(","))}this.onChange()}),Qe(this,"trapFocus",_=>{if(Hi.isIos||Hi.isIPadOS||!this.active||_.key!=="Tab")return;const C=document.activeElement,E=Dc.call(this.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]"),[A]=E,T=E[E.length-1];C!==T||_.shiftKey?C===A&&_.shiftKey&&(T.focus(),_.preventDefault()):(A.focus(),_.preventDefault())}),Qe(this,"update",()=>{if(this.supported){let _;_=this.forceFallback?"Fallback (forced)":dn.nativeSupported?"Native":"Fallback",this.player.debug.log(`${_} fullscreen enabled`)}else this.player.debug.log("Fullscreen not supported and fallback disabled");Nt(this.player.elements.container,this.player.config.classNames.fullscreen.enabled,this.supported)}),Qe(this,"enter",()=>{this.supported&&(Hi.isIos&&this.player.config.fullscreen.iosNative?this.player.isVimeo?this.player.embed.requestFullscreen():this.target.webkitEnterFullscreen():!dn.nativeSupported||this.forceFallback?this.toggleFallback(!0):this.prefix?J.empty(this.prefix)||this.target[`${this.prefix}Request${this.property}`]():this.target.requestFullscreen({navigationUI:"hide"}))}),Qe(this,"exit",()=>{if(this.supported)if(Hi.isIos&&this.player.config.fullscreen.iosNative)this.player.isVimeo?this.player.embed.exitFullscreen():this.target.webkitEnterFullscreen(),kn(this.player.play());else if(!dn.nativeSupported||this.forceFallback)this.toggleFallback(!1);else if(this.prefix){if(!J.empty(this.prefix)){const _=this.prefix==="moz"?"Cancel":"Exit";document[`${this.prefix}${_}${this.property}`]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document)}),Qe(this,"toggle",()=>{this.active?this.exit():this.enter()}),this.player=y,this.prefix=dn.prefix,this.property=dn.property,this.scrollPosition={x:0,y:0},this.forceFallback=y.config.fullscreen.fallback==="force",this.player.elements.fullscreen=y.config.fullscreen.container&&cb(this.player.elements.container,y.config.fullscreen.container),At.call(this.player,document,this.prefix==="ms"?"MSFullscreenChange":`${this.prefix}fullscreenchange`,()=>{this.onChange()}),At.call(this.player,this.player.elements.container,"dblclick",_=>{J.element(this.player.elements.controls)&&this.player.elements.controls.contains(_.target)||this.player.listeners.proxy(_,this.toggle,"fullscreen")}),At.call(this,this.player.elements.container,"keydown",_=>this.trapFocus(_)),this.update()}static get nativeSupported(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}get useNative(){return dn.nativeSupported&&!this.forceFallback}static get prefix(){if(J.function(document.exitFullscreen))return"";let y="";return["webkit","moz","ms"].some(_=>!(!J.function(document[`${_}ExitFullscreen`])&&!J.function(document[`${_}CancelFullScreen`]))&&(y=_,!0)),y}static get property(){return this.prefix==="moz"?"FullScreen":"Fullscreen"}get supported(){return[this.player.config.fullscreen.enabled,this.player.isVideo,dn.nativeSupported||this.player.config.fullscreen.fallback,!this.player.isYouTube||dn.nativeSupported||!Hi.isIos||this.player.config.playsinline&&!this.player.config.fullscreen.iosNative].every(Boolean)}get active(){if(!this.supported)return!1;if(!dn.nativeSupported||this.forceFallback)return zh(this.target,this.player.config.classNames.fullscreen.fallback);const y=this.prefix?this.target.getRootNode()[`${this.prefix}${this.property}Element`]:this.target.getRootNode().fullscreenElement;return y&&y.shadowRoot?y===this.target.getRootNode().host:y===this.target}get target(){return Hi.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen??this.player.elements.container}}function bh(p,y=1){return new Promise((_,C)=>{const E=new Image,A=()=>{delete E.onload,delete E.onerror,(E.naturalWidth>=y?_:C)(E)};Object.assign(E,{onload:A,onerror:A,src:p})})}const Zt={addStyleHook(){Nt(this.elements.container,this.config.selectors.container.replace(".",""),!0),Nt(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls(p=!1){p&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build(){if(this.listeners.media(),!this.supported.ui)return this.debug.warn(`Basic support only for ${this.provider} ${this.type}`),void Zt.toggleNativeControls.call(this,!0);J.element(this.elements.controls)||(Xe.inject.call(this),this.listeners.controls()),Zt.toggleNativeControls.call(this),this.isHTML5&&Dt.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,Xe.updateVolume.call(this),Xe.timeUpdate.call(this),Xe.durationUpdate.call(this),Zt.checkPlaying.call(this),Nt(this.elements.container,this.config.classNames.pip.supported,Pi.pip&&this.isHTML5&&this.isVideo),Nt(this.elements.container,this.config.classNames.airplay.supported,Pi.airplay&&this.isHTML5),Nt(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout(()=>{mt.call(this,this.media,"ready")},0),Zt.setTitle.call(this),this.poster&&Zt.setPoster.call(this,this.poster,!1).catch(()=>{}),this.config.duration&&Xe.durationUpdate.call(this),this.config.mediaMetadata&&Xe.setMediaMetadata.call(this)},setTitle(){let p=Zi.get("play",this.config);if(J.string(this.config.title)&&!J.empty(this.config.title)&&(p+=`, ${this.config.title}`),Array.from(this.elements.buttons.play||[]).forEach(y=>{y.setAttribute("aria-label",p)}),this.isEmbed){const y=Oi.call(this,"iframe");if(!J.element(y))return;const _=J.empty(this.config.title)?"video":this.config.title,C=Zi.get("frameTitle",this.config);y.setAttribute("title",C.replace("{title}",_))}},togglePoster(p){Nt(this.elements.container,this.config.classNames.posterEnabled,p)},setPoster(p,y=!0){return y&&this.poster?Promise.reject(new Error("Poster already set")):(this.media.setAttribute("data-poster",p),this.elements.poster.removeAttribute("hidden"),db.call(this).then(()=>bh(p)).catch(_=>{throw p===this.poster&&Zt.togglePoster.call(this,!1),_}).then(()=>{if(p!==this.poster)throw new Error("setPoster cancelled by later call to setPoster")}).then(()=>(Object.assign(this.elements.poster.style,{backgroundImage:`url('${p}')`,backgroundSize:""}),Zt.togglePoster.call(this,!0),p)))},checkPlaying(p){Nt(this.elements.container,this.config.classNames.playing,this.playing),Nt(this.elements.container,this.config.classNames.paused,this.paused),Nt(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach(y=>{Object.assign(y,{pressed:this.playing}),y.setAttribute("aria-label",Zi.get(this.playing?"pause":"play",this.config))}),J.event(p)&&p.type==="timeupdate"||Zt.toggleControls.call(this)},checkLoading(p){this.loading=["stalled","waiting"].includes(p.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout(()=>{Nt(this.elements.container,this.config.classNames.loading,this.loading),Zt.toggleControls.call(this)},this.loading?250:0)},toggleControls(p){const{controls:y}=this.elements;if(y&&this.config.hideControls){const _=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(!!(p||this.loading||this.paused||y.pressed||y.hover||_))}},migrateStyles(){Object.values({...this.media.style}).filter(p=>!J.empty(p)&&J.string(p)&&p.startsWith("--plyr")).forEach(p=>{this.elements.container.style.setProperty(p,this.media.style.getPropertyValue(p)),this.media.style.removeProperty(p)}),J.empty(this.media.style)&&this.media.removeAttribute("style")}};class Pb{constructor(y){Qe(this,"firstTouch",()=>{const{player:_}=this,{elements:C}=_;_.touch=!0,Nt(C.container,_.config.classNames.isTouch,!0)}),Qe(this,"global",(_=!0)=>{const{player:C}=this;C.config.keyboard.global&&Lc.call(C,window,"keydown keyup",this.handleKey,_,!1),Lc.call(C,document.body,"click",this.toggleMenu,_),Op.call(C,document.body,"touchstart",this.firstTouch)}),Qe(this,"container",()=>{const{player:_}=this,{config:C,elements:E,timers:A}=_;!C.keyboard.global&&C.keyboard.focused&&At.call(_,E.container,"keydown keyup",this.handleKey,!1),At.call(_,E.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",he=>{const{controls:se}=E;se&&he.type==="enterfullscreen"&&(se.pressed=!1,se.hover=!1);let fe=0;["touchstart","touchmove","mousemove"].includes(he.type)&&(Zt.toggleControls.call(_,!0),fe=_.touch?3e3:2e3),clearTimeout(A.controls),A.controls=setTimeout(()=>Zt.toggleControls.call(_,!1),fe)});const T=()=>{if(!_.isVimeo||_.config.vimeo.premium)return;const he=E.wrapper,{active:se}=_.fullscreen,[fe,xe]=jp.call(_),ie=Ng(`aspect-ratio: ${fe} / ${xe}`);if(!se)return void(ie?(he.style.width=null,he.style.height=null):(he.style.maxWidth=null,he.style.margin=null));const[K,ge]=pb(),Oe=K/ge>fe/xe;ie?(he.style.width=Oe?"auto":"100%",he.style.height=Oe?"100%":"auto"):(he.style.maxWidth=Oe?ge/xe*fe+"px":null,he.style.margin=Oe?"0 auto":null)},o=()=>{clearTimeout(A.resized),A.resized=setTimeout(T,50)};At.call(_,E.container,"enterfullscreen exitfullscreen",he=>{const{target:se}=_.fullscreen;se===E.container&&(!_.isEmbed&&J.empty(_.config.ratio)||(T(),(he.type==="enterfullscreen"?At:Zh).call(_,window,"resize",o)))})}),Qe(this,"media",()=>{const{player:_}=this,{elements:C}=_;if(At.call(_,_.media,"timeupdate seeking seeked",A=>Xe.timeUpdate.call(_,A)),At.call(_,_.media,"durationchange loadeddata loadedmetadata",A=>Xe.durationUpdate.call(_,A)),At.call(_,_.media,"ended",()=>{_.isHTML5&&_.isVideo&&_.config.resetOnEnd&&(_.restart(),_.pause())}),At.call(_,_.media,"progress playing seeking seeked",A=>Xe.updateProgress.call(_,A)),At.call(_,_.media,"volumechange",A=>Xe.updateVolume.call(_,A)),At.call(_,_.media,"playing play pause ended emptied timeupdate",A=>Zt.checkPlaying.call(_,A)),At.call(_,_.media,"waiting canplay seeked playing",A=>Zt.checkLoading.call(_,A)),_.supported.ui&&_.config.clickToPlay&&!_.isAudio){const A=Oi.call(_,`.${_.config.classNames.video}`);if(!J.element(A))return;At.call(_,C.container,"click",T=>{([C.container,A].includes(T.target)||A.contains(T.target))&&(_.touch&&_.config.hideControls||(_.ended?(this.proxy(T,_.restart,"restart"),this.proxy(T,()=>{kn(_.play())},"play")):this.proxy(T,()=>{kn(_.togglePlay())},"play")))})}_.supported.ui&&_.config.disableContextMenu&&At.call(_,C.wrapper,"contextmenu",A=>{A.preventDefault()},!1),At.call(_,_.media,"volumechange",()=>{_.storage.set({volume:_.volume,muted:_.muted})}),At.call(_,_.media,"ratechange",()=>{Xe.updateSetting.call(_,"speed"),_.storage.set({speed:_.speed})}),At.call(_,_.media,"qualitychange",A=>{Xe.updateSetting.call(_,"quality",null,A.detail.quality)}),At.call(_,_.media,"ready qualitychange",()=>{Xe.setDownloadUrl.call(_)});const E=_.config.events.concat(["keyup","keydown"]).join(" ");At.call(_,_.media,E,A=>{let{detail:T={}}=A;A.type==="error"&&(T=_.media.error),mt.call(_,C.container,A.type,!0,T)})}),Qe(this,"proxy",(_,C,E)=>{const{player:A}=this,T=A.config.listeners[E];let o=!0;J.function(T)&&(o=T.call(A,_)),o!==!1&&J.function(C)&&C.call(A,_)}),Qe(this,"bind",(_,C,E,A,T=!0)=>{const{player:o}=this,he=o.config.listeners[A],se=J.function(he);At.call(o,_,C,fe=>this.proxy(fe,E,A),T&&!se)}),Qe(this,"controls",()=>{const{player:_}=this,{elements:C}=_,E=Hi.isIE?"change":"input";if(C.buttons.play&&Array.from(C.buttons.play).forEach(A=>{this.bind(A,"click",()=>{kn(_.togglePlay())},"play")}),this.bind(C.buttons.restart,"click",_.restart,"restart"),this.bind(C.buttons.rewind,"click",()=>{_.lastSeekTime=Date.now(),_.rewind()},"rewind"),this.bind(C.buttons.fastForward,"click",()=>{_.lastSeekTime=Date.now(),_.forward()},"fastForward"),this.bind(C.buttons.mute,"click",()=>{_.muted=!_.muted},"mute"),this.bind(C.buttons.captions,"click",()=>_.toggleCaptions()),this.bind(C.buttons.download,"click",()=>{mt.call(_,_.media,"download")},"download"),this.bind(C.buttons.fullscreen,"click",()=>{_.fullscreen.toggle()},"fullscreen"),this.bind(C.buttons.pip,"click",()=>{_.pip="toggle"},"pip"),this.bind(C.buttons.airplay,"click",_.airplay,"airplay"),this.bind(C.buttons.settings,"click",A=>{A.stopPropagation(),A.preventDefault(),Xe.toggleMenu.call(_,A)},null,!1),this.bind(C.buttons.settings,"keyup",A=>{[" ","Enter"].includes(A.key)&&(A.key!=="Enter"?(A.preventDefault(),A.stopPropagation(),Xe.toggleMenu.call(_,A)):Xe.focusFirstMenuItem.call(_,null,!0))},null,!1),this.bind(C.settings.menu,"keydown",A=>{A.key==="Escape"&&Xe.toggleMenu.call(_,A)}),this.bind(C.inputs.seek,"mousedown mousemove",A=>{const T=C.progress.getBoundingClientRect(),o=100/T.width*(A.pageX-T.left);A.currentTarget.setAttribute("seek-value",o)}),this.bind(C.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",A=>{const T=A.currentTarget,o="play-on-seeked";if(J.keyboardEvent(A)&&!["ArrowLeft","ArrowRight"].includes(A.key))return;_.lastSeekTime=Date.now();const he=T.hasAttribute(o),se=["mouseup","touchend","keyup"].includes(A.type);he&&se?(T.removeAttribute(o),kn(_.play())):!se&&_.playing&&(T.setAttribute(o,""),_.pause())}),Hi.isIos){const A=Dc.call(_,'input[type="range"]');Array.from(A).forEach(T=>this.bind(T,E,o=>Fg(o.target)))}this.bind(C.inputs.seek,E,A=>{const T=A.currentTarget;let o=T.getAttribute("seek-value");J.empty(o)&&(o=T.value),T.removeAttribute("seek-value"),_.currentTime=o/T.max*_.duration},"seek"),this.bind(C.progress,"mouseenter mouseleave mousemove",A=>Xe.updateSeekTooltip.call(_,A)),this.bind(C.progress,"mousemove touchmove",A=>{const{previewThumbnails:T}=_;T&&T.loaded&&T.startMove(A)}),this.bind(C.progress,"mouseleave touchend click",()=>{const{previewThumbnails:A}=_;A&&A.loaded&&A.endMove(!1,!0)}),this.bind(C.progress,"mousedown touchstart",A=>{const{previewThumbnails:T}=_;T&&T.loaded&&T.startScrubbing(A)}),this.bind(C.progress,"mouseup touchend",A=>{const{previewThumbnails:T}=_;T&&T.loaded&&T.endScrubbing(A)}),Hi.isWebKit&&Array.from(Dc.call(_,'input[type="range"]')).forEach(A=>{this.bind(A,"input",T=>Xe.updateRangeFill.call(_,T.target))}),_.config.toggleInvert&&!J.element(C.display.duration)&&this.bind(C.display.currentTime,"click",()=>{_.currentTime!==0&&(_.config.invertTime=!_.config.invertTime,Xe.timeUpdate.call(_))}),this.bind(C.inputs.volume,E,A=>{_.volume=A.target.value},"volume"),this.bind(C.controls,"mouseenter mouseleave",A=>{C.controls.hover=!_.touch&&A.type==="mouseenter"}),C.fullscreen&&Array.from(C.fullscreen.children).filter(A=>!A.contains(C.container)).forEach(A=>{this.bind(A,"mouseenter mouseleave",T=>{C.controls&&(C.controls.hover=!_.touch&&T.type==="mouseenter")})}),this.bind(C.controls,"mousedown mouseup touchstart touchend touchcancel",A=>{C.controls.pressed=["mousedown","touchstart"].includes(A.type)}),this.bind(C.controls,"focusin",()=>{const{config:A,timers:T}=_;Nt(C.controls,A.classNames.noTransition,!0),Zt.toggleControls.call(_,!0),setTimeout(()=>{Nt(C.controls,A.classNames.noTransition,!1)},0);const o=this.touch?3e3:4e3;clearTimeout(T.controls),T.controls=setTimeout(()=>Zt.toggleControls.call(_,!1),o)}),this.bind(C.inputs.volume,"wheel",A=>{const T=A.webkitDirectionInvertedFromDevice,[o,he]=[A.deltaX,-A.deltaY].map(xe=>T?-xe:xe),se=Math.sign(Math.abs(o)>Math.abs(he)?o:he);_.increaseVolume(se/50);const{volume:fe}=_.media;(se===1&&fe<1||se===-1&&fe>0)&&A.preventDefault()},"volume",!1)}),this.player=y,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.firstTouch=this.firstTouch.bind(this)}handleKey(y){const{player:_}=this,{elements:C}=_,{key:E,type:A,altKey:T,ctrlKey:o,metaKey:he,shiftKey:se}=y,fe=A==="keydown",xe=fe&&E===this.lastKey;if(!(T||o||he||se)&&E){if(fe){const K=document.activeElement;if(J.element(K)){const{editable:ge}=_.config.selectors,{seek:Oe}=C.inputs;if(K!==Oe&&ja(K,ge)||y.key===" "&&ja(K,'button, [role^="menuitem"]'))return}switch([" ","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","0","1","2","3","4","5","6","7","8","9","c","f","k","l","m"].includes(E)&&(y.preventDefault(),y.stopPropagation()),E){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":xe||(ie=parseInt(E,10),_.currentTime=_.duration/10*ie);break;case" ":case"k":xe||kn(_.togglePlay());break;case"ArrowUp":_.increaseVolume(.1);break;case"ArrowDown":_.decreaseVolume(.1);break;case"m":xe||(_.muted=!_.muted);break;case"ArrowRight":_.forward();break;case"ArrowLeft":_.rewind();break;case"f":_.fullscreen.toggle();break;case"c":xe||_.toggleCaptions();break;case"l":_.loop=!_.loop}E==="Escape"&&!_.fullscreen.usingNative&&_.fullscreen.active&&_.fullscreen.toggle(),this.lastKey=E}else this.lastKey=null;var ie}}toggleMenu(y){Xe.toggleMenu.call(this.player,y)}}function Sb(p,y){return p(y={exports:{}},y.exports),y.exports}var Cb=Sb(function(p,y){p.exports=function(){var _=function(){},C={},E={},A={};function T(ie,K){ie=ie.push?ie:[ie];var ge,Oe,He,Ze=[],Re=ie.length,rt=Re;for(ge=function(Je,lt){lt.length&&Ze.push(Je),--rt||K(Ze)};Re--;)Oe=ie[Re],(He=E[Oe])?ge(Oe,He):(A[Oe]=A[Oe]||[]).push(ge)}function o(ie,K){if(ie){var ge=A[ie];if(E[ie]=K,ge)for(;ge.length;)ge[0](ie,K),ge.splice(0,1)}}function he(ie,K){ie.call&&(ie={success:ie}),K.length?(ie.error||_)(K):(ie.success||_)(ie)}function se(ie,K,ge,Oe){var He,Ze,Re=document,rt=ge.async,Je=(ge.numRetries||0)+1,lt=ge.before||_,ft=ie.replace(/[\?|#].*$/,""),et=ie.replace(/^(css|img)!/,"");Oe=Oe||0,/(^css!|\.css$)/.test(ft)?((Ze=Re.createElement("link")).rel="stylesheet",Ze.href=et,(He="hideFocus"in Ze)&&Ze.relList&&(He=0,Ze.rel="preload",Ze.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(ft)?(Ze=Re.createElement("img")).src=et:((Ze=Re.createElement("script")).src=ie,Ze.async=rt===void 0||rt),Ze.onload=Ze.onerror=Ze.onbeforeload=function(ct){var kt=ct.type[0];if(He)try{Ze.sheet.cssText.length||(kt="e")}catch(Qi){Qi.code!=18&&(kt="e")}if(kt=="e"){if((Oe+=1)<Je)return se(ie,K,ge,Oe)}else if(Ze.rel=="preload"&&Ze.as=="style")return Ze.rel="stylesheet";K(ie,kt,ct.defaultPrevented)},lt(ie,Ze)!==!1&&Re.head.appendChild(Ze)}function fe(ie,K,ge){var Oe,He,Ze=(ie=ie.push?ie:[ie]).length,Re=Ze,rt=[];for(Oe=function(Je,lt,ft){if(lt=="e"&&rt.push(Je),lt=="b"){if(!ft)return;rt.push(Je)}--Ze||K(rt)},He=0;He<Re;He++)se(ie[He],Oe,ge)}function xe(ie,K,ge){var Oe,He;if(K&&K.trim&&(Oe=K),He=(Oe?ge:K)||{},Oe){if(Oe in C)throw"LoadJS";C[Oe]=!0}function Ze(Re,rt){fe(ie,function(Je){he(He,Je),Re&&he({success:Re,error:rt},Je),o(Oe,Je)},He)}if(He.returnPromise)return new Promise(Ze);Ze()}return xe.ready=function(ie,K){return T(ie,function(ge){he(K,ge)}),xe},xe.done=function(ie){o(ie,[])},xe.reset=function(){C={},E={},A={}},xe.isDefined=function(ie){return ie in C},xe}()});function Np(p){return new Promise((y,_)=>{Cb(p,{success:y,error:_})})}function Mb(p){return J.empty(p)?null:J.number(Number(p))?p:p.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:p}function Ib(p){const y=p.match(/^.*(vimeo.com\/|video\/)(\d+)(\?.*&*h=|\/)+([\d,a-f]+)/);return y&&y.length===5?y[4]:null}function wc(p){p&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===p&&(this.media.paused=!p,mt.call(this,this.media,p?"play":"pause"))}const bp={setup(){const p=this;Nt(p.elements.wrapper,p.config.classNames.embed,!0),p.options.speed=p.config.speed.options,Xo.call(p),J.object(window.Vimeo)?bp.ready.call(p):Np(p.config.urls.vimeo.sdk).then(()=>{bp.ready.call(p)}).catch(y=>{p.debug.warn("Vimeo SDK (player.js) failed to load",y)})},ready(){const p=this,y=p.config.vimeo,{premium:_,referrerPolicy:C,...E}=y;let A=p.media.getAttribute("src"),T="";J.empty(A)?(A=p.media.getAttribute(p.config.attributes.embed.id),T=p.media.getAttribute(p.config.attributes.embed.hash)):T=Ib(A);const o=T?{h:T}:{};_&&Object.assign(E,{controls:!1,sidedock:!1});const he=Hg({loop:p.config.loop.active,autoplay:p.autoplay,muted:p.muted,gesture:"media",playsinline:p.config.playsinline,...o,...E}),se=Mb(A),fe=pt("iframe"),xe=vp(p.config.urls.vimeo.iframe,se,he);if(fe.setAttribute("src",xe),fe.setAttribute("allowfullscreen",""),fe.setAttribute("allow",["autoplay","fullscreen","picture-in-picture","encrypted-media","accelerometer","gyroscope"].join("; ")),J.empty(C)||fe.setAttribute("referrerPolicy",C),_||!y.customControls)fe.setAttribute("data-poster",p.poster),p.media=Ah(fe,p.media);else{const Re=pt("div",{class:p.config.classNames.embedContainer,"data-poster":p.poster});Re.appendChild(fe),p.media=Ah(Re,p.media)}y.customControls||qc(vp(p.config.urls.vimeo.api,xe)).then(Re=>{!J.empty(Re)&&Re.thumbnail_url&&Zt.setPoster.call(p,Re.thumbnail_url).catch(()=>{})}),p.embed=new window.Vimeo.Player(fe,{autopause:p.config.autopause,muted:p.muted}),p.media.paused=!0,p.media.currentTime=0,p.supported.ui&&p.embed.disableTextTrack(),p.media.play=()=>(wc.call(p,!0),p.embed.play()),p.media.pause=()=>(wc.call(p,!1),p.embed.pause()),p.media.stop=()=>{p.pause(),p.currentTime=0};let{currentTime:ie}=p.media;Object.defineProperty(p.media,"currentTime",{get:()=>ie,set(Re){const{embed:rt,media:Je,paused:lt,volume:ft}=p,et=lt&&!rt.hasPlayed;Je.seeking=!0,mt.call(p,Je,"seeking"),Promise.resolve(et&&rt.setVolume(0)).then(()=>rt.setCurrentTime(Re)).then(()=>et&&rt.pause()).then(()=>et&&rt.setVolume(ft)).catch(()=>{})}});let K=p.config.speed.selected;Object.defineProperty(p.media,"playbackRate",{get:()=>K,set(Re){p.embed.setPlaybackRate(Re).then(()=>{K=Re,mt.call(p,p.media,"ratechange")}).catch(()=>{p.options.speed=[1]})}});let{volume:ge}=p.config;Object.defineProperty(p.media,"volume",{get:()=>ge,set(Re){p.embed.setVolume(Re).then(()=>{ge=Re,mt.call(p,p.media,"volumechange")})}});let{muted:Oe}=p.config;Object.defineProperty(p.media,"muted",{get:()=>Oe,set(Re){const rt=!!J.boolean(Re)&&Re;p.embed.setMuted(!!rt||p.config.muted).then(()=>{Oe=rt,mt.call(p,p.media,"volumechange")})}});let He,{loop:Ze}=p.config;Object.defineProperty(p.media,"loop",{get:()=>Ze,set(Re){const rt=J.boolean(Re)?Re:p.config.loop.active;p.embed.setLoop(rt).then(()=>{Ze=rt})}}),p.embed.getVideoUrl().then(Re=>{He=Re,Xe.setDownloadUrl.call(p)}).catch(Re=>{this.debug.warn(Re)}),Object.defineProperty(p.media,"currentSrc",{get:()=>He}),Object.defineProperty(p.media,"ended",{get:()=>p.currentTime===p.duration}),Promise.all([p.embed.getVideoWidth(),p.embed.getVideoHeight()]).then(Re=>{const[rt,Je]=Re;p.embed.ratio=Ug(rt,Je),Xo.call(this)}),p.embed.setAutopause(p.config.autopause).then(Re=>{p.config.autopause=Re}),p.embed.getVideoTitle().then(Re=>{p.config.title=Re,Zt.setTitle.call(this)}),p.embed.getCurrentTime().then(Re=>{ie=Re,mt.call(p,p.media,"timeupdate")}),p.embed.getDuration().then(Re=>{p.media.duration=Re,mt.call(p,p.media,"durationchange")}),p.embed.getTextTracks().then(Re=>{p.media.textTracks=Re,Dt.setup.call(p)}),p.embed.on("cuechange",({cues:Re=[]})=>{const rt=Re.map(Je=>yb(Je.text));Dt.updateCues.call(p,rt)}),p.embed.on("loaded",()=>{p.embed.getPaused().then(Re=>{wc.call(p,!Re),Re||mt.call(p,p.media,"playing")}),J.element(p.embed.element)&&p.supported.ui&&p.embed.element.setAttribute("tabindex",-1)}),p.embed.on("bufferstart",()=>{mt.call(p,p.media,"waiting")}),p.embed.on("bufferend",()=>{mt.call(p,p.media,"playing")}),p.embed.on("play",()=>{wc.call(p,!0),mt.call(p,p.media,"playing")}),p.embed.on("pause",()=>{wc.call(p,!1)}),p.embed.on("timeupdate",Re=>{p.media.seeking=!1,ie=Re.seconds,mt.call(p,p.media,"timeupdate")}),p.embed.on("progress",Re=>{p.media.buffered=Re.percent,mt.call(p,p.media,"progress"),parseInt(Re.percent,10)===1&&mt.call(p,p.media,"canplaythrough"),p.embed.getDuration().then(rt=>{rt!==p.media.duration&&(p.media.duration=rt,mt.call(p,p.media,"durationchange"))})}),p.embed.on("seeked",()=>{p.media.seeking=!1,mt.call(p,p.media,"seeked")}),p.embed.on("ended",()=>{p.media.paused=!0,mt.call(p,p.media,"ended")}),p.embed.on("error",Re=>{p.media.error=Re,mt.call(p,p.media,"error")}),y.customControls&&setTimeout(()=>Zt.build.call(p),0)}};function Eb(p){return J.empty(p)?null:p.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/)?RegExp.$2:p}function Tc(p){p&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===p&&(this.media.paused=!p,mt.call(this,this.media,p?"play":"pause"))}function kb(p){return p.noCookie?"https://www.youtube-nocookie.com":window.location.protocol==="http:"?"http://www.youtube.com":void 0}const xh={setup(){if(Nt(this.elements.wrapper,this.config.classNames.embed,!0),J.object(window.YT)&&J.function(window.YT.Player))xh.ready.call(this);else{const p=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=()=>{J.function(p)&&p(),xh.ready.call(this)},Np(this.config.urls.youtube.sdk).catch(y=>{this.debug.warn("YouTube API failed to load",y)})}},getTitle(p){qc(vp(this.config.urls.youtube.api,p)).then(y=>{if(J.object(y)){const{title:_,height:C,width:E}=y;this.config.title=_,Zt.setTitle.call(this),this.embed.ratio=Ug(E,C)}Xo.call(this)}).catch(()=>{Xo.call(this)})},ready(){const p=this,y=p.config.youtube,_=p.media&&p.media.getAttribute("id");if(!J.empty(_)&&_.startsWith("youtube-"))return;let C=p.media.getAttribute("src");J.empty(C)&&(C=p.media.getAttribute(this.config.attributes.embed.id));const E=Eb(C),A=pt("div",{id:fb(p.provider),"data-poster":y.customControls?p.poster:void 0});if(p.media=Ah(A,p.media),y.customControls){const T=o=>`https://i.ytimg.com/vi/${E}/${o}default.jpg`;bh(T("maxres"),121).catch(()=>bh(T("sd"),121)).catch(()=>bh(T("hq"))).then(o=>Zt.setPoster.call(p,o.src)).then(o=>{o.includes("maxres")||(p.elements.poster.style.backgroundSize="cover")}).catch(()=>{})}p.embed=new window.YT.Player(p.media,{videoId:E,host:kb(y),playerVars:Ti({},{autoplay:p.config.autoplay?1:0,hl:p.config.hl,controls:p.supported.ui&&y.customControls?0:1,disablekb:1,playsinline:p.config.playsinline&&!p.config.fullscreen.iosNative?1:0,cc_load_policy:p.captions.active?1:0,cc_lang_pref:p.config.captions.language,widget_referrer:window?window.location.href:null},y),events:{onError(T){if(!p.media.error){const o=T.data,he={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[o]||"An unknown error occurred";p.media.error={code:o,message:he},mt.call(p,p.media,"error")}},onPlaybackRateChange(T){const o=T.target;p.media.playbackRate=o.getPlaybackRate(),mt.call(p,p.media,"ratechange")},onReady(T){if(J.function(p.media.play))return;const o=T.target;xh.getTitle.call(p,E),p.media.play=()=>{Tc.call(p,!0),o.playVideo()},p.media.pause=()=>{Tc.call(p,!1),o.pauseVideo()},p.media.stop=()=>{o.stopVideo()},p.media.duration=o.getDuration(),p.media.paused=!0,p.media.currentTime=0,Object.defineProperty(p.media,"currentTime",{get:()=>Number(o.getCurrentTime()),set(xe){p.paused&&!p.embed.hasPlayed&&p.embed.mute(),p.media.seeking=!0,mt.call(p,p.media,"seeking"),o.seekTo(xe)}}),Object.defineProperty(p.media,"playbackRate",{get:()=>o.getPlaybackRate(),set(xe){o.setPlaybackRate(xe)}});let{volume:he}=p.config;Object.defineProperty(p.media,"volume",{get:()=>he,set(xe){he=xe,o.setVolume(100*he),mt.call(p,p.media,"volumechange")}});let{muted:se}=p.config;Object.defineProperty(p.media,"muted",{get:()=>se,set(xe){const ie=J.boolean(xe)?xe:se;se=ie,o[ie?"mute":"unMute"](),o.setVolume(100*he),mt.call(p,p.media,"volumechange")}}),Object.defineProperty(p.media,"currentSrc",{get:()=>o.getVideoUrl()}),Object.defineProperty(p.media,"ended",{get:()=>p.currentTime===p.duration});const fe=o.getAvailablePlaybackRates();p.options.speed=fe.filter(xe=>p.config.speed.options.includes(xe)),p.supported.ui&&y.customControls&&p.media.setAttribute("tabindex",-1),mt.call(p,p.media,"timeupdate"),mt.call(p,p.media,"durationchange"),clearInterval(p.timers.buffering),p.timers.buffering=setInterval(()=>{p.media.buffered=o.getVideoLoadedFraction(),(p.media.lastBuffered===null||p.media.lastBuffered<p.media.buffered)&&mt.call(p,p.media,"progress"),p.media.lastBuffered=p.media.buffered,p.media.buffered===1&&(clearInterval(p.timers.buffering),mt.call(p,p.media,"canplaythrough"))},200),y.customControls&&setTimeout(()=>Zt.build.call(p),50)},onStateChange(T){const o=T.target;switch(clearInterval(p.timers.playing),p.media.seeking&&[1,2].includes(T.data)&&(p.media.seeking=!1,mt.call(p,p.media,"seeked")),T.data){case-1:mt.call(p,p.media,"timeupdate"),p.media.buffered=o.getVideoLoadedFraction(),mt.call(p,p.media,"progress");break;case 0:Tc.call(p,!1),p.media.loop?(o.stopVideo(),o.playVideo()):mt.call(p,p.media,"ended");break;case 1:y.customControls&&!p.config.autoplay&&p.media.paused&&!p.embed.hasPlayed?p.media.pause():(Tc.call(p,!0),mt.call(p,p.media,"playing"),p.timers.playing=setInterval(()=>{mt.call(p,p.media,"timeupdate")},50),p.media.duration!==o.getDuration()&&(p.media.duration=o.getDuration(),mt.call(p,p.media,"durationchange")));break;case 2:p.muted||p.embed.unMute(),Tc.call(p,!1);break;case 3:mt.call(p,p.media,"waiting")}mt.call(p,p.elements.container,"statechange",!1,{code:T.data})}}})}},Xg={setup(){this.media?(Nt(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),Nt(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&Nt(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=pt("div",{class:this.config.classNames.video}),Og(this.media,this.elements.wrapper),this.elements.poster=pt("div",{class:this.config.classNames.poster}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?Ys.setup.call(this):this.isYouTube?xh.setup.call(this):this.isVimeo&&bp.setup.call(this)):this.debug.warn("No media element found!")}};class Ab{constructor(y){Qe(this,"load",()=>{this.enabled&&(J.object(window.google)&&J.object(window.google.ima)?this.ready():Np(this.player.config.urls.googleIMA.sdk).then(()=>{this.ready()}).catch(()=>{this.trigger("error",new Error("Google IMA SDK failed to load"))}))}),Qe(this,"ready",()=>{var _;this.enabled||((_=this).manager&&_.manager.destroy(),_.elements.displayContainer&&_.elements.displayContainer.destroy(),_.elements.container.remove()),this.startSafetyTimer(12e3,"ready()"),this.managerPromise.then(()=>{this.clearSafetyTimer("onAdsManagerLoaded()")}),this.listeners(),this.setupIMA()}),Qe(this,"setupIMA",()=>{this.elements.container=pt("div",{class:this.player.config.classNames.ads}),this.player.elements.container.appendChild(this.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(this.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playsinline),this.elements.displayContainer=new google.ima.AdDisplayContainer(this.elements.container,this.player.media),this.loader=new google.ima.AdsLoader(this.elements.displayContainer),this.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,_=>this.onAdsManagerLoaded(_),!1),this.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,_=>this.onAdError(_),!1),this.requestAds()}),Qe(this,"requestAds",()=>{const{container:_}=this.player.elements;try{const C=new google.ima.AdsRequest;C.adTagUrl=this.tagUrl,C.linearAdSlotWidth=_.offsetWidth,C.linearAdSlotHeight=_.offsetHeight,C.nonLinearAdSlotWidth=_.offsetWidth,C.nonLinearAdSlotHeight=_.offsetHeight,C.forceNonLinearFullSlot=!1,C.setAdWillPlayMuted(!this.player.muted),this.loader.requestAds(C)}catch(C){this.onAdError(C)}}),Qe(this,"pollCountdown",(_=!1)=>{if(!_)return clearInterval(this.countdownTimer),void this.elements.container.removeAttribute("data-badge-text");this.countdownTimer=setInterval(()=>{const C=Gh(Math.max(this.manager.getRemainingTime(),0)),E=`${Zi.get("advertisement",this.player.config)} - ${C}`;this.elements.container.setAttribute("data-badge-text",E)},100)}),Qe(this,"onAdsManagerLoaded",_=>{if(!this.enabled)return;const C=new google.ima.AdsRenderingSettings;C.restoreCustomPlaybackStateOnAdBreakComplete=!0,C.enablePreloading=!0,this.manager=_.getAdsManager(this.player,C),this.cuePoints=this.manager.getCuePoints(),this.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,E=>this.onAdError(E)),Object.keys(google.ima.AdEvent.Type).forEach(E=>{this.manager.addEventListener(google.ima.AdEvent.Type[E],A=>this.onAdEvent(A))}),this.trigger("loaded")}),Qe(this,"addCuePoints",()=>{J.empty(this.cuePoints)||this.cuePoints.forEach(_=>{if(_!==0&&_!==-1&&_<this.player.duration){const C=this.player.elements.progress;if(J.element(C)){const E=100/this.player.duration*_,A=pt("span",{class:this.player.config.classNames.cues});A.style.left=`${E.toString()}%`,C.appendChild(A)}}})}),Qe(this,"onAdEvent",_=>{const{container:C}=this.player.elements,E=_.getAd(),A=_.getAdData();switch((T=>{mt.call(this.player,this.player.media,`ads${T.replace(/_/g,"").toLowerCase()}`)})(_.type),_.type){case google.ima.AdEvent.Type.LOADED:this.trigger("loaded"),this.pollCountdown(!0),E.isLinear()||(E.width=C.offsetWidth,E.height=C.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:this.manager.setVolume(this.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:this.player.ended?this.loadAds():this.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:this.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:this.pollCountdown(),this.resumeContent();break;case google.ima.AdEvent.Type.LOG:A.adError&&this.player.debug.warn(`Non-fatal ad error: ${A.adError.getMessage()}`)}}),Qe(this,"onAdError",_=>{this.cancel(),this.player.debug.warn("Ads error",_)}),Qe(this,"listeners",()=>{const{container:_}=this.player.elements;let C;this.player.on("canplay",()=>{this.addCuePoints()}),this.player.on("ended",()=>{this.loader.contentComplete()}),this.player.on("timeupdate",()=>{C=this.player.currentTime}),this.player.on("seeked",()=>{const E=this.player.currentTime;J.empty(this.cuePoints)||this.cuePoints.forEach((A,T)=>{C<A&&A<E&&(this.manager.discardAdBreak(),this.cuePoints.splice(T,1))})}),window.addEventListener("resize",()=>{this.manager&&this.manager.resize(_.offsetWidth,_.offsetHeight,google.ima.ViewMode.NORMAL)})}),Qe(this,"play",()=>{const{container:_}=this.player.elements;this.managerPromise||this.resumeContent(),this.managerPromise.then(()=>{this.manager.setVolume(this.player.volume),this.elements.displayContainer.initialize();try{this.initialized||(this.manager.init(_.offsetWidth,_.offsetHeight,google.ima.ViewMode.NORMAL),this.manager.start()),this.initialized=!0}catch(C){this.onAdError(C)}}).catch(()=>{})}),Qe(this,"resumeContent",()=>{this.elements.container.style.zIndex="",this.playing=!1,kn(this.player.media.play())}),Qe(this,"pauseContent",()=>{this.elements.container.style.zIndex=3,this.playing=!0,this.player.media.pause()}),Qe(this,"cancel",()=>{this.initialized&&this.resumeContent(),this.trigger("error"),this.loadAds()}),Qe(this,"loadAds",()=>{this.managerPromise.then(()=>{this.manager&&this.manager.destroy(),this.managerPromise=new Promise(_=>{this.on("loaded",_),this.player.debug.log(this.manager)}),this.initialized=!1,this.requestAds()}).catch(()=>{})}),Qe(this,"trigger",(_,...C)=>{const E=this.events[_];J.array(E)&&E.forEach(A=>{J.function(A)&&A.apply(this,C)})}),Qe(this,"on",(_,C)=>(J.array(this.events[_])||(this.events[_]=[]),this.events[_].push(C),this)),Qe(this,"startSafetyTimer",(_,C)=>{this.player.debug.log(`Safety timer invoked from: ${C}`),this.safetyTimer=setTimeout(()=>{this.cancel(),this.clearSafetyTimer("startSafetyTimer()")},_)}),Qe(this,"clearSafetyTimer",_=>{J.nullOrUndefined(this.safetyTimer)||(this.player.debug.log(`Safety timer cleared from: ${_}`),clearTimeout(this.safetyTimer),this.safetyTimer=null)}),this.player=y,this.config=y.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise((_,C)=>{this.on("loaded",_),this.on("error",C)}),this.load()}get enabled(){const{config:y}=this;return this.player.isHTML5&&this.player.isVideo&&y.enabled&&(!J.empty(y.publisherId)||J.url(y.tagUrl))}get tagUrl(){const{config:y}=this;return J.url(y.tagUrl)?y.tagUrl:`https://go.aniview.com/api/adserver6/vast/?${Hg({AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:y.publisherId})}`}}function Kg(p=0,y=0,_=255){return Math.min(Math.max(p,y),_)}const zb=p=>{const y=[];return p.split(/\r\n\r\n|\n\n|\r\r/).forEach(_=>{const C={};_.split(/\r\n|\n|\r/).forEach(E=>{if(J.number(C.startTime)){if(!J.empty(E.trim())&&J.empty(C.text)){const A=E.trim().split("#xywh=");[C.text]=A,A[1]&&([C.x,C.y,C.w,C.h]=A[1].split(","))}}else{const A=E.match(/([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/);A&&(C.startTime=60*Number(A[1]||0)*60+60*Number(A[2])+Number(A[3])+ +`0.${A[4]}`,C.endTime=60*Number(A[6]||0)*60+60*Number(A[7])+Number(A[8])+ +`0.${A[9]}`)}}),C.text&&y.push(C)}),y},qm=(p,y)=>{const _={};return p>y.width/y.height?(_.width=y.width,_.height=1/p*y.width):(_.height=y.height,_.width=p*y.height),_};class xp{constructor(y){Qe(this,"load",()=>{this.player.elements.display.seekTooltip&&(this.player.elements.display.seekTooltip.hidden=this.enabled),this.enabled&&this.getThumbnails().then(()=>{this.enabled&&(this.render(),this.determineContainerAutoSizing(),this.listeners(),this.loaded=!0)})}),Qe(this,"getThumbnails",()=>new Promise(_=>{const{src:C}=this.player.config.previewThumbnails;if(J.empty(C))throw new Error("Missing previewThumbnails.src config attribute");const E=()=>{this.thumbnails.sort((A,T)=>A.height-T.height),this.player.debug.log("Preview thumbnails",this.thumbnails),_()};if(J.function(C))C(A=>{this.thumbnails=A,E()});else{const A=(J.string(C)?[C]:C).map(T=>this.getThumbnail(T));Promise.all(A).then(E)}})),Qe(this,"getThumbnail",_=>new Promise(C=>{qc(_).then(E=>{const A={frames:zb(E),height:null,urlPrefix:""};A.frames[0].text.startsWith("/")||A.frames[0].text.startsWith("http://")||A.frames[0].text.startsWith("https://")||(A.urlPrefix=_.substring(0,_.lastIndexOf("/")+1));const T=new Image;T.onload=()=>{A.height=T.naturalHeight,A.width=T.naturalWidth,this.thumbnails.push(A),C()},T.src=A.urlPrefix+A.frames[0].text})})),Qe(this,"startMove",_=>{if(this.loaded&&J.event(_)&&["touchmove","mousemove"].includes(_.type)&&this.player.media.duration){if(_.type==="touchmove")this.seekTime=this.player.media.duration*(this.player.elements.inputs.seek.value/100);else{var C,E;const A=this.player.elements.progress.getBoundingClientRect(),T=100/A.width*(_.pageX-A.left);this.seekTime=this.player.media.duration*(T/100),this.seekTime<0&&(this.seekTime=0),this.seekTime>this.player.media.duration-1&&(this.seekTime=this.player.media.duration-1),this.mousePosX=_.pageX,this.elements.thumb.time.innerText=Gh(this.seekTime);const o=(C=this.player.config.markers)===null||C===void 0||(E=C.points)===null||E===void 0?void 0:E.find(({time:he})=>he===Math.round(this.seekTime));o&&this.elements.thumb.time.insertAdjacentHTML("afterbegin",`${o.label}<br>`)}this.showImageAtCurrentTime()}}),Qe(this,"endMove",()=>{this.toggleThumbContainer(!1,!0)}),Qe(this,"startScrubbing",_=>{(J.nullOrUndefined(_.button)||_.button===!1||_.button===0)&&(this.mouseDown=!0,this.player.media.duration&&(this.toggleScrubbingContainer(!0),this.toggleThumbContainer(!1,!0),this.showImageAtCurrentTime()))}),Qe(this,"endScrubbing",()=>{this.mouseDown=!1,Math.ceil(this.lastTime)===Math.ceil(this.player.media.currentTime)?this.toggleScrubbingContainer(!1):Op.call(this.player,this.player.media,"timeupdate",()=>{this.mouseDown||this.toggleScrubbingContainer(!1)})}),Qe(this,"listeners",()=>{this.player.on("play",()=>{this.toggleThumbContainer(!1,!0)}),this.player.on("seeked",()=>{this.toggleThumbContainer(!1)}),this.player.on("timeupdate",()=>{this.lastTime=this.player.media.currentTime})}),Qe(this,"render",()=>{this.elements.thumb.container=pt("div",{class:this.player.config.classNames.previewThumbnails.thumbContainer}),this.elements.thumb.imageContainer=pt("div",{class:this.player.config.classNames.previewThumbnails.imageContainer}),this.elements.thumb.container.appendChild(this.elements.thumb.imageContainer);const _=pt("div",{class:this.player.config.classNames.previewThumbnails.timeContainer});this.elements.thumb.time=pt("span",{},"00:00"),_.appendChild(this.elements.thumb.time),this.elements.thumb.imageContainer.appendChild(_),J.element(this.player.elements.progress)&&this.player.elements.progress.appendChild(this.elements.thumb.container),this.elements.scrubbing.container=pt("div",{class:this.player.config.classNames.previewThumbnails.scrubbingContainer}),this.player.elements.wrapper.appendChild(this.elements.scrubbing.container)}),Qe(this,"destroy",()=>{this.elements.thumb.container&&this.elements.thumb.container.remove(),this.elements.scrubbing.container&&this.elements.scrubbing.container.remove()}),Qe(this,"showImageAtCurrentTime",()=>{this.mouseDown?this.setScrubbingContainerSize():this.setThumbContainerSizeAndPos();const _=this.thumbnails[0].frames.findIndex(A=>this.seekTime>=A.startTime&&this.seekTime<=A.endTime),C=_>=0;let E=0;this.mouseDown||this.toggleThumbContainer(C),C&&(this.thumbnails.forEach((A,T)=>{this.loadedImages.includes(A.frames[_].text)&&(E=T)}),_!==this.showingThumb&&(this.showingThumb=_,this.loadImage(E)))}),Qe(this,"loadImage",(_=0)=>{const C=this.showingThumb,E=this.thumbnails[_],{urlPrefix:A}=E,T=E.frames[C],o=E.frames[C].text,he=A+o;if(this.currentImageElement&&this.currentImageElement.dataset.filename===o)this.showImage(this.currentImageElement,T,_,C,o,!1),this.currentImageElement.dataset.index=C,this.removeOldImages(this.currentImageElement);else{this.loadingImage&&this.usingSprites&&(this.loadingImage.onload=null);const se=new Image;se.src=he,se.dataset.index=C,se.dataset.filename=o,this.showingThumbFilename=o,this.player.debug.log(`Loading image: ${he}`),se.onload=()=>this.showImage(se,T,_,C,o,!0),this.loadingImage=se,this.removeOldImages(se)}}),Qe(this,"showImage",(_,C,E,A,T,o=!0)=>{this.player.debug.log(`Showing thumb: ${T}. num: ${A}. qual: ${E}. newimg: ${o}`),this.setImageSizeAndOffset(_,C),o&&(this.currentImageContainer.appendChild(_),this.currentImageElement=_,this.loadedImages.includes(T)||this.loadedImages.push(T)),this.preloadNearby(A,!0).then(this.preloadNearby(A,!1)).then(this.getHigherQuality(E,_,C,T))}),Qe(this,"removeOldImages",_=>{Array.from(this.currentImageContainer.children).forEach(C=>{if(C.tagName.toLowerCase()!=="img")return;const E=this.usingSprites?500:1e3;if(C.dataset.index!==_.dataset.index&&!C.dataset.deleting){C.dataset.deleting=!0;const{currentImageContainer:A}=this;setTimeout(()=>{A.removeChild(C),this.player.debug.log(`Removing thumb: ${C.dataset.filename}`)},E)}})}),Qe(this,"preloadNearby",(_,C=!0)=>new Promise(E=>{setTimeout(()=>{const A=this.thumbnails[0].frames[_].text;if(this.showingThumbFilename===A){let T;T=C?this.thumbnails[0].frames.slice(_):this.thumbnails[0].frames.slice(0,_).reverse();let o=!1;T.forEach(he=>{const se=he.text;if(se!==A&&!this.loadedImages.includes(se)){o=!0,this.player.debug.log(`Preloading thumb filename: ${se}`);const{urlPrefix:fe}=this.thumbnails[0],xe=fe+se,ie=new Image;ie.src=xe,ie.onload=()=>{this.player.debug.log(`Preloaded thumb filename: ${se}`),this.loadedImages.includes(se)||this.loadedImages.push(se),E()}}}),o||E()}},300)})),Qe(this,"getHigherQuality",(_,C,E,A)=>{if(_<this.thumbnails.length-1){let T=C.naturalHeight;this.usingSprites&&(T=E.h),T<this.thumbContainerHeight&&setTimeout(()=>{this.showingThumbFilename===A&&(this.player.debug.log(`Showing higher quality thumb for: ${A}`),this.loadImage(_+1))},300)}}),Qe(this,"toggleThumbContainer",(_=!1,C=!1)=>{const E=this.player.config.classNames.previewThumbnails.thumbContainerShown;this.elements.thumb.container.classList.toggle(E,_),!_&&C&&(this.showingThumb=null,this.showingThumbFilename=null)}),Qe(this,"toggleScrubbingContainer",(_=!1)=>{const C=this.player.config.classNames.previewThumbnails.scrubbingContainerShown;this.elements.scrubbing.container.classList.toggle(C,_),_||(this.showingThumb=null,this.showingThumbFilename=null)}),Qe(this,"determineContainerAutoSizing",()=>{(this.elements.thumb.imageContainer.clientHeight>20||this.elements.thumb.imageContainer.clientWidth>20)&&(this.sizeSpecifiedInCSS=!0)}),Qe(this,"setThumbContainerSizeAndPos",()=>{const{imageContainer:_}=this.elements.thumb;if(this.sizeSpecifiedInCSS){if(_.clientHeight>20&&_.clientWidth<20){const C=Math.floor(_.clientHeight*this.thumbAspectRatio);_.style.width=`${C}px`}else if(_.clientHeight<20&&_.clientWidth>20){const C=Math.floor(_.clientWidth/this.thumbAspectRatio);_.style.height=`${C}px`}}else{const C=Math.floor(this.thumbContainerHeight*this.thumbAspectRatio);_.style.height=`${this.thumbContainerHeight}px`,_.style.width=`${C}px`}this.setThumbContainerPos()}),Qe(this,"setThumbContainerPos",()=>{const _=this.player.elements.progress.getBoundingClientRect(),C=this.player.elements.container.getBoundingClientRect(),{container:E}=this.elements.thumb,A=C.left-_.left+10,T=C.right-_.left-E.clientWidth-10,o=this.mousePosX-_.left-E.clientWidth/2,he=Kg(o,A,T);E.style.left=`${he}px`,E.style.setProperty("--preview-arrow-offset",o-he+"px")}),Qe(this,"setScrubbingContainerSize",()=>{const{width:_,height:C}=qm(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});this.elements.scrubbing.container.style.width=`${_}px`,this.elements.scrubbing.container.style.height=`${C}px`}),Qe(this,"setImageSizeAndOffset",(_,C)=>{if(!this.usingSprites)return;const E=this.thumbContainerHeight/C.h;_.style.height=_.naturalHeight*E+"px",_.style.width=_.naturalWidth*E+"px",_.style.left=`-${C.x*E}px`,_.style.top=`-${C.y*E}px`}),this.player=y,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}get enabled(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}get currentImageContainer(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}get usingSprites(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}get thumbAspectRatio(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}get thumbContainerHeight(){if(this.mouseDown){const{height:y}=qm(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight});return y}return this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}get currentImageElement(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement}set currentImageElement(y){this.mouseDown?this.currentScrubbingImageElement=y:this.currentThumbnailImageElement=y}}const wp={insertElements(p,y){J.string(y)?Nm(p,this.media,{src:y}):J.array(y)&&y.forEach(_=>{Nm(p,this.media,_)})},change(p){Bg(p,"sources.length")?(Ys.cancelRequests.call(this),this.destroy.call(this,()=>{this.options.quality=[],ps(this.media),this.media=null,J.element(this.elements.container)&&this.elements.container.removeAttribute("class");const{sources:y,type:_}=p,[{provider:C=Xs.html5,src:E}]=y,A=C==="html5"?_:"div",T=C==="html5"?{}:{src:E};Object.assign(this,{provider:C,type:_,supported:Pi.check(_,C,this.config.playsinline),media:pt(A,T)}),this.elements.container.appendChild(this.media),J.boolean(p.autoplay)&&(this.config.autoplay=p.autoplay),this.isHTML5&&(this.config.crossorigin&&this.media.setAttribute("crossorigin",""),this.config.autoplay&&this.media.setAttribute("autoplay",""),J.empty(p.poster)||(this.poster=p.poster),this.config.loop.active&&this.media.setAttribute("loop",""),this.config.muted&&this.media.setAttribute("muted",""),this.config.playsinline&&this.media.setAttribute("playsinline","")),Zt.addStyleHook.call(this),this.isHTML5&&wp.insertElements.call(this,"source",y),this.config.title=p.title,Xg.setup.call(this),this.isHTML5&&Object.keys(p).includes("tracks")&&wp.insertElements.call(this,"track",p.tracks),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&Zt.build.call(this),this.isHTML5&&this.media.load(),J.empty(p.previewThumbnails)||(Object.assign(this.config.previewThumbnails,p.previewThumbnails),this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new xp(this))),this.fullscreen.update()},!0)):this.debug.warn("Invalid source format")}};class Fc{constructor(y,_){if(Qe(this,"play",()=>J.function(this.media.play)?(this.ads&&this.ads.enabled&&this.ads.managerPromise.then(()=>this.ads.play()).catch(()=>kn(this.media.play())),this.media.play()):null),Qe(this,"pause",()=>this.playing&&J.function(this.media.pause)?this.media.pause():null),Qe(this,"togglePlay",o=>(J.boolean(o)?o:!this.playing)?this.play():this.pause()),Qe(this,"stop",()=>{this.isHTML5?(this.pause(),this.restart()):J.function(this.media.stop)&&this.media.stop()}),Qe(this,"restart",()=>{this.currentTime=0}),Qe(this,"rewind",o=>{this.currentTime-=J.number(o)?o:this.config.seekTime}),Qe(this,"forward",o=>{this.currentTime+=J.number(o)?o:this.config.seekTime}),Qe(this,"increaseVolume",o=>{const he=this.media.muted?0:this.volume;this.volume=he+(J.number(o)?o:0)}),Qe(this,"decreaseVolume",o=>{this.increaseVolume(-o)}),Qe(this,"airplay",()=>{Pi.airplay&&this.media.webkitShowPlaybackTargetPicker()}),Qe(this,"toggleControls",o=>{if(this.supported.ui&&!this.isAudio){const he=zh(this.elements.container,this.config.classNames.hideControls),se=o===void 0?void 0:!o,fe=Nt(this.elements.container,this.config.classNames.hideControls,se);if(fe&&J.array(this.config.controls)&&this.config.controls.includes("settings")&&!J.empty(this.config.settings)&&Xe.toggleMenu.call(this,!1),fe!==he){const xe=fe?"controlshidden":"controlsshown";mt.call(this,this.media,xe)}return!fe}return!1}),Qe(this,"on",(o,he)=>{At.call(this,this.elements.container,o,he)}),Qe(this,"once",(o,he)=>{Op.call(this,this.elements.container,o,he)}),Qe(this,"off",(o,he)=>{Zh(this.elements.container,o,he)}),Qe(this,"destroy",(o,he=!1)=>{if(!this.ready)return;const se=()=>{document.body.style.overflow="",this.embed=null,he?(Object.keys(this.elements).length&&(ps(this.elements.buttons.play),ps(this.elements.captions),ps(this.elements.controls),ps(this.elements.wrapper),this.elements.buttons.play=null,this.elements.captions=null,this.elements.controls=null,this.elements.wrapper=null),J.function(o)&&o()):(hb.call(this),Ys.cancelRequests.call(this),Ah(this.elements.original,this.elements.container),mt.call(this,this.elements.original,"destroyed",!0),J.function(o)&&o.call(this.elements.original),this.ready=!1,setTimeout(()=>{this.elements=null,this.media=null},200))};this.stop(),clearTimeout(this.timers.loading),clearTimeout(this.timers.controls),clearTimeout(this.timers.resized),this.isHTML5?(Zt.toggleNativeControls.call(this,!0),se()):this.isYouTube?(clearInterval(this.timers.buffering),clearInterval(this.timers.playing),this.embed!==null&&J.function(this.embed.destroy)&&this.embed.destroy(),se()):this.isVimeo&&(this.embed!==null&&this.embed.unload().then(se),setTimeout(se,200))}),Qe(this,"supports",o=>Pi.mime.call(this,o)),this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=Pi.touch,this.media=y,J.string(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||J.nodeList(this.media)||J.array(this.media))&&(this.media=this.media[0]),this.config=Ti({},Wg,Fc.defaults,_||{},(()=>{try{return JSON.parse(this.media.getAttribute("data-plyr-config"))}catch{return{}}})()),this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new Tb(this.config.debug),this.debug.log("Config",this.config),this.debug.log("Support",Pi),J.nullOrUndefined(this.media)||!J.element(this.media))return void this.debug.error("Setup failed: no suitable element passed");if(this.media.plyr)return void this.debug.warn("Target already setup");if(!this.config.enabled)return void this.debug.error("Setup failed: disabled by config");if(!Pi.check().api)return void this.debug.error("Setup failed: no support");const C=this.media.cloneNode(!0);C.autoplay=!1,this.elements.original=C;const E=this.media.tagName.toLowerCase();let A=null,T=null;switch(E){case"div":if(A=this.media.querySelector("iframe"),J.element(A)){if(T=Gg(A.getAttribute("src")),this.provider=wb(T.toString()),this.elements.container=this.media,this.media=A,this.elements.container.className="",T.search.length){const o=["1","true"];o.includes(T.searchParams.get("autoplay"))&&(this.config.autoplay=!0),o.includes(T.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=o.includes(T.searchParams.get("playsinline")),this.config.youtube.hl=T.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(J.empty(this.provider)||!Object.values(Xs).includes(this.provider))return void this.debug.error("Setup failed: Invalid provider");this.type=ap.video;break;case"video":case"audio":this.type=E,this.provider=Xs.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:return void this.debug.error("Setup failed: unsupported type")}this.supported=Pi.check(this.type,this.provider),this.supported.api?(this.eventListeners=[],this.listeners=new Pb(this),this.storage=new Rc(this),this.media.plyr=this,J.element(this.elements.container)||(this.elements.container=pt("div"),Og(this.media,this.elements.container)),Zt.migrateStyles.call(this),Zt.addStyleHook.call(this),Xg.setup.call(this),this.config.debug&&At.call(this,this.elements.container,this.config.events.join(" "),o=>{this.debug.log(`event: ${o.type}`)}),this.fullscreen=new dn(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&Zt.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new Ab(this)),this.isHTML5&&this.config.autoplay&&this.once("canplay",()=>kn(this.play())),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new xp(this))):this.debug.error("Setup failed: no support")}get isHTML5(){return this.provider===Xs.html5}get isEmbed(){return this.isYouTube||this.isVimeo}get isYouTube(){return this.provider===Xs.youtube}get isVimeo(){return this.provider===Xs.vimeo}get isVideo(){return this.type===ap.video}get isAudio(){return this.type===ap.audio}get playing(){return!!(this.ready&&!this.paused&&!this.ended)}get paused(){return!!this.media.paused}get stopped(){return!!(this.paused&&this.currentTime===0)}get ended(){return!!this.media.ended}set currentTime(y){if(!this.duration)return;const _=J.number(y)&&y>0;this.media.currentTime=_?Math.min(y,this.duration):0,this.debug.log(`Seeking to ${this.currentTime} seconds`)}get currentTime(){return Number(this.media.currentTime)}get buffered(){const{buffered:y}=this.media;return J.number(y)?y:y&&y.length&&this.duration>0?y.end(0)/this.duration:0}get seeking(){return!!this.media.seeking}get duration(){const y=parseFloat(this.config.duration),_=(this.media||{}).duration,C=J.number(_)&&_!==1/0?_:0;return y||C}set volume(y){let _=y;J.string(_)&&(_=Number(_)),J.number(_)||(_=this.storage.get("volume")),J.number(_)||({volume:_}=this.config),_>1&&(_=1),_<0&&(_=0),this.config.volume=_,this.media.volume=_,!J.empty(y)&&this.muted&&_>0&&(this.muted=!1)}get volume(){return Number(this.media.volume)}set muted(y){let _=y;J.boolean(_)||(_=this.storage.get("muted")),J.boolean(_)||(_=this.config.muted),this.config.muted=_,this.media.muted=_}get muted(){return!!this.media.muted}get hasAudio(){return!this.isHTML5||!!this.isAudio||!!this.media.mozHasAudio||!!this.media.webkitAudioDecodedByteCount||!!(this.media.audioTracks&&this.media.audioTracks.length)}set speed(y){let _=null;J.number(y)&&(_=y),J.number(_)||(_=this.storage.get("speed")),J.number(_)||(_=this.config.speed.selected);const{minimumSpeed:C,maximumSpeed:E}=this;_=Kg(_,C,E),this.config.speed.selected=_,setTimeout(()=>{this.media&&(this.media.playbackRate=_)},0)}get speed(){return Number(this.media.playbackRate)}get minimumSpeed(){return this.isYouTube?Math.min(...this.options.speed):this.isVimeo?.5:.0625}get maximumSpeed(){return this.isYouTube?Math.max(...this.options.speed):this.isVimeo?2:16}set quality(y){const _=this.config.quality,C=this.options.quality;if(!C.length)return;let E=[!J.empty(y)&&Number(y),this.storage.get("quality"),_.selected,_.default].find(J.number),A=!0;if(!C.includes(E)){const T=jg(C,E);this.debug.warn(`Unsupported quality option: ${E}, using ${T} instead`),E=T,A=!1}_.selected=E,this.media.quality=E,A&&this.storage.set({quality:E})}get quality(){return this.media.quality}set loop(y){const _=J.boolean(y)?y:this.config.loop.active;this.config.loop.active=_,this.media.loop=_}get loop(){return!!this.media.loop}set source(y){wp.change.call(this,y)}get source(){return this.media.currentSrc}get download(){const{download:y}=this.config.urls;return J.url(y)?y:this.source}set download(y){J.url(y)&&(this.config.urls.download=y,Xe.setDownloadUrl.call(this))}set poster(y){this.isVideo?Zt.setPoster.call(this,y,!1).catch(()=>{}):this.debug.warn("Poster can only be set for video")}get poster(){return this.isVideo?this.media.getAttribute("poster")||this.media.getAttribute("data-poster"):null}get ratio(){if(!this.isVideo)return null;const y=Dh(jp.call(this));return J.array(y)?y.join(":"):y}set ratio(y){this.isVideo?J.string(y)&&Vg(y)?(this.config.ratio=Dh(y),Xo.call(this)):this.debug.error(`Invalid aspect ratio specified (${y})`):this.debug.warn("Aspect ratio can only be set for video")}set autoplay(y){this.config.autoplay=J.boolean(y)?y:this.config.autoplay}get autoplay(){return!!this.config.autoplay}toggleCaptions(y){Dt.toggle.call(this,y,!1)}set currentTrack(y){Dt.set.call(this,y,!1),Dt.setup.call(this)}get currentTrack(){const{toggled:y,currentTrack:_}=this.captions;return y?_:-1}set language(y){Dt.setLanguage.call(this,y,!1)}get language(){return(Dt.getCurrentTrack.call(this)||{}).language}set pip(y){if(!Pi.pip)return;const _=J.boolean(y)?y:!this.pip;J.function(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(_?sp.active:sp.inactive),J.function(this.media.requestPictureInPicture)&&(!this.pip&&_?this.media.requestPictureInPicture():this.pip&&!_&&document.exitPictureInPicture())}get pip(){return Pi.pip?J.empty(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===sp.active:null}setPreviewThumbnails(y){this.previewThumbnails&&this.previewThumbnails.loaded&&(this.previewThumbnails.destroy(),this.previewThumbnails=null),Object.assign(this.config.previewThumbnails,y),this.config.previewThumbnails.enabled&&(this.previewThumbnails=new xp(this))}static supported(y,_){return Pi.check(y,_)}static loadSprite(y,_){return qg(y,_)}static setup(y,_={}){let C=null;return J.string(y)?C=Array.from(document.querySelectorAll(y)):J.nodeList(y)?C=Array.from(y):J.array(y)&&(C=y.filter(J.element)),J.empty(C)?null:C.map(E=>new Fc(E,_))}}Fc.defaults=ob(Wg);var Db=Ji('<video controls playsinline="" id="player" class="svelte-1umz190"></video>',2);function Lb(p,y){Jo(y,!0);let _=$h(y,"contentState",15),C=Ho(()=>_().currentVideo),E;Rp(()=>{E=new Fc("#player",{keyboard:{global:!0}}),E.on("playing",()=>{_(_().videoPlaying=!0,!0),_(_().videoBarVisible=!1,!0)}),E.on("pause",()=>{E.seeking||_(_().videoPlaying=!1,!0),_(_().videoBarVisible=!1,!0)})}),og(()=>{if(ht(C),ht(C)!=null)return E.source={type:"video",title:ht(C).title,poster:ht(C).thumbUrl,sources:[{src:ht(C).videoUrl,type:"video/mp4",size:360}]},()=>{setTimeout(()=>{E.stop()},300)}});var A=Db();Gi(p,A),Qo()}var Rb=(p,y)=>ht(y).videoBarVisible=!0,Fb=Ji('<div class="video-bar-wrapper svelte-1ufm73j"><!></div>'),Bb=Ji('<button class="sidebar-button svelte-1ufm73j" aria-label="Toggle sidebar"><i class="bi-chevron-double-right"></i></button> <button class="elements-button svelte-1ufm73j" aria-label="Toggle elements"><i class="bi-funnel-fill"></i></button> <div><!></div> <button><p>Другие даты</p> <i class="bi-chevron-up"></i></button> <div class="video-wrapper svelte-1ufm73j"><!></div> <!>',1);function Ob(p){let y=Sc(yr({mapExpanded:!0,videoBarVisible:!1,currentVideo:null,videoPlaying:!1})),_=Ho(()=>ht(y).mapExpanded?"map-wrapper_map-mode":"map-wrapper_video-mode");var C=Bb(),E=Yi(Ic(C),4),A=Si(E);_0(A,{get contentState(){return ht(y)},set contentState(xe){Ai(y,yr(xe))}});var T=Yi(E,2);T.__click=[Rb,y];var o=Yi(T,2),he=Si(o);Lb(he,{get contentState(){return ht(y)},set contentState(xe){Ai(y,yr(xe))}});var se=Yi(o,2);{var fe=xe=>{var ie=Fb(),K=Si(ie);M0(K,{get contentState(){return ht(y)},set contentState(ge){Ai(y,yr(ge))}}),fp(3,ie,()=>r0,()=>({y:200,duration:200})),Gi(xe,ie)};Lp(se,xe=>{ht(y).videoBarVisible&&xe(fe)})}Js(()=>{zc(E,`map-wrapper ${ht(_)??""} ${(ht(y).videoPlaying?"map-wrapper_video-playing":"")??""} svelte-1ufm73j`),zc(T,`other-dates-bttn ${(ht(y).videoPlaying?"other-dates-bttn_video-playing":"")??""} svelte-1ufm73j`)}),Gi(p,C)}Dp(["click"]);Qy();var jb=Ji('<button aria-label="Toggle" class="burger-button svelte-14wtj0v"><div class="burger-button__bar burger-button__bar-1 svelte-14wtj0v"></div> <div class="burger-button__bar burger-button__bar-2 svelte-14wtj0v"></div> <div class="burger-button__bar burger-button__bar-3 svelte-14wtj0v"></div></button>');function Nb(p){var y=jb();Gi(p,y)}var Vb=Ji('<button class="dropdown svelte-10re3sb"><p class="dropdown__label svelte-10re3sb"> </p> <i class="bi-caret-down-fill svelte-10re3sb"></i></button>');function fh(p,y){let _=$h(y,"label",3,"");var C=Vb(),E=Si(C),A=Si(E);Js(()=>kh(A,_())),Gi(p,C)}const Ub="/assets/logo-B1xLA_fw.png";var $b=Ji('<header class="header svelte-1d5nafy"><div class="header__left-section svelte-1d5nafy"><div class="header__burger-button-wrapper svelte-1d5nafy"><!></div> <img alt="Logo" class="header__logo svelte-1d5nafy"> <p class="header__text svelte-1d5nafy">Система управления проектной документацией проекта ВСМ-1</p></div> <div class="header__right-section svelte-1d5nafy"><!> <!> <!> <!></div></header>');function qb(p){var y=$b(),_=Si(y),C=Si(_),E=Si(C);Nb(E);var A=Yi(C,2);Cc(A,"src",Ub);var T=Yi(_,2),o=Si(T);fh(o,{label:"Объекты"});var he=Yi(o,2);fh(he,{label:"Регионы"});var se=Yi(he,2);fh(se,{label:"Этапы"});var fe=Yi(se,2);fh(fe,{label:"Слои"}),Gi(p,y)}const Tp=[{id:0,title:"Главная страница",url:"/"},{id:1,title:"Карта",url:"/"},{id:2,title:"Высокоскоростной электропоезд",url:"/"},{id:3,title:"Финансовая модель",url:"/"},{id:4,title:"Архив",url:"/"}];var Zb=Ji('<div class="navbar__separator svelte-t2sogs"></div>'),Gb=Ji('<li><a class="svelte-t2sogs"> </a></li> <!>',1),Hb=Ji('<nav class="navbar svelte-t2sogs"><ul class="navbar__list svelte-t2sogs"></ul></nav>');function Wb(p,y){Jo(y,!0);var _=Hb(),C=Si(_);pp(C,21,()=>Tp,Tg,(E,A,T)=>{var o=Gb(),he=Ic(o),se=Si(he),fe=Si(se),xe=Yi(he,2);{var ie=K=>{var ge=Zb();Gi(K,ge)};Lp(xe,K=>{var ge;((ge=Tp[T+1])==null?void 0:ge.id)!=y.currPage.id&&ht(A).id!=y.currPage.id&&K(ie)})}Js(()=>{zc(he,`navbar__item ${(ht(A).id==y.currPage.id?"navbar__item_selected":"")??""} svelte-t2sogs`),Cc(se,"href",ht(A).url),kh(fe,ht(A).title)}),Gi(E,o)}),Gi(p,_),Qo()}var Xb=Ji('<div class="page svelte-6h390h"><div class="navbar-wrapper svelte-6h390h"><!></div> <div class="header-wrapper svelte-6h390h"><!></div> <main class="content-wrapper svelte-6h390h"><!></main></div>');function Kb(p,y){Jo(y,!0);let _=yr(Tp[1]);var C=Xb();Rv(fe=>{Js(()=>eg.title=_.title)});var E=Si(C),A=Si(E);Wb(A,{get currPage(){return _}});var T=Yi(E,2),o=Si(T);qb(o);var he=Yi(T,2),se=Si(he);Ob(se),Gi(p,C),Qo()}Ov(Kb,{target:document.getElementById("app")});
